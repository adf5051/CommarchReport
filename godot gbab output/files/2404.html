<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359</pre></div></td><td class="code"><div class="highlight"><pre><span></span><a name="gbab-1"></a><span class="cp">#endif  </span><span class="cm">/* WEBP_WEBP_DEMUX_H_ */</span><span class="cp"></span>
<a name="gbab-2"></a><span class="c1">// Copyright 2012 Google Inc. All Rights Reserved.</span>
<a name="gbab-3"></a><span class="c1">//</span>
<a name="gbab-4"></a><span class="c1">// Use of this source code is governed by a BSD-style license</span>
<a name="gbab-5"></a><span class="c1">// that can be found in the COPYING file in the root of the source</span>
<a name="gbab-6"></a><span class="c1">// tree. An additional intellectual property rights grant can be found</span>
<a name="gbab-7"></a><span class="c1">// in the file PATENTS. All contributing project authors may</span>
<a name="gbab-8"></a><span class="c1">// be found in the AUTHORS file in the root of the source tree.</span>
<a name="gbab-9"></a><span class="c1">// -----------------------------------------------------------------------------</span>
<a name="gbab-10"></a><span class="c1">//</span>
<a name="gbab-11"></a><span class="c1">// Demux API.</span>
<a name="gbab-12"></a><span class="c1">// Enables extraction of image and extended format data from WebP files.</span>
<a name="gbab-13"></a>
<a name="gbab-14"></a><span class="c1">// Code Example: Demuxing WebP data to extract all the frames, ICC profile</span>
<a name="gbab-15"></a><span class="c1">// and EXIF/XMP metadata.</span>
<a name="gbab-16"></a><span class="cm">/*</span>
<a name="gbab-17"></a><span class="cm">  WebPDemuxer* demux = WebPDemux(&amp;webp_data);</span>
<a name="gbab-18"></a>
<a name="gbab-19"></a><span class="cm">  uint32_t width = WebPDemuxGetI(demux, WEBP_FF_CANVAS_WIDTH);</span>
<a name="gbab-20"></a><span class="cm">  uint32_t height = WebPDemuxGetI(demux, WEBP_FF_CANVAS_HEIGHT);</span>
<a name="gbab-21"></a><span class="cm">  // ... (Get information about the features present in the WebP file).</span>
<a name="gbab-22"></a><span class="cm">  uint32_t flags = WebPDemuxGetI(demux, WEBP_FF_FORMAT_FLAGS);</span>
<a name="gbab-23"></a>
<a name="gbab-24"></a><span class="cm">  // ... (Iterate over all frames).</span>
<a name="gbab-25"></a><span class="cm">  WebPIterator iter;</span>
<a name="gbab-26"></a><span class="cm">  if (WebPDemuxGetFrame(demux, 1, &amp;iter)) {</span>
<a name="gbab-27"></a><span class="cm">    do {</span>
<a name="gbab-28"></a><span class="cm">      // ... (Consume &#39;iter&#39;; e.g. Decode &#39;iter.fragment&#39; with WebPDecode(),</span>
<a name="gbab-29"></a><span class="cm">      // ... and get other frame properties like width, height, offsets etc.</span>
<a name="gbab-30"></a><span class="cm">      // ... see &#39;struct WebPIterator&#39; below for more info).</span>
<a name="gbab-31"></a><span class="cm">    } while (WebPDemuxNextFrame(&amp;iter));</span>
<a name="gbab-32"></a><span class="cm">    WebPDemuxReleaseIterator(&amp;iter);</span>
<a name="gbab-33"></a><span class="cm">  }</span>
<a name="gbab-34"></a>
<a name="gbab-35"></a><span class="cm">  // ... (Extract metadata).</span>
<a name="gbab-36"></a><span class="cm">  WebPChunkIterator chunk_iter;</span>
<a name="gbab-37"></a><span class="cm">  if (flags &amp; ICCP_FLAG) WebPDemuxGetChunk(demux, &quot;ICCP&quot;, 1, &amp;chunk_iter);</span>
<a name="gbab-38"></a><span class="cm">  // ... (Consume the ICC profile in &#39;chunk_iter.chunk&#39;).</span>
<a name="gbab-39"></a><span class="cm">  WebPDemuxReleaseChunkIterator(&amp;chunk_iter);</span>
<a name="gbab-40"></a><span class="cm">  if (flags &amp; EXIF_FLAG) WebPDemuxGetChunk(demux, &quot;EXIF&quot;, 1, &amp;chunk_iter);</span>
<a name="gbab-41"></a><span class="cm">  // ... (Consume the EXIF metadata in &#39;chunk_iter.chunk&#39;).</span>
<a name="gbab-42"></a><span class="cm">  WebPDemuxReleaseChunkIterator(&amp;chunk_iter);</span>
<a name="gbab-43"></a><span class="cm">  if (flags &amp; XMP_FLAG) WebPDemuxGetChunk(demux, &quot;XMP &quot;, 1, &amp;chunk_iter);</span>
<a name="gbab-44"></a><span class="cm">  // ... (Consume the XMP metadata in &#39;chunk_iter.chunk&#39;).</span>
<a name="gbab-45"></a><span class="cm">  WebPDemuxReleaseChunkIterator(&amp;chunk_iter);</span>
<a name="gbab-46"></a><span class="cm">  WebPDemuxDelete(demux);</span>
<a name="gbab-47"></a><span class="cm">*/</span>
<a name="gbab-48"></a>
<a name="gbab-49"></a><span class="cp">#ifndef WEBP_WEBP_DEMUX_H_</span>
<a name="gbab-50"></a><span class="cp">#define WEBP_WEBP_DEMUX_H_</span>
<a name="gbab-51"></a>
<a name="gbab-52"></a><span class="cp">#include</span> <span class="cpf">&quot;./decode.h&quot;     // for WEBP_CSP_MODE</span><span class="cp"></span>
<a name="gbab-53"></a><span class="cp">#include</span> <span class="cpf">&quot;./mux_types.h&quot;</span><span class="cp"></span>
<a name="gbab-54"></a>
<a name="gbab-55"></a><span class="cp">#ifdef __cplusplus</span>
<a name="gbab-56"></a><span class="k">extern</span> <span class="s">&quot;C&quot;</span> <span class="p">{</span>
<a name="gbab-57"></a><span class="cp">#endif</span>
<a name="gbab-58"></a>
<a name="gbab-59"></a><span class="cp">#define WEBP_DEMUX_ABI_VERSION 0x0107    </span><span class="c1">// MAJOR(8b) + MINOR(8b)</span>
<a name="gbab-60"></a>
<a name="gbab-61"></a><span class="c1">// Note: forward declaring enumerations is not allowed in (strict) C and C++,</span>
<a name="gbab-62"></a><span class="c1">// the types are left here for reference.</span>
<a name="gbab-63"></a><span class="c1">// typedef enum WebPDemuxState WebPDemuxState;</span>
<a name="gbab-64"></a><span class="c1">// typedef enum WebPFormatFeature WebPFormatFeature;</span>
<a name="gbab-65"></a><span class="k">typedef</span> <span class="k">struct</span> <span class="n">WebPDemuxer</span> <span class="n">WebPDemuxer</span><span class="p">;</span>
<a name="gbab-66"></a><span class="k">typedef</span> <span class="k">struct</span> <span class="n">WebPIterator</span> <span class="n">WebPIterator</span><span class="p">;</span>
<a name="gbab-67"></a><span class="k">typedef</span> <span class="k">struct</span> <span class="n">WebPChunkIterator</span> <span class="n">WebPChunkIterator</span><span class="p">;</span>
<a name="gbab-68"></a><span class="k">typedef</span> <span class="k">struct</span> <span class="n">WebPAnimInfo</span> <span class="n">WebPAnimInfo</span><span class="p">;</span>
<a name="gbab-69"></a><span class="k">typedef</span> <span class="k">struct</span> <span class="n">WebPAnimDecoderOptions</span> <span class="n">WebPAnimDecoderOptions</span><span class="p">;</span>
<a name="gbab-70"></a>
<a name="gbab-71"></a><span class="c1">//------------------------------------------------------------------------------</span>
<a name="gbab-72"></a>
<a name="gbab-73"></a><span class="c1">// Returns the version number of the demux library, packed in hexadecimal using</span>
<a name="gbab-74"></a><span class="c1">// 8bits for each of major/minor/revision. E.g: v2.5.7 is 0x020507.</span>
<a name="gbab-75"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">WebPGetDemuxVersion</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<a name="gbab-76"></a>
<a name="gbab-77"></a><span class="c1">//------------------------------------------------------------------------------</span>
<a name="gbab-78"></a><span class="c1">// Life of a Demux object</span>
<a name="gbab-79"></a>
<a name="gbab-80"></a><span class="k">typedef</span> <span class="k">enum</span> <span class="n">WebPDemuxState</span> <span class="p">{</span>
<a name="gbab-81"></a>  <span class="n">WEBP_DEMUX_PARSE_ERROR</span>    <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="c1">// An error occurred while parsing.</span>
<a name="gbab-82"></a>  <span class="n">WEBP_DEMUX_PARSING_HEADER</span> <span class="o">=</span>  <span class="mi">0</span><span class="p">,</span>  <span class="c1">// Not enough data to parse full header.</span>
<a name="gbab-83"></a>  <span class="n">WEBP_DEMUX_PARSED_HEADER</span>  <span class="o">=</span>  <span class="mi">1</span><span class="p">,</span>  <span class="c1">// Header parsing complete,</span>
<a name="gbab-84"></a>                                   <span class="c1">// data may be available.</span>
<a name="gbab-85"></a>  <span class="n">WEBP_DEMUX_DONE</span>           <span class="o">=</span>  <span class="mi">2</span>   <span class="c1">// Entire file has been parsed.</span>
<a name="gbab-86"></a><span class="p">}</span> <span class="n">WebPDemuxState</span><span class="p">;</span>
<a name="gbab-87"></a>
<a name="gbab-88"></a><span class="c1">// Internal, version-checked, entry point</span>
<a name="gbab-89"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="n">WebPDemuxer</span><span class="o">*</span><span class="p">)</span> <span class="n">WebPDemuxInternal</span><span class="p">(</span>
<a name="gbab-90"></a>    <span class="k">const</span> <span class="n">WebPData</span><span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="n">WebPDemuxState</span><span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<a name="gbab-91"></a>
<a name="gbab-92"></a><span class="c1">// Parses the full WebP file given by &#39;data&#39;. For single images the WebP file</span>
<a name="gbab-93"></a><span class="c1">// header alone or the file header and the chunk header may be absent.</span>
<a name="gbab-94"></a><span class="c1">// Returns a WebPDemuxer object on successful parse, NULL otherwise.</span>
<a name="gbab-95"></a><span class="k">static</span> <span class="n">WEBP_INLINE</span> <span class="n">WebPDemuxer</span><span class="o">*</span> <span class="nf">WebPDemux</span><span class="p">(</span><span class="k">const</span> <span class="n">WebPData</span><span class="o">*</span> <span class="n">data</span><span class="p">)</span> <span class="p">{</span>
<a name="gbab-96"></a>  <span class="k">return</span> <span class="n">WebPDemuxInternal</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">WEBP_DEMUX_ABI_VERSION</span><span class="p">);</span>
<a name="gbab-97"></a><span class="p">}</span>
<a name="gbab-98"></a>
<a name="gbab-99"></a><span class="c1">// Parses the possibly incomplete WebP file given by &#39;data&#39;.</span>
<a name="gbab-100"></a><span class="c1">// If &#39;state&#39; is non-NULL it will be set to indicate the status of the demuxer.</span>
<a name="gbab-101"></a><span class="c1">// Returns NULL in case of error or if there isn&#39;t enough data to start parsing;</span>
<a name="gbab-102"></a><span class="c1">// and a WebPDemuxer object on successful parse.</span>
<a name="gbab-103"></a><span class="c1">// Note that WebPDemuxer keeps internal pointers to &#39;data&#39; memory segment.</span>
<a name="gbab-104"></a><span class="c1">// If this data is volatile, the demuxer object should be deleted (by calling</span>
<a name="gbab-105"></a><span class="c1">// WebPDemuxDelete()) and WebPDemuxPartial() called again on the new data.</span>
<a name="gbab-106"></a><span class="c1">// This is usually an inexpensive operation.</span>
<a name="gbab-107"></a><span class="k">static</span> <span class="n">WEBP_INLINE</span> <span class="n">WebPDemuxer</span><span class="o">*</span> <span class="nf">WebPDemuxPartial</span><span class="p">(</span>
<a name="gbab-108"></a>    <span class="k">const</span> <span class="n">WebPData</span><span class="o">*</span> <span class="n">data</span><span class="p">,</span> <span class="n">WebPDemuxState</span><span class="o">*</span> <span class="n">state</span><span class="p">)</span> <span class="p">{</span>
<a name="gbab-109"></a>  <span class="k">return</span> <span class="n">WebPDemuxInternal</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">WEBP_DEMUX_ABI_VERSION</span><span class="p">);</span>
<a name="gbab-110"></a><span class="p">}</span>
<a name="gbab-111"></a>
<a name="gbab-112"></a><span class="c1">// Frees memory associated with &#39;dmux&#39;.</span>
<a name="gbab-113"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="n">WebPDemuxDelete</span><span class="p">(</span><span class="n">WebPDemuxer</span><span class="o">*</span> <span class="n">dmux</span><span class="p">);</span>
<a name="gbab-114"></a>
<a name="gbab-115"></a><span class="c1">//------------------------------------------------------------------------------</span>
<a name="gbab-116"></a><span class="c1">// Data/information extraction.</span>
<a name="gbab-117"></a>
<a name="gbab-118"></a><span class="k">typedef</span> <span class="k">enum</span> <span class="n">WebPFormatFeature</span> <span class="p">{</span>
<a name="gbab-119"></a>  <span class="n">WEBP_FF_FORMAT_FLAGS</span><span class="p">,</span>  <span class="c1">// Extended format flags present in the &#39;VP8X&#39; chunk.</span>
<a name="gbab-120"></a>  <span class="n">WEBP_FF_CANVAS_WIDTH</span><span class="p">,</span>
<a name="gbab-121"></a>  <span class="n">WEBP_FF_CANVAS_HEIGHT</span><span class="p">,</span>
<a name="gbab-122"></a>  <span class="n">WEBP_FF_LOOP_COUNT</span><span class="p">,</span>
<a name="gbab-123"></a>  <span class="n">WEBP_FF_BACKGROUND_COLOR</span><span class="p">,</span>
<a name="gbab-124"></a>  <span class="n">WEBP_FF_FRAME_COUNT</span>    <span class="c1">// Number of frames present in the demux object.</span>
<a name="gbab-125"></a>                         <span class="c1">// In case of a partial demux, this is the number of</span>
<a name="gbab-126"></a>                         <span class="c1">// frames seen so far, with the last frame possibly</span>
<a name="gbab-127"></a>                         <span class="c1">// being partial.</span>
<a name="gbab-128"></a><span class="p">}</span> <span class="n">WebPFormatFeature</span><span class="p">;</span>
<a name="gbab-129"></a>
<a name="gbab-130"></a><span class="c1">// Get the &#39;feature&#39; value from the &#39;dmux&#39;.</span>
<a name="gbab-131"></a><span class="c1">// NOTE: values are only valid if WebPDemux() was used or WebPDemuxPartial()</span>
<a name="gbab-132"></a><span class="c1">// returned a state &gt; WEBP_DEMUX_PARSING_HEADER.</span>
<a name="gbab-133"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="n">WebPDemuxGetI</span><span class="p">(</span>
<a name="gbab-134"></a>    <span class="k">const</span> <span class="n">WebPDemuxer</span><span class="o">*</span> <span class="n">dmux</span><span class="p">,</span> <span class="n">WebPFormatFeature</span> <span class="n">feature</span><span class="p">);</span>
<a name="gbab-135"></a>
<a name="gbab-136"></a><span class="c1">//------------------------------------------------------------------------------</span>
<a name="gbab-137"></a><span class="c1">// Frame iteration.</span>
<a name="gbab-138"></a>
<a name="gbab-139"></a><span class="k">struct</span> <span class="n">WebPIterator</span> <span class="p">{</span>
<a name="gbab-140"></a>  <span class="kt">int</span> <span class="n">frame_num</span><span class="p">;</span>
<a name="gbab-141"></a>  <span class="kt">int</span> <span class="n">num_frames</span><span class="p">;</span>          <span class="c1">// equivalent to WEBP_FF_FRAME_COUNT.</span>
<a name="gbab-142"></a>  <span class="kt">int</span> <span class="n">x_offset</span><span class="p">,</span> <span class="n">y_offset</span><span class="p">;</span>  <span class="c1">// offset relative to the canvas.</span>
<a name="gbab-143"></a>  <span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">;</span>       <span class="c1">// dimensions of this frame.</span>
<a name="gbab-144"></a>  <span class="kt">int</span> <span class="n">duration</span><span class="p">;</span>            <span class="c1">// display duration in milliseconds.</span>
<a name="gbab-145"></a>  <span class="n">WebPMuxAnimDispose</span> <span class="n">dispose_method</span><span class="p">;</span>  <span class="c1">// dispose method for the frame.</span>
<a name="gbab-146"></a>  <span class="kt">int</span> <span class="n">complete</span><span class="p">;</span>   <span class="c1">// true if &#39;fragment&#39; contains a full frame. partial images</span>
<a name="gbab-147"></a>                  <span class="c1">// may still be decoded with the WebP incremental decoder.</span>
<a name="gbab-148"></a>  <span class="n">WebPData</span> <span class="n">fragment</span><span class="p">;</span>  <span class="c1">// The frame given by &#39;frame_num&#39;. Note for historical</span>
<a name="gbab-149"></a>                      <span class="c1">// reasons this is called a fragment.</span>
<a name="gbab-150"></a>  <span class="kt">int</span> <span class="n">has_alpha</span><span class="p">;</span>      <span class="c1">// True if the frame contains transparency.</span>
<a name="gbab-151"></a>  <span class="n">WebPMuxAnimBlend</span> <span class="n">blend_method</span><span class="p">;</span>  <span class="c1">// Blend operation for the frame.</span>
<a name="gbab-152"></a>
<a name="gbab-153"></a>  <span class="kt">uint32_t</span> <span class="n">pad</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>         <span class="c1">// padding for later use.</span>
<a name="gbab-154"></a>  <span class="kt">void</span><span class="o">*</span> <span class="n">private_</span><span class="p">;</span>          <span class="c1">// for internal use only.</span>
<a name="gbab-155"></a><span class="p">};</span>
<a name="gbab-156"></a>
<a name="gbab-157"></a><span class="c1">// Retrieves frame &#39;frame_number&#39; from &#39;dmux&#39;.</span>
<a name="gbab-158"></a><span class="c1">// &#39;iter-&gt;fragment&#39; points to the frame on return from this function.</span>
<a name="gbab-159"></a><span class="c1">// Setting &#39;frame_number&#39; equal to 0 will return the last frame of the image.</span>
<a name="gbab-160"></a><span class="c1">// Returns false if &#39;dmux&#39; is NULL or frame &#39;frame_number&#39; is not present.</span>
<a name="gbab-161"></a><span class="c1">// Call WebPDemuxReleaseIterator() when use of the iterator is complete.</span>
<a name="gbab-162"></a><span class="c1">// NOTE: &#39;dmux&#39; must persist for the lifetime of &#39;iter&#39;.</span>
<a name="gbab-163"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">WebPDemuxGetFrame</span><span class="p">(</span>
<a name="gbab-164"></a>    <span class="k">const</span> <span class="n">WebPDemuxer</span><span class="o">*</span> <span class="n">dmux</span><span class="p">,</span> <span class="kt">int</span> <span class="n">frame_number</span><span class="p">,</span> <span class="n">WebPIterator</span><span class="o">*</span> <span class="n">iter</span><span class="p">);</span>
<a name="gbab-165"></a>
<a name="gbab-166"></a><span class="c1">// Sets &#39;iter-&gt;fragment&#39; to point to the next (&#39;iter-&gt;frame_num&#39; + 1) or</span>
<a name="gbab-167"></a><span class="c1">// previous (&#39;iter-&gt;frame_num&#39; - 1) frame. These functions do not loop.</span>
<a name="gbab-168"></a><span class="c1">// Returns true on success, false otherwise.</span>
<a name="gbab-169"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">WebPDemuxNextFrame</span><span class="p">(</span><span class="n">WebPIterator</span><span class="o">*</span> <span class="n">iter</span><span class="p">);</span>
<a name="gbab-170"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">WebPDemuxPrevFrame</span><span class="p">(</span><span class="n">WebPIterator</span><span class="o">*</span> <span class="n">iter</span><span class="p">);</span>
<a name="gbab-171"></a>
<a name="gbab-172"></a><span class="c1">// Releases any memory associated with &#39;iter&#39;.</span>
<a name="gbab-173"></a><span class="c1">// Must be called before any subsequent calls to WebPDemuxGetChunk() on the same</span>
<a name="gbab-174"></a><span class="c1">// iter. Also, must be called before destroying the associated WebPDemuxer with</span>
<a name="gbab-175"></a><span class="c1">// WebPDemuxDelete().</span>
<a name="gbab-176"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="n">WebPDemuxReleaseIterator</span><span class="p">(</span><span class="n">WebPIterator</span><span class="o">*</span> <span class="n">iter</span><span class="p">);</span>
<a name="gbab-177"></a>
<a name="gbab-178"></a><span class="c1">//------------------------------------------------------------------------------</span>
<a name="gbab-179"></a><span class="c1">// Chunk iteration.</span>
<a name="gbab-180"></a>
<a name="gbab-181"></a><span class="k">struct</span> <span class="n">WebPChunkIterator</span> <span class="p">{</span>
<a name="gbab-182"></a>  <span class="c1">// The current and total number of chunks with the fourcc given to</span>
<a name="gbab-183"></a>  <span class="c1">// WebPDemuxGetChunk().</span>
<a name="gbab-184"></a>  <span class="kt">int</span> <span class="n">chunk_num</span><span class="p">;</span>
<a name="gbab-185"></a>  <span class="kt">int</span> <span class="n">num_chunks</span><span class="p">;</span>
<a name="gbab-186"></a>  <span class="n">WebPData</span> <span class="n">chunk</span><span class="p">;</span>    <span class="c1">// The payload of the chunk.</span>
<a name="gbab-187"></a>
<a name="gbab-188"></a>  <span class="kt">uint32_t</span> <span class="n">pad</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>   <span class="c1">// padding for later use</span>
<a name="gbab-189"></a>  <span class="kt">void</span><span class="o">*</span> <span class="n">private_</span><span class="p">;</span>
<a name="gbab-190"></a><span class="p">};</span>
<a name="gbab-191"></a>
<a name="gbab-192"></a><span class="c1">// Retrieves the &#39;chunk_number&#39; instance of the chunk with id &#39;fourcc&#39; from</span>
<a name="gbab-193"></a><span class="c1">// &#39;dmux&#39;.</span>
<a name="gbab-194"></a><span class="c1">// &#39;fourcc&#39; is a character array containing the fourcc of the chunk to return,</span>
<a name="gbab-195"></a><span class="c1">// e.g., &quot;ICCP&quot;, &quot;XMP &quot;, &quot;EXIF&quot;, etc.</span>
<a name="gbab-196"></a><span class="c1">// Setting &#39;chunk_number&#39; equal to 0 will return the last chunk in a set.</span>
<a name="gbab-197"></a><span class="c1">// Returns true if the chunk is found, false otherwise. Image related chunk</span>
<a name="gbab-198"></a><span class="c1">// payloads are accessed through WebPDemuxGetFrame() and related functions.</span>
<a name="gbab-199"></a><span class="c1">// Call WebPDemuxReleaseChunkIterator() when use of the iterator is complete.</span>
<a name="gbab-200"></a><span class="c1">// NOTE: &#39;dmux&#39; must persist for the lifetime of the iterator.</span>
<a name="gbab-201"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">WebPDemuxGetChunk</span><span class="p">(</span><span class="k">const</span> <span class="n">WebPDemuxer</span><span class="o">*</span> <span class="n">dmux</span><span class="p">,</span>
<a name="gbab-202"></a>                                   <span class="k">const</span> <span class="kt">char</span> <span class="n">fourcc</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="kt">int</span> <span class="n">chunk_number</span><span class="p">,</span>
<a name="gbab-203"></a>                                   <span class="n">WebPChunkIterator</span><span class="o">*</span> <span class="n">iter</span><span class="p">);</span>
<a name="gbab-204"></a>
<a name="gbab-205"></a><span class="c1">// Sets &#39;iter-&gt;chunk&#39; to point to the next (&#39;iter-&gt;chunk_num&#39; + 1) or previous</span>
<a name="gbab-206"></a><span class="c1">// (&#39;iter-&gt;chunk_num&#39; - 1) chunk. These functions do not loop.</span>
<a name="gbab-207"></a><span class="c1">// Returns true on success, false otherwise.</span>
<a name="gbab-208"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">WebPDemuxNextChunk</span><span class="p">(</span><span class="n">WebPChunkIterator</span><span class="o">*</span> <span class="n">iter</span><span class="p">);</span>
<a name="gbab-209"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">WebPDemuxPrevChunk</span><span class="p">(</span><span class="n">WebPChunkIterator</span><span class="o">*</span> <span class="n">iter</span><span class="p">);</span>
<a name="gbab-210"></a>
<a name="gbab-211"></a><span class="c1">// Releases any memory associated with &#39;iter&#39;.</span>
<a name="gbab-212"></a><span class="c1">// Must be called before destroying the associated WebPDemuxer with</span>
<a name="gbab-213"></a><span class="c1">// WebPDemuxDelete().</span>
<a name="gbab-214"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="n">WebPDemuxReleaseChunkIterator</span><span class="p">(</span><span class="n">WebPChunkIterator</span><span class="o">*</span> <span class="n">iter</span><span class="p">);</span>
<a name="gbab-215"></a>
<a name="gbab-216"></a><span class="c1">//------------------------------------------------------------------------------</span>
<a name="gbab-217"></a><span class="c1">// WebPAnimDecoder API</span>
<a name="gbab-218"></a><span class="c1">//</span>
<a name="gbab-219"></a><span class="c1">// This API allows decoding (possibly) animated WebP images.</span>
<a name="gbab-220"></a><span class="c1">//</span>
<a name="gbab-221"></a><span class="c1">// Code Example:</span>
<a name="gbab-222"></a><span class="cm">/*</span>
<a name="gbab-223"></a><span class="cm">  WebPAnimDecoderOptions dec_options;</span>
<a name="gbab-224"></a><span class="cm">  WebPAnimDecoderOptionsInit(&amp;dec_options);</span>
<a name="gbab-225"></a><span class="cm">  // Tune &#39;dec_options&#39; as needed.</span>
<a name="gbab-226"></a><span class="cm">  WebPAnimDecoder* dec = WebPAnimDecoderNew(webp_data, &amp;dec_options);</span>
<a name="gbab-227"></a><span class="cm">  WebPAnimInfo anim_info;</span>
<a name="gbab-228"></a><span class="cm">  WebPAnimDecoderGetInfo(dec, &amp;anim_info);</span>
<a name="gbab-229"></a><span class="cm">  for (uint32_t i = 0; i &lt; anim_info.loop_count; ++i) {</span>
<a name="gbab-230"></a><span class="cm">    while (WebPAnimDecoderHasMoreFrames(dec)) {</span>
<a name="gbab-231"></a><span class="cm">      uint8_t* buf;</span>
<a name="gbab-232"></a><span class="cm">      int timestamp;</span>
<a name="gbab-233"></a><span class="cm">      WebPAnimDecoderGetNext(dec, &amp;buf, &amp;timestamp);</span>
<a name="gbab-234"></a><span class="cm">      // ... (Render &#39;buf&#39; based on &#39;timestamp&#39;).</span>
<a name="gbab-235"></a><span class="cm">      // ... (Do NOT free &#39;buf&#39;, as it is owned by &#39;dec&#39;).</span>
<a name="gbab-236"></a><span class="cm">    }</span>
<a name="gbab-237"></a><span class="cm">    WebPAnimDecoderReset(dec);</span>
<a name="gbab-238"></a><span class="cm">  }</span>
<a name="gbab-239"></a><span class="cm">  const WebPDemuxer* demuxer = WebPAnimDecoderGetDemuxer(dec);</span>
<a name="gbab-240"></a><span class="cm">  // ... (Do something using &#39;demuxer&#39;; e.g. get EXIF/XMP/ICC data).</span>
<a name="gbab-241"></a><span class="cm">  WebPAnimDecoderDelete(dec);</span>
<a name="gbab-242"></a><span class="cm">*/</span>
<a name="gbab-243"></a>
<a name="gbab-244"></a><span class="k">typedef</span> <span class="k">struct</span> <span class="n">WebPAnimDecoder</span> <span class="n">WebPAnimDecoder</span><span class="p">;</span>  <span class="c1">// Main opaque object.</span>
<a name="gbab-245"></a>
<a name="gbab-246"></a><span class="c1">// Global options.</span>
<a name="gbab-247"></a><span class="k">struct</span> <span class="n">WebPAnimDecoderOptions</span> <span class="p">{</span>
<a name="gbab-248"></a>  <span class="c1">// Output colorspace. Only the following modes are supported:</span>
<a name="gbab-249"></a>  <span class="c1">// MODE_RGBA, MODE_BGRA, MODE_rgbA and MODE_bgrA.</span>
<a name="gbab-250"></a>  <span class="n">WEBP_CSP_MODE</span> <span class="n">color_mode</span><span class="p">;</span>
<a name="gbab-251"></a>  <span class="kt">int</span> <span class="n">use_threads</span><span class="p">;</span>           <span class="c1">// If true, use multi-threaded decoding.</span>
<a name="gbab-252"></a>  <span class="kt">uint32_t</span> <span class="n">padding</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>       <span class="c1">// Padding for later use.</span>
<a name="gbab-253"></a><span class="p">};</span>
<a name="gbab-254"></a>
<a name="gbab-255"></a><span class="c1">// Internal, version-checked, entry point.</span>
<a name="gbab-256"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">WebPAnimDecoderOptionsInitInternal</span><span class="p">(</span>
<a name="gbab-257"></a>    <span class="n">WebPAnimDecoderOptions</span><span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<a name="gbab-258"></a>
<a name="gbab-259"></a><span class="c1">// Should always be called, to initialize a fresh WebPAnimDecoderOptions</span>
<a name="gbab-260"></a><span class="c1">// structure before modification. Returns false in case of version mismatch.</span>
<a name="gbab-261"></a><span class="c1">// WebPAnimDecoderOptionsInit() must have succeeded before using the</span>
<a name="gbab-262"></a><span class="c1">// &#39;dec_options&#39; object.</span>
<a name="gbab-263"></a><span class="k">static</span> <span class="n">WEBP_INLINE</span> <span class="kt">int</span> <span class="nf">WebPAnimDecoderOptionsInit</span><span class="p">(</span>
<a name="gbab-264"></a>    <span class="n">WebPAnimDecoderOptions</span><span class="o">*</span> <span class="n">dec_options</span><span class="p">)</span> <span class="p">{</span>
<a name="gbab-265"></a>  <span class="k">return</span> <span class="n">WebPAnimDecoderOptionsInitInternal</span><span class="p">(</span><span class="n">dec_options</span><span class="p">,</span>
<a name="gbab-266"></a>                                            <span class="n">WEBP_DEMUX_ABI_VERSION</span><span class="p">);</span>
<a name="gbab-267"></a><span class="p">}</span>
<a name="gbab-268"></a>
<a name="gbab-269"></a><span class="c1">// Internal, version-checked, entry point.</span>
<a name="gbab-270"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="n">WebPAnimDecoder</span><span class="o">*</span><span class="p">)</span> <span class="n">WebPAnimDecoderNewInternal</span><span class="p">(</span>
<a name="gbab-271"></a>    <span class="k">const</span> <span class="n">WebPData</span><span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="n">WebPAnimDecoderOptions</span><span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<a name="gbab-272"></a>
<a name="gbab-273"></a><span class="c1">// Creates and initializes a WebPAnimDecoder object.</span>
<a name="gbab-274"></a><span class="c1">// Parameters:</span>
<a name="gbab-275"></a><span class="c1">//   webp_data - (in) WebP bitstream. This should remain unchanged during the</span>
<a name="gbab-276"></a><span class="c1">//                    lifetime of the output WebPAnimDecoder object.</span>
<a name="gbab-277"></a><span class="c1">//   dec_options - (in) decoding options. Can be passed NULL to choose</span>
<a name="gbab-278"></a><span class="c1">//                      reasonable defaults (in particular, color mode MODE_RGBA</span>
<a name="gbab-279"></a><span class="c1">//                      will be picked).</span>
<a name="gbab-280"></a><span class="c1">// Returns:</span>
<a name="gbab-281"></a><span class="c1">//   A pointer to the newly created WebPAnimDecoder object, or NULL in case of</span>
<a name="gbab-282"></a><span class="c1">//   parsing error, invalid option or memory error.</span>
<a name="gbab-283"></a><span class="k">static</span> <span class="n">WEBP_INLINE</span> <span class="n">WebPAnimDecoder</span><span class="o">*</span> <span class="nf">WebPAnimDecoderNew</span><span class="p">(</span>
<a name="gbab-284"></a>    <span class="k">const</span> <span class="n">WebPData</span><span class="o">*</span> <span class="n">webp_data</span><span class="p">,</span> <span class="k">const</span> <span class="n">WebPAnimDecoderOptions</span><span class="o">*</span> <span class="n">dec_options</span><span class="p">)</span> <span class="p">{</span>
<a name="gbab-285"></a>  <span class="k">return</span> <span class="n">WebPAnimDecoderNewInternal</span><span class="p">(</span><span class="n">webp_data</span><span class="p">,</span> <span class="n">dec_options</span><span class="p">,</span>
<a name="gbab-286"></a>                                    <span class="n">WEBP_DEMUX_ABI_VERSION</span><span class="p">);</span>
<a name="gbab-287"></a><span class="p">}</span>
<a name="gbab-288"></a>
<a name="gbab-289"></a><span class="c1">// Global information about the animation..</span>
<a name="gbab-290"></a><span class="k">struct</span> <span class="n">WebPAnimInfo</span> <span class="p">{</span>
<a name="gbab-291"></a>  <span class="kt">uint32_t</span> <span class="n">canvas_width</span><span class="p">;</span>
<a name="gbab-292"></a>  <span class="kt">uint32_t</span> <span class="n">canvas_height</span><span class="p">;</span>
<a name="gbab-293"></a>  <span class="kt">uint32_t</span> <span class="n">loop_count</span><span class="p">;</span>
<a name="gbab-294"></a>  <span class="kt">uint32_t</span> <span class="n">bgcolor</span><span class="p">;</span>
<a name="gbab-295"></a>  <span class="kt">uint32_t</span> <span class="n">frame_count</span><span class="p">;</span>
<a name="gbab-296"></a>  <span class="kt">uint32_t</span> <span class="n">pad</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>   <span class="c1">// padding for later use</span>
<a name="gbab-297"></a><span class="p">};</span>
<a name="gbab-298"></a>
<a name="gbab-299"></a><span class="c1">// Get global information about the animation.</span>
<a name="gbab-300"></a><span class="c1">// Parameters:</span>
<a name="gbab-301"></a><span class="c1">//   dec - (in) decoder instance to get information from.</span>
<a name="gbab-302"></a><span class="c1">//   info - (out) global information fetched from the animation.</span>
<a name="gbab-303"></a><span class="c1">// Returns:</span>
<a name="gbab-304"></a><span class="c1">//   True on success.</span>
<a name="gbab-305"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">WebPAnimDecoderGetInfo</span><span class="p">(</span><span class="k">const</span> <span class="n">WebPAnimDecoder</span><span class="o">*</span> <span class="n">dec</span><span class="p">,</span>
<a name="gbab-306"></a>                                        <span class="n">WebPAnimInfo</span><span class="o">*</span> <span class="n">info</span><span class="p">);</span>
<a name="gbab-307"></a>
<a name="gbab-308"></a><span class="c1">// Fetch the next frame from &#39;dec&#39; based on options supplied to</span>
<a name="gbab-309"></a><span class="c1">// WebPAnimDecoderNew(). This will be a fully reconstructed canvas of size</span>
<a name="gbab-310"></a><span class="c1">// &#39;canvas_width * 4 * canvas_height&#39;, and not just the frame sub-rectangle. The</span>
<a name="gbab-311"></a><span class="c1">// returned buffer &#39;buf&#39; is valid only until the next call to</span>
<a name="gbab-312"></a><span class="c1">// WebPAnimDecoderGetNext(), WebPAnimDecoderReset() or WebPAnimDecoderDelete().</span>
<a name="gbab-313"></a><span class="c1">// Parameters:</span>
<a name="gbab-314"></a><span class="c1">//   dec - (in/out) decoder instance from which the next frame is to be fetched.</span>
<a name="gbab-315"></a><span class="c1">//   buf - (out) decoded frame.</span>
<a name="gbab-316"></a><span class="c1">//   timestamp - (out) timestamp of the frame in milliseconds.</span>
<a name="gbab-317"></a><span class="c1">// Returns:</span>
<a name="gbab-318"></a><span class="c1">//   False if any of the arguments are NULL, or if there is a parsing or</span>
<a name="gbab-319"></a><span class="c1">//   decoding error, or if there are no more frames. Otherwise, returns true.</span>
<a name="gbab-320"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">WebPAnimDecoderGetNext</span><span class="p">(</span><span class="n">WebPAnimDecoder</span><span class="o">*</span> <span class="n">dec</span><span class="p">,</span>
<a name="gbab-321"></a>                                        <span class="kt">uint8_t</span><span class="o">**</span> <span class="n">buf</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span> <span class="n">timestamp</span><span class="p">);</span>
<a name="gbab-322"></a>
<a name="gbab-323"></a><span class="c1">// Check if there are more frames left to decode.</span>
<a name="gbab-324"></a><span class="c1">// Parameters:</span>
<a name="gbab-325"></a><span class="c1">//   dec - (in) decoder instance to be checked.</span>
<a name="gbab-326"></a><span class="c1">// Returns:</span>
<a name="gbab-327"></a><span class="c1">//   True if &#39;dec&#39; is not NULL and some frames are yet to be decoded.</span>
<a name="gbab-328"></a><span class="c1">//   Otherwise, returns false.</span>
<a name="gbab-329"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">WebPAnimDecoderHasMoreFrames</span><span class="p">(</span><span class="k">const</span> <span class="n">WebPAnimDecoder</span><span class="o">*</span> <span class="n">dec</span><span class="p">);</span>
<a name="gbab-330"></a>
<a name="gbab-331"></a><span class="c1">// Resets the WebPAnimDecoder object, so that next call to</span>
<a name="gbab-332"></a><span class="c1">// WebPAnimDecoderGetNext() will restart decoding from 1st frame. This would be</span>
<a name="gbab-333"></a><span class="c1">// helpful when all frames need to be decoded multiple times (e.g.</span>
<a name="gbab-334"></a><span class="c1">// info.loop_count times) without destroying and recreating the &#39;dec&#39; object.</span>
<a name="gbab-335"></a><span class="c1">// Parameters:</span>
<a name="gbab-336"></a><span class="c1">//   dec - (in/out) decoder instance to be reset</span>
<a name="gbab-337"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="n">WebPAnimDecoderReset</span><span class="p">(</span><span class="n">WebPAnimDecoder</span><span class="o">*</span> <span class="n">dec</span><span class="p">);</span>
<a name="gbab-338"></a>
<a name="gbab-339"></a><span class="c1">// Grab the internal demuxer object.</span>
<a name="gbab-340"></a><span class="c1">// Getting the demuxer object can be useful if one wants to use operations only</span>
<a name="gbab-341"></a><span class="c1">// available through demuxer; e.g. to get XMP/EXIF/ICC metadata. The returned</span>
<a name="gbab-342"></a><span class="c1">// demuxer object is owned by &#39;dec&#39; and is valid only until the next call to</span>
<a name="gbab-343"></a><span class="c1">// WebPAnimDecoderDelete().</span>
<a name="gbab-344"></a><span class="c1">//</span>
<a name="gbab-345"></a><span class="c1">// Parameters:</span>
<a name="gbab-346"></a><span class="c1">//   dec - (in) decoder instance from which the demuxer object is to be fetched.</span>
<a name="gbab-347"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="k">const</span> <span class="n">WebPDemuxer</span><span class="o">*</span><span class="p">)</span> <span class="n">WebPAnimDecoderGetDemuxer</span><span class="p">(</span>
<a name="gbab-348"></a>    <span class="k">const</span> <span class="n">WebPAnimDecoder</span><span class="o">*</span> <span class="n">dec</span><span class="p">);</span>
<a name="gbab-349"></a>
<a name="gbab-350"></a><span class="c1">// Deletes the WebPAnimDecoder object.</span>
<a name="gbab-351"></a><span class="c1">// Parameters:</span>
<a name="gbab-352"></a><span class="c1">//   dec - (in/out) decoder instance to be deleted</span>
<a name="gbab-353"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="n">WebPAnimDecoderDelete</span><span class="p">(</span><span class="n">WebPAnimDecoder</span><span class="o">*</span> <span class="n">dec</span><span class="p">);</span>
<a name="gbab-354"></a>
<a name="gbab-355"></a><span class="cp">#ifdef __cplusplus</span>
<a name="gbab-356"></a><span class="p">}</span>    <span class="c1">// extern &quot;C&quot;</span>
<a name="gbab-357"></a><span class="cp">#endif</span>
<a name="gbab-358"></a>
<a name="gbab-359"></a><span class="cp">#endif  </span><span class="cm">/* WEBP_WEBP_DEMUX_H_ */</span><span class="cp"></span>
</pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>   1
   2
   3
   4
   5
   6
   7
   8
   9
  10
  11
  12
  13
  14
  15
  16
  17
  18
  19
  20
  21
  22
  23
  24
  25
  26
  27
  28
  29
  30
  31
  32
  33
  34
  35
  36
  37
  38
  39
  40
  41
  42
  43
  44
  45
  46
  47
  48
  49
  50
  51
  52
  53
  54
  55
  56
  57
  58
  59
  60
  61
  62
  63
  64
  65
  66
  67
  68
  69
  70
  71
  72
  73
  74
  75
  76
  77
  78
  79
  80
  81
  82
  83
  84
  85
  86
  87
  88
  89
  90
  91
  92
  93
  94
  95
  96
  97
  98
  99
 100
 101
 102
 103
 104
 105
 106
 107
 108
 109
 110
 111
 112
 113
 114
 115
 116
 117
 118
 119
 120
 121
 122
 123
 124
 125
 126
 127
 128
 129
 130
 131
 132
 133
 134
 135
 136
 137
 138
 139
 140
 141
 142
 143
 144
 145
 146
 147
 148
 149
 150
 151
 152
 153
 154
 155
 156
 157
 158
 159
 160
 161
 162
 163
 164
 165
 166
 167
 168
 169
 170
 171
 172
 173
 174
 175
 176
 177
 178
 179
 180
 181
 182
 183
 184
 185
 186
 187
 188
 189
 190
 191
 192
 193
 194
 195
 196
 197
 198
 199
 200
 201
 202
 203
 204
 205
 206
 207
 208
 209
 210
 211
 212
 213
 214
 215
 216
 217
 218
 219
 220
 221
 222
 223
 224
 225
 226
 227
 228
 229
 230
 231
 232
 233
 234
 235
 236
 237
 238
 239
 240
 241
 242
 243
 244
 245
 246
 247
 248
 249
 250
 251
 252
 253
 254
 255
 256
 257
 258
 259
 260
 261
 262
 263
 264
 265
 266
 267
 268
 269
 270
 271
 272
 273
 274
 275
 276
 277
 278
 279
 280
 281
 282
 283
 284
 285
 286
 287
 288
 289
 290
 291
 292
 293
 294
 295
 296
 297
 298
 299
 300
 301
 302
 303
 304
 305
 306
 307
 308
 309
 310
 311
 312
 313
 314
 315
 316
 317
 318
 319
 320
 321
 322
 323
 324
 325
 326
 327
 328
 329
 330
 331
 332
 333
 334
 335
 336
 337
 338
 339
 340
 341
 342
 343
 344
 345
 346
 347
 348
 349
 350
 351
 352
 353
 354
 355
 356
 357
 358
 359
 360
 361
 362
 363
 364
 365
 366
 367
 368
 369
 370
 371
 372
 373
 374
 375
 376
 377
 378
 379
 380
 381
 382
 383
 384
 385
 386
 387
 388
 389
 390
 391
 392
 393
 394
 395
 396
 397
 398
 399
 400
 401
 402
 403
 404
 405
 406
 407
 408
 409
 410
 411
 412
 413
 414
 415
 416
 417
 418
 419
 420
 421
 422
 423
 424
 425
 426
 427
 428
 429
 430
 431
 432
 433
 434
 435
 436
 437
 438
 439
 440
 441
 442
 443
 444
 445
 446
 447
 448
 449
 450
 451
 452
 453
 454
 455
 456
 457
 458
 459
 460
 461
 462
 463
 464
 465
 466
 467
 468
 469
 470
 471
 472
 473
 474
 475
 476
 477
 478
 479
 480
 481
 482
 483
 484
 485
 486
 487
 488
 489
 490
 491
 492
 493
 494
 495
 496
 497
 498
 499
 500
 501
 502
 503
 504
 505
 506
 507
 508
 509
 510
 511
 512
 513
 514
 515
 516
 517
 518
 519
 520
 521
 522
 523
 524
 525
 526
 527
 528
 529
 530
 531
 532
 533
 534
 535
 536
 537
 538
 539
 540
 541
 542
 543
 544
 545
 546
 547
 548
 549
 550
 551
 552
 553
 554
 555
 556
 557
 558
 559
 560
 561
 562
 563
 564
 565
 566
 567
 568
 569
 570
 571
 572
 573
 574
 575
 576
 577
 578
 579
 580
 581
 582
 583
 584
 585
 586
 587
 588
 589
 590
 591
 592
 593
 594
 595
 596
 597
 598
 599
 600
 601
 602
 603
 604
 605
 606
 607
 608
 609
 610
 611
 612
 613
 614
 615
 616
 617
 618
 619
 620
 621
 622
 623
 624
 625
 626
 627
 628
 629
 630
 631
 632
 633
 634
 635
 636
 637
 638
 639
 640
 641
 642
 643
 644
 645
 646
 647
 648
 649
 650
 651
 652
 653
 654
 655
 656
 657
 658
 659
 660
 661
 662
 663
 664
 665
 666
 667
 668
 669
 670
 671
 672
 673
 674
 675
 676
 677
 678
 679
 680
 681
 682
 683
 684
 685
 686
 687
 688
 689
 690
 691
 692
 693
 694
 695
 696
 697
 698
 699
 700
 701
 702
 703
 704
 705
 706
 707
 708
 709
 710
 711
 712
 713
 714
 715
 716
 717
 718
 719
 720
 721
 722
 723
 724
 725
 726
 727
 728
 729
 730
 731
 732
 733
 734
 735
 736
 737
 738
 739
 740
 741
 742
 743
 744
 745
 746
 747
 748
 749
 750
 751
 752
 753
 754
 755
 756
 757
 758
 759
 760
 761
 762
 763
 764
 765
 766
 767
 768
 769
 770
 771
 772
 773
 774
 775
 776
 777
 778
 779
 780
 781
 782
 783
 784
 785
 786
 787
 788
 789
 790
 791
 792
 793
 794
 795
 796
 797
 798
 799
 800
 801
 802
 803
 804
 805
 806
 807
 808
 809
 810
 811
 812
 813
 814
 815
 816
 817
 818
 819
 820
 821
 822
 823
 824
 825
 826
 827
 828
 829
 830
 831
 832
 833
 834
 835
 836
 837
 838
 839
 840
 841
 842
 843
 844
 845
 846
 847
 848
 849
 850
 851
 852
 853
 854
 855
 856
 857
 858
 859
 860
 861
 862
 863
 864
 865
 866
 867
 868
 869
 870
 871
 872
 873
 874
 875
 876
 877
 878
 879
 880
 881
 882
 883
 884
 885
 886
 887
 888
 889
 890
 891
 892
 893
 894
 895
 896
 897
 898
 899
 900
 901
 902
 903
 904
 905
 906
 907
 908
 909
 910
 911
 912
 913
 914
 915
 916
 917
 918
 919
 920
 921
 922
 923
 924
 925
 926
 927
 928
 929
 930
 931
 932
 933
 934
 935
 936
 937
 938
 939
 940
 941
 942
 943
 944
 945
 946
 947
 948
 949
 950
 951
 952
 953
 954
 955
 956
 957
 958
 959
 960
 961
 962
 963
 964
 965
 966
 967
 968
 969
 970
 971
 972
 973
 974
 975
 976
 977
 978
 979
 980
 981
 982
 983
 984
 985
 986
 987
 988
 989
 990
 991
 992
 993
 994
 995
 996
 997
 998
 999
1000
1001
1002
1003
1004
1005
1006
1007
1008
1009
1010
1011
1012
1013
1014
1015
1016
1017
1018
1019
1020
1021
1022
1023
1024
1025
1026
1027
1028
1029
1030
1031
1032
1033
1034
1035
1036
1037
1038
1039
1040
1041
1042
1043
1044
1045
1046
1047
1048
1049
1050
1051
1052
1053
1054
1055
1056
1057
1058
1059
1060
1061
1062
1063
1064
1065
1066
1067
1068
1069
1070
1071
1072
1073
1074
1075
1076
1077
1078
1079
1080
1081
1082
1083
1084
1085
1086
1087
1088
1089
1090
1091
1092
1093
1094
1095
1096
1097
1098
1099
1100
1101
1102
1103
1104
1105
1106
1107
1108
1109
1110
1111
1112
1113
1114
1115
1116
1117
1118
1119
1120
1121
1122
1123
1124
1125
1126
1127
1128
1129
1130
1131
1132
1133
1134
1135
1136
1137
1138
1139
1140
1141
1142
1143
1144
1145
1146
1147
1148
1149
1150
1151
1152
1153
1154
1155
1156
1157
1158
1159
1160
1161
1162
1163
1164
1165
1166
1167
1168
1169
1170
1171
1172
1173
1174
1175
1176
1177
1178
1179
1180
1181
1182
1183
1184
1185
1186
1187
1188
1189
1190
1191
1192
1193
1194
1195
1196
1197
1198
1199
1200
1201
1202
1203
1204
1205
1206
1207
1208
1209
1210
1211
1212
1213
1214
1215
1216
1217
1218
1219
1220
1221
1222
1223
1224
1225
1226
1227
1228
1229
1230
1231
1232
1233
1234
1235
1236
1237
1238
1239
1240
1241
1242
1243
1244
1245
1246
1247
1248
1249
1250
1251
1252
1253
1254
1255
1256
1257
1258
1259
1260
1261
1262
1263
1264
1265
1266
1267
1268
1269
1270
1271
1272
1273
1274
1275
1276
1277
1278
1279
1280
1281
1282
1283
1284
1285
1286
1287
1288
1289
1290
1291
1292
1293
1294
1295
1296
1297
1298
1299
1300
1301
1302
1303
1304
1305
1306
1307
1308
1309
1310
1311
1312
1313
1314
1315
1316
1317
1318
1319
1320
1321
1322
1323
1324
1325
1326
1327
1328
1329
1330
1331
1332
1333
1334
1335
1336
1337
1338
1339
1340
1341
1342
1343
1344
1345
1346
1347
1348
1349
1350
1351
1352
1353
1354
1355
1356
1357
1358
1359
1360
1361
1362
1363
1364
1365
1366
1367
1368
1369
1370
1371
1372
1373
1374
1375
1376
1377
1378
1379
1380
1381
1382
1383
1384
1385
1386
1387
1388
1389
1390
1391
1392
1393
1394
1395
1396
1397
1398
1399
1400
1401
1402
1403
1404
1405
1406
1407
1408
1409
1410
1411
1412
1413
1414
1415
1416
1417
1418
1419
1420
1421
1422
1423
1424
1425
1426
1427
1428
1429
1430
1431
1432
1433
1434
1435
1436
1437
1438
1439
1440
1441
1442
1443
1444
1445
1446
1447
1448
1449
1450
1451
1452
1453
1454
1455
1456
1457
1458
1459
1460
1461
1462
1463
1464
1465
1466
1467
1468
1469
1470
1471
1472
1473
1474
1475
1476
1477
1478
1479
1480
1481
1482
1483
1484
1485
1486
1487
1488
1489
1490
1491
1492
1493
1494
1495
1496
1497
1498
1499
1500
1501
1502
1503
1504
1505
1506
1507
1508
1509
1510
1511
1512
1513
1514
1515
1516
1517
1518
1519
1520
1521
1522
1523
1524
1525
1526
1527
1528
1529
1530
1531
1532
1533
1534
1535
1536
1537
1538
1539
1540
1541
1542
1543
1544
1545
1546
1547
1548
1549
1550
1551
1552
1553
1554
1555
1556
1557
1558
1559
1560
1561
1562
1563
1564
1565
1566
1567
1568
1569
1570
1571
1572
1573
1574
1575
1576
1577
1578
1579
1580
1581
1582
1583
1584
1585
1586
1587
1588
1589
1590
1591
1592
1593
1594
1595
1596
1597
1598
1599
1600
1601
1602
1603
1604
1605
1606
1607
1608
1609
1610
1611
1612
1613
1614
1615
1616
1617
1618
1619
1620
1621
1622
1623
1624
1625
1626
1627
1628
1629
1630
1631
1632
1633
1634
1635
1636
1637
1638
1639
1640
1641
1642
1643
1644
1645
1646
1647
1648
1649
1650
1651
1652
1653
1654
1655
1656
1657
1658
1659
1660
1661
1662
1663
1664
1665
1666
1667
1668
1669
1670
1671
1672
1673
1674
1675
1676
1677
1678
1679
1680
1681
1682
1683
1684
1685
1686
1687
1688
1689
1690
1691
1692
1693
1694
1695
1696
1697
1698
1699
1700
1701
1702
1703
1704
1705
1706
1707
1708
1709
1710
1711
1712
1713
1714
1715
1716
1717
1718
1719
1720
1721
1722
1723
1724
1725
1726
1727
1728
1729
1730
1731
1732
1733
1734
1735
1736
1737
1738
1739
1740
1741
1742
1743
1744
1745
1746
1747
1748
1749
1750
1751
1752
1753
1754
1755
1756
1757
1758
1759
1760
1761
1762
1763
1764
1765
1766
1767
1768
1769
1770
1771
1772
1773
1774
1775
1776
1777
1778
1779
1780
1781
1782
1783
1784
1785
1786
1787
1788
1789
1790
1791
1792
1793
1794
1795
1796
1797
1798
1799
1800
1801
1802
1803
1804
1805
1806
1807
1808
1809
1810
1811
1812
1813
1814
1815
1816
1817
1818
1819
1820
1821
1822
1823
1824
1825
1826
1827
1828
1829
1830
1831
1832
1833
1834
1835
1836
1837
1838
1839
1840
1841
1842
1843
1844
1845
1846
1847
1848
1849
1850
1851
1852
1853
1854
1855
1856
1857
1858
1859
1860
1861
1862
1863
1864
1865
1866
1867
1868
1869
1870
1871
1872
1873
1874
1875
1876
1877
1878
1879
1880
1881
1882
1883
1884
1885
1886
1887
1888
1889
1890
1891
1892
1893
1894
1895
1896
1897
1898
1899
1900
1901
1902
1903
1904
1905
1906
1907
1908
1909
1910
1911
1912
1913
1914
1915
1916
1917
1918
1919
1920
1921
1922
1923
1924
1925
1926
1927
1928
1929
1930
1931</pre></div></td><td class="code"><div class="highlight"><pre><span></span><a name="gbab-1"></a><span class="cm">/* pngpriv.h - private declarations for use inside libpng</span>
<a name="gbab-2"></a><span class="cm"> *</span>
<a name="gbab-3"></a><span class="cm"> * Last changed in libpng 1.6.22 [May 26, 2016]</span>
<a name="gbab-4"></a><span class="cm"> * Copyright (c) 1998-2002,2004,2006-2016 Glenn Randers-Pehrson</span>
<a name="gbab-5"></a><span class="cm"> * (Version 0.96 Copyright (c) 1996, 1997 Andreas Dilger)</span>
<a name="gbab-6"></a><span class="cm"> * (Version 0.88 Copyright (c) 1995, 1996 Guy Eric Schalnat, Group 42, Inc.)</span>
<a name="gbab-7"></a><span class="cm"> *</span>
<a name="gbab-8"></a><span class="cm"> * This code is released under the libpng license.</span>
<a name="gbab-9"></a><span class="cm"> * For conditions of distribution and use, see the disclaimer</span>
<a name="gbab-10"></a><span class="cm"> * and license in png.h</span>
<a name="gbab-11"></a><span class="cm"> */</span>
<a name="gbab-12"></a>
<a name="gbab-13"></a><span class="cm">/* The symbols declared in this file (including the functions declared</span>
<a name="gbab-14"></a><span class="cm"> * as extern) are PRIVATE.  They are not part of the libpng public</span>
<a name="gbab-15"></a><span class="cm"> * interface, and are not recommended for use by regular applications.</span>
<a name="gbab-16"></a><span class="cm"> * Some of them may become public in the future; others may stay private,</span>
<a name="gbab-17"></a><span class="cm"> * change in an incompatible way, or even disappear.</span>
<a name="gbab-18"></a><span class="cm"> * Although the libpng users are not forbidden to include this header,</span>
<a name="gbab-19"></a><span class="cm"> * they should be well aware of the issues that may arise from doing so.</span>
<a name="gbab-20"></a><span class="cm"> */</span>
<a name="gbab-21"></a>
<a name="gbab-22"></a><span class="cp">#ifndef PNGPRIV_H</span>
<a name="gbab-23"></a><span class="cp">#define PNGPRIV_H</span>
<a name="gbab-24"></a>
<a name="gbab-25"></a><span class="cm">/* Feature Test Macros.  The following are defined here to ensure that correctly</span>
<a name="gbab-26"></a><span class="cm"> * implemented libraries reveal the APIs libpng needs to build and hide those</span>
<a name="gbab-27"></a><span class="cm"> * that are not needed and potentially damaging to the compilation.</span>
<a name="gbab-28"></a><span class="cm"> *</span>
<a name="gbab-29"></a><span class="cm"> * Feature Test Macros must be defined before any system header is included (see</span>
<a name="gbab-30"></a><span class="cm"> * POSIX 1003.1 2.8.2 &quot;POSIX Symbols.&quot;</span>
<a name="gbab-31"></a><span class="cm"> *</span>
<a name="gbab-32"></a><span class="cm"> * These macros only have an effect if the operating system supports either</span>
<a name="gbab-33"></a><span class="cm"> * POSIX 1003.1 or C99, or both.  On other operating systems (particularly</span>
<a name="gbab-34"></a><span class="cm"> * Windows/Visual Studio) there is no effect; the OS specific tests below are</span>
<a name="gbab-35"></a><span class="cm"> * still required (as of 2011-05-02.)</span>
<a name="gbab-36"></a><span class="cm"> */</span>
<a name="gbab-37"></a><span class="cp">#define _POSIX_SOURCE 1 </span><span class="cm">/* Just the POSIX 1003.1 and C89 APIs */</span><span class="cp"></span>
<a name="gbab-38"></a>
<a name="gbab-39"></a><span class="cp">#ifndef PNG_VERSION_INFO_ONLY</span>
<a name="gbab-40"></a><span class="cm">/* Standard library headers not required by png.h: */</span>
<a name="gbab-41"></a><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
<a name="gbab-42"></a><span class="cp">#  include &lt;string.h&gt;</span>
<a name="gbab-43"></a><span class="cp">#endif</span>
<a name="gbab-44"></a>
<a name="gbab-45"></a><span class="cp">#define PNGLIB_BUILD </span><span class="cm">/*libpng is being built, not used*/</span><span class="cp"></span>
<a name="gbab-46"></a>
<a name="gbab-47"></a><span class="cm">/* If HAVE_CONFIG_H is defined during the build then the build system must</span>
<a name="gbab-48"></a><span class="cm"> * provide an appropriate &quot;config.h&quot; file on the include path.  The header file</span>
<a name="gbab-49"></a><span class="cm"> * must provide definitions as required below (search for &quot;HAVE_CONFIG_H&quot;);</span>
<a name="gbab-50"></a><span class="cm"> * see configure.ac for more details of the requirements.  The macro</span>
<a name="gbab-51"></a><span class="cm"> * &quot;PNG_NO_CONFIG_H&quot; is provided for maintainers to test for dependencies on</span>
<a name="gbab-52"></a><span class="cm"> * &#39;configure&#39;; define this macro to prevent the configure build including the</span>
<a name="gbab-53"></a><span class="cm"> * configure generated config.h.  Libpng is expected to compile without *any*</span>
<a name="gbab-54"></a><span class="cm"> * special build system support on a reasonably ANSI-C compliant system.</span>
<a name="gbab-55"></a><span class="cm"> */</span>
<a name="gbab-56"></a><span class="cp">#if defined(HAVE_CONFIG_H) &amp;&amp; !defined(PNG_NO_CONFIG_H)</span>
<a name="gbab-57"></a><span class="cp">#  include &lt;config.h&gt;</span>
<a name="gbab-58"></a>
<a name="gbab-59"></a>   <span class="cm">/* Pick up the definition of &#39;restrict&#39; from config.h if it was read: */</span>
<a name="gbab-60"></a><span class="cp">#  define PNG_RESTRICT restrict</span>
<a name="gbab-61"></a><span class="cp">#endif</span>
<a name="gbab-62"></a>
<a name="gbab-63"></a><span class="cm">/* To support symbol prefixing it is necessary to know *before* including png.h</span>
<a name="gbab-64"></a><span class="cm"> * whether the fixed point (and maybe other) APIs are exported, because if they</span>
<a name="gbab-65"></a><span class="cm"> * are not internal definitions may be required.  This is handled below just</span>
<a name="gbab-66"></a><span class="cm"> * before png.h is included, but load the configuration now if it is available.</span>
<a name="gbab-67"></a><span class="cm"> */</span>
<a name="gbab-68"></a><span class="cp">#ifndef PNGLCONF_H</span>
<a name="gbab-69"></a><span class="cp">#  include &quot;pnglibconf.h&quot;</span>
<a name="gbab-70"></a><span class="cp">#endif</span>
<a name="gbab-71"></a>
<a name="gbab-72"></a><span class="cm">/* Local renames may change non-exported API functions from png.h */</span>
<a name="gbab-73"></a><span class="cp">#if defined(PNG_PREFIX) &amp;&amp; !defined(PNGPREFIX_H)</span>
<a name="gbab-74"></a><span class="cp">#  include &quot;pngprefix.h&quot;</span>
<a name="gbab-75"></a><span class="cp">#endif</span>
<a name="gbab-76"></a>
<a name="gbab-77"></a><span class="cp">#ifdef PNG_USER_CONFIG</span>
<a name="gbab-78"></a><span class="cp">#  include &quot;pngusr.h&quot;</span>
<a name="gbab-79"></a>   <span class="cm">/* These should have been defined in pngusr.h */</span>
<a name="gbab-80"></a><span class="cp">#  ifndef PNG_USER_PRIVATEBUILD</span>
<a name="gbab-81"></a><span class="cp">#    define PNG_USER_PRIVATEBUILD &quot;Custom libpng build&quot;</span>
<a name="gbab-82"></a><span class="cp">#  endif</span>
<a name="gbab-83"></a><span class="cp">#  ifndef PNG_USER_DLLFNAME_POSTFIX</span>
<a name="gbab-84"></a><span class="cp">#    define PNG_USER_DLLFNAME_POSTFIX &quot;Cb&quot;</span>
<a name="gbab-85"></a><span class="cp">#  endif</span>
<a name="gbab-86"></a><span class="cp">#endif</span>
<a name="gbab-87"></a>
<a name="gbab-88"></a><span class="cm">/* Compile time options.</span>
<a name="gbab-89"></a><span class="cm"> * =====================</span>
<a name="gbab-90"></a><span class="cm"> * In a multi-arch build the compiler may compile the code several times for the</span>
<a name="gbab-91"></a><span class="cm"> * same object module, producing different binaries for different architectures.</span>
<a name="gbab-92"></a><span class="cm"> * When this happens configure-time setting of the target host options cannot be</span>
<a name="gbab-93"></a><span class="cm"> * done and this interferes with the handling of the ARM NEON optimizations, and</span>
<a name="gbab-94"></a><span class="cm"> * possibly other similar optimizations.  Put additional tests here; in general</span>
<a name="gbab-95"></a><span class="cm"> * this is needed when the same option can be changed at both compile time and</span>
<a name="gbab-96"></a><span class="cm"> * run time depending on the target OS (i.e. iOS vs Android.)</span>
<a name="gbab-97"></a><span class="cm"> *</span>
<a name="gbab-98"></a><span class="cm"> * NOTE: symbol prefixing does not pass $(CFLAGS) to the preprocessor, because</span>
<a name="gbab-99"></a><span class="cm"> * this is not possible with certain compilers (Oracle SUN OS CC), as a result</span>
<a name="gbab-100"></a><span class="cm"> * it is necessary to ensure that all extern functions that *might* be used</span>
<a name="gbab-101"></a><span class="cm"> * regardless of $(CFLAGS) get declared in this file.  The test on __ARM_NEON__</span>
<a name="gbab-102"></a><span class="cm"> * below is one example of this behavior because it is controlled by the</span>
<a name="gbab-103"></a><span class="cm"> * presence or not of -mfpu=neon on the GCC command line, it is possible to do</span>
<a name="gbab-104"></a><span class="cm"> * this in $(CC), e.g. &quot;CC=gcc -mfpu=neon&quot;, but people who build libpng rarely</span>
<a name="gbab-105"></a><span class="cm"> * do this.</span>
<a name="gbab-106"></a><span class="cm"> */</span>
<a name="gbab-107"></a><span class="cp">#ifndef PNG_ARM_NEON_OPT</span>
<a name="gbab-108"></a>   <span class="cm">/* ARM NEON optimizations are being controlled by the compiler settings,</span>
<a name="gbab-109"></a><span class="cm">    * typically the target FPU.  If the FPU has been set to NEON (-mfpu=neon</span>
<a name="gbab-110"></a><span class="cm">    * with GCC) then the compiler will define __ARM_NEON__ and we can rely</span>
<a name="gbab-111"></a><span class="cm">    * unconditionally on NEON instructions not crashing, otherwise we must</span>
<a name="gbab-112"></a><span class="cm">    * disable use of NEON instructions.</span>
<a name="gbab-113"></a><span class="cm">    *</span>
<a name="gbab-114"></a><span class="cm">    * NOTE: at present these optimizations depend on &#39;ALIGNED_MEMORY&#39;, so they</span>
<a name="gbab-115"></a><span class="cm">    * can only be turned on automatically if that is supported too.  If</span>
<a name="gbab-116"></a><span class="cm">    * PNG_ARM_NEON_OPT is set in CPPFLAGS (to &gt;0) then arm/arm_init.c will fail</span>
<a name="gbab-117"></a><span class="cm">    * to compile with an appropriate #error if ALIGNED_MEMORY has been turned</span>
<a name="gbab-118"></a><span class="cm">    * off.</span>
<a name="gbab-119"></a><span class="cm">    *</span>
<a name="gbab-120"></a><span class="cm">    * Note that gcc-4.9 defines __ARM_NEON instead of the deprecated</span>
<a name="gbab-121"></a><span class="cm">    * __ARM_NEON__, so we check both variants.</span>
<a name="gbab-122"></a><span class="cm">    *</span>
<a name="gbab-123"></a><span class="cm">    * To disable ARM_NEON optimizations entirely, and skip compiling the</span>
<a name="gbab-124"></a><span class="cm">    * associated assembler code, pass --enable-arm-neon=no to configure</span>
<a name="gbab-125"></a><span class="cm">    * or put -DPNG_ARM_NEON_OPT=0 in CPPFLAGS.</span>
<a name="gbab-126"></a><span class="cm">    */</span>
<a name="gbab-127"></a><span class="cp">#  if (defined(__ARM_NEON__) || defined(__ARM_NEON)) &amp;&amp; \</span>
<a name="gbab-128"></a><span class="cp">   defined(PNG_ALIGNED_MEMORY_SUPPORTED)</span>
<a name="gbab-129"></a><span class="cp">#     define PNG_ARM_NEON_OPT 2</span>
<a name="gbab-130"></a><span class="cp">#  else</span>
<a name="gbab-131"></a><span class="cp">#     define PNG_ARM_NEON_OPT 0</span>
<a name="gbab-132"></a><span class="cp">#  endif</span>
<a name="gbab-133"></a><span class="cp">#endif</span>
<a name="gbab-134"></a>
<a name="gbab-135"></a><span class="cp">#if PNG_ARM_NEON_OPT &gt; 0</span>
<a name="gbab-136"></a>   <span class="cm">/* NEON optimizations are to be at least considered by libpng, so enable the</span>
<a name="gbab-137"></a><span class="cm">    * callbacks to do this.</span>
<a name="gbab-138"></a><span class="cm">    */</span>
<a name="gbab-139"></a><span class="cp">#  define PNG_FILTER_OPTIMIZATIONS png_init_filter_functions_neon</span>
<a name="gbab-140"></a>
<a name="gbab-141"></a>   <span class="cm">/* By default the &#39;intrinsics&#39; code in arm/filter_neon_intrinsics.c is used</span>
<a name="gbab-142"></a><span class="cm">    * if possible - if __ARM_NEON__ is set and the compiler version is not known</span>
<a name="gbab-143"></a><span class="cm">    * to be broken.  This is controlled by PNG_ARM_NEON_IMPLEMENTATION which can</span>
<a name="gbab-144"></a><span class="cm">    * be:</span>
<a name="gbab-145"></a><span class="cm">    *</span>
<a name="gbab-146"></a><span class="cm">    *    1  The intrinsics code (the default with __ARM_NEON__)</span>
<a name="gbab-147"></a><span class="cm">    *    2  The hand coded assembler (the default without __ARM_NEON__)</span>
<a name="gbab-148"></a><span class="cm">    *</span>
<a name="gbab-149"></a><span class="cm">    * It is possible to set PNG_ARM_NEON_IMPLEMENTATION in CPPFLAGS, however</span>
<a name="gbab-150"></a><span class="cm">    * this is *NOT* supported and may cease to work even after a minor revision</span>
<a name="gbab-151"></a><span class="cm">    * to libpng.  It *is* valid to do this for testing purposes, e.g. speed</span>
<a name="gbab-152"></a><span class="cm">    * testing or a new compiler, but the results should be communicated to the</span>
<a name="gbab-153"></a><span class="cm">    * libpng implementation list for incorporation in the next minor release.</span>
<a name="gbab-154"></a><span class="cm">    */</span>
<a name="gbab-155"></a><span class="cp">#  ifndef PNG_ARM_NEON_IMPLEMENTATION</span>
<a name="gbab-156"></a><span class="cp">#     if defined(__ARM_NEON__) || defined(__ARM_NEON)</span>
<a name="gbab-157"></a><span class="cp">#        if defined(__clang__)</span>
<a name="gbab-158"></a>            <span class="cm">/* At present it is unknown by the libpng developers which versions</span>
<a name="gbab-159"></a><span class="cm">             * of clang support the intrinsics, however some or perhaps all</span>
<a name="gbab-160"></a><span class="cm">             * versions do not work with the assembler so this may be</span>
<a name="gbab-161"></a><span class="cm">             * irrelevant, so just use the default (do nothing here.)</span>
<a name="gbab-162"></a><span class="cm">             */</span>
<a name="gbab-163"></a><span class="cp">#        elif defined(__GNUC__)</span>
<a name="gbab-164"></a>            <span class="cm">/* GCC 4.5.4 NEON support is known to be broken.  4.6.3 is known to</span>
<a name="gbab-165"></a><span class="cm">             * work, so if this *is* GCC, or G++, look for a version &gt;4.5</span>
<a name="gbab-166"></a><span class="cm">             */</span>
<a name="gbab-167"></a><span class="cp">#           if __GNUC__ &lt; 4 || (__GNUC__ == 4 &amp;&amp; __GNUC_MINOR__ &lt; 6)</span>
<a name="gbab-168"></a><span class="cp">#              define PNG_ARM_NEON_IMPLEMENTATION 2</span>
<a name="gbab-169"></a><span class="cp">#           endif </span><span class="cm">/* no GNUC support */</span><span class="cp"></span>
<a name="gbab-170"></a><span class="cp">#        endif </span><span class="cm">/* __GNUC__ */</span><span class="cp"></span>
<a name="gbab-171"></a><span class="cp">#     else </span><span class="cm">/* !defined __ARM_NEON__ */</span><span class="cp"></span>
<a name="gbab-172"></a>         <span class="cm">/* The &#39;intrinsics&#39; code simply won&#39;t compile without this -mfpu=neon:</span>
<a name="gbab-173"></a><span class="cm">          */</span>
<a name="gbab-174"></a><span class="cp">#        define PNG_ARM_NEON_IMPLEMENTATION 2</span>
<a name="gbab-175"></a><span class="cp">#     endif </span><span class="cm">/* __ARM_NEON__ */</span><span class="cp"></span>
<a name="gbab-176"></a><span class="cp">#  endif </span><span class="cm">/* !PNG_ARM_NEON_IMPLEMENTATION */</span><span class="cp"></span>
<a name="gbab-177"></a>
<a name="gbab-178"></a><span class="cp">#  ifndef PNG_ARM_NEON_IMPLEMENTATION</span>
<a name="gbab-179"></a>      <span class="cm">/* Use the intrinsics code by default. */</span>
<a name="gbab-180"></a><span class="cp">#     define PNG_ARM_NEON_IMPLEMENTATION 1</span>
<a name="gbab-181"></a><span class="cp">#  endif</span>
<a name="gbab-182"></a><span class="cp">#endif </span><span class="cm">/* PNG_ARM_NEON_OPT &gt; 0 */</span><span class="cp"></span>
<a name="gbab-183"></a>
<a name="gbab-184"></a><span class="cm">/* Is this a build of a DLL where compilation of the object modules requires</span>
<a name="gbab-185"></a><span class="cm"> * different preprocessor settings to those required for a simple library?  If</span>
<a name="gbab-186"></a><span class="cm"> * so PNG_BUILD_DLL must be set.</span>
<a name="gbab-187"></a><span class="cm"> *</span>
<a name="gbab-188"></a><span class="cm"> * If libpng is used inside a DLL but that DLL does not export the libpng APIs</span>
<a name="gbab-189"></a><span class="cm"> * PNG_BUILD_DLL must not be set.  To avoid the code below kicking in build a</span>
<a name="gbab-190"></a><span class="cm"> * static library of libpng then link the DLL against that.</span>
<a name="gbab-191"></a><span class="cm"> */</span>
<a name="gbab-192"></a><span class="cp">#ifndef PNG_BUILD_DLL</span>
<a name="gbab-193"></a><span class="cp">#  ifdef DLL_EXPORT</span>
<a name="gbab-194"></a>      <span class="cm">/* This is set by libtool when files are compiled for a DLL; libtool</span>
<a name="gbab-195"></a><span class="cm">       * always compiles twice, even on systems where it isn&#39;t necessary.  Set</span>
<a name="gbab-196"></a><span class="cm">       * PNG_BUILD_DLL in case it is necessary:</span>
<a name="gbab-197"></a><span class="cm">       */</span>
<a name="gbab-198"></a><span class="cp">#     define PNG_BUILD_DLL</span>
<a name="gbab-199"></a><span class="cp">#  else</span>
<a name="gbab-200"></a><span class="cp">#     ifdef _WINDLL</span>
<a name="gbab-201"></a>         <span class="cm">/* This is set by the Microsoft Visual Studio IDE in projects that</span>
<a name="gbab-202"></a><span class="cm">          * build a DLL.  It can&#39;t easily be removed from those projects (it</span>
<a name="gbab-203"></a><span class="cm">          * isn&#39;t visible in the Visual Studio UI) so it is a fairly reliable</span>
<a name="gbab-204"></a><span class="cm">          * indication that PNG_IMPEXP needs to be set to the DLL export</span>
<a name="gbab-205"></a><span class="cm">          * attributes.</span>
<a name="gbab-206"></a><span class="cm">          */</span>
<a name="gbab-207"></a><span class="cp">#        define PNG_BUILD_DLL</span>
<a name="gbab-208"></a><span class="cp">#     else</span>
<a name="gbab-209"></a><span class="cp">#        ifdef __DLL__</span>
<a name="gbab-210"></a>            <span class="cm">/* This is set by the Borland C system when compiling for a DLL</span>
<a name="gbab-211"></a><span class="cm">             * (as above.)</span>
<a name="gbab-212"></a><span class="cm">             */</span>
<a name="gbab-213"></a><span class="cp">#           define PNG_BUILD_DLL</span>
<a name="gbab-214"></a><span class="cp">#        else</span>
<a name="gbab-215"></a>            <span class="cm">/* Add additional compiler cases here. */</span>
<a name="gbab-216"></a><span class="cp">#        endif</span>
<a name="gbab-217"></a><span class="cp">#     endif</span>
<a name="gbab-218"></a><span class="cp">#  endif</span>
<a name="gbab-219"></a><span class="cp">#endif </span><span class="cm">/* Setting PNG_BUILD_DLL if required */</span><span class="cp"></span>
<a name="gbab-220"></a>
<a name="gbab-221"></a><span class="cm">/* See pngconf.h for more details: the builder of the library may set this on</span>
<a name="gbab-222"></a><span class="cm"> * the command line to the right thing for the specific compilation system or it</span>
<a name="gbab-223"></a><span class="cm"> * may be automagically set above (at present we know of no system where it does</span>
<a name="gbab-224"></a><span class="cm"> * need to be set on the command line.)</span>
<a name="gbab-225"></a><span class="cm"> *</span>
<a name="gbab-226"></a><span class="cm"> * PNG_IMPEXP must be set here when building the library to prevent pngconf.h</span>
<a name="gbab-227"></a><span class="cm"> * setting it to the &quot;import&quot; setting for a DLL build.</span>
<a name="gbab-228"></a><span class="cm"> */</span>
<a name="gbab-229"></a><span class="cp">#ifndef PNG_IMPEXP</span>
<a name="gbab-230"></a><span class="cp">#  ifdef PNG_BUILD_DLL</span>
<a name="gbab-231"></a><span class="cp">#     define PNG_IMPEXP PNG_DLL_EXPORT</span>
<a name="gbab-232"></a><span class="cp">#  else</span>
<a name="gbab-233"></a>      <span class="cm">/* Not building a DLL, or the DLL doesn&#39;t require specific export</span>
<a name="gbab-234"></a><span class="cm">       * definitions.</span>
<a name="gbab-235"></a><span class="cm">       */</span>
<a name="gbab-236"></a><span class="cp">#     define PNG_IMPEXP</span>
<a name="gbab-237"></a><span class="cp">#  endif</span>
<a name="gbab-238"></a><span class="cp">#endif</span>
<a name="gbab-239"></a>
<a name="gbab-240"></a><span class="cm">/* No warnings for private or deprecated functions in the build: */</span>
<a name="gbab-241"></a><span class="cp">#ifndef PNG_DEPRECATED</span>
<a name="gbab-242"></a><span class="cp">#  define PNG_DEPRECATED</span>
<a name="gbab-243"></a><span class="cp">#endif</span>
<a name="gbab-244"></a><span class="cp">#ifndef PNG_PRIVATE</span>
<a name="gbab-245"></a><span class="cp">#  define PNG_PRIVATE</span>
<a name="gbab-246"></a><span class="cp">#endif</span>
<a name="gbab-247"></a>
<a name="gbab-248"></a><span class="cm">/* Symbol preprocessing support.</span>
<a name="gbab-249"></a><span class="cm"> *</span>
<a name="gbab-250"></a><span class="cm"> * To enable listing global, but internal, symbols the following macros should</span>
<a name="gbab-251"></a><span class="cm"> * always be used to declare an extern data or function object in this file.</span>
<a name="gbab-252"></a><span class="cm"> */</span>
<a name="gbab-253"></a><span class="cp">#ifndef PNG_INTERNAL_DATA</span>
<a name="gbab-254"></a><span class="cp">#  define PNG_INTERNAL_DATA(type, name, array) PNG_LINKAGE_DATA type name array</span>
<a name="gbab-255"></a><span class="cp">#endif</span>
<a name="gbab-256"></a>
<a name="gbab-257"></a><span class="cp">#ifndef PNG_INTERNAL_FUNCTION</span>
<a name="gbab-258"></a><span class="cp">#  define PNG_INTERNAL_FUNCTION(type, name, args, attributes)\</span>
<a name="gbab-259"></a><span class="cp">      PNG_LINKAGE_FUNCTION PNG_FUNCTION(type, name, args, PNG_EMPTY attributes)</span>
<a name="gbab-260"></a><span class="cp">#endif</span>
<a name="gbab-261"></a>
<a name="gbab-262"></a><span class="cp">#ifndef PNG_INTERNAL_CALLBACK</span>
<a name="gbab-263"></a><span class="cp">#  define PNG_INTERNAL_CALLBACK(type, name, args, attributes)\</span>
<a name="gbab-264"></a><span class="cp">      PNG_LINKAGE_CALLBACK PNG_FUNCTION(type, (PNGCBAPI name), args,\</span>
<a name="gbab-265"></a><span class="cp">         PNG_EMPTY attributes)</span>
<a name="gbab-266"></a><span class="cp">#endif</span>
<a name="gbab-267"></a>
<a name="gbab-268"></a><span class="cm">/* If floating or fixed point APIs are disabled they may still be compiled</span>
<a name="gbab-269"></a><span class="cm"> * internally.  To handle this make sure they are declared as the appropriate</span>
<a name="gbab-270"></a><span class="cm"> * internal extern function (otherwise the symbol prefixing stuff won&#39;t work and</span>
<a name="gbab-271"></a><span class="cm"> * the functions will be used without definitions.)</span>
<a name="gbab-272"></a><span class="cm"> *</span>
<a name="gbab-273"></a><span class="cm"> * NOTE: although all the API functions are declared here they are not all</span>
<a name="gbab-274"></a><span class="cm"> * actually built!  Because the declarations are still made it is necessary to</span>
<a name="gbab-275"></a><span class="cm"> * fake out types that they depend on.</span>
<a name="gbab-276"></a><span class="cm"> */</span>
<a name="gbab-277"></a><span class="cp">#ifndef PNG_FP_EXPORT</span>
<a name="gbab-278"></a><span class="cp">#  ifndef PNG_FLOATING_POINT_SUPPORTED</span>
<a name="gbab-279"></a><span class="cp">#     define PNG_FP_EXPORT(ordinal, type, name, args)\</span>
<a name="gbab-280"></a><span class="cp">         PNG_INTERNAL_FUNCTION(type, name, args, PNG_EMPTY);</span>
<a name="gbab-281"></a><span class="cp">#     ifndef PNG_VERSION_INFO_ONLY</span>
<a name="gbab-282"></a>         <span class="k">typedef</span> <span class="k">struct</span> <span class="n">png_incomplete</span> <span class="n">png_double</span><span class="p">;</span>
<a name="gbab-283"></a>         <span class="k">typedef</span> <span class="n">png_double</span><span class="o">*</span>           <span class="n">png_doublep</span><span class="p">;</span>
<a name="gbab-284"></a>         <span class="k">typedef</span> <span class="k">const</span> <span class="n">png_double</span><span class="o">*</span>     <span class="n">png_const_doublep</span><span class="p">;</span>
<a name="gbab-285"></a>         <span class="k">typedef</span> <span class="n">png_double</span><span class="o">**</span>          <span class="n">png_doublepp</span><span class="p">;</span>
<a name="gbab-286"></a><span class="cp">#     endif</span>
<a name="gbab-287"></a><span class="cp">#  endif</span>
<a name="gbab-288"></a><span class="cp">#endif</span>
<a name="gbab-289"></a><span class="cp">#ifndef PNG_FIXED_EXPORT</span>
<a name="gbab-290"></a><span class="cp">#  ifndef PNG_FIXED_POINT_SUPPORTED</span>
<a name="gbab-291"></a><span class="cp">#     define PNG_FIXED_EXPORT(ordinal, type, name, args)\</span>
<a name="gbab-292"></a><span class="cp">         PNG_INTERNAL_FUNCTION(type, name, args, PNG_EMPTY);</span>
<a name="gbab-293"></a><span class="cp">#  endif</span>
<a name="gbab-294"></a><span class="cp">#endif</span>
<a name="gbab-295"></a>
<a name="gbab-296"></a><span class="cp">#include</span> <span class="cpf">&quot;png.h&quot;</span><span class="cp"></span>
<a name="gbab-297"></a>
<a name="gbab-298"></a><span class="cm">/* pngconf.h does not set PNG_DLL_EXPORT unless it is required, so: */</span>
<a name="gbab-299"></a><span class="cp">#ifndef PNG_DLL_EXPORT</span>
<a name="gbab-300"></a><span class="cp">#  define PNG_DLL_EXPORT</span>
<a name="gbab-301"></a><span class="cp">#endif</span>
<a name="gbab-302"></a>
<a name="gbab-303"></a><span class="cm">/* This is a global switch to set the compilation for an installed system</span>
<a name="gbab-304"></a><span class="cm"> * (a release build).  It can be set for testing debug builds to ensure that</span>
<a name="gbab-305"></a><span class="cm"> * they will compile when the build type is switched to RC or STABLE, the</span>
<a name="gbab-306"></a><span class="cm"> * default is just to use PNG_LIBPNG_BUILD_BASE_TYPE.  Set this in CPPFLAGS</span>
<a name="gbab-307"></a><span class="cm"> * with either:</span>
<a name="gbab-308"></a><span class="cm"> *</span>
<a name="gbab-309"></a><span class="cm"> *   -DPNG_RELEASE_BUILD Turns on the release compile path</span>
<a name="gbab-310"></a><span class="cm"> *   -DPNG_RELEASE_BUILD=0 Turns it off</span>
<a name="gbab-311"></a><span class="cm"> * or in your pngusr.h with</span>
<a name="gbab-312"></a><span class="cm"> *   #define PNG_RELEASE_BUILD=1 Turns on the release compile path</span>
<a name="gbab-313"></a><span class="cm"> *   #define PNG_RELEASE_BUILD=0 Turns it off</span>
<a name="gbab-314"></a><span class="cm"> */</span>
<a name="gbab-315"></a><span class="cp">#ifndef PNG_RELEASE_BUILD</span>
<a name="gbab-316"></a><span class="cp">#  define PNG_RELEASE_BUILD (PNG_LIBPNG_BUILD_BASE_TYPE &gt;= PNG_LIBPNG_BUILD_RC)</span>
<a name="gbab-317"></a><span class="cp">#endif</span>
<a name="gbab-318"></a>
<a name="gbab-319"></a><span class="cm">/* SECURITY and SAFETY:</span>
<a name="gbab-320"></a><span class="cm"> *</span>
<a name="gbab-321"></a><span class="cm"> * libpng is built with support for internal limits on image dimensions and</span>
<a name="gbab-322"></a><span class="cm"> * memory usage.  These are documented in scripts/pnglibconf.dfa of the</span>
<a name="gbab-323"></a><span class="cm"> * source and recorded in the machine generated header file pnglibconf.h.</span>
<a name="gbab-324"></a><span class="cm"> */</span>
<a name="gbab-325"></a>
<a name="gbab-326"></a><span class="cm">/* If you are running on a machine where you cannot allocate more</span>
<a name="gbab-327"></a><span class="cm"> * than 64K of memory at once, uncomment this.  While libpng will not</span>
<a name="gbab-328"></a><span class="cm"> * normally need that much memory in a chunk (unless you load up a very</span>
<a name="gbab-329"></a><span class="cm"> * large file), zlib needs to know how big of a chunk it can use, and</span>
<a name="gbab-330"></a><span class="cm"> * libpng thus makes sure to check any memory allocation to verify it</span>
<a name="gbab-331"></a><span class="cm"> * will fit into memory.</span>
<a name="gbab-332"></a><span class="cm"> *</span>
<a name="gbab-333"></a><span class="cm"> * zlib provides &#39;MAXSEG_64K&#39; which, if defined, indicates the</span>
<a name="gbab-334"></a><span class="cm"> * same limit and pngconf.h (already included) sets the limit</span>
<a name="gbab-335"></a><span class="cm"> * if certain operating systems are detected.</span>
<a name="gbab-336"></a><span class="cm"> */</span>
<a name="gbab-337"></a><span class="cp">#if defined(MAXSEG_64K) &amp;&amp; !defined(PNG_MAX_MALLOC_64K)</span>
<a name="gbab-338"></a><span class="cp">#  define PNG_MAX_MALLOC_64K</span>
<a name="gbab-339"></a><span class="cp">#endif</span>
<a name="gbab-340"></a>
<a name="gbab-341"></a><span class="cp">#ifndef PNG_UNUSED</span>
<a name="gbab-342"></a><span class="cm">/* Unused formal parameter warnings are silenced using the following macro</span>
<a name="gbab-343"></a><span class="cm"> * which is expected to have no bad effects on performance (optimizing</span>
<a name="gbab-344"></a><span class="cm"> * compilers will probably remove it entirely).  Note that if you replace</span>
<a name="gbab-345"></a><span class="cm"> * it with something other than whitespace, you must include the terminating</span>
<a name="gbab-346"></a><span class="cm"> * semicolon.</span>
<a name="gbab-347"></a><span class="cm"> */</span>
<a name="gbab-348"></a><span class="cp">#  define PNG_UNUSED(param) (void)param;</span>
<a name="gbab-349"></a><span class="cp">#endif</span>
<a name="gbab-350"></a>
<a name="gbab-351"></a><span class="cm">/* Just a little check that someone hasn&#39;t tried to define something</span>
<a name="gbab-352"></a><span class="cm"> * contradictory.</span>
<a name="gbab-353"></a><span class="cm"> */</span>
<a name="gbab-354"></a><span class="cp">#if (PNG_ZBUF_SIZE &gt; 65536L) &amp;&amp; defined(PNG_MAX_MALLOC_64K)</span>
<a name="gbab-355"></a><span class="cp">#  undef PNG_ZBUF_SIZE</span>
<a name="gbab-356"></a><span class="cp">#  define PNG_ZBUF_SIZE 65536L</span>
<a name="gbab-357"></a><span class="cp">#endif</span>
<a name="gbab-358"></a>
<a name="gbab-359"></a><span class="cm">/* If warnings or errors are turned off the code is disabled or redirected here.</span>
<a name="gbab-360"></a><span class="cm"> * From 1.5.4 functions have been added to allow very limited formatting of</span>
<a name="gbab-361"></a><span class="cm"> * error and warning messages - this code will also be disabled here.</span>
<a name="gbab-362"></a><span class="cm"> */</span>
<a name="gbab-363"></a><span class="cp">#ifdef PNG_WARNINGS_SUPPORTED</span>
<a name="gbab-364"></a><span class="cp">#  define PNG_WARNING_PARAMETERS(p) png_warning_parameters p;</span>
<a name="gbab-365"></a><span class="cp">#else</span>
<a name="gbab-366"></a><span class="cp">#  define png_warning_parameter(p,number,string) ((void)0)</span>
<a name="gbab-367"></a><span class="cp">#  define png_warning_parameter_unsigned(p,number,format,value) ((void)0)</span>
<a name="gbab-368"></a><span class="cp">#  define png_warning_parameter_signed(p,number,format,value) ((void)0)</span>
<a name="gbab-369"></a><span class="cp">#  define png_formatted_warning(pp,p,message) ((void)(pp))</span>
<a name="gbab-370"></a><span class="cp">#  define PNG_WARNING_PARAMETERS(p)</span>
<a name="gbab-371"></a><span class="cp">#endif</span>
<a name="gbab-372"></a><span class="cp">#ifndef PNG_ERROR_TEXT_SUPPORTED</span>
<a name="gbab-373"></a><span class="cp">#  define png_fixed_error(s1,s2) png_err(s1)</span>
<a name="gbab-374"></a><span class="cp">#endif</span>
<a name="gbab-375"></a>
<a name="gbab-376"></a><span class="cm">/* C allows up-casts from (void*) to any pointer and (const void*) to any</span>
<a name="gbab-377"></a><span class="cm"> * pointer to a const object.  C++ regards this as a type error and requires an</span>
<a name="gbab-378"></a><span class="cm"> * explicit, static, cast and provides the static_cast&lt;&gt; rune to ensure that</span>
<a name="gbab-379"></a><span class="cm"> * const is not cast away.</span>
<a name="gbab-380"></a><span class="cm"> */</span>
<a name="gbab-381"></a><span class="cp">#ifdef __cplusplus</span>
<a name="gbab-382"></a><span class="cp">#  define png_voidcast(type, value) static_cast&lt;type&gt;(value)</span>
<a name="gbab-383"></a><span class="cp">#  define png_constcast(type, value) const_cast&lt;type&gt;(value)</span>
<a name="gbab-384"></a><span class="cp">#  define png_aligncast(type, value) \</span>
<a name="gbab-385"></a><span class="cp">   static_cast&lt;type&gt;(static_cast&lt;void*&gt;(value))</span>
<a name="gbab-386"></a><span class="cp">#  define png_aligncastconst(type, value) \</span>
<a name="gbab-387"></a><span class="cp">   static_cast&lt;type&gt;(static_cast&lt;const void*&gt;(value))</span>
<a name="gbab-388"></a><span class="cp">#else</span>
<a name="gbab-389"></a><span class="cp">#  define png_voidcast(type, value) (value)</span>
<a name="gbab-390"></a><span class="cp">#  define png_constcast(type, value) ((type)(value))</span>
<a name="gbab-391"></a><span class="cp">#  define png_aligncast(type, value) ((void*)(value))</span>
<a name="gbab-392"></a><span class="cp">#  define png_aligncastconst(type, value) ((const void*)(value))</span>
<a name="gbab-393"></a><span class="cp">#endif </span><span class="cm">/* __cplusplus */</span><span class="cp"></span>
<a name="gbab-394"></a>
<a name="gbab-395"></a><span class="cm">/* Some fixed point APIs are still required even if not exported because</span>
<a name="gbab-396"></a><span class="cm"> * they get used by the corresponding floating point APIs.  This magic</span>
<a name="gbab-397"></a><span class="cm"> * deals with this:</span>
<a name="gbab-398"></a><span class="cm"> */</span>
<a name="gbab-399"></a><span class="cp">#ifdef PNG_FIXED_POINT_SUPPORTED</span>
<a name="gbab-400"></a><span class="cp">#  define PNGFAPI PNGAPI</span>
<a name="gbab-401"></a><span class="cp">#else</span>
<a name="gbab-402"></a><span class="cp">#  define PNGFAPI </span><span class="cm">/* PRIVATE */</span><span class="cp"></span>
<a name="gbab-403"></a><span class="cp">#endif</span>
<a name="gbab-404"></a>
<a name="gbab-405"></a><span class="cp">#ifndef PNG_VERSION_INFO_ONLY</span>
<a name="gbab-406"></a><span class="cm">/* Other defines specific to compilers can go here.  Try to keep</span>
<a name="gbab-407"></a><span class="cm"> * them inside an appropriate ifdef/endif pair for portability.</span>
<a name="gbab-408"></a><span class="cm"> */</span>
<a name="gbab-409"></a><span class="cp">#if defined(PNG_FLOATING_POINT_SUPPORTED) ||\</span>
<a name="gbab-410"></a><span class="cp">    defined(PNG_FLOATING_ARITHMETIC_SUPPORTED)</span>
<a name="gbab-411"></a>   <span class="cm">/* png.c requires the following ANSI-C constants if the conversion of</span>
<a name="gbab-412"></a><span class="cm">    * floating point to ASCII is implemented therein:</span>
<a name="gbab-413"></a><span class="cm">    *</span>
<a name="gbab-414"></a><span class="cm">    *  DBL_DIG  Maximum number of decimal digits (can be set to any constant)</span>
<a name="gbab-415"></a><span class="cm">    *  DBL_MIN  Smallest normalized fp number (can be set to an arbitrary value)</span>
<a name="gbab-416"></a><span class="cm">    *  DBL_MAX  Maximum floating point number (can be set to an arbitrary value)</span>
<a name="gbab-417"></a><span class="cm">    */</span>
<a name="gbab-418"></a><span class="cp">#  include &lt;float.h&gt;</span>
<a name="gbab-419"></a>
<a name="gbab-420"></a><span class="cp">#  if (defined(__MWERKS__) &amp;&amp; defined(macintosh)) || defined(applec) || \</span>
<a name="gbab-421"></a><span class="cp">    defined(THINK_C) || defined(__SC__) || defined(TARGET_OS_MAC)</span>
<a name="gbab-422"></a>     <span class="cm">/* We need to check that &lt;math.h&gt; hasn&#39;t already been included earlier</span>
<a name="gbab-423"></a><span class="cm">      * as it seems it doesn&#39;t agree with &lt;fp.h&gt;, yet we should really use</span>
<a name="gbab-424"></a><span class="cm">      * &lt;fp.h&gt; if possible.</span>
<a name="gbab-425"></a><span class="cm">      */</span>
<a name="gbab-426"></a><span class="cp">#    if !defined(__MATH_H__) &amp;&amp; !defined(__MATH_H) &amp;&amp; !defined(__cmath__)</span>
<a name="gbab-427"></a><span class="cp">#      include &lt;fp.h&gt;</span>
<a name="gbab-428"></a><span class="cp">#    endif</span>
<a name="gbab-429"></a><span class="cp">#  else</span>
<a name="gbab-430"></a><span class="cp">#    include &lt;math.h&gt;</span>
<a name="gbab-431"></a><span class="cp">#  endif</span>
<a name="gbab-432"></a><span class="cp">#  if defined(_AMIGA) &amp;&amp; defined(__SASC) &amp;&amp; defined(_M68881)</span>
<a name="gbab-433"></a>     <span class="cm">/* Amiga SAS/C: We must include builtin FPU functions when compiling using</span>
<a name="gbab-434"></a><span class="cm">      * MATH=68881</span>
<a name="gbab-435"></a><span class="cm">      */</span>
<a name="gbab-436"></a><span class="cp">#    include &lt;m68881.h&gt;</span>
<a name="gbab-437"></a><span class="cp">#  endif</span>
<a name="gbab-438"></a><span class="cp">#endif</span>
<a name="gbab-439"></a>
<a name="gbab-440"></a><span class="cm">/* This provides the non-ANSI (far) memory allocation routines. */</span>
<a name="gbab-441"></a><span class="cp">#if defined(__TURBOC__) &amp;&amp; defined(__MSDOS__)</span>
<a name="gbab-442"></a><span class="cp">#  include &lt;mem.h&gt;</span>
<a name="gbab-443"></a><span class="cp">#  include &lt;alloc.h&gt;</span>
<a name="gbab-444"></a><span class="cp">#endif</span>
<a name="gbab-445"></a>
<a name="gbab-446"></a><span class="cp">#if defined(WIN32) || defined(_Windows) || defined(_WINDOWS) || \</span>
<a name="gbab-447"></a><span class="cp">    defined(_WIN32) || defined(__WIN32__)</span>
<a name="gbab-448"></a><span class="cp">#  include &lt;windows.h&gt;  </span><span class="cm">/* defines _WINDOWS_ macro */</span><span class="cp"></span>
<a name="gbab-449"></a><span class="cp">#endif</span>
<a name="gbab-450"></a><span class="cp">#endif </span><span class="cm">/* PNG_VERSION_INFO_ONLY */</span><span class="cp"></span>
<a name="gbab-451"></a>
<a name="gbab-452"></a><span class="cm">/* Moved here around 1.5.0beta36 from pngconf.h */</span>
<a name="gbab-453"></a><span class="cm">/* Users may want to use these so they are not private.  Any library</span>
<a name="gbab-454"></a><span class="cm"> * functions that are passed far data must be model-independent.</span>
<a name="gbab-455"></a><span class="cm"> */</span>
<a name="gbab-456"></a>
<a name="gbab-457"></a><span class="cm">/* Memory model/platform independent fns */</span>
<a name="gbab-458"></a><span class="cp">#ifndef PNG_ABORT</span>
<a name="gbab-459"></a><span class="cp">#  ifdef _WINDOWS_</span>
<a name="gbab-460"></a><span class="cp">#    define PNG_ABORT() ExitProcess(0)</span>
<a name="gbab-461"></a><span class="cp">#  else</span>
<a name="gbab-462"></a><span class="cp">#    define PNG_ABORT() abort()</span>
<a name="gbab-463"></a><span class="cp">#  endif</span>
<a name="gbab-464"></a><span class="cp">#endif</span>
<a name="gbab-465"></a>
<a name="gbab-466"></a><span class="cm">/* These macros may need to be architecture dependent. */</span>
<a name="gbab-467"></a><span class="cp">#define PNG_ALIGN_NONE   0 </span><span class="cm">/* do not use data alignment */</span><span class="cp"></span>
<a name="gbab-468"></a><span class="cp">#define PNG_ALIGN_ALWAYS 1 </span><span class="cm">/* assume unaligned accesses are OK */</span><span class="cp"></span>
<a name="gbab-469"></a><span class="cp">#ifdef offsetof</span>
<a name="gbab-470"></a><span class="cp">#  define PNG_ALIGN_OFFSET 2 </span><span class="cm">/* use offsetof to determine alignment */</span><span class="cp"></span>
<a name="gbab-471"></a><span class="cp">#else</span>
<a name="gbab-472"></a><span class="cp">#  define PNG_ALIGN_OFFSET -1 </span><span class="cm">/* prevent the use of this */</span><span class="cp"></span>
<a name="gbab-473"></a><span class="cp">#endif</span>
<a name="gbab-474"></a><span class="cp">#define PNG_ALIGN_SIZE   3 </span><span class="cm">/* use sizeof to determine alignment */</span><span class="cp"></span>
<a name="gbab-475"></a>
<a name="gbab-476"></a><span class="cp">#ifndef PNG_ALIGN_TYPE</span>
<a name="gbab-477"></a>   <span class="cm">/* Default to using aligned access optimizations and requiring alignment to a</span>
<a name="gbab-478"></a><span class="cm">    * multiple of the data type size.  Override in a compiler specific fashion</span>
<a name="gbab-479"></a><span class="cm">    * if necessary by inserting tests here:</span>
<a name="gbab-480"></a><span class="cm">    */</span>
<a name="gbab-481"></a><span class="cp">#  define PNG_ALIGN_TYPE PNG_ALIGN_SIZE</span>
<a name="gbab-482"></a><span class="cp">#endif</span>
<a name="gbab-483"></a>
<a name="gbab-484"></a><span class="cp">#if PNG_ALIGN_TYPE == PNG_ALIGN_SIZE</span>
<a name="gbab-485"></a>   <span class="cm">/* This is used because in some compiler implementations non-aligned</span>
<a name="gbab-486"></a><span class="cm">    * structure members are supported, so the offsetof approach below fails.</span>
<a name="gbab-487"></a><span class="cm">    * Set PNG_ALIGN_SIZE=0 for compiler combinations where unaligned access</span>
<a name="gbab-488"></a><span class="cm">    * is good for performance.  Do not do this unless you have tested the result</span>
<a name="gbab-489"></a><span class="cm">    * and understand it.</span>
<a name="gbab-490"></a><span class="cm">    */</span>
<a name="gbab-491"></a><span class="cp">#  define png_alignof(type) (sizeof (type))</span>
<a name="gbab-492"></a><span class="cp">#else</span>
<a name="gbab-493"></a><span class="cp">#  if PNG_ALIGN_TYPE == PNG_ALIGN_OFFSET</span>
<a name="gbab-494"></a><span class="cp">#     define png_alignof(type) offsetof(struct{char c; type t;}, t)</span>
<a name="gbab-495"></a><span class="cp">#  else</span>
<a name="gbab-496"></a><span class="cp">#     if PNG_ALIGN_TYPE == PNG_ALIGN_ALWAYS</span>
<a name="gbab-497"></a><span class="cp">#        define png_alignof(type) (1)</span>
<a name="gbab-498"></a><span class="cp">#     endif</span>
<a name="gbab-499"></a>      <span class="cm">/* Else leave png_alignof undefined to prevent use thereof */</span>
<a name="gbab-500"></a><span class="cp">#  endif</span>
<a name="gbab-501"></a><span class="cp">#endif</span>
<a name="gbab-502"></a>
<a name="gbab-503"></a><span class="cm">/* This implicitly assumes alignment is always to a power of 2. */</span>
<a name="gbab-504"></a><span class="cp">#ifdef png_alignof</span>
<a name="gbab-505"></a><span class="cp">#  define png_isaligned(ptr, type)\</span>
<a name="gbab-506"></a><span class="cp">   ((((const char*)ptr-(const char*)0) &amp; (png_alignof(type)-1)) == 0)</span>
<a name="gbab-507"></a><span class="cp">#else</span>
<a name="gbab-508"></a><span class="cp">#  define png_isaligned(ptr, type) 0</span>
<a name="gbab-509"></a><span class="cp">#endif</span>
<a name="gbab-510"></a>
<a name="gbab-511"></a><span class="cm">/* End of memory model/platform independent support */</span>
<a name="gbab-512"></a><span class="cm">/* End of 1.5.0beta36 move from pngconf.h */</span>
<a name="gbab-513"></a>
<a name="gbab-514"></a><span class="cm">/* CONSTANTS and UTILITY MACROS</span>
<a name="gbab-515"></a><span class="cm"> * These are used internally by libpng and not exposed in the API</span>
<a name="gbab-516"></a><span class="cm"> */</span>
<a name="gbab-517"></a>
<a name="gbab-518"></a><span class="cm">/* Various modes of operation.  Note that after an init, mode is set to</span>
<a name="gbab-519"></a><span class="cm"> * zero automatically when the structure is created.  Three of these</span>
<a name="gbab-520"></a><span class="cm"> * are defined in png.h because they need to be visible to applications</span>
<a name="gbab-521"></a><span class="cm"> * that call png_set_unknown_chunk().</span>
<a name="gbab-522"></a><span class="cm"> */</span>
<a name="gbab-523"></a><span class="cm">/* #define PNG_HAVE_IHDR            0x01 (defined in png.h) */</span>
<a name="gbab-524"></a><span class="cm">/* #define PNG_HAVE_PLTE            0x02 (defined in png.h) */</span>
<a name="gbab-525"></a><span class="cp">#define PNG_HAVE_IDAT               0x04</span>
<a name="gbab-526"></a><span class="cm">/* #define PNG_AFTER_IDAT           0x08 (defined in png.h) */</span>
<a name="gbab-527"></a><span class="cp">#define PNG_HAVE_IEND               0x10</span>
<a name="gbab-528"></a>                   <span class="cm">/*               0x20 (unused) */</span>
<a name="gbab-529"></a>                   <span class="cm">/*               0x40 (unused) */</span>
<a name="gbab-530"></a>                   <span class="cm">/*               0x80 (unused) */</span>
<a name="gbab-531"></a><span class="cp">#define PNG_HAVE_CHUNK_HEADER      0x100</span>
<a name="gbab-532"></a><span class="cp">#define PNG_WROTE_tIME             0x200</span>
<a name="gbab-533"></a><span class="cp">#define PNG_WROTE_INFO_BEFORE_PLTE 0x400</span>
<a name="gbab-534"></a><span class="cp">#define PNG_BACKGROUND_IS_GRAY     0x800</span>
<a name="gbab-535"></a><span class="cp">#define PNG_HAVE_PNG_SIGNATURE    0x1000</span>
<a name="gbab-536"></a><span class="cp">#define PNG_HAVE_CHUNK_AFTER_IDAT 0x2000 </span><span class="cm">/* Have another chunk after IDAT */</span><span class="cp"></span>
<a name="gbab-537"></a>                   <span class="cm">/*             0x4000 (unused) */</span>
<a name="gbab-538"></a><span class="cp">#define PNG_IS_READ_STRUCT        0x8000 </span><span class="cm">/* Else is a write struct */</span><span class="cp"></span>
<a name="gbab-539"></a>
<a name="gbab-540"></a><span class="cm">/* Flags for the transformations the PNG library does on the image data */</span>
<a name="gbab-541"></a><span class="cp">#define PNG_BGR                 0x0001</span>
<a name="gbab-542"></a><span class="cp">#define PNG_INTERLACE           0x0002</span>
<a name="gbab-543"></a><span class="cp">#define PNG_PACK                0x0004</span>
<a name="gbab-544"></a><span class="cp">#define PNG_SHIFT               0x0008</span>
<a name="gbab-545"></a><span class="cp">#define PNG_SWAP_BYTES          0x0010</span>
<a name="gbab-546"></a><span class="cp">#define PNG_INVERT_MONO         0x0020</span>
<a name="gbab-547"></a><span class="cp">#define PNG_QUANTIZE            0x0040</span>
<a name="gbab-548"></a><span class="cp">#define PNG_COMPOSE             0x0080     </span><span class="cm">/* Was PNG_BACKGROUND */</span><span class="cp"></span>
<a name="gbab-549"></a><span class="cp">#define PNG_BACKGROUND_EXPAND   0x0100</span>
<a name="gbab-550"></a><span class="cp">#define PNG_EXPAND_16           0x0200     </span><span class="cm">/* Added to libpng 1.5.2 */</span><span class="cp"></span>
<a name="gbab-551"></a><span class="cp">#define PNG_16_TO_8             0x0400     </span><span class="cm">/* Becomes &#39;chop&#39; in 1.5.4 */</span><span class="cp"></span>
<a name="gbab-552"></a><span class="cp">#define PNG_RGBA                0x0800</span>
<a name="gbab-553"></a><span class="cp">#define PNG_EXPAND              0x1000</span>
<a name="gbab-554"></a><span class="cp">#define PNG_GAMMA               0x2000</span>
<a name="gbab-555"></a><span class="cp">#define PNG_GRAY_TO_RGB         0x4000</span>
<a name="gbab-556"></a><span class="cp">#define PNG_FILLER              0x8000</span>
<a name="gbab-557"></a><span class="cp">#define PNG_PACKSWAP           0x10000</span>
<a name="gbab-558"></a><span class="cp">#define PNG_SWAP_ALPHA         0x20000</span>
<a name="gbab-559"></a><span class="cp">#define PNG_STRIP_ALPHA        0x40000</span>
<a name="gbab-560"></a><span class="cp">#define PNG_INVERT_ALPHA       0x80000</span>
<a name="gbab-561"></a><span class="cp">#define PNG_USER_TRANSFORM    0x100000</span>
<a name="gbab-562"></a><span class="cp">#define PNG_RGB_TO_GRAY_ERR   0x200000</span>
<a name="gbab-563"></a><span class="cp">#define PNG_RGB_TO_GRAY_WARN  0x400000</span>
<a name="gbab-564"></a><span class="cp">#define PNG_RGB_TO_GRAY       0x600000 </span><span class="cm">/* two bits, RGB_TO_GRAY_ERR|WARN */</span><span class="cp"></span>
<a name="gbab-565"></a><span class="cp">#define PNG_ENCODE_ALPHA      0x800000 </span><span class="cm">/* Added to libpng-1.5.4 */</span><span class="cp"></span>
<a name="gbab-566"></a><span class="cp">#define PNG_ADD_ALPHA         0x1000000 </span><span class="cm">/* Added to libpng-1.2.7 */</span><span class="cp"></span>
<a name="gbab-567"></a><span class="cp">#define PNG_EXPAND_tRNS       0x2000000 </span><span class="cm">/* Added to libpng-1.2.9 */</span><span class="cp"></span>
<a name="gbab-568"></a><span class="cp">#define PNG_SCALE_16_TO_8     0x4000000 </span><span class="cm">/* Added to libpng-1.5.4 */</span><span class="cp"></span>
<a name="gbab-569"></a>                       <span class="cm">/*   0x8000000 unused */</span>
<a name="gbab-570"></a>                       <span class="cm">/*  0x10000000 unused */</span>
<a name="gbab-571"></a>                       <span class="cm">/*  0x20000000 unused */</span>
<a name="gbab-572"></a>                       <span class="cm">/*  0x40000000 unused */</span>
<a name="gbab-573"></a><span class="cm">/* Flags for png_create_struct */</span>
<a name="gbab-574"></a><span class="cp">#define PNG_STRUCT_PNG   0x0001</span>
<a name="gbab-575"></a><span class="cp">#define PNG_STRUCT_INFO  0x0002</span>
<a name="gbab-576"></a>
<a name="gbab-577"></a><span class="cm">/* Flags for the png_ptr-&gt;flags rather than declaring a byte for each one */</span>
<a name="gbab-578"></a><span class="cp">#define PNG_FLAG_ZLIB_CUSTOM_STRATEGY     0x0001</span>
<a name="gbab-579"></a><span class="cp">#define PNG_FLAG_ZSTREAM_INITIALIZED      0x0002 </span><span class="cm">/* Added to libpng-1.6.0 */</span><span class="cp"></span>
<a name="gbab-580"></a>                                  <span class="cm">/*      0x0004    unused */</span>
<a name="gbab-581"></a><span class="cp">#define PNG_FLAG_ZSTREAM_ENDED            0x0008 </span><span class="cm">/* Added to libpng-1.6.0 */</span><span class="cp"></span>
<a name="gbab-582"></a>                                  <span class="cm">/*      0x0010    unused */</span>
<a name="gbab-583"></a>                                  <span class="cm">/*      0x0020    unused */</span>
<a name="gbab-584"></a><span class="cp">#define PNG_FLAG_ROW_INIT                 0x0040</span>
<a name="gbab-585"></a><span class="cp">#define PNG_FLAG_FILLER_AFTER             0x0080</span>
<a name="gbab-586"></a><span class="cp">#define PNG_FLAG_CRC_ANCILLARY_USE        0x0100</span>
<a name="gbab-587"></a><span class="cp">#define PNG_FLAG_CRC_ANCILLARY_NOWARN     0x0200</span>
<a name="gbab-588"></a><span class="cp">#define PNG_FLAG_CRC_CRITICAL_USE         0x0400</span>
<a name="gbab-589"></a><span class="cp">#define PNG_FLAG_CRC_CRITICAL_IGNORE      0x0800</span>
<a name="gbab-590"></a><span class="cp">#define PNG_FLAG_ASSUME_sRGB              0x1000  </span><span class="cm">/* Added to libpng-1.5.4 */</span><span class="cp"></span>
<a name="gbab-591"></a><span class="cp">#define PNG_FLAG_OPTIMIZE_ALPHA           0x2000  </span><span class="cm">/* Added to libpng-1.5.4 */</span><span class="cp"></span>
<a name="gbab-592"></a><span class="cp">#define PNG_FLAG_DETECT_UNINITIALIZED     0x4000  </span><span class="cm">/* Added to libpng-1.5.4 */</span><span class="cp"></span>
<a name="gbab-593"></a><span class="cm">/* #define PNG_FLAG_KEEP_UNKNOWN_CHUNKS      0x8000 */</span>
<a name="gbab-594"></a><span class="cm">/* #define PNG_FLAG_KEEP_UNSAFE_CHUNKS      0x10000 */</span>
<a name="gbab-595"></a><span class="cp">#define PNG_FLAG_LIBRARY_MISMATCH         0x20000</span>
<a name="gbab-596"></a><span class="cp">#define PNG_FLAG_STRIP_ERROR_NUMBERS      0x40000</span>
<a name="gbab-597"></a><span class="cp">#define PNG_FLAG_STRIP_ERROR_TEXT         0x80000</span>
<a name="gbab-598"></a><span class="cp">#define PNG_FLAG_BENIGN_ERRORS_WARN     0x100000 </span><span class="cm">/* Added to libpng-1.4.0 */</span><span class="cp"></span>
<a name="gbab-599"></a><span class="cp">#define PNG_FLAG_APP_WARNINGS_WARN      0x200000 </span><span class="cm">/* Added to libpng-1.6.0 */</span><span class="cp"></span>
<a name="gbab-600"></a><span class="cp">#define PNG_FLAG_APP_ERRORS_WARN        0x400000 </span><span class="cm">/* Added to libpng-1.6.0 */</span><span class="cp"></span>
<a name="gbab-601"></a>                                  <span class="cm">/*    0x800000    unused */</span>
<a name="gbab-602"></a>                                  <span class="cm">/*   0x1000000    unused */</span>
<a name="gbab-603"></a>                                  <span class="cm">/*   0x2000000    unused */</span>
<a name="gbab-604"></a>                                  <span class="cm">/*   0x4000000    unused */</span>
<a name="gbab-605"></a>                                  <span class="cm">/*   0x8000000    unused */</span>
<a name="gbab-606"></a>                                  <span class="cm">/*  0x10000000    unused */</span>
<a name="gbab-607"></a>                                  <span class="cm">/*     0x20000000  unused */</span>
<a name="gbab-608"></a>                                  <span class="cm">/*     0x40000000  unused */</span>
<a name="gbab-609"></a>
<a name="gbab-610"></a><span class="cp">#define PNG_FLAG_CRC_ANCILLARY_MASK (PNG_FLAG_CRC_ANCILLARY_USE | \</span>
<a name="gbab-611"></a><span class="cp">                                     PNG_FLAG_CRC_ANCILLARY_NOWARN)</span>
<a name="gbab-612"></a>
<a name="gbab-613"></a><span class="cp">#define PNG_FLAG_CRC_CRITICAL_MASK  (PNG_FLAG_CRC_CRITICAL_USE | \</span>
<a name="gbab-614"></a><span class="cp">                                     PNG_FLAG_CRC_CRITICAL_IGNORE)</span>
<a name="gbab-615"></a>
<a name="gbab-616"></a><span class="cp">#define PNG_FLAG_CRC_MASK           (PNG_FLAG_CRC_ANCILLARY_MASK | \</span>
<a name="gbab-617"></a><span class="cp">                                     PNG_FLAG_CRC_CRITICAL_MASK)</span>
<a name="gbab-618"></a>
<a name="gbab-619"></a><span class="cm">/* Save typing and make code easier to understand */</span>
<a name="gbab-620"></a>
<a name="gbab-621"></a><span class="cp">#define PNG_COLOR_DIST(c1, c2) (abs((int)((c1).red) - (int)((c2).red)) + \</span>
<a name="gbab-622"></a><span class="cp">   abs((int)((c1).green) - (int)((c2).green)) + \</span>
<a name="gbab-623"></a><span class="cp">   abs((int)((c1).blue) - (int)((c2).blue)))</span>
<a name="gbab-624"></a>
<a name="gbab-625"></a><span class="cm">/* Added to libpng-1.6.0: scale a 16-bit value in the range 0..65535 to 0..255</span>
<a name="gbab-626"></a><span class="cm"> * by dividing by 257 *with rounding*.  This macro is exact for the given range.</span>
<a name="gbab-627"></a><span class="cm"> * See the discourse in pngrtran.c png_do_scale_16_to_8.  The values in the</span>
<a name="gbab-628"></a><span class="cm"> * macro were established by experiment (modifying the added value).  The macro</span>
<a name="gbab-629"></a><span class="cm"> * has a second variant that takes a value already scaled by 255 and divides by</span>
<a name="gbab-630"></a><span class="cm"> * 65535 - this has a maximum error of .502.  Over the range 0..65535*65535 it</span>
<a name="gbab-631"></a><span class="cm"> * only gives off-by-one errors and only for 0.5% (1 in 200) of the values.</span>
<a name="gbab-632"></a><span class="cm"> */</span>
<a name="gbab-633"></a><span class="cp">#define PNG_DIV65535(v24) (((v24) + 32895) &gt;&gt; 16)</span>
<a name="gbab-634"></a><span class="cp">#define PNG_DIV257(v16) PNG_DIV65535((png_uint_32)(v16) * 255)</span>
<a name="gbab-635"></a>
<a name="gbab-636"></a><span class="cm">/* Added to libpng-1.2.6 JB */</span>
<a name="gbab-637"></a><span class="cp">#define PNG_ROWBYTES(pixel_bits, width) \</span>
<a name="gbab-638"></a><span class="cp">    ((pixel_bits) &gt;= 8 ? \</span>
<a name="gbab-639"></a><span class="cp">    ((png_size_t)(width) * (((png_size_t)(pixel_bits)) &gt;&gt; 3)) : \</span>
<a name="gbab-640"></a><span class="cp">    (( ((png_size_t)(width) * ((png_size_t)(pixel_bits))) + 7) &gt;&gt; 3) )</span>
<a name="gbab-641"></a>
<a name="gbab-642"></a><span class="cm">/* PNG_OUT_OF_RANGE returns true if value is outside the range</span>
<a name="gbab-643"></a><span class="cm"> * ideal-delta..ideal+delta.  Each argument is evaluated twice.</span>
<a name="gbab-644"></a><span class="cm"> * &quot;ideal&quot; and &quot;delta&quot; should be constants, normally simple</span>
<a name="gbab-645"></a><span class="cm"> * integers, &quot;value&quot; a variable. Added to libpng-1.2.6 JB</span>
<a name="gbab-646"></a><span class="cm"> */</span>
<a name="gbab-647"></a><span class="cp">#define PNG_OUT_OF_RANGE(value, ideal, delta) \</span>
<a name="gbab-648"></a><span class="cp">   ( (value) &lt; (ideal)-(delta) || (value) &gt; (ideal)+(delta) )</span>
<a name="gbab-649"></a>
<a name="gbab-650"></a><span class="cm">/* Conversions between fixed and floating point, only defined if</span>
<a name="gbab-651"></a><span class="cm"> * required (to make sure the code doesn&#39;t accidentally use float</span>
<a name="gbab-652"></a><span class="cm"> * when it is supposedly disabled.)</span>
<a name="gbab-653"></a><span class="cm"> */</span>
<a name="gbab-654"></a><span class="cp">#ifdef PNG_FLOATING_POINT_SUPPORTED</span>
<a name="gbab-655"></a><span class="cm">/* The floating point conversion can&#39;t overflow, though it can and</span>
<a name="gbab-656"></a><span class="cm"> * does lose accuracy relative to the original fixed point value.</span>
<a name="gbab-657"></a><span class="cm"> * In practice this doesn&#39;t matter because png_fixed_point only</span>
<a name="gbab-658"></a><span class="cm"> * stores numbers with very low precision.  The png_ptr and s</span>
<a name="gbab-659"></a><span class="cm"> * arguments are unused by default but are there in case error</span>
<a name="gbab-660"></a><span class="cm"> * checking becomes a requirement.</span>
<a name="gbab-661"></a><span class="cm"> */</span>
<a name="gbab-662"></a><span class="cp">#define png_float(png_ptr, fixed, s) (.00001 * (fixed))</span>
<a name="gbab-663"></a>
<a name="gbab-664"></a><span class="cm">/* The fixed point conversion performs range checking and evaluates</span>
<a name="gbab-665"></a><span class="cm"> * its argument multiple times, so must be used with care.  The</span>
<a name="gbab-666"></a><span class="cm"> * range checking uses the PNG specification values for a signed</span>
<a name="gbab-667"></a><span class="cm"> * 32-bit fixed point value except that the values are deliberately</span>
<a name="gbab-668"></a><span class="cm"> * rounded-to-zero to an integral value - 21474 (21474.83 is roughly</span>
<a name="gbab-669"></a><span class="cm"> * (2^31-1) * 100000). &#39;s&#39; is a string that describes the value being</span>
<a name="gbab-670"></a><span class="cm"> * converted.</span>
<a name="gbab-671"></a><span class="cm"> *</span>
<a name="gbab-672"></a><span class="cm"> * NOTE: this macro will raise a png_error if the range check fails,</span>
<a name="gbab-673"></a><span class="cm"> * therefore it is normally only appropriate to use this on values</span>
<a name="gbab-674"></a><span class="cm"> * that come from API calls or other sources where an out of range</span>
<a name="gbab-675"></a><span class="cm"> * error indicates a programming error, not a data error!</span>
<a name="gbab-676"></a><span class="cm"> *</span>
<a name="gbab-677"></a><span class="cm"> * NOTE: by default this is off - the macro is not used - because the</span>
<a name="gbab-678"></a><span class="cm"> * function call saves a lot of code.</span>
<a name="gbab-679"></a><span class="cm"> */</span>
<a name="gbab-680"></a><span class="cp">#ifdef PNG_FIXED_POINT_MACRO_SUPPORTED</span>
<a name="gbab-681"></a><span class="cp">#define png_fixed(png_ptr, fp, s) ((fp) &lt;= 21474 &amp;&amp; (fp) &gt;= -21474 ?\</span>
<a name="gbab-682"></a><span class="cp">    ((png_fixed_point)(100000 * (fp))) : (png_fixed_error(png_ptr, s),0))</span>
<a name="gbab-683"></a><span class="cp">#endif</span>
<a name="gbab-684"></a><span class="cm">/* else the corresponding function is defined below, inside the scope of the</span>
<a name="gbab-685"></a><span class="cm"> * cplusplus test.</span>
<a name="gbab-686"></a><span class="cm"> */</span>
<a name="gbab-687"></a><span class="cp">#endif</span>
<a name="gbab-688"></a>
<a name="gbab-689"></a><span class="cm">/* Constants for known chunk types.  If you need to add a chunk, define the name</span>
<a name="gbab-690"></a><span class="cm"> * here.  For historical reasons these constants have the form png_&lt;name&gt;; i.e.</span>
<a name="gbab-691"></a><span class="cm"> * the prefix is lower case.  Please use decimal values as the parameters to</span>
<a name="gbab-692"></a><span class="cm"> * match the ISO PNG specification and to avoid relying on the C locale</span>
<a name="gbab-693"></a><span class="cm"> * interpretation of character values.</span>
<a name="gbab-694"></a><span class="cm"> *</span>
<a name="gbab-695"></a><span class="cm"> * Prior to 1.5.6 these constants were strings, as of 1.5.6 png_uint_32 values</span>
<a name="gbab-696"></a><span class="cm"> * are computed and a new macro (PNG_STRING_FROM_CHUNK) added to allow a string</span>
<a name="gbab-697"></a><span class="cm"> * to be generated if required.</span>
<a name="gbab-698"></a><span class="cm"> *</span>
<a name="gbab-699"></a><span class="cm"> * PNG_32b correctly produces a value shifted by up to 24 bits, even on</span>
<a name="gbab-700"></a><span class="cm"> * architectures where (int) is only 16 bits.</span>
<a name="gbab-701"></a><span class="cm"> */</span>
<a name="gbab-702"></a><span class="cp">#define PNG_32b(b,s) ((png_uint_32)(b) &lt;&lt; (s))</span>
<a name="gbab-703"></a><span class="cp">#define PNG_U32(b1,b2,b3,b4) \</span>
<a name="gbab-704"></a><span class="cp">   (PNG_32b(b1,24) | PNG_32b(b2,16) | PNG_32b(b3,8) | PNG_32b(b4,0))</span>
<a name="gbab-705"></a>
<a name="gbab-706"></a><span class="cm">/* Constants for known chunk types.</span>
<a name="gbab-707"></a><span class="cm"> *</span>
<a name="gbab-708"></a><span class="cm"> * MAINTAINERS: If you need to add a chunk, define the name here.</span>
<a name="gbab-709"></a><span class="cm"> * For historical reasons these constants have the form png_&lt;name&gt;; i.e.</span>
<a name="gbab-710"></a><span class="cm"> * the prefix is lower case.  Please use decimal values as the parameters to</span>
<a name="gbab-711"></a><span class="cm"> * match the ISO PNG specification and to avoid relying on the C locale</span>
<a name="gbab-712"></a><span class="cm"> * interpretation of character values.  Please keep the list sorted.</span>
<a name="gbab-713"></a><span class="cm"> *</span>
<a name="gbab-714"></a><span class="cm"> * Notice that PNG_U32 is used to define a 32-bit value for the 4 byte chunk</span>
<a name="gbab-715"></a><span class="cm"> * type.  In fact the specification does not express chunk types this way,</span>
<a name="gbab-716"></a><span class="cm"> * however using a 32-bit value means that the chunk type can be read from the</span>
<a name="gbab-717"></a><span class="cm"> * stream using exactly the same code as used for a 32-bit unsigned value and</span>
<a name="gbab-718"></a><span class="cm"> * can be examined far more efficiently (using one arithmetic compare).</span>
<a name="gbab-719"></a><span class="cm"> *</span>
<a name="gbab-720"></a><span class="cm"> * Prior to 1.5.6 the chunk type constants were expressed as C strings.  The</span>
<a name="gbab-721"></a><span class="cm"> * libpng API still uses strings for &#39;unknown&#39; chunks and a macro,</span>
<a name="gbab-722"></a><span class="cm"> * PNG_STRING_FROM_CHUNK, allows a string to be generated if required.  Notice</span>
<a name="gbab-723"></a><span class="cm"> * that for portable code numeric values must still be used; the string &quot;IHDR&quot;</span>
<a name="gbab-724"></a><span class="cm"> * is not portable and neither is PNG_U32(&#39;I&#39;, &#39;H&#39;, &#39;D&#39;, &#39;R&#39;).</span>
<a name="gbab-725"></a><span class="cm"> *</span>
<a name="gbab-726"></a><span class="cm"> * In 1.7.0 the definitions will be made public in png.h to avoid having to</span>
<a name="gbab-727"></a><span class="cm"> * duplicate the same definitions in application code.</span>
<a name="gbab-728"></a><span class="cm"> */</span>
<a name="gbab-729"></a><span class="cp">#define png_IDAT PNG_U32( 73,  68,  65,  84)</span>
<a name="gbab-730"></a><span class="cp">#define png_IEND PNG_U32( 73,  69,  78,  68)</span>
<a name="gbab-731"></a><span class="cp">#define png_IHDR PNG_U32( 73,  72,  68,  82)</span>
<a name="gbab-732"></a><span class="cp">#define png_PLTE PNG_U32( 80,  76,  84,  69)</span>
<a name="gbab-733"></a><span class="cp">#define png_bKGD PNG_U32( 98,  75,  71,  68)</span>
<a name="gbab-734"></a><span class="cp">#define png_cHRM PNG_U32( 99,  72,  82,  77)</span>
<a name="gbab-735"></a><span class="cp">#define png_fRAc PNG_U32(102,  82,  65,  99) </span><span class="cm">/* registered, not defined */</span><span class="cp"></span>
<a name="gbab-736"></a><span class="cp">#define png_gAMA PNG_U32(103,  65,  77,  65)</span>
<a name="gbab-737"></a><span class="cp">#define png_gIFg PNG_U32(103,  73,  70, 103)</span>
<a name="gbab-738"></a><span class="cp">#define png_gIFt PNG_U32(103,  73,  70, 116) </span><span class="cm">/* deprecated */</span><span class="cp"></span>
<a name="gbab-739"></a><span class="cp">#define png_gIFx PNG_U32(103,  73,  70, 120)</span>
<a name="gbab-740"></a><span class="cp">#define png_hIST PNG_U32(104,  73,  83,  84)</span>
<a name="gbab-741"></a><span class="cp">#define png_iCCP PNG_U32(105,  67,  67,  80)</span>
<a name="gbab-742"></a><span class="cp">#define png_iTXt PNG_U32(105,  84,  88, 116)</span>
<a name="gbab-743"></a><span class="cp">#define png_oFFs PNG_U32(111,  70,  70, 115)</span>
<a name="gbab-744"></a><span class="cp">#define png_pCAL PNG_U32(112,  67,  65,  76)</span>
<a name="gbab-745"></a><span class="cp">#define png_pHYs PNG_U32(112,  72,  89, 115)</span>
<a name="gbab-746"></a><span class="cp">#define png_sBIT PNG_U32(115,  66,  73,  84)</span>
<a name="gbab-747"></a><span class="cp">#define png_sCAL PNG_U32(115,  67,  65,  76)</span>
<a name="gbab-748"></a><span class="cp">#define png_sPLT PNG_U32(115,  80,  76,  84)</span>
<a name="gbab-749"></a><span class="cp">#define png_sRGB PNG_U32(115,  82,  71,  66)</span>
<a name="gbab-750"></a><span class="cp">#define png_sTER PNG_U32(115,  84,  69,  82)</span>
<a name="gbab-751"></a><span class="cp">#define png_tEXt PNG_U32(116,  69,  88, 116)</span>
<a name="gbab-752"></a><span class="cp">#define png_tIME PNG_U32(116,  73,  77,  69)</span>
<a name="gbab-753"></a><span class="cp">#define png_tRNS PNG_U32(116,  82,  78,  83)</span>
<a name="gbab-754"></a><span class="cp">#define png_zTXt PNG_U32(122,  84,  88, 116)</span>
<a name="gbab-755"></a>
<a name="gbab-756"></a><span class="cm">/* The following will work on (signed char*) strings, whereas the get_uint_32</span>
<a name="gbab-757"></a><span class="cm"> * macro will fail on top-bit-set values because of the sign extension.</span>
<a name="gbab-758"></a><span class="cm"> */</span>
<a name="gbab-759"></a><span class="cp">#define PNG_CHUNK_FROM_STRING(s)\</span>
<a name="gbab-760"></a><span class="cp">   PNG_U32(0xff &amp; (s)[0], 0xff &amp; (s)[1], 0xff &amp; (s)[2], 0xff &amp; (s)[3])</span>
<a name="gbab-761"></a>
<a name="gbab-762"></a><span class="cm">/* This uses (char), not (png_byte) to avoid warnings on systems where (char) is</span>
<a name="gbab-763"></a><span class="cm"> * signed and the argument is a (char[])  This macro will fail miserably on</span>
<a name="gbab-764"></a><span class="cm"> * systems where (char) is more than 8 bits.</span>
<a name="gbab-765"></a><span class="cm"> */</span>
<a name="gbab-766"></a><span class="cp">#define PNG_STRING_FROM_CHUNK(s,c)\</span>
<a name="gbab-767"></a><span class="cp">   (void)(((char*)(s))[0]=(char)(((c)&gt;&gt;24) &amp; 0xff), \</span>
<a name="gbab-768"></a><span class="cp">   ((char*)(s))[1]=(char)(((c)&gt;&gt;16) &amp; 0xff),\</span>
<a name="gbab-769"></a><span class="cp">   ((char*)(s))[2]=(char)(((c)&gt;&gt;8) &amp; 0xff), \</span>
<a name="gbab-770"></a><span class="cp">   ((char*)(s))[3]=(char)((c &amp; 0xff)))</span>
<a name="gbab-771"></a>
<a name="gbab-772"></a><span class="cm">/* Do the same but terminate with a null character. */</span>
<a name="gbab-773"></a><span class="cp">#define PNG_CSTRING_FROM_CHUNK(s,c)\</span>
<a name="gbab-774"></a><span class="cp">   (void)(PNG_STRING_FROM_CHUNK(s,c), ((char*)(s))[4] = 0)</span>
<a name="gbab-775"></a>
<a name="gbab-776"></a><span class="cm">/* Test on flag values as defined in the spec (section 5.4): */</span>
<a name="gbab-777"></a><span class="cp">#define PNG_CHUNK_ANCILLARY(c)   (1 &amp; ((c) &gt;&gt; 29))</span>
<a name="gbab-778"></a><span class="cp">#define PNG_CHUNK_CRITICAL(c)     (!PNG_CHUNK_ANCILLARY(c))</span>
<a name="gbab-779"></a><span class="cp">#define PNG_CHUNK_PRIVATE(c)      (1 &amp; ((c) &gt;&gt; 21))</span>
<a name="gbab-780"></a><span class="cp">#define PNG_CHUNK_RESERVED(c)     (1 &amp; ((c) &gt;&gt; 13))</span>
<a name="gbab-781"></a><span class="cp">#define PNG_CHUNK_SAFE_TO_COPY(c) (1 &amp; ((c) &gt;&gt;  5))</span>
<a name="gbab-782"></a>
<a name="gbab-783"></a><span class="cm">/* Gamma values (new at libpng-1.5.4): */</span>
<a name="gbab-784"></a><span class="cp">#define PNG_GAMMA_MAC_OLD 151724  </span><span class="cm">/* Assume &#39;1.8&#39; is really 2.2/1.45! */</span><span class="cp"></span>
<a name="gbab-785"></a><span class="cp">#define PNG_GAMMA_MAC_INVERSE 65909</span>
<a name="gbab-786"></a><span class="cp">#define PNG_GAMMA_sRGB_INVERSE 45455</span>
<a name="gbab-787"></a>
<a name="gbab-788"></a><span class="cm">/* Almost everything below is C specific; the #defines above can be used in</span>
<a name="gbab-789"></a><span class="cm"> * non-C code (so long as it is C-preprocessed) the rest of this stuff cannot.</span>
<a name="gbab-790"></a><span class="cm"> */</span>
<a name="gbab-791"></a><span class="cp">#ifndef PNG_VERSION_INFO_ONLY</span>
<a name="gbab-792"></a>
<a name="gbab-793"></a><span class="cp">#include</span> <span class="cpf">&quot;pngstruct.h&quot;</span><span class="cp"></span>
<a name="gbab-794"></a><span class="cp">#include</span> <span class="cpf">&quot;pnginfo.h&quot;</span><span class="cp"></span>
<a name="gbab-795"></a>
<a name="gbab-796"></a><span class="cm">/* Validate the include paths - the include path used to generate pnglibconf.h</span>
<a name="gbab-797"></a><span class="cm"> * must match that used in the build, or we must be using pnglibconf.h.prebuilt:</span>
<a name="gbab-798"></a><span class="cm"> */</span>
<a name="gbab-799"></a><span class="cp">#if PNG_ZLIB_VERNUM != 0 &amp;&amp; PNG_ZLIB_VERNUM != ZLIB_VERNUM</span>
<a name="gbab-800"></a><span class="cp">#  error ZLIB_VERNUM != PNG_ZLIB_VERNUM \</span>
<a name="gbab-801"></a><span class="cp">      &quot;-I (include path) error: see the notes in pngpriv.h&quot;</span>
<a name="gbab-802"></a>   <span class="cm">/* This means that when pnglibconf.h was built the copy of zlib.h that it</span>
<a name="gbab-803"></a><span class="cm">    * used is not the same as the one being used here.  Because the build of</span>
<a name="gbab-804"></a><span class="cm">    * libpng makes decisions to use inflateInit2 and inflateReset2 based on the</span>
<a name="gbab-805"></a><span class="cm">    * zlib version number and because this affects handling of certain broken</span>
<a name="gbab-806"></a><span class="cm">    * PNG files the -I directives must match.</span>
<a name="gbab-807"></a><span class="cm">    *</span>
<a name="gbab-808"></a><span class="cm">    * The most likely explanation is that you passed a -I in CFLAGS. This will</span>
<a name="gbab-809"></a><span class="cm">    * not work; all the preprocessor directories and in particular all the -I</span>
<a name="gbab-810"></a><span class="cm">    * directives must be in CPPFLAGS.</span>
<a name="gbab-811"></a><span class="cm">    */</span>
<a name="gbab-812"></a><span class="cp">#endif</span>
<a name="gbab-813"></a>
<a name="gbab-814"></a><span class="cm">/* This is used for 16-bit gamma tables -- only the top level pointers are</span>
<a name="gbab-815"></a><span class="cm"> * const; this could be changed:</span>
<a name="gbab-816"></a><span class="cm"> */</span>
<a name="gbab-817"></a><span class="k">typedef</span> <span class="k">const</span> <span class="n">png_uint_16p</span> <span class="o">*</span> <span class="n">png_const_uint_16pp</span><span class="p">;</span>
<a name="gbab-818"></a>
<a name="gbab-819"></a><span class="cm">/* Added to libpng-1.5.7: sRGB conversion tables */</span>
<a name="gbab-820"></a><span class="cp">#if defined(PNG_SIMPLIFIED_READ_SUPPORTED) ||\</span>
<a name="gbab-821"></a><span class="cp">   defined(PNG_SIMPLIFIED_WRITE_SUPPORTED)</span>
<a name="gbab-822"></a><span class="cp">#ifdef PNG_SIMPLIFIED_READ_SUPPORTED</span>
<a name="gbab-823"></a><span class="n">PNG_INTERNAL_DATA</span><span class="p">(</span><span class="k">const</span> <span class="n">png_uint_16</span><span class="p">,</span> <span class="n">png_sRGB_table</span><span class="p">,</span> <span class="p">[</span><span class="mi">256</span><span class="p">]);</span>
<a name="gbab-824"></a>   <span class="cm">/* Convert from an sRGB encoded value 0..255 to a 16-bit linear value,</span>
<a name="gbab-825"></a><span class="cm">    * 0..65535.  This table gives the closest 16-bit answers (no errors).</span>
<a name="gbab-826"></a><span class="cm">    */</span>
<a name="gbab-827"></a><span class="cp">#endif</span>
<a name="gbab-828"></a>
<a name="gbab-829"></a><span class="n">PNG_INTERNAL_DATA</span><span class="p">(</span><span class="k">const</span> <span class="n">png_uint_16</span><span class="p">,</span> <span class="n">png_sRGB_base</span><span class="p">,</span> <span class="p">[</span><span class="mi">512</span><span class="p">]);</span>
<a name="gbab-830"></a><span class="n">PNG_INTERNAL_DATA</span><span class="p">(</span><span class="k">const</span> <span class="n">png_byte</span><span class="p">,</span> <span class="n">png_sRGB_delta</span><span class="p">,</span> <span class="p">[</span><span class="mi">512</span><span class="p">]);</span>
<a name="gbab-831"></a>
<a name="gbab-832"></a><span class="cp">#define PNG_sRGB_FROM_LINEAR(linear) \</span>
<a name="gbab-833"></a><span class="cp">  ((png_byte)(0xff &amp; ((png_sRGB_base[(linear)&gt;&gt;15] \</span>
<a name="gbab-834"></a><span class="cp">   + ((((linear) &amp; 0x7fff)*png_sRGB_delta[(linear)&gt;&gt;15])&gt;&gt;12)) &gt;&gt; 8)))</span>
<a name="gbab-835"></a>   <span class="cm">/* Given a value &#39;linear&#39; in the range 0..255*65535 calculate the 8-bit sRGB</span>
<a name="gbab-836"></a><span class="cm">    * encoded value with maximum error 0.646365.  Note that the input is not a</span>
<a name="gbab-837"></a><span class="cm">    * 16-bit value; it has been multiplied by 255! */</span>
<a name="gbab-838"></a><span class="cp">#endif </span><span class="cm">/* SIMPLIFIED_READ/WRITE */</span><span class="cp"></span>
<a name="gbab-839"></a>
<a name="gbab-840"></a>
<a name="gbab-841"></a><span class="cm">/* Inhibit C++ name-mangling for libpng functions but not for system calls. */</span>
<a name="gbab-842"></a><span class="cp">#ifdef __cplusplus</span>
<a name="gbab-843"></a><span class="k">extern</span> <span class="s">&quot;C&quot;</span> <span class="p">{</span>
<a name="gbab-844"></a><span class="cp">#endif </span><span class="cm">/* __cplusplus */</span><span class="cp"></span>
<a name="gbab-845"></a>
<a name="gbab-846"></a><span class="cm">/* Internal functions; these are not exported from a DLL however because they</span>
<a name="gbab-847"></a><span class="cm"> * are used within several of the C source files they have to be C extern.</span>
<a name="gbab-848"></a><span class="cm"> *</span>
<a name="gbab-849"></a><span class="cm"> * All of these functions must be declared with PNG_INTERNAL_FUNCTION.</span>
<a name="gbab-850"></a><span class="cm"> */</span>
<a name="gbab-851"></a>
<a name="gbab-852"></a><span class="cm">/* Zlib support */</span>
<a name="gbab-853"></a><span class="cp">#define PNG_UNEXPECTED_ZLIB_RETURN (-7)</span>
<a name="gbab-854"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span> <span class="n">png_zstream_error</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">ret</span><span class="p">),</span>
<a name="gbab-855"></a>   <span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-856"></a>   <span class="cm">/* Used by the zlib handling functions to ensure that z_stream::msg is always</span>
<a name="gbab-857"></a><span class="cm">    * set before they return.</span>
<a name="gbab-858"></a><span class="cm">    */</span>
<a name="gbab-859"></a>
<a name="gbab-860"></a><span class="cp">#ifdef PNG_WRITE_SUPPORTED</span>
<a name="gbab-861"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_free_buffer_list</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-862"></a>   <span class="n">png_compression_bufferp</span> <span class="o">*</span><span class="n">list</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-863"></a>   <span class="cm">/* Free the buffer list used by the compressed write code. */</span>
<a name="gbab-864"></a><span class="cp">#endif</span>
<a name="gbab-865"></a>
<a name="gbab-866"></a><span class="cp">#if defined(PNG_FLOATING_POINT_SUPPORTED) &amp;&amp; \</span>
<a name="gbab-867"></a><span class="cp">   !defined(PNG_FIXED_POINT_MACRO_SUPPORTED) &amp;&amp; \</span>
<a name="gbab-868"></a><span class="cp">   (defined(PNG_gAMA_SUPPORTED) || defined(PNG_cHRM_SUPPORTED) || \</span>
<a name="gbab-869"></a><span class="cp">   defined(PNG_sCAL_SUPPORTED) || defined(PNG_READ_BACKGROUND_SUPPORTED) || \</span>
<a name="gbab-870"></a><span class="cp">   defined(PNG_READ_RGB_TO_GRAY_SUPPORTED)) || \</span>
<a name="gbab-871"></a><span class="cp">   (defined(PNG_sCAL_SUPPORTED) &amp;&amp; \</span>
<a name="gbab-872"></a><span class="cp">   defined(PNG_FLOATING_ARITHMETIC_SUPPORTED))</span>
<a name="gbab-873"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="n">png_fixed_point</span><span class="p">,</span><span class="n">png_fixed</span><span class="p">,(</span><span class="n">png_const_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-874"></a>   <span class="kt">double</span> <span class="n">fp</span><span class="p">,</span> <span class="n">png_const_charp</span> <span class="n">text</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-875"></a><span class="cp">#endif</span>
<a name="gbab-876"></a>
<a name="gbab-877"></a><span class="cm">/* Check the user version string for compatibility, returns false if the version</span>
<a name="gbab-878"></a><span class="cm"> * numbers aren&#39;t compatible.</span>
<a name="gbab-879"></a><span class="cm"> */</span>
<a name="gbab-880"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="n">png_user_version_check</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-881"></a>   <span class="n">png_const_charp</span> <span class="n">user_png_ver</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-882"></a>
<a name="gbab-883"></a><span class="cm">/* Internal base allocator - no messages, NULL on failure to allocate.  This</span>
<a name="gbab-884"></a><span class="cm"> * does, however, call the application provided allocator and that could call</span>
<a name="gbab-885"></a><span class="cm"> * png_error (although that would be a bug in the application implementation.)</span>
<a name="gbab-886"></a><span class="cm"> */</span>
<a name="gbab-887"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="n">png_voidp</span><span class="p">,</span><span class="n">png_malloc_base</span><span class="p">,(</span><span class="n">png_const_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-888"></a>   <span class="n">png_alloc_size_t</span> <span class="n">size</span><span class="p">),</span><span class="n">PNG_ALLOCATED</span><span class="p">);</span>
<a name="gbab-889"></a>
<a name="gbab-890"></a><span class="cp">#if defined(PNG_TEXT_SUPPORTED) || defined(PNG_sPLT_SUPPORTED) ||\</span>
<a name="gbab-891"></a><span class="cp">   defined(PNG_STORE_UNKNOWN_CHUNKS_SUPPORTED)</span>
<a name="gbab-892"></a><span class="cm">/* Internal array allocator, outputs no error or warning messages on failure,</span>
<a name="gbab-893"></a><span class="cm"> * just returns NULL.</span>
<a name="gbab-894"></a><span class="cm"> */</span>
<a name="gbab-895"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="n">png_voidp</span><span class="p">,</span><span class="n">png_malloc_array</span><span class="p">,(</span><span class="n">png_const_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-896"></a>   <span class="kt">int</span> <span class="n">nelements</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">element_size</span><span class="p">),</span><span class="n">PNG_ALLOCATED</span><span class="p">);</span>
<a name="gbab-897"></a>
<a name="gbab-898"></a><span class="cm">/* The same but an existing array is extended by add_elements.  This function</span>
<a name="gbab-899"></a><span class="cm"> * also memsets the new elements to 0 and copies the old elements.  The old</span>
<a name="gbab-900"></a><span class="cm"> * array is not freed or altered.</span>
<a name="gbab-901"></a><span class="cm"> */</span>
<a name="gbab-902"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="n">png_voidp</span><span class="p">,</span><span class="n">png_realloc_array</span><span class="p">,(</span><span class="n">png_const_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-903"></a>   <span class="n">png_const_voidp</span> <span class="n">array</span><span class="p">,</span> <span class="kt">int</span> <span class="n">old_elements</span><span class="p">,</span> <span class="kt">int</span> <span class="n">add_elements</span><span class="p">,</span>
<a name="gbab-904"></a>   <span class="kt">size_t</span> <span class="n">element_size</span><span class="p">),</span><span class="n">PNG_ALLOCATED</span><span class="p">);</span>
<a name="gbab-905"></a><span class="cp">#endif </span><span class="cm">/* text, sPLT or unknown chunks */</span><span class="cp"></span>
<a name="gbab-906"></a>
<a name="gbab-907"></a><span class="cm">/* Magic to create a struct when there is no struct to call the user supplied</span>
<a name="gbab-908"></a><span class="cm"> * memory allocators.  Because error handling has not been set up the memory</span>
<a name="gbab-909"></a><span class="cm"> * handlers can&#39;t safely call png_error, but this is an obscure and undocumented</span>
<a name="gbab-910"></a><span class="cm"> * restriction so libpng has to assume that the &#39;free&#39; handler, at least, might</span>
<a name="gbab-911"></a><span class="cm"> * call png_error.</span>
<a name="gbab-912"></a><span class="cm"> */</span>
<a name="gbab-913"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="n">png_structp</span><span class="p">,</span><span class="n">png_create_png_struct</span><span class="p">,</span>
<a name="gbab-914"></a>   <span class="p">(</span><span class="n">png_const_charp</span> <span class="n">user_png_ver</span><span class="p">,</span> <span class="n">png_voidp</span> <span class="n">error_ptr</span><span class="p">,</span> <span class="n">png_error_ptr</span> <span class="n">error_fn</span><span class="p">,</span>
<a name="gbab-915"></a>    <span class="n">png_error_ptr</span> <span class="n">warn_fn</span><span class="p">,</span> <span class="n">png_voidp</span> <span class="n">mem_ptr</span><span class="p">,</span> <span class="n">png_malloc_ptr</span> <span class="n">malloc_fn</span><span class="p">,</span>
<a name="gbab-916"></a>    <span class="n">png_free_ptr</span> <span class="n">free_fn</span><span class="p">),</span><span class="n">PNG_ALLOCATED</span><span class="p">);</span>
<a name="gbab-917"></a>
<a name="gbab-918"></a><span class="cm">/* Free memory from internal libpng struct */</span>
<a name="gbab-919"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_destroy_png_struct</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">),</span>
<a name="gbab-920"></a>   <span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-921"></a>
<a name="gbab-922"></a><span class="cm">/* Free an allocated jmp_buf (always succeeds) */</span>
<a name="gbab-923"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_free_jmpbuf</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-924"></a>
<a name="gbab-925"></a><span class="cm">/* Function to allocate memory for zlib.  PNGAPI is disallowed. */</span>
<a name="gbab-926"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="n">voidpf</span><span class="p">,</span><span class="n">png_zalloc</span><span class="p">,(</span><span class="n">voidpf</span> <span class="n">png_ptr</span><span class="p">,</span> <span class="n">uInt</span> <span class="n">items</span><span class="p">,</span> <span class="n">uInt</span> <span class="n">size</span><span class="p">),</span>
<a name="gbab-927"></a>   <span class="n">PNG_ALLOCATED</span><span class="p">);</span>
<a name="gbab-928"></a>
<a name="gbab-929"></a><span class="cm">/* Function to free memory for zlib.  PNGAPI is disallowed. */</span>
<a name="gbab-930"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_zfree</span><span class="p">,(</span><span class="n">voidpf</span> <span class="n">png_ptr</span><span class="p">,</span> <span class="n">voidpf</span> <span class="n">ptr</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-931"></a>
<a name="gbab-932"></a><span class="cm">/* Next four functions are used internally as callbacks.  PNGCBAPI is required</span>
<a name="gbab-933"></a><span class="cm"> * but not PNG_EXPORT.  PNGAPI added at libpng version 1.2.3, changed to</span>
<a name="gbab-934"></a><span class="cm"> * PNGCBAPI at 1.5.0</span>
<a name="gbab-935"></a><span class="cm"> */</span>
<a name="gbab-936"></a>
<a name="gbab-937"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span> <span class="n">PNGCBAPI</span><span class="p">,</span><span class="n">png_default_read_data</span><span class="p">,(</span><span class="n">png_structp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-938"></a>    <span class="n">png_bytep</span> <span class="n">data</span><span class="p">,</span> <span class="n">png_size_t</span> <span class="n">length</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-939"></a>
<a name="gbab-940"></a><span class="cp">#ifdef PNG_PROGRESSIVE_READ_SUPPORTED</span>
<a name="gbab-941"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span> <span class="n">PNGCBAPI</span><span class="p">,</span><span class="n">png_push_fill_buffer</span><span class="p">,(</span><span class="n">png_structp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-942"></a>    <span class="n">png_bytep</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">png_size_t</span> <span class="n">length</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-943"></a><span class="cp">#endif</span>
<a name="gbab-944"></a>
<a name="gbab-945"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span> <span class="n">PNGCBAPI</span><span class="p">,</span><span class="n">png_default_write_data</span><span class="p">,(</span><span class="n">png_structp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-946"></a>    <span class="n">png_bytep</span> <span class="n">data</span><span class="p">,</span> <span class="n">png_size_t</span> <span class="n">length</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-947"></a>
<a name="gbab-948"></a><span class="cp">#ifdef PNG_WRITE_FLUSH_SUPPORTED</span>
<a name="gbab-949"></a><span class="cp">#  ifdef PNG_STDIO_SUPPORTED</span>
<a name="gbab-950"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span> <span class="n">PNGCBAPI</span><span class="p">,</span><span class="n">png_default_flush</span><span class="p">,(</span><span class="n">png_structp</span> <span class="n">png_ptr</span><span class="p">),</span>
<a name="gbab-951"></a>   <span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-952"></a><span class="cp">#  endif</span>
<a name="gbab-953"></a><span class="cp">#endif</span>
<a name="gbab-954"></a>
<a name="gbab-955"></a><span class="cm">/* Reset the CRC variable */</span>
<a name="gbab-956"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_reset_crc</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-957"></a>
<a name="gbab-958"></a><span class="cm">/* Write the &quot;data&quot; buffer to whatever output you are using */</span>
<a name="gbab-959"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_write_data</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-960"></a>    <span class="n">png_const_bytep</span> <span class="n">data</span><span class="p">,</span> <span class="n">png_size_t</span> <span class="n">length</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-961"></a>
<a name="gbab-962"></a><span class="cm">/* Read and check the PNG file signature */</span>
<a name="gbab-963"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_read_sig</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-964"></a>   <span class="n">png_inforp</span> <span class="n">info_ptr</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-965"></a>
<a name="gbab-966"></a><span class="cm">/* Read the chunk header (length + type name) */</span>
<a name="gbab-967"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="n">png_uint_32</span><span class="p">,</span><span class="n">png_read_chunk_header</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">),</span>
<a name="gbab-968"></a>   <span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-969"></a>
<a name="gbab-970"></a><span class="cm">/* Read data from whatever input you are using into the &quot;data&quot; buffer */</span>
<a name="gbab-971"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_read_data</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span> <span class="n">png_bytep</span> <span class="n">data</span><span class="p">,</span>
<a name="gbab-972"></a>    <span class="n">png_size_t</span> <span class="n">length</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-973"></a>
<a name="gbab-974"></a><span class="cm">/* Read bytes into buf, and update png_ptr-&gt;crc */</span>
<a name="gbab-975"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_crc_read</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span> <span class="n">png_bytep</span> <span class="n">buf</span><span class="p">,</span>
<a name="gbab-976"></a>    <span class="n">png_uint_32</span> <span class="n">length</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-977"></a>
<a name="gbab-978"></a><span class="cm">/* Read &quot;skip&quot; bytes, read the file crc, and (optionally) verify png_ptr-&gt;crc */</span>
<a name="gbab-979"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="n">png_crc_finish</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-980"></a>   <span class="n">png_uint_32</span> <span class="n">skip</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-981"></a>
<a name="gbab-982"></a><span class="cm">/* Read the CRC from the file and compare it to the libpng calculated CRC */</span>
<a name="gbab-983"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="n">png_crc_error</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-984"></a>
<a name="gbab-985"></a><span class="cm">/* Calculate the CRC over a section of data.  Note that we are only</span>
<a name="gbab-986"></a><span class="cm"> * passing a maximum of 64K on systems that have this as a memory limit,</span>
<a name="gbab-987"></a><span class="cm"> * since this is the maximum buffer size we can specify.</span>
<a name="gbab-988"></a><span class="cm"> */</span>
<a name="gbab-989"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_calculate_crc</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-990"></a>   <span class="n">png_const_bytep</span> <span class="n">ptr</span><span class="p">,</span> <span class="n">png_size_t</span> <span class="n">length</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-991"></a>
<a name="gbab-992"></a><span class="cp">#ifdef PNG_WRITE_FLUSH_SUPPORTED</span>
<a name="gbab-993"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_flush</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-994"></a><span class="cp">#endif</span>
<a name="gbab-995"></a>
<a name="gbab-996"></a><span class="cm">/* Write various chunks */</span>
<a name="gbab-997"></a>
<a name="gbab-998"></a><span class="cm">/* Write the IHDR chunk, and update the png_struct with the necessary</span>
<a name="gbab-999"></a><span class="cm"> * information.</span>
<a name="gbab-1000"></a><span class="cm"> */</span>
<a name="gbab-1001"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_write_IHDR</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1002"></a>   <span class="n">png_uint_32</span> <span class="n">width</span><span class="p">,</span> <span class="n">png_uint_32</span> <span class="n">height</span><span class="p">,</span> <span class="kt">int</span> <span class="n">bit_depth</span><span class="p">,</span> <span class="kt">int</span> <span class="n">color_type</span><span class="p">,</span>
<a name="gbab-1003"></a>   <span class="kt">int</span> <span class="n">compression_method</span><span class="p">,</span> <span class="kt">int</span> <span class="n">filter_method</span><span class="p">,</span> <span class="kt">int</span> <span class="n">interlace_method</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1004"></a>
<a name="gbab-1005"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_write_PLTE</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1006"></a>   <span class="n">png_const_colorp</span> <span class="n">palette</span><span class="p">,</span> <span class="n">png_uint_32</span> <span class="n">num_pal</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1007"></a>
<a name="gbab-1008"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_compress_IDAT</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1009"></a>   <span class="n">png_const_bytep</span> <span class="n">row_data</span><span class="p">,</span> <span class="n">png_alloc_size_t</span> <span class="n">row_data_length</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flush</span><span class="p">),</span>
<a name="gbab-1010"></a>   <span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1011"></a>
<a name="gbab-1012"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_write_IEND</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1013"></a>
<a name="gbab-1014"></a><span class="cp">#ifdef PNG_WRITE_gAMA_SUPPORTED</span>
<a name="gbab-1015"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_write_gAMA_fixed</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1016"></a>    <span class="n">png_fixed_point</span> <span class="n">file_gamma</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1017"></a><span class="cp">#  endif</span>
<a name="gbab-1018"></a>
<a name="gbab-1019"></a><span class="cp">#ifdef PNG_WRITE_sBIT_SUPPORTED</span>
<a name="gbab-1020"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_write_sBIT</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1021"></a>    <span class="n">png_const_color_8p</span> <span class="n">sbit</span><span class="p">,</span> <span class="kt">int</span> <span class="n">color_type</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1022"></a><span class="cp">#endif</span>
<a name="gbab-1023"></a>
<a name="gbab-1024"></a><span class="cp">#ifdef PNG_WRITE_cHRM_SUPPORTED</span>
<a name="gbab-1025"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_write_cHRM_fixed</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1026"></a>    <span class="k">const</span> <span class="n">png_xy</span> <span class="o">*</span><span class="n">xy</span><span class="p">),</span> <span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1027"></a>    <span class="cm">/* The xy value must have been previously validated */</span>
<a name="gbab-1028"></a><span class="cp">#endif</span>
<a name="gbab-1029"></a>
<a name="gbab-1030"></a><span class="cp">#ifdef PNG_WRITE_sRGB_SUPPORTED</span>
<a name="gbab-1031"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_write_sRGB</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1032"></a>    <span class="kt">int</span> <span class="n">intent</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1033"></a><span class="cp">#endif</span>
<a name="gbab-1034"></a>
<a name="gbab-1035"></a><span class="cp">#ifdef PNG_WRITE_iCCP_SUPPORTED</span>
<a name="gbab-1036"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_write_iCCP</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1037"></a>   <span class="n">png_const_charp</span> <span class="n">name</span><span class="p">,</span> <span class="n">png_const_bytep</span> <span class="n">profile</span><span class="p">),</span> <span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1038"></a>   <span class="cm">/* The profile must have been previously validated for correctness, the</span>
<a name="gbab-1039"></a><span class="cm">    * length comes from the first four bytes.  Only the base, deflate,</span>
<a name="gbab-1040"></a><span class="cm">    * compression is supported.</span>
<a name="gbab-1041"></a><span class="cm">    */</span>
<a name="gbab-1042"></a><span class="cp">#endif</span>
<a name="gbab-1043"></a>
<a name="gbab-1044"></a><span class="cp">#ifdef PNG_WRITE_sPLT_SUPPORTED</span>
<a name="gbab-1045"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_write_sPLT</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1046"></a>    <span class="n">png_const_sPLT_tp</span> <span class="n">palette</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1047"></a><span class="cp">#endif</span>
<a name="gbab-1048"></a>
<a name="gbab-1049"></a><span class="cp">#ifdef PNG_WRITE_tRNS_SUPPORTED</span>
<a name="gbab-1050"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_write_tRNS</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1051"></a>    <span class="n">png_const_bytep</span> <span class="n">trans</span><span class="p">,</span> <span class="n">png_const_color_16p</span> <span class="n">values</span><span class="p">,</span> <span class="kt">int</span> <span class="n">number</span><span class="p">,</span>
<a name="gbab-1052"></a>    <span class="kt">int</span> <span class="n">color_type</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1053"></a><span class="cp">#endif</span>
<a name="gbab-1054"></a>
<a name="gbab-1055"></a><span class="cp">#ifdef PNG_WRITE_bKGD_SUPPORTED</span>
<a name="gbab-1056"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_write_bKGD</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1057"></a>    <span class="n">png_const_color_16p</span> <span class="n">values</span><span class="p">,</span> <span class="kt">int</span> <span class="n">color_type</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1058"></a><span class="cp">#endif</span>
<a name="gbab-1059"></a>
<a name="gbab-1060"></a><span class="cp">#ifdef PNG_WRITE_hIST_SUPPORTED</span>
<a name="gbab-1061"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_write_hIST</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1062"></a>    <span class="n">png_const_uint_16p</span> <span class="n">hist</span><span class="p">,</span> <span class="kt">int</span> <span class="n">num_hist</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1063"></a><span class="cp">#endif</span>
<a name="gbab-1064"></a>
<a name="gbab-1065"></a><span class="cm">/* Chunks that have keywords */</span>
<a name="gbab-1066"></a><span class="cp">#ifdef PNG_WRITE_tEXt_SUPPORTED</span>
<a name="gbab-1067"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_write_tEXt</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1068"></a>   <span class="n">png_const_charp</span> <span class="n">key</span><span class="p">,</span> <span class="n">png_const_charp</span> <span class="n">text</span><span class="p">,</span> <span class="n">png_size_t</span> <span class="n">text_len</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1069"></a><span class="cp">#endif</span>
<a name="gbab-1070"></a>
<a name="gbab-1071"></a><span class="cp">#ifdef PNG_WRITE_zTXt_SUPPORTED</span>
<a name="gbab-1072"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_write_zTXt</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span> <span class="n">png_const_charp</span>
<a name="gbab-1073"></a>    <span class="n">key</span><span class="p">,</span> <span class="n">png_const_charp</span> <span class="n">text</span><span class="p">,</span> <span class="kt">int</span> <span class="n">compression</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1074"></a><span class="cp">#endif</span>
<a name="gbab-1075"></a>
<a name="gbab-1076"></a><span class="cp">#ifdef PNG_WRITE_iTXt_SUPPORTED</span>
<a name="gbab-1077"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_write_iTXt</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1078"></a>    <span class="kt">int</span> <span class="n">compression</span><span class="p">,</span> <span class="n">png_const_charp</span> <span class="n">key</span><span class="p">,</span> <span class="n">png_const_charp</span> <span class="n">lang</span><span class="p">,</span>
<a name="gbab-1079"></a>    <span class="n">png_const_charp</span> <span class="n">lang_key</span><span class="p">,</span> <span class="n">png_const_charp</span> <span class="n">text</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1080"></a><span class="cp">#endif</span>
<a name="gbab-1081"></a>
<a name="gbab-1082"></a><span class="cp">#ifdef PNG_TEXT_SUPPORTED  </span><span class="cm">/* Added at version 1.0.14 and 1.2.4 */</span><span class="cp"></span>
<a name="gbab-1083"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="n">png_set_text_2</span><span class="p">,(</span><span class="n">png_const_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1084"></a>    <span class="n">png_inforp</span> <span class="n">info_ptr</span><span class="p">,</span> <span class="n">png_const_textp</span> <span class="n">text_ptr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">num_text</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1085"></a><span class="cp">#endif</span>
<a name="gbab-1086"></a>
<a name="gbab-1087"></a><span class="cp">#ifdef PNG_WRITE_oFFs_SUPPORTED</span>
<a name="gbab-1088"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_write_oFFs</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1089"></a>    <span class="n">png_int_32</span> <span class="n">x_offset</span><span class="p">,</span> <span class="n">png_int_32</span> <span class="n">y_offset</span><span class="p">,</span> <span class="kt">int</span> <span class="n">unit_type</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1090"></a><span class="cp">#endif</span>
<a name="gbab-1091"></a>
<a name="gbab-1092"></a><span class="cp">#ifdef PNG_WRITE_pCAL_SUPPORTED</span>
<a name="gbab-1093"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_write_pCAL</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1094"></a>    <span class="n">png_charp</span> <span class="n">purpose</span><span class="p">,</span> <span class="n">png_int_32</span> <span class="n">X0</span><span class="p">,</span> <span class="n">png_int_32</span> <span class="n">X1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nparams</span><span class="p">,</span>
<a name="gbab-1095"></a>    <span class="n">png_const_charp</span> <span class="n">units</span><span class="p">,</span> <span class="n">png_charpp</span> <span class="n">params</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1096"></a><span class="cp">#endif</span>
<a name="gbab-1097"></a>
<a name="gbab-1098"></a><span class="cp">#ifdef PNG_WRITE_pHYs_SUPPORTED</span>
<a name="gbab-1099"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_write_pHYs</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1100"></a>    <span class="n">png_uint_32</span> <span class="n">x_pixels_per_unit</span><span class="p">,</span> <span class="n">png_uint_32</span> <span class="n">y_pixels_per_unit</span><span class="p">,</span>
<a name="gbab-1101"></a>    <span class="kt">int</span> <span class="n">unit_type</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1102"></a><span class="cp">#endif</span>
<a name="gbab-1103"></a>
<a name="gbab-1104"></a><span class="cp">#ifdef PNG_WRITE_tIME_SUPPORTED</span>
<a name="gbab-1105"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_write_tIME</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1106"></a>    <span class="n">png_const_timep</span> <span class="n">mod_time</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1107"></a><span class="cp">#endif</span>
<a name="gbab-1108"></a>
<a name="gbab-1109"></a><span class="cp">#ifdef PNG_WRITE_sCAL_SUPPORTED</span>
<a name="gbab-1110"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_write_sCAL_s</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1111"></a>    <span class="kt">int</span> <span class="n">unit</span><span class="p">,</span> <span class="n">png_const_charp</span> <span class="n">width</span><span class="p">,</span> <span class="n">png_const_charp</span> <span class="n">height</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1112"></a><span class="cp">#endif</span>
<a name="gbab-1113"></a>
<a name="gbab-1114"></a><span class="cm">/* Called when finished processing a row of data */</span>
<a name="gbab-1115"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_write_finish_row</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">),</span>
<a name="gbab-1116"></a>    <span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1117"></a>
<a name="gbab-1118"></a><span class="cm">/* Internal use only.   Called before first row of data */</span>
<a name="gbab-1119"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_write_start_row</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">),</span>
<a name="gbab-1120"></a>    <span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1121"></a>
<a name="gbab-1122"></a><span class="cm">/* Combine a row of data, dealing with alpha, etc. if requested.  &#39;row&#39; is an</span>
<a name="gbab-1123"></a><span class="cm"> * array of png_ptr-&gt;width pixels.  If the image is not interlaced or this</span>
<a name="gbab-1124"></a><span class="cm"> * is the final pass this just does a memcpy, otherwise the &quot;display&quot; flag</span>
<a name="gbab-1125"></a><span class="cm"> * is used to determine whether to copy pixels that are not in the current pass.</span>
<a name="gbab-1126"></a><span class="cm"> *</span>
<a name="gbab-1127"></a><span class="cm"> * Because &#39;png_do_read_interlace&#39; (below) replicates pixels this allows this</span>
<a name="gbab-1128"></a><span class="cm"> * function to achieve the documented &#39;blocky&#39; appearance during interlaced read</span>
<a name="gbab-1129"></a><span class="cm"> * if display is 1 and the &#39;sparkle&#39; appearance, where existing pixels in &#39;row&#39;</span>
<a name="gbab-1130"></a><span class="cm"> * are not changed if they are not in the current pass, when display is 0.</span>
<a name="gbab-1131"></a><span class="cm"> *</span>
<a name="gbab-1132"></a><span class="cm"> * &#39;display&#39; must be 0 or 1, otherwise the memcpy will be done regardless.</span>
<a name="gbab-1133"></a><span class="cm"> *</span>
<a name="gbab-1134"></a><span class="cm"> * The API always reads from the png_struct row buffer and always assumes that</span>
<a name="gbab-1135"></a><span class="cm"> * it is full width (png_do_read_interlace has already been called.)</span>
<a name="gbab-1136"></a><span class="cm"> *</span>
<a name="gbab-1137"></a><span class="cm"> * This function is only ever used to write to row buffers provided by the</span>
<a name="gbab-1138"></a><span class="cm"> * caller of the relevant libpng API and the row must have already been</span>
<a name="gbab-1139"></a><span class="cm"> * transformed by the read transformations.</span>
<a name="gbab-1140"></a><span class="cm"> *</span>
<a name="gbab-1141"></a><span class="cm"> * The PNG_USE_COMPILE_TIME_MASKS option causes generation of pre-computed</span>
<a name="gbab-1142"></a><span class="cm"> * bitmasks for use within the code, otherwise runtime generated masks are used.</span>
<a name="gbab-1143"></a><span class="cm"> * The default is compile time masks.</span>
<a name="gbab-1144"></a><span class="cm"> */</span>
<a name="gbab-1145"></a><span class="cp">#ifndef PNG_USE_COMPILE_TIME_MASKS</span>
<a name="gbab-1146"></a><span class="cp">#  define PNG_USE_COMPILE_TIME_MASKS 1</span>
<a name="gbab-1147"></a><span class="cp">#endif</span>
<a name="gbab-1148"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_combine_row</span><span class="p">,(</span><span class="n">png_const_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1149"></a>    <span class="n">png_bytep</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">display</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1150"></a>
<a name="gbab-1151"></a><span class="cp">#ifdef PNG_READ_INTERLACING_SUPPORTED</span>
<a name="gbab-1152"></a><span class="cm">/* Expand an interlaced row: the &#39;row_info&#39; describes the pass data that has</span>
<a name="gbab-1153"></a><span class="cm"> * been read in and must correspond to the pixels in &#39;row&#39;, the pixels are</span>
<a name="gbab-1154"></a><span class="cm"> * expanded (moved apart) in &#39;row&#39; to match the final layout, when doing this</span>
<a name="gbab-1155"></a><span class="cm"> * the pixels are *replicated* to the intervening space.  This is essential for</span>
<a name="gbab-1156"></a><span class="cm"> * the correct operation of png_combine_row, above.</span>
<a name="gbab-1157"></a><span class="cm"> */</span>
<a name="gbab-1158"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_do_read_interlace</span><span class="p">,(</span><span class="n">png_row_infop</span> <span class="n">row_info</span><span class="p">,</span>
<a name="gbab-1159"></a>    <span class="n">png_bytep</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pass</span><span class="p">,</span> <span class="n">png_uint_32</span> <span class="n">transformations</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1160"></a><span class="cp">#endif</span>
<a name="gbab-1161"></a>
<a name="gbab-1162"></a><span class="cm">/* GRR TO DO (2.0 or whenever):  simplify other internal calling interfaces */</span>
<a name="gbab-1163"></a>
<a name="gbab-1164"></a><span class="cp">#ifdef PNG_WRITE_INTERLACING_SUPPORTED</span>
<a name="gbab-1165"></a><span class="cm">/* Grab pixels out of a row for an interlaced pass */</span>
<a name="gbab-1166"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_do_write_interlace</span><span class="p">,(</span><span class="n">png_row_infop</span> <span class="n">row_info</span><span class="p">,</span>
<a name="gbab-1167"></a>    <span class="n">png_bytep</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pass</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1168"></a><span class="cp">#endif</span>
<a name="gbab-1169"></a>
<a name="gbab-1170"></a><span class="cm">/* Unfilter a row: check the filter value before calling this, there is no point</span>
<a name="gbab-1171"></a><span class="cm"> * calling it for PNG_FILTER_VALUE_NONE.</span>
<a name="gbab-1172"></a><span class="cm"> */</span>
<a name="gbab-1173"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_read_filter_row</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">pp</span><span class="p">,</span> <span class="n">png_row_infop</span>
<a name="gbab-1174"></a>    <span class="n">row_info</span><span class="p">,</span> <span class="n">png_bytep</span> <span class="n">row</span><span class="p">,</span> <span class="n">png_const_bytep</span> <span class="n">prev_row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">filter</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1175"></a>
<a name="gbab-1176"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_read_filter_row_up_neon</span><span class="p">,(</span><span class="n">png_row_infop</span> <span class="n">row_info</span><span class="p">,</span>
<a name="gbab-1177"></a>    <span class="n">png_bytep</span> <span class="n">row</span><span class="p">,</span> <span class="n">png_const_bytep</span> <span class="n">prev_row</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1178"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_read_filter_row_sub3_neon</span><span class="p">,(</span><span class="n">png_row_infop</span>
<a name="gbab-1179"></a>    <span class="n">row_info</span><span class="p">,</span> <span class="n">png_bytep</span> <span class="n">row</span><span class="p">,</span> <span class="n">png_const_bytep</span> <span class="n">prev_row</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1180"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_read_filter_row_sub4_neon</span><span class="p">,(</span><span class="n">png_row_infop</span>
<a name="gbab-1181"></a>    <span class="n">row_info</span><span class="p">,</span> <span class="n">png_bytep</span> <span class="n">row</span><span class="p">,</span> <span class="n">png_const_bytep</span> <span class="n">prev_row</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1182"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_read_filter_row_avg3_neon</span><span class="p">,(</span><span class="n">png_row_infop</span>
<a name="gbab-1183"></a>    <span class="n">row_info</span><span class="p">,</span> <span class="n">png_bytep</span> <span class="n">row</span><span class="p">,</span> <span class="n">png_const_bytep</span> <span class="n">prev_row</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1184"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_read_filter_row_avg4_neon</span><span class="p">,(</span><span class="n">png_row_infop</span>
<a name="gbab-1185"></a>    <span class="n">row_info</span><span class="p">,</span> <span class="n">png_bytep</span> <span class="n">row</span><span class="p">,</span> <span class="n">png_const_bytep</span> <span class="n">prev_row</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1186"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_read_filter_row_paeth3_neon</span><span class="p">,(</span><span class="n">png_row_infop</span>
<a name="gbab-1187"></a>    <span class="n">row_info</span><span class="p">,</span> <span class="n">png_bytep</span> <span class="n">row</span><span class="p">,</span> <span class="n">png_const_bytep</span> <span class="n">prev_row</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1188"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_read_filter_row_paeth4_neon</span><span class="p">,(</span><span class="n">png_row_infop</span>
<a name="gbab-1189"></a>    <span class="n">row_info</span><span class="p">,</span> <span class="n">png_bytep</span> <span class="n">row</span><span class="p">,</span> <span class="n">png_const_bytep</span> <span class="n">prev_row</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1190"></a>
<a name="gbab-1191"></a><span class="cm">/* Choose the best filter to use and filter the row data */</span>
<a name="gbab-1192"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_write_find_filter</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1193"></a>    <span class="n">png_row_infop</span> <span class="n">row_info</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1194"></a>
<a name="gbab-1195"></a><span class="cp">#ifdef PNG_SEQUENTIAL_READ_SUPPORTED</span>
<a name="gbab-1196"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_read_IDAT_data</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1197"></a>   <span class="n">png_bytep</span> <span class="n">output</span><span class="p">,</span> <span class="n">png_alloc_size_t</span> <span class="n">avail_out</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1198"></a>   <span class="cm">/* Read &#39;avail_out&#39; bytes of data from the IDAT stream.  If the output buffer</span>
<a name="gbab-1199"></a><span class="cm">    * is NULL the function checks, instead, for the end of the stream.  In this</span>
<a name="gbab-1200"></a><span class="cm">    * case a benign error will be issued if the stream end is not found or if</span>
<a name="gbab-1201"></a><span class="cm">    * extra data has to be consumed.</span>
<a name="gbab-1202"></a><span class="cm">    */</span>
<a name="gbab-1203"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_read_finish_IDAT</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">),</span>
<a name="gbab-1204"></a>   <span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1205"></a>   <span class="cm">/* This cleans up when the IDAT LZ stream does not end when the last image</span>
<a name="gbab-1206"></a><span class="cm">    * byte is read; there is still some pending input.</span>
<a name="gbab-1207"></a><span class="cm">    */</span>
<a name="gbab-1208"></a>
<a name="gbab-1209"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_read_finish_row</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">),</span>
<a name="gbab-1210"></a>   <span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1211"></a><span class="cm">/* Finish a row while reading, dealing with interlacing passes, etc. */</span>
<a name="gbab-1212"></a><span class="cp">#endif </span><span class="cm">/* SEQUENTIAL_READ */</span><span class="cp"></span>
<a name="gbab-1213"></a>
<a name="gbab-1214"></a><span class="cm">/* Initialize the row buffers, etc. */</span>
<a name="gbab-1215"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_read_start_row</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1216"></a>
<a name="gbab-1217"></a><span class="cp">#if PNG_ZLIB_VERNUM &gt;= 0x1240</span>
<a name="gbab-1218"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="n">png_zlib_inflate</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flush</span><span class="p">),</span>
<a name="gbab-1219"></a>      <span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1220"></a><span class="cp">#  define PNG_INFLATE(pp, flush) png_zlib_inflate(pp, flush)</span>
<a name="gbab-1221"></a><span class="cp">#else </span><span class="cm">/* Zlib &lt; 1.2.4 */</span><span class="cp"></span>
<a name="gbab-1222"></a><span class="cp">#  define PNG_INFLATE(pp, flush) inflate(&amp;(pp)-&gt;zstream, flush)</span>
<a name="gbab-1223"></a><span class="cp">#endif </span><span class="cm">/* Zlib &lt; 1.2.4 */</span><span class="cp"></span>
<a name="gbab-1224"></a>
<a name="gbab-1225"></a><span class="cp">#ifdef PNG_READ_TRANSFORMS_SUPPORTED</span>
<a name="gbab-1226"></a><span class="cm">/* Optional call to update the users info structure */</span>
<a name="gbab-1227"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_read_transform_info</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1228"></a>    <span class="n">png_inforp</span> <span class="n">info_ptr</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1229"></a><span class="cp">#endif</span>
<a name="gbab-1230"></a>
<a name="gbab-1231"></a><span class="cm">/* Shared transform functions, defined in pngtran.c */</span>
<a name="gbab-1232"></a><span class="cp">#if defined(PNG_WRITE_FILLER_SUPPORTED) || \</span>
<a name="gbab-1233"></a><span class="cp">    defined(PNG_READ_STRIP_ALPHA_SUPPORTED)</span>
<a name="gbab-1234"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_do_strip_channel</span><span class="p">,(</span><span class="n">png_row_infop</span> <span class="n">row_info</span><span class="p">,</span>
<a name="gbab-1235"></a>    <span class="n">png_bytep</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">at_start</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1236"></a><span class="cp">#endif</span>
<a name="gbab-1237"></a>
<a name="gbab-1238"></a><span class="cp">#ifdef PNG_16BIT_SUPPORTED</span>
<a name="gbab-1239"></a><span class="cp">#if defined(PNG_READ_SWAP_SUPPORTED) || defined(PNG_WRITE_SWAP_SUPPORTED)</span>
<a name="gbab-1240"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_do_swap</span><span class="p">,(</span><span class="n">png_row_infop</span> <span class="n">row_info</span><span class="p">,</span>
<a name="gbab-1241"></a>    <span class="n">png_bytep</span> <span class="n">row</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1242"></a><span class="cp">#endif</span>
<a name="gbab-1243"></a><span class="cp">#endif</span>
<a name="gbab-1244"></a>
<a name="gbab-1245"></a><span class="cp">#if defined(PNG_READ_PACKSWAP_SUPPORTED) || \</span>
<a name="gbab-1246"></a><span class="cp">    defined(PNG_WRITE_PACKSWAP_SUPPORTED)</span>
<a name="gbab-1247"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_do_packswap</span><span class="p">,(</span><span class="n">png_row_infop</span> <span class="n">row_info</span><span class="p">,</span>
<a name="gbab-1248"></a>    <span class="n">png_bytep</span> <span class="n">row</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1249"></a><span class="cp">#endif</span>
<a name="gbab-1250"></a>
<a name="gbab-1251"></a><span class="cp">#if defined(PNG_READ_INVERT_SUPPORTED) || defined(PNG_WRITE_INVERT_SUPPORTED)</span>
<a name="gbab-1252"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_do_invert</span><span class="p">,(</span><span class="n">png_row_infop</span> <span class="n">row_info</span><span class="p">,</span>
<a name="gbab-1253"></a>    <span class="n">png_bytep</span> <span class="n">row</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1254"></a><span class="cp">#endif</span>
<a name="gbab-1255"></a>
<a name="gbab-1256"></a><span class="cp">#if defined(PNG_READ_BGR_SUPPORTED) || defined(PNG_WRITE_BGR_SUPPORTED)</span>
<a name="gbab-1257"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_do_bgr</span><span class="p">,(</span><span class="n">png_row_infop</span> <span class="n">row_info</span><span class="p">,</span>
<a name="gbab-1258"></a>    <span class="n">png_bytep</span> <span class="n">row</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1259"></a><span class="cp">#endif</span>
<a name="gbab-1260"></a>
<a name="gbab-1261"></a><span class="cm">/* The following decodes the appropriate chunks, and does error correction,</span>
<a name="gbab-1262"></a><span class="cm"> * then calls the appropriate callback for the chunk if it is valid.</span>
<a name="gbab-1263"></a><span class="cm"> */</span>
<a name="gbab-1264"></a>
<a name="gbab-1265"></a><span class="cm">/* Decode the IHDR chunk */</span>
<a name="gbab-1266"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_handle_IHDR</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1267"></a>    <span class="n">png_inforp</span> <span class="n">info_ptr</span><span class="p">,</span> <span class="n">png_uint_32</span> <span class="n">length</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1268"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_handle_PLTE</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1269"></a>    <span class="n">png_inforp</span> <span class="n">info_ptr</span><span class="p">,</span> <span class="n">png_uint_32</span> <span class="n">length</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1270"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_handle_IEND</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1271"></a>    <span class="n">png_inforp</span> <span class="n">info_ptr</span><span class="p">,</span> <span class="n">png_uint_32</span> <span class="n">length</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1272"></a>
<a name="gbab-1273"></a><span class="cp">#ifdef PNG_READ_bKGD_SUPPORTED</span>
<a name="gbab-1274"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_handle_bKGD</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1275"></a>    <span class="n">png_inforp</span> <span class="n">info_ptr</span><span class="p">,</span> <span class="n">png_uint_32</span> <span class="n">length</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1276"></a><span class="cp">#endif</span>
<a name="gbab-1277"></a>
<a name="gbab-1278"></a><span class="cp">#ifdef PNG_READ_cHRM_SUPPORTED</span>
<a name="gbab-1279"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_handle_cHRM</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1280"></a>    <span class="n">png_inforp</span> <span class="n">info_ptr</span><span class="p">,</span> <span class="n">png_uint_32</span> <span class="n">length</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1281"></a><span class="cp">#endif</span>
<a name="gbab-1282"></a>
<a name="gbab-1283"></a><span class="cp">#ifdef PNG_READ_gAMA_SUPPORTED</span>
<a name="gbab-1284"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_handle_gAMA</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1285"></a>    <span class="n">png_inforp</span> <span class="n">info_ptr</span><span class="p">,</span> <span class="n">png_uint_32</span> <span class="n">length</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1286"></a><span class="cp">#endif</span>
<a name="gbab-1287"></a>
<a name="gbab-1288"></a><span class="cp">#ifdef PNG_READ_hIST_SUPPORTED</span>
<a name="gbab-1289"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_handle_hIST</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1290"></a>    <span class="n">png_inforp</span> <span class="n">info_ptr</span><span class="p">,</span> <span class="n">png_uint_32</span> <span class="n">length</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1291"></a><span class="cp">#endif</span>
<a name="gbab-1292"></a>
<a name="gbab-1293"></a><span class="cp">#ifdef PNG_READ_iCCP_SUPPORTED</span>
<a name="gbab-1294"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_handle_iCCP</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1295"></a>    <span class="n">png_inforp</span> <span class="n">info_ptr</span><span class="p">,</span> <span class="n">png_uint_32</span> <span class="n">length</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1296"></a><span class="cp">#endif </span><span class="cm">/* READ_iCCP */</span><span class="cp"></span>
<a name="gbab-1297"></a>
<a name="gbab-1298"></a><span class="cp">#ifdef PNG_READ_iTXt_SUPPORTED</span>
<a name="gbab-1299"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_handle_iTXt</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1300"></a>    <span class="n">png_inforp</span> <span class="n">info_ptr</span><span class="p">,</span> <span class="n">png_uint_32</span> <span class="n">length</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1301"></a><span class="cp">#endif</span>
<a name="gbab-1302"></a>
<a name="gbab-1303"></a><span class="cp">#ifdef PNG_READ_oFFs_SUPPORTED</span>
<a name="gbab-1304"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_handle_oFFs</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1305"></a>    <span class="n">png_inforp</span> <span class="n">info_ptr</span><span class="p">,</span> <span class="n">png_uint_32</span> <span class="n">length</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1306"></a><span class="cp">#endif</span>
<a name="gbab-1307"></a>
<a name="gbab-1308"></a><span class="cp">#ifdef PNG_READ_pCAL_SUPPORTED</span>
<a name="gbab-1309"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_handle_pCAL</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1310"></a>    <span class="n">png_inforp</span> <span class="n">info_ptr</span><span class="p">,</span> <span class="n">png_uint_32</span> <span class="n">length</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1311"></a><span class="cp">#endif</span>
<a name="gbab-1312"></a>
<a name="gbab-1313"></a><span class="cp">#ifdef PNG_READ_pHYs_SUPPORTED</span>
<a name="gbab-1314"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_handle_pHYs</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1315"></a>    <span class="n">png_inforp</span> <span class="n">info_ptr</span><span class="p">,</span> <span class="n">png_uint_32</span> <span class="n">length</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1316"></a><span class="cp">#endif</span>
<a name="gbab-1317"></a>
<a name="gbab-1318"></a><span class="cp">#ifdef PNG_READ_sBIT_SUPPORTED</span>
<a name="gbab-1319"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_handle_sBIT</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1320"></a>    <span class="n">png_inforp</span> <span class="n">info_ptr</span><span class="p">,</span> <span class="n">png_uint_32</span> <span class="n">length</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1321"></a><span class="cp">#endif</span>
<a name="gbab-1322"></a>
<a name="gbab-1323"></a><span class="cp">#ifdef PNG_READ_sCAL_SUPPORTED</span>
<a name="gbab-1324"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_handle_sCAL</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1325"></a>    <span class="n">png_inforp</span> <span class="n">info_ptr</span><span class="p">,</span> <span class="n">png_uint_32</span> <span class="n">length</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1326"></a><span class="cp">#endif</span>
<a name="gbab-1327"></a>
<a name="gbab-1328"></a><span class="cp">#ifdef PNG_READ_sPLT_SUPPORTED</span>
<a name="gbab-1329"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_handle_sPLT</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1330"></a>    <span class="n">png_inforp</span> <span class="n">info_ptr</span><span class="p">,</span> <span class="n">png_uint_32</span> <span class="n">length</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1331"></a><span class="cp">#endif </span><span class="cm">/* READ_sPLT */</span><span class="cp"></span>
<a name="gbab-1332"></a>
<a name="gbab-1333"></a><span class="cp">#ifdef PNG_READ_sRGB_SUPPORTED</span>
<a name="gbab-1334"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_handle_sRGB</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1335"></a>    <span class="n">png_inforp</span> <span class="n">info_ptr</span><span class="p">,</span> <span class="n">png_uint_32</span> <span class="n">length</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1336"></a><span class="cp">#endif</span>
<a name="gbab-1337"></a>
<a name="gbab-1338"></a><span class="cp">#ifdef PNG_READ_tEXt_SUPPORTED</span>
<a name="gbab-1339"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_handle_tEXt</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1340"></a>    <span class="n">png_inforp</span> <span class="n">info_ptr</span><span class="p">,</span> <span class="n">png_uint_32</span> <span class="n">length</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1341"></a><span class="cp">#endif</span>
<a name="gbab-1342"></a>
<a name="gbab-1343"></a><span class="cp">#ifdef PNG_READ_tIME_SUPPORTED</span>
<a name="gbab-1344"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_handle_tIME</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1345"></a>    <span class="n">png_inforp</span> <span class="n">info_ptr</span><span class="p">,</span> <span class="n">png_uint_32</span> <span class="n">length</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1346"></a><span class="cp">#endif</span>
<a name="gbab-1347"></a>
<a name="gbab-1348"></a><span class="cp">#ifdef PNG_READ_tRNS_SUPPORTED</span>
<a name="gbab-1349"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_handle_tRNS</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1350"></a>    <span class="n">png_inforp</span> <span class="n">info_ptr</span><span class="p">,</span> <span class="n">png_uint_32</span> <span class="n">length</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1351"></a><span class="cp">#endif</span>
<a name="gbab-1352"></a>
<a name="gbab-1353"></a><span class="cp">#ifdef PNG_READ_zTXt_SUPPORTED</span>
<a name="gbab-1354"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_handle_zTXt</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1355"></a>    <span class="n">png_inforp</span> <span class="n">info_ptr</span><span class="p">,</span> <span class="n">png_uint_32</span> <span class="n">length</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1356"></a><span class="cp">#endif</span>
<a name="gbab-1357"></a>
<a name="gbab-1358"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_check_chunk_name</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1359"></a>    <span class="n">png_uint_32</span> <span class="n">chunk_name</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1360"></a>
<a name="gbab-1361"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_handle_unknown</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1362"></a>    <span class="n">png_inforp</span> <span class="n">info_ptr</span><span class="p">,</span> <span class="n">png_uint_32</span> <span class="n">length</span><span class="p">,</span> <span class="kt">int</span> <span class="n">keep</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1363"></a>   <span class="cm">/* This is the function that gets called for unknown chunks.  The &#39;keep&#39;</span>
<a name="gbab-1364"></a><span class="cm">    * argument is either non-zero for a known chunk that has been set to be</span>
<a name="gbab-1365"></a><span class="cm">    * handled as unknown or zero for an unknown chunk.  By default the function</span>
<a name="gbab-1366"></a><span class="cm">    * just skips the chunk or errors out if it is critical.</span>
<a name="gbab-1367"></a><span class="cm">    */</span>
<a name="gbab-1368"></a>
<a name="gbab-1369"></a><span class="cp">#if defined(PNG_READ_UNKNOWN_CHUNKS_SUPPORTED) ||\</span>
<a name="gbab-1370"></a><span class="cp">    defined(PNG_HANDLE_AS_UNKNOWN_SUPPORTED)</span>
<a name="gbab-1371"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="n">png_chunk_unknown_handling</span><span class="p">,</span>
<a name="gbab-1372"></a>    <span class="p">(</span><span class="n">png_const_structrp</span> <span class="n">png_ptr</span><span class="p">,</span> <span class="n">png_uint_32</span> <span class="n">chunk_name</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1373"></a>   <span class="cm">/* Exactly as the API png_handle_as_unknown() except that the argument is a</span>
<a name="gbab-1374"></a><span class="cm">    * 32-bit chunk name, not a string.</span>
<a name="gbab-1375"></a><span class="cm"> */</span>
<a name="gbab-1376"></a><span class="cp">#endif </span><span class="cm">/* READ_UNKNOWN_CHUNKS || HANDLE_AS_UNKNOWN */</span><span class="cp"></span>
<a name="gbab-1377"></a>
<a name="gbab-1378"></a><span class="cm">/* Handle the transformations for reading and writing */</span>
<a name="gbab-1379"></a><span class="cp">#ifdef PNG_READ_TRANSFORMS_SUPPORTED</span>
<a name="gbab-1380"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_do_read_transformations</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1381"></a>   <span class="n">png_row_infop</span> <span class="n">row_info</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1382"></a><span class="cp">#endif</span>
<a name="gbab-1383"></a><span class="cp">#ifdef PNG_WRITE_TRANSFORMS_SUPPORTED</span>
<a name="gbab-1384"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_do_write_transformations</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1385"></a>   <span class="n">png_row_infop</span> <span class="n">row_info</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1386"></a><span class="cp">#endif</span>
<a name="gbab-1387"></a>
<a name="gbab-1388"></a><span class="cp">#ifdef PNG_READ_TRANSFORMS_SUPPORTED</span>
<a name="gbab-1389"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_init_read_transformations</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">),</span>
<a name="gbab-1390"></a>    <span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1391"></a><span class="cp">#endif</span>
<a name="gbab-1392"></a>
<a name="gbab-1393"></a><span class="cp">#ifdef PNG_PROGRESSIVE_READ_SUPPORTED</span>
<a name="gbab-1394"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_push_read_chunk</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1395"></a>    <span class="n">png_inforp</span> <span class="n">info_ptr</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1396"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_push_read_sig</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1397"></a>    <span class="n">png_inforp</span> <span class="n">info_ptr</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1398"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_push_check_crc</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1399"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_push_save_buffer</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">),</span>
<a name="gbab-1400"></a>    <span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1401"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_push_restore_buffer</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1402"></a>    <span class="n">png_bytep</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">png_size_t</span> <span class="n">buffer_length</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1403"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_push_read_IDAT</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1404"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_process_IDAT_data</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1405"></a>    <span class="n">png_bytep</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">png_size_t</span> <span class="n">buffer_length</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1406"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_push_process_row</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">),</span>
<a name="gbab-1407"></a>    <span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1408"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_push_handle_unknown</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1409"></a>   <span class="n">png_inforp</span> <span class="n">info_ptr</span><span class="p">,</span> <span class="n">png_uint_32</span> <span class="n">length</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1410"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_push_have_info</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1411"></a>   <span class="n">png_inforp</span> <span class="n">info_ptr</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1412"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_push_have_end</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1413"></a>   <span class="n">png_inforp</span> <span class="n">info_ptr</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1414"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_push_have_row</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1415"></a>     <span class="n">png_bytep</span> <span class="n">row</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1416"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_push_read_end</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1417"></a>    <span class="n">png_inforp</span> <span class="n">info_ptr</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1418"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_process_some_data</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1419"></a>    <span class="n">png_inforp</span> <span class="n">info_ptr</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1420"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_read_push_finish_row</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">),</span>
<a name="gbab-1421"></a>    <span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1422"></a><span class="cp">#  ifdef PNG_READ_tEXt_SUPPORTED</span>
<a name="gbab-1423"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_push_handle_tEXt</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1424"></a>    <span class="n">png_inforp</span> <span class="n">info_ptr</span><span class="p">,</span> <span class="n">png_uint_32</span> <span class="n">length</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1425"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_push_read_tEXt</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1426"></a>    <span class="n">png_inforp</span> <span class="n">info_ptr</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1427"></a><span class="cp">#  endif</span>
<a name="gbab-1428"></a><span class="cp">#  ifdef PNG_READ_zTXt_SUPPORTED</span>
<a name="gbab-1429"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_push_handle_zTXt</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1430"></a>    <span class="n">png_inforp</span> <span class="n">info_ptr</span><span class="p">,</span> <span class="n">png_uint_32</span> <span class="n">length</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1431"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_push_read_zTXt</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1432"></a>    <span class="n">png_inforp</span> <span class="n">info_ptr</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1433"></a><span class="cp">#  endif</span>
<a name="gbab-1434"></a><span class="cp">#  ifdef PNG_READ_iTXt_SUPPORTED</span>
<a name="gbab-1435"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_push_handle_iTXt</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1436"></a>    <span class="n">png_inforp</span> <span class="n">info_ptr</span><span class="p">,</span> <span class="n">png_uint_32</span> <span class="n">length</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1437"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_push_read_iTXt</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1438"></a>    <span class="n">png_inforp</span> <span class="n">info_ptr</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1439"></a><span class="cp">#  endif</span>
<a name="gbab-1440"></a>
<a name="gbab-1441"></a><span class="cp">#endif </span><span class="cm">/* PROGRESSIVE_READ */</span><span class="cp"></span>
<a name="gbab-1442"></a>
<a name="gbab-1443"></a><span class="cm">/* Added at libpng version 1.6.0 */</span>
<a name="gbab-1444"></a><span class="cp">#ifdef PNG_GAMMA_SUPPORTED</span>
<a name="gbab-1445"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_colorspace_set_gamma</span><span class="p">,(</span><span class="n">png_const_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1446"></a>    <span class="n">png_colorspacerp</span> <span class="n">colorspace</span><span class="p">,</span> <span class="n">png_fixed_point</span> <span class="n">gAMA</span><span class="p">),</span> <span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1447"></a>   <span class="cm">/* Set the colorspace gamma with a value provided by the application or by</span>
<a name="gbab-1448"></a><span class="cm">    * the gAMA chunk on read.  The value will override anything set by an ICC</span>
<a name="gbab-1449"></a><span class="cm">    * profile.</span>
<a name="gbab-1450"></a><span class="cm">    */</span>
<a name="gbab-1451"></a>
<a name="gbab-1452"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_colorspace_sync_info</span><span class="p">,(</span><span class="n">png_const_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1453"></a>    <span class="n">png_inforp</span> <span class="n">info_ptr</span><span class="p">),</span> <span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1454"></a>    <span class="cm">/* Synchronize the info &#39;valid&#39; flags with the colorspace */</span>
<a name="gbab-1455"></a>
<a name="gbab-1456"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_colorspace_sync</span><span class="p">,(</span><span class="n">png_const_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1457"></a>    <span class="n">png_inforp</span> <span class="n">info_ptr</span><span class="p">),</span> <span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1458"></a>    <span class="cm">/* Copy the png_struct colorspace to the info_struct and call the above to</span>
<a name="gbab-1459"></a><span class="cm">     * synchronize the flags.  Checks for NULL info_ptr and does nothing.</span>
<a name="gbab-1460"></a><span class="cm">     */</span>
<a name="gbab-1461"></a><span class="cp">#endif</span>
<a name="gbab-1462"></a>
<a name="gbab-1463"></a><span class="cm">/* Added at libpng version 1.4.0 */</span>
<a name="gbab-1464"></a><span class="cp">#ifdef PNG_COLORSPACE_SUPPORTED</span>
<a name="gbab-1465"></a><span class="cm">/* These internal functions are for maintaining the colorspace structure within</span>
<a name="gbab-1466"></a><span class="cm"> * a png_info or png_struct (or, indeed, both).</span>
<a name="gbab-1467"></a><span class="cm"> */</span>
<a name="gbab-1468"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="n">png_colorspace_set_chromaticities</span><span class="p">,</span>
<a name="gbab-1469"></a>   <span class="p">(</span><span class="n">png_const_structrp</span> <span class="n">png_ptr</span><span class="p">,</span> <span class="n">png_colorspacerp</span> <span class="n">colorspace</span><span class="p">,</span> <span class="k">const</span> <span class="n">png_xy</span> <span class="o">*</span><span class="n">xy</span><span class="p">,</span>
<a name="gbab-1470"></a>    <span class="kt">int</span> <span class="n">preferred</span><span class="p">),</span> <span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1471"></a>
<a name="gbab-1472"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="n">png_colorspace_set_endpoints</span><span class="p">,</span>
<a name="gbab-1473"></a>   <span class="p">(</span><span class="n">png_const_structrp</span> <span class="n">png_ptr</span><span class="p">,</span> <span class="n">png_colorspacerp</span> <span class="n">colorspace</span><span class="p">,</span> <span class="k">const</span> <span class="n">png_XYZ</span> <span class="o">*</span><span class="n">XYZ</span><span class="p">,</span>
<a name="gbab-1474"></a>    <span class="kt">int</span> <span class="n">preferred</span><span class="p">),</span> <span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1475"></a>
<a name="gbab-1476"></a><span class="cp">#ifdef PNG_sRGB_SUPPORTED</span>
<a name="gbab-1477"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="n">png_colorspace_set_sRGB</span><span class="p">,(</span><span class="n">png_const_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1478"></a>   <span class="n">png_colorspacerp</span> <span class="n">colorspace</span><span class="p">,</span> <span class="kt">int</span> <span class="n">intent</span><span class="p">),</span> <span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1479"></a>   <span class="cm">/* This does set the colorspace gAMA and cHRM values too, but doesn&#39;t set the</span>
<a name="gbab-1480"></a><span class="cm">    * flags to write them, if it returns false there was a problem and an error</span>
<a name="gbab-1481"></a><span class="cm">    * message has already been output (but the colorspace may still need to be</span>
<a name="gbab-1482"></a><span class="cm">    * synced to record the invalid flag).</span>
<a name="gbab-1483"></a><span class="cm">    */</span>
<a name="gbab-1484"></a><span class="cp">#endif </span><span class="cm">/* sRGB */</span><span class="cp"></span>
<a name="gbab-1485"></a>
<a name="gbab-1486"></a><span class="cp">#ifdef PNG_iCCP_SUPPORTED</span>
<a name="gbab-1487"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="n">png_colorspace_set_ICC</span><span class="p">,(</span><span class="n">png_const_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1488"></a>   <span class="n">png_colorspacerp</span> <span class="n">colorspace</span><span class="p">,</span> <span class="n">png_const_charp</span> <span class="n">name</span><span class="p">,</span>
<a name="gbab-1489"></a>   <span class="n">png_uint_32</span> <span class="n">profile_length</span><span class="p">,</span> <span class="n">png_const_bytep</span> <span class="n">profile</span><span class="p">,</span> <span class="kt">int</span> <span class="n">color_type</span><span class="p">),</span>
<a name="gbab-1490"></a>   <span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1491"></a>   <span class="cm">/* The &#39;name&#39; is used for information only */</span>
<a name="gbab-1492"></a>
<a name="gbab-1493"></a><span class="cm">/* Routines for checking parts of an ICC profile. */</span>
<a name="gbab-1494"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="n">png_icc_check_length</span><span class="p">,(</span><span class="n">png_const_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1495"></a>   <span class="n">png_colorspacerp</span> <span class="n">colorspace</span><span class="p">,</span> <span class="n">png_const_charp</span> <span class="n">name</span><span class="p">,</span>
<a name="gbab-1496"></a>   <span class="n">png_uint_32</span> <span class="n">profile_length</span><span class="p">),</span> <span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1497"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="n">png_icc_check_header</span><span class="p">,(</span><span class="n">png_const_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1498"></a>   <span class="n">png_colorspacerp</span> <span class="n">colorspace</span><span class="p">,</span> <span class="n">png_const_charp</span> <span class="n">name</span><span class="p">,</span>
<a name="gbab-1499"></a>   <span class="n">png_uint_32</span> <span class="n">profile_length</span><span class="p">,</span>
<a name="gbab-1500"></a>   <span class="n">png_const_bytep</span> <span class="n">profile</span> <span class="cm">/* first 132 bytes only */</span><span class="p">,</span> <span class="kt">int</span> <span class="n">color_type</span><span class="p">),</span>
<a name="gbab-1501"></a>   <span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1502"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="n">png_icc_check_tag_table</span><span class="p">,(</span><span class="n">png_const_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1503"></a>   <span class="n">png_colorspacerp</span> <span class="n">colorspace</span><span class="p">,</span> <span class="n">png_const_charp</span> <span class="n">name</span><span class="p">,</span>
<a name="gbab-1504"></a>   <span class="n">png_uint_32</span> <span class="n">profile_length</span><span class="p">,</span>
<a name="gbab-1505"></a>   <span class="n">png_const_bytep</span> <span class="n">profile</span> <span class="cm">/* header plus whole tag table */</span><span class="p">),</span> <span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1506"></a><span class="cp">#ifdef PNG_sRGB_SUPPORTED</span>
<a name="gbab-1507"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_icc_set_sRGB</span><span class="p">,(</span>
<a name="gbab-1508"></a>   <span class="n">png_const_structrp</span> <span class="n">png_ptr</span><span class="p">,</span> <span class="n">png_colorspacerp</span> <span class="n">colorspace</span><span class="p">,</span>
<a name="gbab-1509"></a>   <span class="n">png_const_bytep</span> <span class="n">profile</span><span class="p">,</span> <span class="n">uLong</span> <span class="n">adler</span><span class="p">),</span> <span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1510"></a>   <span class="cm">/* &#39;adler&#39; is the Adler32 checksum of the uncompressed profile data. It may</span>
<a name="gbab-1511"></a><span class="cm">    * be zero to indicate that it is not available.  It is used, if provided,</span>
<a name="gbab-1512"></a><span class="cm">    * as a fast check on the profile when checking to see if it is sRGB.</span>
<a name="gbab-1513"></a><span class="cm"> */</span>
<a name="gbab-1514"></a><span class="cp">#endif</span>
<a name="gbab-1515"></a><span class="cp">#endif </span><span class="cm">/* iCCP */</span><span class="cp"></span>
<a name="gbab-1516"></a>
<a name="gbab-1517"></a><span class="cp">#ifdef PNG_READ_RGB_TO_GRAY_SUPPORTED</span>
<a name="gbab-1518"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_colorspace_set_rgb_coefficients</span><span class="p">,</span>
<a name="gbab-1519"></a>   <span class="p">(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">),</span> <span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1520"></a>   <span class="cm">/* Set the rgb_to_gray coefficients from the colorspace Y values */</span>
<a name="gbab-1521"></a><span class="cp">#endif </span><span class="cm">/* READ_RGB_TO_GRAY */</span><span class="cp"></span>
<a name="gbab-1522"></a><span class="cp">#endif </span><span class="cm">/* COLORSPACE */</span><span class="cp"></span>
<a name="gbab-1523"></a>
<a name="gbab-1524"></a><span class="cm">/* Added at libpng version 1.4.0 */</span>
<a name="gbab-1525"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_check_IHDR</span><span class="p">,(</span><span class="n">png_const_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1526"></a>    <span class="n">png_uint_32</span> <span class="n">width</span><span class="p">,</span> <span class="n">png_uint_32</span> <span class="n">height</span><span class="p">,</span> <span class="kt">int</span> <span class="n">bit_depth</span><span class="p">,</span>
<a name="gbab-1527"></a>    <span class="kt">int</span> <span class="n">color_type</span><span class="p">,</span> <span class="kt">int</span> <span class="n">interlace_type</span><span class="p">,</span> <span class="kt">int</span> <span class="n">compression_type</span><span class="p">,</span>
<a name="gbab-1528"></a>    <span class="kt">int</span> <span class="n">filter_type</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1529"></a>
<a name="gbab-1530"></a><span class="cm">/* Added at libpng version 1.5.10 */</span>
<a name="gbab-1531"></a><span class="cp">#if defined(PNG_READ_CHECK_FOR_INVALID_INDEX_SUPPORTED) || \</span>
<a name="gbab-1532"></a><span class="cp">    defined(PNG_WRITE_CHECK_FOR_INVALID_INDEX_SUPPORTED)</span>
<a name="gbab-1533"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_do_check_palette_indexes</span><span class="p">,</span>
<a name="gbab-1534"></a>   <span class="p">(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span> <span class="n">png_row_infop</span> <span class="n">row_info</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1535"></a><span class="cp">#endif</span>
<a name="gbab-1536"></a>
<a name="gbab-1537"></a><span class="cp">#if defined(PNG_FLOATING_POINT_SUPPORTED) &amp;&amp; defined(PNG_ERROR_TEXT_SUPPORTED)</span>
<a name="gbab-1538"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_fixed_error</span><span class="p">,(</span><span class="n">png_const_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1539"></a>   <span class="n">png_const_charp</span> <span class="n">name</span><span class="p">),</span><span class="n">PNG_NORETURN</span><span class="p">);</span>
<a name="gbab-1540"></a><span class="cp">#endif</span>
<a name="gbab-1541"></a>
<a name="gbab-1542"></a><span class="cm">/* Puts &#39;string&#39; into &#39;buffer&#39; at buffer[pos], taking care never to overwrite</span>
<a name="gbab-1543"></a><span class="cm"> * the end.  Always leaves the buffer nul terminated.  Never errors out (and</span>
<a name="gbab-1544"></a><span class="cm"> * there is no error code.)</span>
<a name="gbab-1545"></a><span class="cm"> */</span>
<a name="gbab-1546"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">size_t</span><span class="p">,</span><span class="n">png_safecat</span><span class="p">,(</span><span class="n">png_charp</span> <span class="n">buffer</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">bufsize</span><span class="p">,</span>
<a name="gbab-1547"></a>   <span class="kt">size_t</span> <span class="n">pos</span><span class="p">,</span> <span class="n">png_const_charp</span> <span class="n">string</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1548"></a>
<a name="gbab-1549"></a><span class="cm">/* Various internal functions to handle formatted warning messages, currently</span>
<a name="gbab-1550"></a><span class="cm"> * only implemented for warnings.</span>
<a name="gbab-1551"></a><span class="cm"> */</span>
<a name="gbab-1552"></a><span class="cp">#if defined(PNG_WARNINGS_SUPPORTED) || defined(PNG_TIME_RFC1123_SUPPORTED)</span>
<a name="gbab-1553"></a><span class="cm">/* Utility to dump an unsigned value into a buffer, given a start pointer and</span>
<a name="gbab-1554"></a><span class="cm"> * and end pointer (which should point just *beyond* the end of the buffer!)</span>
<a name="gbab-1555"></a><span class="cm"> * Returns the pointer to the start of the formatted string.  This utility only</span>
<a name="gbab-1556"></a><span class="cm"> * does unsigned values.</span>
<a name="gbab-1557"></a><span class="cm"> */</span>
<a name="gbab-1558"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="n">png_charp</span><span class="p">,</span><span class="n">png_format_number</span><span class="p">,(</span><span class="n">png_const_charp</span> <span class="n">start</span><span class="p">,</span>
<a name="gbab-1559"></a>   <span class="n">png_charp</span> <span class="n">end</span><span class="p">,</span> <span class="kt">int</span> <span class="n">format</span><span class="p">,</span> <span class="n">png_alloc_size_t</span> <span class="n">number</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1560"></a>
<a name="gbab-1561"></a><span class="cm">/* Convenience macro that takes an array: */</span>
<a name="gbab-1562"></a><span class="cp">#define PNG_FORMAT_NUMBER(buffer,format,number) \</span>
<a name="gbab-1563"></a><span class="cp">   png_format_number(buffer, buffer + (sizeof buffer), format, number)</span>
<a name="gbab-1564"></a>
<a name="gbab-1565"></a><span class="cm">/* Suggested size for a number buffer (enough for 64 bits and a sign!) */</span>
<a name="gbab-1566"></a><span class="cp">#define PNG_NUMBER_BUFFER_SIZE 24</span>
<a name="gbab-1567"></a>
<a name="gbab-1568"></a><span class="cm">/* These are the integer formats currently supported, the name is formed from</span>
<a name="gbab-1569"></a><span class="cm"> * the standard printf(3) format string.</span>
<a name="gbab-1570"></a><span class="cm"> */</span>
<a name="gbab-1571"></a><span class="cp">#define PNG_NUMBER_FORMAT_u     1 </span><span class="cm">/* chose unsigned API! */</span><span class="cp"></span>
<a name="gbab-1572"></a><span class="cp">#define PNG_NUMBER_FORMAT_02u   2</span>
<a name="gbab-1573"></a><span class="cp">#define PNG_NUMBER_FORMAT_d     1 </span><span class="cm">/* chose signed API! */</span><span class="cp"></span>
<a name="gbab-1574"></a><span class="cp">#define PNG_NUMBER_FORMAT_02d   2</span>
<a name="gbab-1575"></a><span class="cp">#define PNG_NUMBER_FORMAT_x     3</span>
<a name="gbab-1576"></a><span class="cp">#define PNG_NUMBER_FORMAT_02x   4</span>
<a name="gbab-1577"></a><span class="cp">#define PNG_NUMBER_FORMAT_fixed 5 </span><span class="cm">/* choose the signed API */</span><span class="cp"></span>
<a name="gbab-1578"></a><span class="cp">#endif</span>
<a name="gbab-1579"></a>
<a name="gbab-1580"></a><span class="cp">#ifdef PNG_WARNINGS_SUPPORTED</span>
<a name="gbab-1581"></a><span class="cm">/* New defines and members adding in libpng-1.5.4 */</span>
<a name="gbab-1582"></a><span class="cp">#  define PNG_WARNING_PARAMETER_SIZE 32</span>
<a name="gbab-1583"></a><span class="cp">#  define PNG_WARNING_PARAMETER_COUNT 8 </span><span class="cm">/* Maximum 9; see pngerror.c */</span><span class="cp"></span>
<a name="gbab-1584"></a>
<a name="gbab-1585"></a><span class="cm">/* An l-value of this type has to be passed to the APIs below to cache the</span>
<a name="gbab-1586"></a><span class="cm"> * values of the parameters to a formatted warning message.</span>
<a name="gbab-1587"></a><span class="cm"> */</span>
<a name="gbab-1588"></a><span class="k">typedef</span> <span class="kt">char</span> <span class="n">png_warning_parameters</span><span class="p">[</span><span class="n">PNG_WARNING_PARAMETER_COUNT</span><span class="p">][</span>
<a name="gbab-1589"></a>   <span class="n">PNG_WARNING_PARAMETER_SIZE</span><span class="p">];</span>
<a name="gbab-1590"></a>
<a name="gbab-1591"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_warning_parameter</span><span class="p">,(</span><span class="n">png_warning_parameters</span> <span class="n">p</span><span class="p">,</span>
<a name="gbab-1592"></a>   <span class="kt">int</span> <span class="n">number</span><span class="p">,</span> <span class="n">png_const_charp</span> <span class="n">string</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1593"></a>    <span class="cm">/* Parameters are limited in size to PNG_WARNING_PARAMETER_SIZE characters,</span>
<a name="gbab-1594"></a><span class="cm">     * including the trailing &#39;\0&#39;.</span>
<a name="gbab-1595"></a><span class="cm">     */</span>
<a name="gbab-1596"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_warning_parameter_unsigned</span><span class="p">,</span>
<a name="gbab-1597"></a>   <span class="p">(</span><span class="n">png_warning_parameters</span> <span class="n">p</span><span class="p">,</span> <span class="kt">int</span> <span class="n">number</span><span class="p">,</span> <span class="kt">int</span> <span class="n">format</span><span class="p">,</span> <span class="n">png_alloc_size_t</span> <span class="n">value</span><span class="p">),</span>
<a name="gbab-1598"></a>   <span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1599"></a>    <span class="cm">/* Use png_alloc_size_t because it is an unsigned type as big as any we</span>
<a name="gbab-1600"></a><span class="cm">     * need to output.  Use the following for a signed value.</span>
<a name="gbab-1601"></a><span class="cm">     */</span>
<a name="gbab-1602"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_warning_parameter_signed</span><span class="p">,</span>
<a name="gbab-1603"></a>   <span class="p">(</span><span class="n">png_warning_parameters</span> <span class="n">p</span><span class="p">,</span> <span class="kt">int</span> <span class="n">number</span><span class="p">,</span> <span class="kt">int</span> <span class="n">format</span><span class="p">,</span> <span class="n">png_int_32</span> <span class="n">value</span><span class="p">),</span>
<a name="gbab-1604"></a>   <span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1605"></a>
<a name="gbab-1606"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_formatted_warning</span><span class="p">,(</span><span class="n">png_const_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1607"></a>   <span class="n">png_warning_parameters</span> <span class="n">p</span><span class="p">,</span> <span class="n">png_const_charp</span> <span class="n">message</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1608"></a>    <span class="cm">/* &#39;message&#39; follows the X/Open approach of using @1, @2 to insert</span>
<a name="gbab-1609"></a><span class="cm">     * parameters previously supplied using the above functions.  Errors in</span>
<a name="gbab-1610"></a><span class="cm">    * specifying the parameters will simply result in garbage substitutions.</span>
<a name="gbab-1611"></a><span class="cm">     */</span>
<a name="gbab-1612"></a><span class="cp">#endif</span>
<a name="gbab-1613"></a>
<a name="gbab-1614"></a><span class="cp">#ifdef PNG_BENIGN_ERRORS_SUPPORTED</span>
<a name="gbab-1615"></a><span class="cm">/* Application errors (new in 1.6); use these functions (declared below) for</span>
<a name="gbab-1616"></a><span class="cm"> * errors in the parameters or order of API function calls on read.  The</span>
<a name="gbab-1617"></a><span class="cm"> * &#39;warning&#39; should be used for an error that can be handled completely; the</span>
<a name="gbab-1618"></a><span class="cm"> * &#39;error&#39; for one which can be handled safely but which may lose application</span>
<a name="gbab-1619"></a><span class="cm"> * information or settings.</span>
<a name="gbab-1620"></a><span class="cm"> *</span>
<a name="gbab-1621"></a><span class="cm"> * By default these both result in a png_error call prior to release, while in a</span>
<a name="gbab-1622"></a><span class="cm"> * released version the &#39;warning&#39; is just a warning.  However if the application</span>
<a name="gbab-1623"></a><span class="cm"> * explicitly disables benign errors (explicitly permitting the code to lose</span>
<a name="gbab-1624"></a><span class="cm"> * information) they both turn into warnings.</span>
<a name="gbab-1625"></a><span class="cm"> *</span>
<a name="gbab-1626"></a><span class="cm"> * If benign errors aren&#39;t supported they end up as the corresponding base call</span>
<a name="gbab-1627"></a><span class="cm"> * (png_warning or png_error.)</span>
<a name="gbab-1628"></a><span class="cm"> */</span>
<a name="gbab-1629"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_app_warning</span><span class="p">,(</span><span class="n">png_const_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1630"></a>   <span class="n">png_const_charp</span> <span class="n">message</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1631"></a>   <span class="cm">/* The application provided invalid parameters to an API function or called</span>
<a name="gbab-1632"></a><span class="cm">    * an API function at the wrong time, libpng can completely recover.</span>
<a name="gbab-1633"></a><span class="cm">    */</span>
<a name="gbab-1634"></a>
<a name="gbab-1635"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_app_error</span><span class="p">,(</span><span class="n">png_const_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1636"></a>   <span class="n">png_const_charp</span> <span class="n">message</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1637"></a>   <span class="cm">/* As above but libpng will ignore the call, or attempt some other partial</span>
<a name="gbab-1638"></a><span class="cm">    * recovery from the error.</span>
<a name="gbab-1639"></a><span class="cm">    */</span>
<a name="gbab-1640"></a><span class="cp">#else</span>
<a name="gbab-1641"></a><span class="cp">#  define png_app_warning(pp,s) png_warning(pp,s)</span>
<a name="gbab-1642"></a><span class="cp">#  define png_app_error(pp,s) png_error(pp,s)</span>
<a name="gbab-1643"></a><span class="cp">#endif</span>
<a name="gbab-1644"></a>
<a name="gbab-1645"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_chunk_report</span><span class="p">,(</span><span class="n">png_const_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1646"></a>   <span class="n">png_const_charp</span> <span class="n">message</span><span class="p">,</span> <span class="kt">int</span> <span class="n">error</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1647"></a>   <span class="cm">/* Report a recoverable issue in chunk data.  On read this is used to report</span>
<a name="gbab-1648"></a><span class="cm">    * a problem found while reading a particular chunk and the</span>
<a name="gbab-1649"></a><span class="cm">    * png_chunk_benign_error or png_chunk_warning function is used as</span>
<a name="gbab-1650"></a><span class="cm">    * appropriate.  On write this is used to report an error that comes from</span>
<a name="gbab-1651"></a><span class="cm">    * data set via an application call to a png_set_ API and png_app_error or</span>
<a name="gbab-1652"></a><span class="cm">    * png_app_warning is used as appropriate.</span>
<a name="gbab-1653"></a><span class="cm">    *</span>
<a name="gbab-1654"></a><span class="cm">    * The &#39;error&#39; parameter must have one of the following values:</span>
<a name="gbab-1655"></a><span class="cm">    */</span>
<a name="gbab-1656"></a><span class="cp">#define PNG_CHUNK_WARNING     0 </span><span class="cm">/* never an error */</span><span class="cp"></span>
<a name="gbab-1657"></a><span class="cp">#define PNG_CHUNK_WRITE_ERROR 1 </span><span class="cm">/* an error only on write */</span><span class="cp"></span>
<a name="gbab-1658"></a><span class="cp">#define PNG_CHUNK_ERROR       2 </span><span class="cm">/* always an error */</span><span class="cp"></span>
<a name="gbab-1659"></a>
<a name="gbab-1660"></a><span class="cm">/* ASCII to FP interfaces, currently only implemented if sCAL</span>
<a name="gbab-1661"></a><span class="cm"> * support is required.</span>
<a name="gbab-1662"></a><span class="cm"> */</span>
<a name="gbab-1663"></a><span class="cp">#if defined(PNG_sCAL_SUPPORTED)</span>
<a name="gbab-1664"></a><span class="cm">/* MAX_DIGITS is actually the maximum number of characters in an sCAL</span>
<a name="gbab-1665"></a><span class="cm"> * width or height, derived from the precision (number of significant</span>
<a name="gbab-1666"></a><span class="cm"> * digits - a build time settable option) and assumptions about the</span>
<a name="gbab-1667"></a><span class="cm"> * maximum ridiculous exponent.</span>
<a name="gbab-1668"></a><span class="cm"> */</span>
<a name="gbab-1669"></a><span class="cp">#define PNG_sCAL_MAX_DIGITS (PNG_sCAL_PRECISION+1</span><span class="cm">/*.*/</span><span class="cp">+1</span><span class="cm">/*E*/</span><span class="cp">+10</span><span class="cm">/*exponent*/</span><span class="cp">)</span>
<a name="gbab-1670"></a>
<a name="gbab-1671"></a><span class="cp">#ifdef PNG_FLOATING_POINT_SUPPORTED</span>
<a name="gbab-1672"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_ascii_from_fp</span><span class="p">,(</span><span class="n">png_const_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1673"></a>   <span class="n">png_charp</span> <span class="n">ascii</span><span class="p">,</span> <span class="n">png_size_t</span> <span class="n">size</span><span class="p">,</span> <span class="kt">double</span> <span class="n">fp</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">precision</span><span class="p">),</span>
<a name="gbab-1674"></a>   <span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1675"></a><span class="cp">#endif </span><span class="cm">/* FLOATING_POINT */</span><span class="cp"></span>
<a name="gbab-1676"></a>
<a name="gbab-1677"></a><span class="cp">#ifdef PNG_FIXED_POINT_SUPPORTED</span>
<a name="gbab-1678"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_ascii_from_fixed</span><span class="p">,(</span><span class="n">png_const_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1679"></a>   <span class="n">png_charp</span> <span class="n">ascii</span><span class="p">,</span> <span class="n">png_size_t</span> <span class="n">size</span><span class="p">,</span> <span class="n">png_fixed_point</span> <span class="n">fp</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1680"></a><span class="cp">#endif </span><span class="cm">/* FIXED_POINT */</span><span class="cp"></span>
<a name="gbab-1681"></a><span class="cp">#endif </span><span class="cm">/* sCAL */</span><span class="cp"></span>
<a name="gbab-1682"></a>
<a name="gbab-1683"></a><span class="cp">#if defined(PNG_sCAL_SUPPORTED) || defined(PNG_pCAL_SUPPORTED)</span>
<a name="gbab-1684"></a><span class="cm">/* An internal API to validate the format of a floating point number.</span>
<a name="gbab-1685"></a><span class="cm"> * The result is the index of the next character.  If the number is</span>
<a name="gbab-1686"></a><span class="cm"> * not valid it will be the index of a character in the supposed number.</span>
<a name="gbab-1687"></a><span class="cm"> *</span>
<a name="gbab-1688"></a><span class="cm"> * The format of a number is defined in the PNG extensions specification</span>
<a name="gbab-1689"></a><span class="cm"> * and this API is strictly conformant to that spec, not anyone elses!</span>
<a name="gbab-1690"></a><span class="cm"> *</span>
<a name="gbab-1691"></a><span class="cm"> * The format as a regular expression is:</span>
<a name="gbab-1692"></a><span class="cm"> *</span>
<a name="gbab-1693"></a><span class="cm"> * [+-]?[0-9]+.?([Ee][+-]?[0-9]+)?</span>
<a name="gbab-1694"></a><span class="cm"> *</span>
<a name="gbab-1695"></a><span class="cm"> * or:</span>
<a name="gbab-1696"></a><span class="cm"> *</span>
<a name="gbab-1697"></a><span class="cm"> * [+-]?.[0-9]+(.[0-9]+)?([Ee][+-]?[0-9]+)?</span>
<a name="gbab-1698"></a><span class="cm"> *</span>
<a name="gbab-1699"></a><span class="cm"> * The complexity is that either integer or fraction must be present and the</span>
<a name="gbab-1700"></a><span class="cm"> * fraction is permitted to have no digits only if the integer is present.</span>
<a name="gbab-1701"></a><span class="cm"> *</span>
<a name="gbab-1702"></a><span class="cm"> * NOTE: The dangling E problem.</span>
<a name="gbab-1703"></a><span class="cm"> *   There is a PNG valid floating point number in the following:</span>
<a name="gbab-1704"></a><span class="cm"> *</span>
<a name="gbab-1705"></a><span class="cm"> *       PNG floating point numbers are not greedy.</span>
<a name="gbab-1706"></a><span class="cm"> *</span>
<a name="gbab-1707"></a><span class="cm"> *   Working this out requires *TWO* character lookahead (because of the</span>
<a name="gbab-1708"></a><span class="cm"> *   sign), the parser does not do this - it will fail at the &#39;r&#39; - this</span>
<a name="gbab-1709"></a><span class="cm"> *   doesn&#39;t matter for PNG sCAL chunk values, but it requires more care</span>
<a name="gbab-1710"></a><span class="cm"> *   if the value were ever to be embedded in something more complex.  Use</span>
<a name="gbab-1711"></a><span class="cm"> *   ANSI-C strtod if you need the lookahead.</span>
<a name="gbab-1712"></a><span class="cm"> */</span>
<a name="gbab-1713"></a><span class="cm">/* State table for the parser. */</span>
<a name="gbab-1714"></a><span class="cp">#define PNG_FP_INTEGER    0  </span><span class="cm">/* before or in integer */</span><span class="cp"></span>
<a name="gbab-1715"></a><span class="cp">#define PNG_FP_FRACTION   1  </span><span class="cm">/* before or in fraction */</span><span class="cp"></span>
<a name="gbab-1716"></a><span class="cp">#define PNG_FP_EXPONENT   2  </span><span class="cm">/* before or in exponent */</span><span class="cp"></span>
<a name="gbab-1717"></a><span class="cp">#define PNG_FP_STATE      3  </span><span class="cm">/* mask for the above */</span><span class="cp"></span>
<a name="gbab-1718"></a><span class="cp">#define PNG_FP_SAW_SIGN   4  </span><span class="cm">/* Saw +/- in current state */</span><span class="cp"></span>
<a name="gbab-1719"></a><span class="cp">#define PNG_FP_SAW_DIGIT  8  </span><span class="cm">/* Saw a digit in current state */</span><span class="cp"></span>
<a name="gbab-1720"></a><span class="cp">#define PNG_FP_SAW_DOT   16  </span><span class="cm">/* Saw a dot in current state */</span><span class="cp"></span>
<a name="gbab-1721"></a><span class="cp">#define PNG_FP_SAW_E     32  </span><span class="cm">/* Saw an E (or e) in current state */</span><span class="cp"></span>
<a name="gbab-1722"></a><span class="cp">#define PNG_FP_SAW_ANY   60  </span><span class="cm">/* Saw any of the above 4 */</span><span class="cp"></span>
<a name="gbab-1723"></a>
<a name="gbab-1724"></a><span class="cm">/* These three values don&#39;t affect the parser.  They are set but not used.</span>
<a name="gbab-1725"></a><span class="cm"> */</span>
<a name="gbab-1726"></a><span class="cp">#define PNG_FP_WAS_VALID 64  </span><span class="cm">/* Preceding substring is a valid fp number */</span><span class="cp"></span>
<a name="gbab-1727"></a><span class="cp">#define PNG_FP_NEGATIVE 128  </span><span class="cm">/* A negative number, including &quot;-0&quot; */</span><span class="cp"></span>
<a name="gbab-1728"></a><span class="cp">#define PNG_FP_NONZERO  256  </span><span class="cm">/* A non-zero value */</span><span class="cp"></span>
<a name="gbab-1729"></a><span class="cp">#define PNG_FP_STICKY   448  </span><span class="cm">/* The above three flags */</span><span class="cp"></span>
<a name="gbab-1730"></a>
<a name="gbab-1731"></a><span class="cm">/* This is available for the caller to store in &#39;state&#39; if required.  Do not</span>
<a name="gbab-1732"></a><span class="cm"> * call the parser after setting it (the parser sometimes clears it.)</span>
<a name="gbab-1733"></a><span class="cm"> */</span>
<a name="gbab-1734"></a><span class="cp">#define PNG_FP_INVALID  512  </span><span class="cm">/* Available for callers as a distinct value */</span><span class="cp"></span>
<a name="gbab-1735"></a>
<a name="gbab-1736"></a><span class="cm">/* Result codes for the parser (boolean - true meants ok, false means</span>
<a name="gbab-1737"></a><span class="cm"> * not ok yet.)</span>
<a name="gbab-1738"></a><span class="cm"> */</span>
<a name="gbab-1739"></a><span class="cp">#define PNG_FP_MAYBE      0  </span><span class="cm">/* The number may be valid in the future */</span><span class="cp"></span>
<a name="gbab-1740"></a><span class="cp">#define PNG_FP_OK         1  </span><span class="cm">/* The number is valid */</span><span class="cp"></span>
<a name="gbab-1741"></a>
<a name="gbab-1742"></a><span class="cm">/* Tests on the sticky non-zero and negative flags.  To pass these checks</span>
<a name="gbab-1743"></a><span class="cm"> * the state must also indicate that the whole number is valid - this is</span>
<a name="gbab-1744"></a><span class="cm"> * achieved by testing PNG_FP_SAW_DIGIT (see the implementation for why this</span>
<a name="gbab-1745"></a><span class="cm"> * is equivalent to PNG_FP_OK above.)</span>
<a name="gbab-1746"></a><span class="cm"> */</span>
<a name="gbab-1747"></a><span class="cp">#define PNG_FP_NZ_MASK (PNG_FP_SAW_DIGIT | PNG_FP_NEGATIVE | PNG_FP_NONZERO)</span>
<a name="gbab-1748"></a>   <span class="cm">/* NZ_MASK: the string is valid and a non-zero negative value */</span>
<a name="gbab-1749"></a><span class="cp">#define PNG_FP_Z_MASK (PNG_FP_SAW_DIGIT | PNG_FP_NONZERO)</span>
<a name="gbab-1750"></a>   <span class="cm">/* Z MASK: the string is valid and a non-zero value. */</span>
<a name="gbab-1751"></a>   <span class="cm">/* PNG_FP_SAW_DIGIT: the string is valid. */</span>
<a name="gbab-1752"></a><span class="cp">#define PNG_FP_IS_ZERO(state) (((state) &amp; PNG_FP_Z_MASK) == PNG_FP_SAW_DIGIT)</span>
<a name="gbab-1753"></a><span class="cp">#define PNG_FP_IS_POSITIVE(state) (((state) &amp; PNG_FP_NZ_MASK) == PNG_FP_Z_MASK)</span>
<a name="gbab-1754"></a><span class="cp">#define PNG_FP_IS_NEGATIVE(state) (((state) &amp; PNG_FP_NZ_MASK) == PNG_FP_NZ_MASK)</span>
<a name="gbab-1755"></a> 
<a name="gbab-1756"></a><span class="cm">/* The actual parser.  This can be called repeatedly. It updates</span>
<a name="gbab-1757"></a><span class="cm"> * the index into the string and the state variable (which must</span>
<a name="gbab-1758"></a><span class="cm"> * be initialized to 0).  It returns a result code, as above.  There</span>
<a name="gbab-1759"></a><span class="cm"> * is no point calling the parser any more if it fails to advance to</span>
<a name="gbab-1760"></a><span class="cm"> * the end of the string - it is stuck on an invalid character (or</span>
<a name="gbab-1761"></a><span class="cm"> * terminated by &#39;\0&#39;).</span>
<a name="gbab-1762"></a><span class="cm"> *</span>
<a name="gbab-1763"></a><span class="cm"> * Note that the pointer will consume an E or even an E+ and then leave</span>
<a name="gbab-1764"></a><span class="cm"> * a &#39;maybe&#39; state even though a preceding integer.fraction is valid.</span>
<a name="gbab-1765"></a><span class="cm"> * The PNG_FP_WAS_VALID flag indicates that a preceding substring was</span>
<a name="gbab-1766"></a><span class="cm"> * a valid number.  It&#39;s possible to recover from this by calling</span>
<a name="gbab-1767"></a><span class="cm"> * the parser again (from the start, with state 0) but with a string</span>
<a name="gbab-1768"></a><span class="cm"> * that omits the last character (i.e. set the size to the index of</span>
<a name="gbab-1769"></a><span class="cm"> * the problem character.)  This has not been tested within libpng.</span>
<a name="gbab-1770"></a><span class="cm"> */</span>
<a name="gbab-1771"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="n">png_check_fp_number</span><span class="p">,(</span><span class="n">png_const_charp</span> <span class="n">string</span><span class="p">,</span>
<a name="gbab-1772"></a>   <span class="n">png_size_t</span> <span class="n">size</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">statep</span><span class="p">,</span> <span class="n">png_size_tp</span> <span class="n">whereami</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1773"></a>
<a name="gbab-1774"></a><span class="cm">/* This is the same but it checks a complete string and returns true</span>
<a name="gbab-1775"></a><span class="cm"> * only if it just contains a floating point number.  As of 1.5.4 this</span>
<a name="gbab-1776"></a><span class="cm"> * function also returns the state at the end of parsing the number if</span>
<a name="gbab-1777"></a><span class="cm"> * it was valid (otherwise it returns 0.)  This can be used for testing</span>
<a name="gbab-1778"></a><span class="cm"> * for negative or zero values using the sticky flag.</span>
<a name="gbab-1779"></a><span class="cm"> */</span>
<a name="gbab-1780"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="n">png_check_fp_string</span><span class="p">,(</span><span class="n">png_const_charp</span> <span class="n">string</span><span class="p">,</span>
<a name="gbab-1781"></a>   <span class="n">png_size_t</span> <span class="n">size</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1782"></a><span class="cp">#endif </span><span class="cm">/* pCAL || sCAL */</span><span class="cp"></span>
<a name="gbab-1783"></a>
<a name="gbab-1784"></a><span class="cp">#if defined(PNG_GAMMA_SUPPORTED) ||\</span>
<a name="gbab-1785"></a><span class="cp">    defined(PNG_INCH_CONVERSIONS_SUPPORTED) || defined(PNG_READ_pHYs_SUPPORTED)</span>
<a name="gbab-1786"></a><span class="cm">/* Added at libpng version 1.5.0 */</span>
<a name="gbab-1787"></a><span class="cm">/* This is a utility to provide a*times/div (rounded) and indicate</span>
<a name="gbab-1788"></a><span class="cm"> * if there is an overflow.  The result is a boolean - false (0)</span>
<a name="gbab-1789"></a><span class="cm"> * for overflow, true (1) if no overflow, in which case *res</span>
<a name="gbab-1790"></a><span class="cm"> * holds the result.</span>
<a name="gbab-1791"></a><span class="cm"> */</span>
<a name="gbab-1792"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="n">png_muldiv</span><span class="p">,(</span><span class="n">png_fixed_point_p</span> <span class="n">res</span><span class="p">,</span> <span class="n">png_fixed_point</span> <span class="n">a</span><span class="p">,</span>
<a name="gbab-1793"></a>   <span class="n">png_int_32</span> <span class="n">multiplied_by</span><span class="p">,</span> <span class="n">png_int_32</span> <span class="n">divided_by</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1794"></a><span class="cp">#endif</span>
<a name="gbab-1795"></a>
<a name="gbab-1796"></a><span class="cp">#if defined(PNG_READ_GAMMA_SUPPORTED) || defined(PNG_INCH_CONVERSIONS_SUPPORTED)</span>
<a name="gbab-1797"></a><span class="cm">/* Same deal, but issue a warning on overflow and return 0. */</span>
<a name="gbab-1798"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="n">png_fixed_point</span><span class="p">,</span><span class="n">png_muldiv_warn</span><span class="p">,</span>
<a name="gbab-1799"></a>   <span class="p">(</span><span class="n">png_const_structrp</span> <span class="n">png_ptr</span><span class="p">,</span> <span class="n">png_fixed_point</span> <span class="n">a</span><span class="p">,</span> <span class="n">png_int_32</span> <span class="n">multiplied_by</span><span class="p">,</span>
<a name="gbab-1800"></a>   <span class="n">png_int_32</span> <span class="n">divided_by</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1801"></a><span class="cp">#endif</span>
<a name="gbab-1802"></a>
<a name="gbab-1803"></a><span class="cp">#ifdef PNG_GAMMA_SUPPORTED</span>
<a name="gbab-1804"></a><span class="cm">/* Calculate a reciprocal - used for gamma values.  This returns</span>
<a name="gbab-1805"></a><span class="cm"> * 0 if the argument is 0 in order to maintain an undefined value;</span>
<a name="gbab-1806"></a><span class="cm"> * there are no warnings.</span>
<a name="gbab-1807"></a><span class="cm"> */</span>
<a name="gbab-1808"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="n">png_fixed_point</span><span class="p">,</span><span class="n">png_reciprocal</span><span class="p">,(</span><span class="n">png_fixed_point</span> <span class="n">a</span><span class="p">),</span>
<a name="gbab-1809"></a>   <span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1810"></a>
<a name="gbab-1811"></a><span class="cp">#ifdef PNG_READ_GAMMA_SUPPORTED</span>
<a name="gbab-1812"></a><span class="cm">/* The same but gives a reciprocal of the product of two fixed point</span>
<a name="gbab-1813"></a><span class="cm"> * values.  Accuracy is suitable for gamma calculations but this is</span>
<a name="gbab-1814"></a><span class="cm"> * not exact - use png_muldiv for that.  Only required at present on read.</span>
<a name="gbab-1815"></a><span class="cm"> */</span>
<a name="gbab-1816"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="n">png_fixed_point</span><span class="p">,</span><span class="n">png_reciprocal2</span><span class="p">,(</span><span class="n">png_fixed_point</span> <span class="n">a</span><span class="p">,</span>
<a name="gbab-1817"></a>   <span class="n">png_fixed_point</span> <span class="n">b</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1818"></a><span class="cp">#endif</span>
<a name="gbab-1819"></a>
<a name="gbab-1820"></a><span class="cm">/* Return true if the gamma value is significantly different from 1.0 */</span>
<a name="gbab-1821"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="n">png_gamma_significant</span><span class="p">,(</span><span class="n">png_fixed_point</span> <span class="n">gamma_value</span><span class="p">),</span>
<a name="gbab-1822"></a>   <span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1823"></a><span class="cp">#endif</span>
<a name="gbab-1824"></a>
<a name="gbab-1825"></a><span class="cp">#ifdef PNG_READ_GAMMA_SUPPORTED</span>
<a name="gbab-1826"></a><span class="cm">/* Internal fixed point gamma correction.  These APIs are called as</span>
<a name="gbab-1827"></a><span class="cm"> * required to convert single values - they don&#39;t need to be fast,</span>
<a name="gbab-1828"></a><span class="cm"> * they are not used when processing image pixel values.</span>
<a name="gbab-1829"></a><span class="cm"> *</span>
<a name="gbab-1830"></a><span class="cm"> * While the input is an &#39;unsigned&#39; value it must actually be the</span>
<a name="gbab-1831"></a><span class="cm"> * correct bit value - 0..255 or 0..65535 as required.</span>
<a name="gbab-1832"></a><span class="cm"> */</span>
<a name="gbab-1833"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="n">png_uint_16</span><span class="p">,</span><span class="n">png_gamma_correct</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1834"></a>   <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">value</span><span class="p">,</span> <span class="n">png_fixed_point</span> <span class="n">gamma_value</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1835"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="n">png_uint_16</span><span class="p">,</span><span class="n">png_gamma_16bit_correct</span><span class="p">,(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">value</span><span class="p">,</span>
<a name="gbab-1836"></a>   <span class="n">png_fixed_point</span> <span class="n">gamma_value</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1837"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="n">png_byte</span><span class="p">,</span><span class="n">png_gamma_8bit_correct</span><span class="p">,(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">value</span><span class="p">,</span>
<a name="gbab-1838"></a>   <span class="n">png_fixed_point</span> <span class="n">gamma_value</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1839"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_destroy_gamma_table</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">),</span>
<a name="gbab-1840"></a>   <span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1841"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_build_gamma_table</span><span class="p">,(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1842"></a>   <span class="kt">int</span> <span class="n">bit_depth</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1843"></a><span class="cp">#endif</span>
<a name="gbab-1844"></a>
<a name="gbab-1845"></a><span class="cm">/* SIMPLIFIED READ/WRITE SUPPORT */</span>
<a name="gbab-1846"></a><span class="cp">#if defined(PNG_SIMPLIFIED_READ_SUPPORTED) ||\</span>
<a name="gbab-1847"></a><span class="cp">   defined(PNG_SIMPLIFIED_WRITE_SUPPORTED)</span>
<a name="gbab-1848"></a><span class="cm">/* The internal structure that png_image::opaque points to. */</span>
<a name="gbab-1849"></a><span class="k">typedef</span> <span class="k">struct</span> <span class="n">png_control</span>
<a name="gbab-1850"></a><span class="p">{</span>
<a name="gbab-1851"></a>   <span class="n">png_structp</span> <span class="n">png_ptr</span><span class="p">;</span>
<a name="gbab-1852"></a>   <span class="n">png_infop</span>   <span class="n">info_ptr</span><span class="p">;</span>
<a name="gbab-1853"></a>   <span class="n">png_voidp</span>   <span class="n">error_buf</span><span class="p">;</span>           <span class="cm">/* Always a jmp_buf at present. */</span>
<a name="gbab-1854"></a>
<a name="gbab-1855"></a>   <span class="n">png_const_bytep</span> <span class="n">memory</span><span class="p">;</span>          <span class="cm">/* Memory buffer. */</span>
<a name="gbab-1856"></a>   <span class="n">png_size_t</span>      <span class="n">size</span><span class="p">;</span>            <span class="cm">/* Size of the memory buffer. */</span>
<a name="gbab-1857"></a>
<a name="gbab-1858"></a>   <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nl">for_write</span>       <span class="p">:</span><span class="mi">1</span><span class="p">;</span> <span class="cm">/* Otherwise it is a read structure */</span>
<a name="gbab-1859"></a>   <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nl">owned_file</span>      <span class="p">:</span><span class="mi">1</span><span class="p">;</span> <span class="cm">/* We own the file in io_ptr */</span>
<a name="gbab-1860"></a><span class="p">}</span> <span class="n">png_control</span><span class="p">;</span>
<a name="gbab-1861"></a>
<a name="gbab-1862"></a><span class="cm">/* Return the pointer to the jmp_buf from a png_control: necessary because C</span>
<a name="gbab-1863"></a><span class="cm"> * does not reveal the type of the elements of jmp_buf.</span>
<a name="gbab-1864"></a><span class="cm"> */</span>
<a name="gbab-1865"></a><span class="cp">#ifdef __cplusplus</span>
<a name="gbab-1866"></a><span class="cp">#  define png_control_jmp_buf(pc) (((jmp_buf*)((pc)-&gt;error_buf))[0])</span>
<a name="gbab-1867"></a><span class="cp">#else</span>
<a name="gbab-1868"></a><span class="cp">#  define png_control_jmp_buf(pc) ((pc)-&gt;error_buf)</span>
<a name="gbab-1869"></a><span class="cp">#endif</span>
<a name="gbab-1870"></a>
<a name="gbab-1871"></a><span class="cm">/* Utility to safely execute a piece of libpng code catching and logging any</span>
<a name="gbab-1872"></a><span class="cm"> * errors that might occur.  Returns true on success, false on failure (either</span>
<a name="gbab-1873"></a><span class="cm"> * of the function or as a result of a png_error.)</span>
<a name="gbab-1874"></a><span class="cm"> */</span>
<a name="gbab-1875"></a><span class="n">PNG_INTERNAL_CALLBACK</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_safe_error</span><span class="p">,(</span><span class="n">png_structp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1876"></a>   <span class="n">png_const_charp</span> <span class="n">error_message</span><span class="p">),</span><span class="n">PNG_NORETURN</span><span class="p">);</span>
<a name="gbab-1877"></a>
<a name="gbab-1878"></a><span class="cp">#ifdef PNG_WARNINGS_SUPPORTED</span>
<a name="gbab-1879"></a><span class="n">PNG_INTERNAL_CALLBACK</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span><span class="n">png_safe_warning</span><span class="p">,(</span><span class="n">png_structp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1880"></a>   <span class="n">png_const_charp</span> <span class="n">warning_message</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1881"></a><span class="cp">#else</span>
<a name="gbab-1882"></a><span class="cp">#  define png_safe_warning 0</span><span class="cm">/*dummy argument*/</span><span class="cp"></span>
<a name="gbab-1883"></a><span class="cp">#endif</span>
<a name="gbab-1884"></a>
<a name="gbab-1885"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="n">png_safe_execute</span><span class="p">,(</span><span class="n">png_imagep</span> <span class="n">image</span><span class="p">,</span>
<a name="gbab-1886"></a>   <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">function</span><span class="p">)(</span><span class="n">png_voidp</span><span class="p">),</span> <span class="n">png_voidp</span> <span class="n">arg</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1887"></a>
<a name="gbab-1888"></a><span class="cm">/* Utility to log an error; this also cleans up the png_image; the function</span>
<a name="gbab-1889"></a><span class="cm"> * always returns 0 (false).</span>
<a name="gbab-1890"></a><span class="cm"> */</span>
<a name="gbab-1891"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="n">png_image_error</span><span class="p">,(</span><span class="n">png_imagep</span> <span class="n">image</span><span class="p">,</span>
<a name="gbab-1892"></a>   <span class="n">png_const_charp</span> <span class="n">error_message</span><span class="p">),</span><span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1893"></a>
<a name="gbab-1894"></a><span class="cp">#ifndef PNG_SIMPLIFIED_READ_SUPPORTED</span>
<a name="gbab-1895"></a><span class="cm">/* png_image_free is used by the write code but not exported */</span>
<a name="gbab-1896"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span> <span class="n">png_image_free</span><span class="p">,</span> <span class="p">(</span><span class="n">png_imagep</span> <span class="n">image</span><span class="p">),</span> <span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1897"></a><span class="cp">#endif </span><span class="cm">/* !SIMPLIFIED_READ */</span><span class="cp"></span>
<a name="gbab-1898"></a>
<a name="gbab-1899"></a><span class="cp">#endif </span><span class="cm">/* SIMPLIFIED READ/WRITE */</span><span class="cp"></span>
<a name="gbab-1900"></a>
<a name="gbab-1901"></a><span class="cm">/* These are initialization functions for hardware specific PNG filter</span>
<a name="gbab-1902"></a><span class="cm"> * optimizations; list these here then select the appropriate one at compile</span>
<a name="gbab-1903"></a><span class="cm"> * time using the macro PNG_FILTER_OPTIMIZATIONS.  If the macro is not defined</span>
<a name="gbab-1904"></a><span class="cm"> * the generic code is used.</span>
<a name="gbab-1905"></a><span class="cm"> */</span>
<a name="gbab-1906"></a><span class="cp">#ifdef PNG_FILTER_OPTIMIZATIONS</span>
<a name="gbab-1907"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span> <span class="n">PNG_FILTER_OPTIMIZATIONS</span><span class="p">,</span> <span class="p">(</span><span class="n">png_structp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1908"></a>   <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">bpp</span><span class="p">),</span> <span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1909"></a>   <span class="cm">/* Just declare the optimization that will be used */</span>
<a name="gbab-1910"></a><span class="cp">#else</span>
<a name="gbab-1911"></a>   <span class="cm">/* List *all* the possible optimizations here - this branch is required if</span>
<a name="gbab-1912"></a><span class="cm">    * the builder of libpng passes the definition of PNG_FILTER_OPTIMIZATIONS in</span>
<a name="gbab-1913"></a><span class="cm">    * CFLAGS in place of CPPFLAGS *and* uses symbol prefixing.</span>
<a name="gbab-1914"></a><span class="cm">    */</span>
<a name="gbab-1915"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="kt">void</span><span class="p">,</span> <span class="n">png_init_filter_functions_neon</span><span class="p">,</span>
<a name="gbab-1916"></a>   <span class="p">(</span><span class="n">png_structp</span> <span class="n">png_ptr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">bpp</span><span class="p">),</span> <span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1917"></a><span class="cp">#endif</span>
<a name="gbab-1918"></a>
<a name="gbab-1919"></a><span class="n">PNG_INTERNAL_FUNCTION</span><span class="p">(</span><span class="n">png_uint_32</span><span class="p">,</span> <span class="n">png_check_keyword</span><span class="p">,</span> <span class="p">(</span><span class="n">png_structrp</span> <span class="n">png_ptr</span><span class="p">,</span>
<a name="gbab-1920"></a>   <span class="n">png_const_charp</span> <span class="n">key</span><span class="p">,</span> <span class="n">png_bytep</span> <span class="n">new_key</span><span class="p">),</span> <span class="n">PNG_EMPTY</span><span class="p">);</span>
<a name="gbab-1921"></a>
<a name="gbab-1922"></a><span class="cm">/* Maintainer: Put new private prototypes here ^ */</span>
<a name="gbab-1923"></a>
<a name="gbab-1924"></a><span class="cp">#include</span> <span class="cpf">&quot;pngdebug.h&quot;</span><span class="cp"></span>
<a name="gbab-1925"></a>
<a name="gbab-1926"></a><span class="cp">#ifdef __cplusplus</span>
<a name="gbab-1927"></a><span class="p">}</span>
<a name="gbab-1928"></a><span class="cp">#endif</span>
<a name="gbab-1929"></a>
<a name="gbab-1930"></a><span class="cp">#endif </span><span class="cm">/* PNG_VERSION_INFO_ONLY */</span><span class="cp"></span>
<a name="gbab-1931"></a><span class="cp">#endif </span><span class="cm">/* PNGPRIV_H */</span><span class="cp"></span>
</pre></div>
</td></tr></table>
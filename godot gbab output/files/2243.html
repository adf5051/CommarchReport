<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493</pre></div></td><td class="code"><div class="highlight"><pre><span></span><a name="gbab-1"></a><span class="cm">/********************************************************************</span>
<a name="gbab-2"></a><span class="cm"> *                                                                  *</span>
<a name="gbab-3"></a><span class="cm"> * THIS FILE IS PART OF THE OggTheora SOFTWARE CODEC SOURCE CODE.   *</span>
<a name="gbab-4"></a><span class="cm"> * USE, DISTRIBUTION AND REPRODUCTION OF THIS LIBRARY SOURCE IS     *</span>
<a name="gbab-5"></a><span class="cm"> * GOVERNED BY A BSD-STYLE SOURCE LICENSE INCLUDED WITH THIS SOURCE *</span>
<a name="gbab-6"></a><span class="cm"> * IN &#39;COPYING&#39;. PLEASE READ THESE TERMS BEFORE DISTRIBUTING.       *</span>
<a name="gbab-7"></a><span class="cm"> *                                                                  *</span>
<a name="gbab-8"></a><span class="cm"> * THE Theora SOURCE CODE IS COPYRIGHT (C) 2002-2009                *</span>
<a name="gbab-9"></a><span class="cm"> * by the Xiph.Org Foundation http://www.xiph.org/                  *</span>
<a name="gbab-10"></a><span class="cm"> *                                                                  *</span>
<a name="gbab-11"></a><span class="cm"> ********************************************************************</span>
<a name="gbab-12"></a>
<a name="gbab-13"></a><span class="cm">  function:</span>
<a name="gbab-14"></a><span class="cm">  last mod: $Id: encint.h 16503 2009-08-22 18:14:02Z giles $</span>
<a name="gbab-15"></a>
<a name="gbab-16"></a><span class="cm"> ********************************************************************/</span>
<a name="gbab-17"></a><span class="cp">#if !defined(_encint_H)</span>
<a name="gbab-18"></a><span class="cp"># define _encint_H (1)</span>
<a name="gbab-19"></a><span class="cp"># if defined(HAVE_CONFIG_H)</span>
<a name="gbab-20"></a><span class="cp">#  include &quot;config.h&quot;</span>
<a name="gbab-21"></a><span class="cp"># endif</span>
<a name="gbab-22"></a><span class="cp"># include &quot;theora/theoraenc.h&quot;</span>
<a name="gbab-23"></a><span class="cp"># include &quot;internal.h&quot;</span>
<a name="gbab-24"></a><span class="cp"># include &quot;ocintrin.h&quot;</span>
<a name="gbab-25"></a><span class="cp"># include &quot;mathops.h&quot;</span>
<a name="gbab-26"></a><span class="cp"># include &quot;enquant.h&quot;</span>
<a name="gbab-27"></a><span class="cp"># include &quot;huffenc.h&quot;</span>
<a name="gbab-28"></a><span class="cm">/*# define OC_COLLECT_METRICS*/</span>
<a name="gbab-29"></a>
<a name="gbab-30"></a>
<a name="gbab-31"></a>
<a name="gbab-32"></a><span class="k">typedef</span> <span class="n">oc_mv</span>                         <span class="n">oc_mv2</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<a name="gbab-33"></a>
<a name="gbab-34"></a><span class="k">typedef</span> <span class="k">struct</span> <span class="n">oc_enc_opt_vtable</span>      <span class="n">oc_enc_opt_vtable</span><span class="p">;</span>
<a name="gbab-35"></a><span class="k">typedef</span> <span class="k">struct</span> <span class="n">oc_mb_enc_info</span>         <span class="n">oc_mb_enc_info</span><span class="p">;</span>
<a name="gbab-36"></a><span class="k">typedef</span> <span class="k">struct</span> <span class="n">oc_mode_scheme_chooser</span> <span class="n">oc_mode_scheme_chooser</span><span class="p">;</span>
<a name="gbab-37"></a><span class="k">typedef</span> <span class="k">struct</span> <span class="n">oc_iir_filter</span>          <span class="n">oc_iir_filter</span><span class="p">;</span>
<a name="gbab-38"></a><span class="k">typedef</span> <span class="k">struct</span> <span class="n">oc_frame_metrics</span>       <span class="n">oc_frame_metrics</span><span class="p">;</span>
<a name="gbab-39"></a><span class="k">typedef</span> <span class="k">struct</span> <span class="n">oc_rc_state</span>            <span class="n">oc_rc_state</span><span class="p">;</span>
<a name="gbab-40"></a><span class="k">typedef</span> <span class="k">struct</span> <span class="n">th_enc_ctx</span>             <span class="n">oc_enc_ctx</span><span class="p">;</span>
<a name="gbab-41"></a><span class="k">typedef</span> <span class="k">struct</span> <span class="n">oc_token_checkpoint</span>    <span class="n">oc_token_checkpoint</span><span class="p">;</span>
<a name="gbab-42"></a>
<a name="gbab-43"></a>
<a name="gbab-44"></a>
<a name="gbab-45"></a><span class="cm">/*Constants for the packet-out state machine specific to the encoder.*/</span>
<a name="gbab-46"></a>
<a name="gbab-47"></a><span class="cm">/*Next packet to emit: Data packet, but none are ready yet.*/</span>
<a name="gbab-48"></a><span class="cp">#define OC_PACKET_EMPTY (0)</span>
<a name="gbab-49"></a><span class="cm">/*Next packet to emit: Data packet, and one is ready.*/</span>
<a name="gbab-50"></a><span class="cp">#define OC_PACKET_READY (1)</span>
<a name="gbab-51"></a>
<a name="gbab-52"></a><span class="cm">/*All features enabled.*/</span>
<a name="gbab-53"></a><span class="cp">#define OC_SP_LEVEL_SLOW       (0)</span>
<a name="gbab-54"></a><span class="cm">/*Enable early skip.*/</span>
<a name="gbab-55"></a><span class="cp">#define OC_SP_LEVEL_EARLY_SKIP (1)</span>
<a name="gbab-56"></a><span class="cm">/*Disable motion compensation.*/</span>
<a name="gbab-57"></a><span class="cp">#define OC_SP_LEVEL_NOMC       (2)</span>
<a name="gbab-58"></a><span class="cm">/*Maximum valid speed level.*/</span>
<a name="gbab-59"></a><span class="cp">#define OC_SP_LEVEL_MAX        (2)</span>
<a name="gbab-60"></a>
<a name="gbab-61"></a>
<a name="gbab-62"></a><span class="cm">/*The bits used for each of the MB mode codebooks.*/</span>
<a name="gbab-63"></a><span class="k">extern</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">OC_MODE_BITS</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">OC_NMODES</span><span class="p">];</span>
<a name="gbab-64"></a>
<a name="gbab-65"></a><span class="cm">/*The bits used for each of the MV codebooks.*/</span>
<a name="gbab-66"></a><span class="k">extern</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">OC_MV_BITS</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">64</span><span class="p">];</span>
<a name="gbab-67"></a>
<a name="gbab-68"></a><span class="cm">/*The minimum value that can be stored in a SB run for each codeword.</span>
<a name="gbab-69"></a><span class="cm">  The last entry is the upper bound on the length of a single SB run.*/</span>
<a name="gbab-70"></a><span class="k">extern</span> <span class="k">const</span> <span class="n">ogg_uint16_t</span>  <span class="n">OC_SB_RUN_VAL_MIN</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
<a name="gbab-71"></a><span class="cm">/*The bits used for each SB run codeword.*/</span>
<a name="gbab-72"></a><span class="k">extern</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">OC_SB_RUN_CODE_NBITS</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
<a name="gbab-73"></a>
<a name="gbab-74"></a><span class="cm">/*The bits used for each block run length (starting with 1).*/</span>
<a name="gbab-75"></a><span class="k">extern</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">OC_BLOCK_RUN_CODE_NBITS</span><span class="p">[</span><span class="mi">30</span><span class="p">];</span>
<a name="gbab-76"></a>
<a name="gbab-77"></a>
<a name="gbab-78"></a>
<a name="gbab-79"></a><span class="cm">/*Encoder specific functions with accelerated variants.*/</span>
<a name="gbab-80"></a><span class="k">struct</span> <span class="n">oc_enc_opt_vtable</span><span class="p">{</span>
<a name="gbab-81"></a>  <span class="kt">unsigned</span> <span class="p">(</span><span class="o">*</span><span class="n">frag_sad</span><span class="p">)(</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_src</span><span class="p">,</span>
<a name="gbab-82"></a>   <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_ref</span><span class="p">,</span><span class="kt">int</span> <span class="n">_ystride</span><span class="p">);</span>
<a name="gbab-83"></a>  <span class="kt">unsigned</span> <span class="p">(</span><span class="o">*</span><span class="n">frag_sad_thresh</span><span class="p">)(</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_src</span><span class="p">,</span>
<a name="gbab-84"></a>   <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_ref</span><span class="p">,</span><span class="kt">int</span> <span class="n">_ystride</span><span class="p">,</span><span class="kt">unsigned</span> <span class="n">_thresh</span><span class="p">);</span>
<a name="gbab-85"></a>  <span class="kt">unsigned</span> <span class="p">(</span><span class="o">*</span><span class="n">frag_sad2_thresh</span><span class="p">)(</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_src</span><span class="p">,</span>
<a name="gbab-86"></a>   <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_ref1</span><span class="p">,</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_ref2</span><span class="p">,</span><span class="kt">int</span> <span class="n">_ystride</span><span class="p">,</span>
<a name="gbab-87"></a>   <span class="kt">unsigned</span> <span class="n">_thresh</span><span class="p">);</span>
<a name="gbab-88"></a>  <span class="kt">unsigned</span> <span class="p">(</span><span class="o">*</span><span class="n">frag_satd_thresh</span><span class="p">)(</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_src</span><span class="p">,</span>
<a name="gbab-89"></a>   <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_ref</span><span class="p">,</span><span class="kt">int</span> <span class="n">_ystride</span><span class="p">,</span><span class="kt">unsigned</span> <span class="n">_thresh</span><span class="p">);</span>
<a name="gbab-90"></a>  <span class="kt">unsigned</span> <span class="p">(</span><span class="o">*</span><span class="n">frag_satd2_thresh</span><span class="p">)(</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_src</span><span class="p">,</span>
<a name="gbab-91"></a>   <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_ref1</span><span class="p">,</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_ref2</span><span class="p">,</span><span class="kt">int</span> <span class="n">_ystride</span><span class="p">,</span>
<a name="gbab-92"></a>   <span class="kt">unsigned</span> <span class="n">_thresh</span><span class="p">);</span>
<a name="gbab-93"></a>  <span class="kt">unsigned</span> <span class="p">(</span><span class="o">*</span><span class="n">frag_intra_satd</span><span class="p">)(</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_src</span><span class="p">,</span><span class="kt">int</span> <span class="n">_ystride</span><span class="p">);</span>
<a name="gbab-94"></a>  <span class="kt">void</span>     <span class="p">(</span><span class="o">*</span><span class="n">frag_sub</span><span class="p">)(</span><span class="n">ogg_int16_t</span> <span class="n">_diff</span><span class="p">[</span><span class="mi">64</span><span class="p">],</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_src</span><span class="p">,</span>
<a name="gbab-95"></a>   <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_ref</span><span class="p">,</span><span class="kt">int</span> <span class="n">_ystride</span><span class="p">);</span>
<a name="gbab-96"></a>  <span class="kt">void</span>     <span class="p">(</span><span class="o">*</span><span class="n">frag_sub_128</span><span class="p">)(</span><span class="n">ogg_int16_t</span> <span class="n">_diff</span><span class="p">[</span><span class="mi">64</span><span class="p">],</span>
<a name="gbab-97"></a>   <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_src</span><span class="p">,</span><span class="kt">int</span> <span class="n">_ystride</span><span class="p">);</span>
<a name="gbab-98"></a>  <span class="kt">void</span>     <span class="p">(</span><span class="o">*</span><span class="n">frag_copy2</span><span class="p">)(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_dst</span><span class="p">,</span>
<a name="gbab-99"></a>   <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_src1</span><span class="p">,</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_src2</span><span class="p">,</span><span class="kt">int</span> <span class="n">_ystride</span><span class="p">);</span>
<a name="gbab-100"></a>  <span class="kt">void</span>     <span class="p">(</span><span class="o">*</span><span class="n">frag_recon_intra</span><span class="p">)(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_dst</span><span class="p">,</span><span class="kt">int</span> <span class="n">_ystride</span><span class="p">,</span>
<a name="gbab-101"></a>   <span class="k">const</span> <span class="n">ogg_int16_t</span> <span class="n">_residue</span><span class="p">[</span><span class="mi">64</span><span class="p">]);</span>
<a name="gbab-102"></a>  <span class="kt">void</span>     <span class="p">(</span><span class="o">*</span><span class="n">frag_recon_inter</span><span class="p">)(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_dst</span><span class="p">,</span>
<a name="gbab-103"></a>   <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_src</span><span class="p">,</span><span class="kt">int</span> <span class="n">_ystride</span><span class="p">,</span><span class="k">const</span> <span class="n">ogg_int16_t</span> <span class="n">_residue</span><span class="p">[</span><span class="mi">64</span><span class="p">]);</span>
<a name="gbab-104"></a>  <span class="kt">void</span>     <span class="p">(</span><span class="o">*</span><span class="n">fdct8x8</span><span class="p">)(</span><span class="n">ogg_int16_t</span> <span class="n">_y</span><span class="p">[</span><span class="mi">64</span><span class="p">],</span><span class="k">const</span> <span class="n">ogg_int16_t</span> <span class="n">_x</span><span class="p">[</span><span class="mi">64</span><span class="p">]);</span>
<a name="gbab-105"></a><span class="p">};</span>
<a name="gbab-106"></a>
<a name="gbab-107"></a>
<a name="gbab-108"></a><span class="kt">void</span> <span class="nf">oc_enc_vtable_init</span><span class="p">(</span><span class="n">oc_enc_ctx</span> <span class="o">*</span><span class="n">_enc</span><span class="p">);</span>
<a name="gbab-109"></a>
<a name="gbab-110"></a>
<a name="gbab-111"></a>
<a name="gbab-112"></a><span class="cm">/*Encoder-specific macroblock information.*/</span>
<a name="gbab-113"></a><span class="k">struct</span> <span class="n">oc_mb_enc_info</span><span class="p">{</span>
<a name="gbab-114"></a>  <span class="cm">/*Neighboring macro blocks that have MVs available from the current frame.*/</span>
<a name="gbab-115"></a>  <span class="kt">unsigned</span>      <span class="n">cneighbors</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<a name="gbab-116"></a>  <span class="cm">/*Neighboring macro blocks to use for MVs from the previous frame.*/</span>
<a name="gbab-117"></a>  <span class="kt">unsigned</span>      <span class="n">pneighbors</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<a name="gbab-118"></a>  <span class="cm">/*The number of current-frame neighbors.*/</span>
<a name="gbab-119"></a>  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">ncneighbors</span><span class="p">;</span>
<a name="gbab-120"></a>  <span class="cm">/*The number of previous-frame neighbors.*/</span>
<a name="gbab-121"></a>  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">npneighbors</span><span class="p">;</span>
<a name="gbab-122"></a>  <span class="cm">/*Flags indicating which MB modes have been refined.*/</span>
<a name="gbab-123"></a>  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">refined</span><span class="p">;</span>
<a name="gbab-124"></a>  <span class="cm">/*Motion vectors for a macro block for the current frame and the</span>
<a name="gbab-125"></a><span class="cm">     previous two frames.</span>
<a name="gbab-126"></a><span class="cm">    Each is a set of 2 vectors against OC_FRAME_GOLD and OC_FRAME_PREV, which</span>
<a name="gbab-127"></a><span class="cm">     can be used to estimate constant velocity and constant acceleration</span>
<a name="gbab-128"></a><span class="cm">     predictors.</span>
<a name="gbab-129"></a><span class="cm">    Uninitialized MVs are (0,0).*/</span>
<a name="gbab-130"></a>  <span class="n">oc_mv2</span>        <span class="n">analysis_mv</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<a name="gbab-131"></a>  <span class="cm">/*Current unrefined analysis MVs.*/</span>
<a name="gbab-132"></a>  <span class="n">oc_mv</span>         <span class="n">unref_mv</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<a name="gbab-133"></a>  <span class="cm">/*Unrefined block MVs.*/</span>
<a name="gbab-134"></a>  <span class="n">oc_mv</span>         <span class="n">block_mv</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<a name="gbab-135"></a>  <span class="cm">/*Refined block MVs.*/</span>
<a name="gbab-136"></a>  <span class="n">oc_mv</span>         <span class="n">ref_mv</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<a name="gbab-137"></a>  <span class="cm">/*Minimum motion estimation error from the analysis stage.*/</span>
<a name="gbab-138"></a>  <span class="n">ogg_uint16_t</span>  <span class="n">error</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<a name="gbab-139"></a>  <span class="cm">/*MB error for half-pel refinement for each frame type.*/</span>
<a name="gbab-140"></a>  <span class="kt">unsigned</span>      <span class="n">satd</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<a name="gbab-141"></a>  <span class="cm">/*Block error for half-pel refinement.*/</span>
<a name="gbab-142"></a>  <span class="kt">unsigned</span>      <span class="n">block_satd</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<a name="gbab-143"></a><span class="p">};</span>
<a name="gbab-144"></a>
<a name="gbab-145"></a>
<a name="gbab-146"></a>
<a name="gbab-147"></a><span class="cm">/*State machine to estimate the opportunity cost of coding a MB mode.*/</span>
<a name="gbab-148"></a><span class="k">struct</span> <span class="n">oc_mode_scheme_chooser</span><span class="p">{</span>
<a name="gbab-149"></a>  <span class="cm">/*Pointers to the a list containing the index of each mode in the mode</span>
<a name="gbab-150"></a><span class="cm">     alphabet used by each scheme.</span>
<a name="gbab-151"></a><span class="cm">    The first entry points to the dynamic scheme0_ranks, while the remaining 7</span>
<a name="gbab-152"></a><span class="cm">     point to the constant entries stored in OC_MODE_SCHEMES.*/</span>
<a name="gbab-153"></a>  <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">mode_ranks</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
<a name="gbab-154"></a>  <span class="cm">/*The ranks for each mode when coded with scheme 0.</span>
<a name="gbab-155"></a><span class="cm">    These are optimized so that the more frequent modes have lower ranks.*/</span>
<a name="gbab-156"></a>  <span class="kt">unsigned</span> <span class="kt">char</span>        <span class="n">scheme0_ranks</span><span class="p">[</span><span class="n">OC_NMODES</span><span class="p">];</span>
<a name="gbab-157"></a>  <span class="cm">/*The list of modes, sorted in descending order of frequency, that</span>
<a name="gbab-158"></a><span class="cm">    corresponds to the ranks above.*/</span>
<a name="gbab-159"></a>  <span class="kt">unsigned</span> <span class="kt">char</span>        <span class="n">scheme0_list</span><span class="p">[</span><span class="n">OC_NMODES</span><span class="p">];</span>
<a name="gbab-160"></a>  <span class="cm">/*The number of times each mode has been chosen so far.*/</span>
<a name="gbab-161"></a>  <span class="kt">int</span>                  <span class="n">mode_counts</span><span class="p">[</span><span class="n">OC_NMODES</span><span class="p">];</span>
<a name="gbab-162"></a>  <span class="cm">/*The list of mode coding schemes, sorted in ascending order of bit cost.*/</span>
<a name="gbab-163"></a>  <span class="kt">unsigned</span> <span class="kt">char</span>        <span class="n">scheme_list</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
<a name="gbab-164"></a>  <span class="cm">/*The number of bits used by each mode coding scheme.*/</span>
<a name="gbab-165"></a>  <span class="kt">ptrdiff_t</span>            <span class="n">scheme_bits</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
<a name="gbab-166"></a><span class="p">};</span>
<a name="gbab-167"></a>
<a name="gbab-168"></a>
<a name="gbab-169"></a><span class="kt">void</span> <span class="nf">oc_mode_scheme_chooser_init</span><span class="p">(</span><span class="n">oc_mode_scheme_chooser</span> <span class="o">*</span><span class="n">_chooser</span><span class="p">);</span>
<a name="gbab-170"></a>
<a name="gbab-171"></a>
<a name="gbab-172"></a>
<a name="gbab-173"></a><span class="cm">/*A 2nd order low-pass Bessel follower.</span>
<a name="gbab-174"></a><span class="cm">  We use this for rate control because it has fast reaction time, but is</span>
<a name="gbab-175"></a><span class="cm">   critically damped.*/</span>
<a name="gbab-176"></a><span class="k">struct</span> <span class="n">oc_iir_filter</span><span class="p">{</span>
<a name="gbab-177"></a>  <span class="n">ogg_int32_t</span> <span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<a name="gbab-178"></a>  <span class="n">ogg_int64_t</span> <span class="n">g</span><span class="p">;</span>
<a name="gbab-179"></a>  <span class="n">ogg_int32_t</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<a name="gbab-180"></a>  <span class="n">ogg_int32_t</span> <span class="n">y</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<a name="gbab-181"></a><span class="p">};</span>
<a name="gbab-182"></a>
<a name="gbab-183"></a>
<a name="gbab-184"></a>
<a name="gbab-185"></a><span class="cm">/*The 2-pass metrics associated with a single frame.*/</span>
<a name="gbab-186"></a><span class="k">struct</span> <span class="n">oc_frame_metrics</span><span class="p">{</span>
<a name="gbab-187"></a>  <span class="cm">/*The log base 2 of the scale factor for this frame in Q24 format.*/</span>
<a name="gbab-188"></a>  <span class="n">ogg_int32_t</span>   <span class="n">log_scale</span><span class="p">;</span>
<a name="gbab-189"></a>  <span class="cm">/*The number of application-requested duplicates of this frame.*/</span>
<a name="gbab-190"></a>  <span class="kt">unsigned</span>      <span class="nl">dup_count</span><span class="p">:</span><span class="mi">31</span><span class="p">;</span>
<a name="gbab-191"></a>  <span class="cm">/*The frame type from pass 1.*/</span>
<a name="gbab-192"></a>  <span class="kt">unsigned</span>      <span class="nl">frame_type</span><span class="p">:</span><span class="mi">1</span><span class="p">;</span>
<a name="gbab-193"></a><span class="p">};</span>
<a name="gbab-194"></a>
<a name="gbab-195"></a>
<a name="gbab-196"></a>
<a name="gbab-197"></a><span class="cm">/*Rate control state information.*/</span>
<a name="gbab-198"></a><span class="k">struct</span> <span class="n">oc_rc_state</span><span class="p">{</span>
<a name="gbab-199"></a>  <span class="cm">/*The target average bits per frame.*/</span>
<a name="gbab-200"></a>  <span class="n">ogg_int64_t</span>        <span class="n">bits_per_frame</span><span class="p">;</span>
<a name="gbab-201"></a>  <span class="cm">/*The current buffer fullness (bits available to be used).*/</span>
<a name="gbab-202"></a>  <span class="n">ogg_int64_t</span>        <span class="n">fullness</span><span class="p">;</span>
<a name="gbab-203"></a>  <span class="cm">/*The target buffer fullness.</span>
<a name="gbab-204"></a><span class="cm">    This is where we&#39;d like to be by the last keyframe the appears in the next</span>
<a name="gbab-205"></a><span class="cm">     buf_delay frames.*/</span>
<a name="gbab-206"></a>  <span class="n">ogg_int64_t</span>        <span class="n">target</span><span class="p">;</span>
<a name="gbab-207"></a>  <span class="cm">/*The maximum buffer fullness (total size of the buffer).*/</span>
<a name="gbab-208"></a>  <span class="n">ogg_int64_t</span>        <span class="n">max</span><span class="p">;</span>
<a name="gbab-209"></a>  <span class="cm">/*The log of the number of pixels in a frame in Q57 format.*/</span>
<a name="gbab-210"></a>  <span class="n">ogg_int64_t</span>        <span class="n">log_npixels</span><span class="p">;</span>
<a name="gbab-211"></a>  <span class="cm">/*The exponent used in the rate model in Q8 format.*/</span>
<a name="gbab-212"></a>  <span class="kt">unsigned</span>           <span class="n">exp</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<a name="gbab-213"></a>  <span class="cm">/*The number of frames to distribute the buffer usage over.*/</span>
<a name="gbab-214"></a>  <span class="kt">int</span>                <span class="n">buf_delay</span><span class="p">;</span>
<a name="gbab-215"></a>  <span class="cm">/*The total drop count from the previous frame.</span>
<a name="gbab-216"></a><span class="cm">    This includes duplicates explicitly requested via the</span>
<a name="gbab-217"></a><span class="cm">     TH_ENCCTL_SET_DUP_COUNT API as well as frames we chose to drop ourselves.*/</span>
<a name="gbab-218"></a>  <span class="n">ogg_uint32_t</span>       <span class="n">prev_drop_count</span><span class="p">;</span>
<a name="gbab-219"></a>  <span class="cm">/*The log of an estimated scale factor used to obtain the real framerate, for</span>
<a name="gbab-220"></a><span class="cm">     VFR sources or, e.g., 12 fps content doubled to 24 fps, etc.*/</span>
<a name="gbab-221"></a>  <span class="n">ogg_int64_t</span>        <span class="n">log_drop_scale</span><span class="p">;</span>
<a name="gbab-222"></a>  <span class="cm">/*The log of estimated scale factor for the rate model in Q57 format.*/</span>
<a name="gbab-223"></a>  <span class="n">ogg_int64_t</span>        <span class="n">log_scale</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<a name="gbab-224"></a>  <span class="cm">/*The log of the target quantizer level in Q57 format.*/</span>
<a name="gbab-225"></a>  <span class="n">ogg_int64_t</span>        <span class="n">log_qtarget</span><span class="p">;</span>
<a name="gbab-226"></a>  <span class="cm">/*Will we drop frames to meet bitrate target?*/</span>
<a name="gbab-227"></a>  <span class="kt">unsigned</span> <span class="kt">char</span>      <span class="n">drop_frames</span><span class="p">;</span>
<a name="gbab-228"></a>  <span class="cm">/*Do we respect the maximum buffer fullness?*/</span>
<a name="gbab-229"></a>  <span class="kt">unsigned</span> <span class="kt">char</span>      <span class="n">cap_overflow</span><span class="p">;</span>
<a name="gbab-230"></a>  <span class="cm">/*Can the reservoir go negative?*/</span>
<a name="gbab-231"></a>  <span class="kt">unsigned</span> <span class="kt">char</span>      <span class="n">cap_underflow</span><span class="p">;</span>
<a name="gbab-232"></a>  <span class="cm">/*Second-order lowpass filters to track scale and VFR.*/</span>
<a name="gbab-233"></a>  <span class="n">oc_iir_filter</span>      <span class="n">scalefilter</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<a name="gbab-234"></a>  <span class="kt">int</span>                <span class="n">inter_count</span><span class="p">;</span>
<a name="gbab-235"></a>  <span class="kt">int</span>                <span class="n">inter_delay</span><span class="p">;</span>
<a name="gbab-236"></a>  <span class="kt">int</span>                <span class="n">inter_delay_target</span><span class="p">;</span>
<a name="gbab-237"></a>  <span class="n">oc_iir_filter</span>      <span class="n">vfrfilter</span><span class="p">;</span>
<a name="gbab-238"></a>  <span class="cm">/*Two-pass mode state.</span>
<a name="gbab-239"></a><span class="cm">    0 =&gt; 1-pass encoding.</span>
<a name="gbab-240"></a><span class="cm">    1 =&gt; 1st pass of 2-pass encoding.</span>
<a name="gbab-241"></a><span class="cm">    2 =&gt; 2nd pass of 2-pass encoding.*/</span>
<a name="gbab-242"></a>  <span class="kt">int</span>                <span class="n">twopass</span><span class="p">;</span>
<a name="gbab-243"></a>  <span class="cm">/*Buffer for current frame metrics.*/</span>
<a name="gbab-244"></a>  <span class="kt">unsigned</span> <span class="kt">char</span>      <span class="n">twopass_buffer</span><span class="p">[</span><span class="mi">48</span><span class="p">];</span>
<a name="gbab-245"></a>  <span class="cm">/*The number of bytes in the frame metrics buffer.</span>
<a name="gbab-246"></a><span class="cm">    When 2-pass encoding is enabled, this is set to 0 after each frame is</span>
<a name="gbab-247"></a><span class="cm">     submitted, and must be non-zero before the next frame will be accepted.*/</span>
<a name="gbab-248"></a>  <span class="kt">int</span>                <span class="n">twopass_buffer_bytes</span><span class="p">;</span>
<a name="gbab-249"></a>  <span class="kt">int</span>                <span class="n">twopass_buffer_fill</span><span class="p">;</span>
<a name="gbab-250"></a>  <span class="cm">/*Whether or not to force the next frame to be a keyframe.*/</span>
<a name="gbab-251"></a>  <span class="kt">unsigned</span> <span class="kt">char</span>      <span class="n">twopass_force_kf</span><span class="p">;</span>
<a name="gbab-252"></a>  <span class="cm">/*The metrics for the previous frame.*/</span>
<a name="gbab-253"></a>  <span class="n">oc_frame_metrics</span>   <span class="n">prev_metrics</span><span class="p">;</span>
<a name="gbab-254"></a>  <span class="cm">/*The metrics for the current frame.*/</span>
<a name="gbab-255"></a>  <span class="n">oc_frame_metrics</span>   <span class="n">cur_metrics</span><span class="p">;</span>
<a name="gbab-256"></a>  <span class="cm">/*The buffered metrics for future frames.*/</span>
<a name="gbab-257"></a>  <span class="n">oc_frame_metrics</span>  <span class="o">*</span><span class="n">frame_metrics</span><span class="p">;</span>
<a name="gbab-258"></a>  <span class="kt">int</span>                <span class="n">nframe_metrics</span><span class="p">;</span>
<a name="gbab-259"></a>  <span class="kt">int</span>                <span class="n">cframe_metrics</span><span class="p">;</span>
<a name="gbab-260"></a>  <span class="cm">/*The index of the current frame in the circular metric buffer.*/</span>
<a name="gbab-261"></a>  <span class="kt">int</span>                <span class="n">frame_metrics_head</span><span class="p">;</span>
<a name="gbab-262"></a>  <span class="cm">/*The frame count of each type (keyframes, delta frames, and dup frames);</span>
<a name="gbab-263"></a><span class="cm">     32 bits limits us to 2.268 years at 60 fps.*/</span>
<a name="gbab-264"></a>  <span class="n">ogg_uint32_t</span>       <span class="n">frames_total</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<a name="gbab-265"></a>  <span class="cm">/*The number of frames of each type yet to be processed.*/</span>
<a name="gbab-266"></a>  <span class="n">ogg_uint32_t</span>       <span class="n">frames_left</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<a name="gbab-267"></a>  <span class="cm">/*The sum of the scale values for each frame type.*/</span>
<a name="gbab-268"></a>  <span class="n">ogg_int64_t</span>        <span class="n">scale_sum</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<a name="gbab-269"></a>  <span class="cm">/*The start of the window over which the current scale sums are taken.*/</span>
<a name="gbab-270"></a>  <span class="kt">int</span>                <span class="n">scale_window0</span><span class="p">;</span>
<a name="gbab-271"></a>  <span class="cm">/*The end of the window over which the current scale sums are taken.*/</span>
<a name="gbab-272"></a>  <span class="kt">int</span>                <span class="n">scale_window_end</span><span class="p">;</span>
<a name="gbab-273"></a>  <span class="cm">/*The frame count of each type in the current 2-pass window; this does not</span>
<a name="gbab-274"></a><span class="cm">     include dup frames.*/</span>
<a name="gbab-275"></a>  <span class="kt">int</span>                <span class="n">nframes</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<a name="gbab-276"></a>  <span class="cm">/*The total accumulated estimation bias.*/</span>
<a name="gbab-277"></a>  <span class="n">ogg_int64_t</span>        <span class="n">rate_bias</span><span class="p">;</span>
<a name="gbab-278"></a><span class="p">};</span>
<a name="gbab-279"></a>
<a name="gbab-280"></a>
<a name="gbab-281"></a><span class="kt">void</span> <span class="nf">oc_rc_state_init</span><span class="p">(</span><span class="n">oc_rc_state</span> <span class="o">*</span><span class="n">_rc</span><span class="p">,</span><span class="n">oc_enc_ctx</span> <span class="o">*</span><span class="n">_enc</span><span class="p">);</span>
<a name="gbab-282"></a><span class="kt">void</span> <span class="nf">oc_rc_state_clear</span><span class="p">(</span><span class="n">oc_rc_state</span> <span class="o">*</span><span class="n">_rc</span><span class="p">);</span>
<a name="gbab-283"></a>
<a name="gbab-284"></a><span class="kt">void</span> <span class="nf">oc_enc_rc_resize</span><span class="p">(</span><span class="n">oc_enc_ctx</span> <span class="o">*</span><span class="n">_enc</span><span class="p">);</span>
<a name="gbab-285"></a><span class="kt">int</span> <span class="nf">oc_enc_select_qi</span><span class="p">(</span><span class="n">oc_enc_ctx</span> <span class="o">*</span><span class="n">_enc</span><span class="p">,</span><span class="kt">int</span> <span class="n">_qti</span><span class="p">,</span><span class="kt">int</span> <span class="n">_clamp</span><span class="p">);</span>
<a name="gbab-286"></a><span class="kt">void</span> <span class="nf">oc_enc_calc_lambda</span><span class="p">(</span><span class="n">oc_enc_ctx</span> <span class="o">*</span><span class="n">_enc</span><span class="p">,</span><span class="kt">int</span> <span class="n">_frame_type</span><span class="p">);</span>
<a name="gbab-287"></a><span class="kt">int</span> <span class="nf">oc_enc_update_rc_state</span><span class="p">(</span><span class="n">oc_enc_ctx</span> <span class="o">*</span><span class="n">_enc</span><span class="p">,</span>
<a name="gbab-288"></a> <span class="kt">long</span> <span class="n">_bits</span><span class="p">,</span><span class="kt">int</span> <span class="n">_qti</span><span class="p">,</span><span class="kt">int</span> <span class="n">_qi</span><span class="p">,</span><span class="kt">int</span> <span class="n">_trial</span><span class="p">,</span><span class="kt">int</span> <span class="n">_droppable</span><span class="p">);</span>
<a name="gbab-289"></a><span class="kt">int</span> <span class="nf">oc_enc_rc_2pass_out</span><span class="p">(</span><span class="n">oc_enc_ctx</span> <span class="o">*</span><span class="n">_enc</span><span class="p">,</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">**</span><span class="n">_buf</span><span class="p">);</span>
<a name="gbab-290"></a><span class="kt">int</span> <span class="nf">oc_enc_rc_2pass_in</span><span class="p">(</span><span class="n">oc_enc_ctx</span> <span class="o">*</span><span class="n">_enc</span><span class="p">,</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_buf</span><span class="p">,</span><span class="kt">size_t</span> <span class="n">_bytes</span><span class="p">);</span>
<a name="gbab-291"></a>
<a name="gbab-292"></a>
<a name="gbab-293"></a>
<a name="gbab-294"></a><span class="cm">/*The internal encoder state.*/</span>
<a name="gbab-295"></a><span class="k">struct</span> <span class="n">th_enc_ctx</span><span class="p">{</span>
<a name="gbab-296"></a>  <span class="cm">/*Shared encoder/decoder state.*/</span>
<a name="gbab-297"></a>  <span class="n">oc_theora_state</span>          <span class="n">state</span><span class="p">;</span>
<a name="gbab-298"></a>  <span class="cm">/*Buffer in which to assemble packets.*/</span>
<a name="gbab-299"></a>  <span class="n">oggpack_buffer</span>           <span class="n">opb</span><span class="p">;</span>
<a name="gbab-300"></a>  <span class="cm">/*Encoder-specific macroblock information.*/</span>
<a name="gbab-301"></a>  <span class="n">oc_mb_enc_info</span>          <span class="o">*</span><span class="n">mb_info</span><span class="p">;</span>
<a name="gbab-302"></a>  <span class="cm">/*DC coefficients after prediction.*/</span>
<a name="gbab-303"></a>  <span class="n">ogg_int16_t</span>             <span class="o">*</span><span class="n">frag_dc</span><span class="p">;</span>
<a name="gbab-304"></a>  <span class="cm">/*The list of coded macro blocks, in coded order.*/</span>
<a name="gbab-305"></a>  <span class="kt">unsigned</span>                <span class="o">*</span><span class="n">coded_mbis</span><span class="p">;</span>
<a name="gbab-306"></a>  <span class="cm">/*The number of coded macro blocks.*/</span>
<a name="gbab-307"></a>  <span class="kt">size_t</span>                   <span class="n">ncoded_mbis</span><span class="p">;</span>
<a name="gbab-308"></a>  <span class="cm">/*Whether or not packets are ready to be emitted.</span>
<a name="gbab-309"></a><span class="cm">    This takes on negative values while there are remaining header packets to</span>
<a name="gbab-310"></a><span class="cm">     be emitted, reaches 0 when the codec is ready for input, and becomes</span>
<a name="gbab-311"></a><span class="cm">     positive when a frame has been processed and data packets are ready.*/</span>
<a name="gbab-312"></a>  <span class="kt">int</span>                      <span class="n">packet_state</span><span class="p">;</span>
<a name="gbab-313"></a>  <span class="cm">/*The maximum distance between keyframes.*/</span>
<a name="gbab-314"></a>  <span class="n">ogg_uint32_t</span>             <span class="n">keyframe_frequency_force</span><span class="p">;</span>
<a name="gbab-315"></a>  <span class="cm">/*The number of duplicates to produce for the next frame.*/</span>
<a name="gbab-316"></a>  <span class="n">ogg_uint32_t</span>             <span class="n">dup_count</span><span class="p">;</span>
<a name="gbab-317"></a>  <span class="cm">/*The number of duplicates remaining to be emitted for the current frame.*/</span>
<a name="gbab-318"></a>  <span class="n">ogg_uint32_t</span>             <span class="n">nqueued_dups</span><span class="p">;</span>
<a name="gbab-319"></a>  <span class="cm">/*The number of duplicates emitted for the last frame.*/</span>
<a name="gbab-320"></a>  <span class="n">ogg_uint32_t</span>             <span class="n">prev_dup_count</span><span class="p">;</span>
<a name="gbab-321"></a>  <span class="cm">/*The current speed level.*/</span>
<a name="gbab-322"></a>  <span class="kt">int</span>                      <span class="n">sp_level</span><span class="p">;</span>
<a name="gbab-323"></a>  <span class="cm">/*Whether or not VP3 compatibility mode has been enabled.*/</span>
<a name="gbab-324"></a>  <span class="kt">unsigned</span> <span class="kt">char</span>            <span class="n">vp3_compatible</span><span class="p">;</span>
<a name="gbab-325"></a>  <span class="cm">/*Whether or not any INTER frames have been coded.*/</span>
<a name="gbab-326"></a>  <span class="kt">unsigned</span> <span class="kt">char</span>            <span class="n">coded_inter_frame</span><span class="p">;</span>
<a name="gbab-327"></a>  <span class="cm">/*Whether or not previous frame was dropped.*/</span>
<a name="gbab-328"></a>  <span class="kt">unsigned</span> <span class="kt">char</span>            <span class="n">prevframe_dropped</span><span class="p">;</span>
<a name="gbab-329"></a>  <span class="cm">/*Stores most recently chosen Huffman tables for each frame type, DC and AC</span>
<a name="gbab-330"></a><span class="cm">     coefficients, and luma and chroma tokens.</span>
<a name="gbab-331"></a><span class="cm">    The actual Huffman table used for a given coefficient depends not only on</span>
<a name="gbab-332"></a><span class="cm">     the choice made here, but also its index in the zig-zag ordering.*/</span>
<a name="gbab-333"></a>  <span class="kt">unsigned</span> <span class="kt">char</span>            <span class="n">huff_idxs</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span>
<a name="gbab-334"></a>  <span class="cm">/*Current count of bits used by each MV coding mode.*/</span>
<a name="gbab-335"></a>  <span class="kt">size_t</span>                   <span class="n">mv_bits</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<a name="gbab-336"></a>  <span class="cm">/*The mode scheme chooser for estimating mode coding costs.*/</span>
<a name="gbab-337"></a>  <span class="n">oc_mode_scheme_chooser</span>   <span class="n">chooser</span><span class="p">;</span>
<a name="gbab-338"></a>  <span class="cm">/*The number of vertical super blocks in an MCU.*/</span>
<a name="gbab-339"></a>  <span class="kt">int</span>                      <span class="n">mcu_nvsbs</span><span class="p">;</span>
<a name="gbab-340"></a>  <span class="cm">/*The SSD error for skipping each fragment in the current MCU.*/</span>
<a name="gbab-341"></a>  <span class="kt">unsigned</span>                <span class="o">*</span><span class="n">mcu_skip_ssd</span><span class="p">;</span>
<a name="gbab-342"></a>  <span class="cm">/*The DCT token lists for each coefficient and each plane.*/</span>
<a name="gbab-343"></a>  <span class="kt">unsigned</span> <span class="kt">char</span>          <span class="o">**</span><span class="n">dct_tokens</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<a name="gbab-344"></a>  <span class="cm">/*The extra bits associated with each DCT token.*/</span>
<a name="gbab-345"></a>  <span class="n">ogg_uint16_t</span>           <span class="o">**</span><span class="n">extra_bits</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<a name="gbab-346"></a>  <span class="cm">/*The number of DCT tokens for each coefficient for each plane.*/</span>
<a name="gbab-347"></a>  <span class="kt">ptrdiff_t</span>                <span class="n">ndct_tokens</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">64</span><span class="p">];</span>
<a name="gbab-348"></a>  <span class="cm">/*Pending EOB runs for each coefficient for each plane.*/</span>
<a name="gbab-349"></a>  <span class="n">ogg_uint16_t</span>             <span class="n">eob_run</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">64</span><span class="p">];</span>
<a name="gbab-350"></a>  <span class="cm">/*The offset of the first DCT token for each coefficient for each plane.*/</span>
<a name="gbab-351"></a>  <span class="kt">unsigned</span> <span class="kt">char</span>            <span class="n">dct_token_offs</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">64</span><span class="p">];</span>
<a name="gbab-352"></a>  <span class="cm">/*The last DC coefficient for each plane and reference frame.*/</span>
<a name="gbab-353"></a>  <span class="kt">int</span>                      <span class="n">dc_pred_last</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">3</span><span class="p">];</span>
<a name="gbab-354"></a><span class="cp">#if defined(OC_COLLECT_METRICS)</span>
<a name="gbab-355"></a>  <span class="cm">/*Fragment SATD statistics for MB mode estimation metrics.*/</span>
<a name="gbab-356"></a>  <span class="kt">unsigned</span>                <span class="o">*</span><span class="n">frag_satd</span><span class="p">;</span>
<a name="gbab-357"></a>  <span class="cm">/*Fragment SSD statistics for MB mode estimation metrics.*/</span>
<a name="gbab-358"></a>  <span class="kt">unsigned</span>                <span class="o">*</span><span class="n">frag_ssd</span><span class="p">;</span>
<a name="gbab-359"></a><span class="cp">#endif</span>
<a name="gbab-360"></a>  <span class="cm">/*The R-D optimization parameter.*/</span>
<a name="gbab-361"></a>  <span class="kt">int</span>                      <span class="n">lambda</span><span class="p">;</span>
<a name="gbab-362"></a>  <span class="cm">/*The huffman tables in use.*/</span>
<a name="gbab-363"></a>  <span class="n">th_huff_code</span>             <span class="n">huff_codes</span><span class="p">[</span><span class="n">TH_NHUFFMAN_TABLES</span><span class="p">][</span><span class="n">TH_NDCT_TOKENS</span><span class="p">];</span>
<a name="gbab-364"></a>  <span class="cm">/*The quantization parameters in use.*/</span>
<a name="gbab-365"></a>  <span class="n">th_quant_info</span>            <span class="n">qinfo</span><span class="p">;</span>
<a name="gbab-366"></a>  <span class="n">oc_iquant</span>               <span class="o">*</span><span class="n">enquant_tables</span><span class="p">[</span><span class="mi">64</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span>
<a name="gbab-367"></a>  <span class="n">oc_iquant_table</span>          <span class="n">enquant_table_data</span><span class="p">[</span><span class="mi">64</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span>
<a name="gbab-368"></a>  <span class="cm">/*An &quot;average&quot; quantizer for each quantizer type (INTRA or INTER) and qi</span>
<a name="gbab-369"></a><span class="cm">     value.</span>
<a name="gbab-370"></a><span class="cm">    This is used to paramterize the rate control decisions.</span>
<a name="gbab-371"></a><span class="cm">    They are kept in the log domain to simplify later processing.</span>
<a name="gbab-372"></a><span class="cm">    Keep in mind these are DCT domain quantizers, and so are scaled by an</span>
<a name="gbab-373"></a><span class="cm">     additional factor of 4 from the pixel domain.*/</span>
<a name="gbab-374"></a>  <span class="n">ogg_int64_t</span>              <span class="n">log_qavg</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">64</span><span class="p">];</span>
<a name="gbab-375"></a>  <span class="cm">/*The buffer state used to drive rate control.*/</span>
<a name="gbab-376"></a>  <span class="n">oc_rc_state</span>              <span class="n">rc</span><span class="p">;</span>
<a name="gbab-377"></a>  <span class="cm">/*Table for encoder acceleration functions.*/</span>
<a name="gbab-378"></a>  <span class="n">oc_enc_opt_vtable</span>        <span class="n">opt_vtable</span><span class="p">;</span>
<a name="gbab-379"></a><span class="p">};</span>
<a name="gbab-380"></a>
<a name="gbab-381"></a>
<a name="gbab-382"></a><span class="kt">void</span> <span class="nf">oc_enc_analyze_intra</span><span class="p">(</span><span class="n">oc_enc_ctx</span> <span class="o">*</span><span class="n">_enc</span><span class="p">,</span><span class="kt">int</span> <span class="n">_recode</span><span class="p">);</span>
<a name="gbab-383"></a><span class="kt">int</span> <span class="nf">oc_enc_analyze_inter</span><span class="p">(</span><span class="n">oc_enc_ctx</span> <span class="o">*</span><span class="n">_enc</span><span class="p">,</span><span class="kt">int</span> <span class="n">_allow_keyframe</span><span class="p">,</span><span class="kt">int</span> <span class="n">_recode</span><span class="p">);</span>
<a name="gbab-384"></a><span class="cp">#if defined(OC_COLLECT_METRICS)</span>
<a name="gbab-385"></a><span class="kt">void</span> <span class="nf">oc_enc_mode_metrics_collect</span><span class="p">(</span><span class="n">oc_enc_ctx</span> <span class="o">*</span><span class="n">_enc</span><span class="p">);</span>
<a name="gbab-386"></a><span class="kt">void</span> <span class="nf">oc_enc_mode_metrics_dump</span><span class="p">(</span><span class="n">oc_enc_ctx</span> <span class="o">*</span><span class="n">_enc</span><span class="p">);</span>
<a name="gbab-387"></a><span class="cp">#endif</span>
<a name="gbab-388"></a>
<a name="gbab-389"></a>
<a name="gbab-390"></a>
<a name="gbab-391"></a><span class="cm">/*Perform fullpel motion search for a single MB against both reference frames.*/</span>
<a name="gbab-392"></a><span class="kt">void</span> <span class="nf">oc_mcenc_search</span><span class="p">(</span><span class="n">oc_enc_ctx</span> <span class="o">*</span><span class="n">_enc</span><span class="p">,</span><span class="kt">int</span> <span class="n">_mbi</span><span class="p">);</span>
<a name="gbab-393"></a><span class="cm">/*Refine a MB MV for one frame.*/</span>
<a name="gbab-394"></a><span class="kt">void</span> <span class="nf">oc_mcenc_refine1mv</span><span class="p">(</span><span class="n">oc_enc_ctx</span> <span class="o">*</span><span class="n">_enc</span><span class="p">,</span><span class="kt">int</span> <span class="n">_mbi</span><span class="p">,</span><span class="kt">int</span> <span class="n">_frame</span><span class="p">);</span>
<a name="gbab-395"></a><span class="cm">/*Refine the block MVs.*/</span>
<a name="gbab-396"></a><span class="kt">void</span> <span class="nf">oc_mcenc_refine4mv</span><span class="p">(</span><span class="n">oc_enc_ctx</span> <span class="o">*</span><span class="n">_enc</span><span class="p">,</span><span class="kt">int</span> <span class="n">_mbi</span><span class="p">);</span>
<a name="gbab-397"></a>
<a name="gbab-398"></a>
<a name="gbab-399"></a>
<a name="gbab-400"></a><span class="cm">/*Used to rollback a tokenlog transaction when we retroactively decide to skip</span>
<a name="gbab-401"></a><span class="cm">   a fragment.</span>
<a name="gbab-402"></a><span class="cm">  A checkpoint is taken right before each token is added.*/</span>
<a name="gbab-403"></a><span class="k">struct</span> <span class="n">oc_token_checkpoint</span><span class="p">{</span>
<a name="gbab-404"></a>  <span class="cm">/*The color plane the token was added to.*/</span>
<a name="gbab-405"></a>  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">pli</span><span class="p">;</span>
<a name="gbab-406"></a>  <span class="cm">/*The zig-zag index the token was added to.*/</span>
<a name="gbab-407"></a>  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">zzi</span><span class="p">;</span>
<a name="gbab-408"></a>  <span class="cm">/*The outstanding EOB run count before the token was added.*/</span>
<a name="gbab-409"></a>  <span class="n">ogg_uint16_t</span>  <span class="n">eob_run</span><span class="p">;</span>
<a name="gbab-410"></a>  <span class="cm">/*The token count before the token was added.*/</span>
<a name="gbab-411"></a>  <span class="kt">ptrdiff_t</span>     <span class="n">ndct_tokens</span><span class="p">;</span>
<a name="gbab-412"></a><span class="p">};</span>
<a name="gbab-413"></a>
<a name="gbab-414"></a>
<a name="gbab-415"></a>
<a name="gbab-416"></a><span class="kt">void</span> <span class="nf">oc_enc_tokenize_start</span><span class="p">(</span><span class="n">oc_enc_ctx</span> <span class="o">*</span><span class="n">_enc</span><span class="p">);</span>
<a name="gbab-417"></a><span class="kt">int</span> <span class="nf">oc_enc_tokenize_ac</span><span class="p">(</span><span class="n">oc_enc_ctx</span> <span class="o">*</span><span class="n">_enc</span><span class="p">,</span><span class="kt">int</span> <span class="n">_pli</span><span class="p">,</span><span class="kt">ptrdiff_t</span> <span class="n">_fragi</span><span class="p">,</span>
<a name="gbab-418"></a> <span class="n">ogg_int16_t</span> <span class="o">*</span><span class="n">_qdct</span><span class="p">,</span><span class="k">const</span> <span class="n">ogg_uint16_t</span> <span class="o">*</span><span class="n">_dequant</span><span class="p">,</span><span class="k">const</span> <span class="n">ogg_int16_t</span> <span class="o">*</span><span class="n">_dct</span><span class="p">,</span>
<a name="gbab-419"></a> <span class="kt">int</span> <span class="n">_zzi</span><span class="p">,</span><span class="n">oc_token_checkpoint</span> <span class="o">**</span><span class="n">_stack</span><span class="p">,</span><span class="kt">int</span> <span class="n">_acmin</span><span class="p">);</span>
<a name="gbab-420"></a><span class="kt">void</span> <span class="nf">oc_enc_tokenlog_rollback</span><span class="p">(</span><span class="n">oc_enc_ctx</span> <span class="o">*</span><span class="n">_enc</span><span class="p">,</span>
<a name="gbab-421"></a> <span class="k">const</span> <span class="n">oc_token_checkpoint</span> <span class="o">*</span><span class="n">_stack</span><span class="p">,</span><span class="kt">int</span> <span class="n">_n</span><span class="p">);</span>
<a name="gbab-422"></a><span class="kt">void</span> <span class="nf">oc_enc_pred_dc_frag_rows</span><span class="p">(</span><span class="n">oc_enc_ctx</span> <span class="o">*</span><span class="n">_enc</span><span class="p">,</span>
<a name="gbab-423"></a> <span class="kt">int</span> <span class="n">_pli</span><span class="p">,</span><span class="kt">int</span> <span class="n">_fragy0</span><span class="p">,</span><span class="kt">int</span> <span class="n">_frag_yend</span><span class="p">);</span>
<a name="gbab-424"></a><span class="kt">void</span> <span class="nf">oc_enc_tokenize_dc_frag_list</span><span class="p">(</span><span class="n">oc_enc_ctx</span> <span class="o">*</span><span class="n">_enc</span><span class="p">,</span><span class="kt">int</span> <span class="n">_pli</span><span class="p">,</span>
<a name="gbab-425"></a> <span class="k">const</span> <span class="kt">ptrdiff_t</span> <span class="o">*</span><span class="n">_coded_fragis</span><span class="p">,</span><span class="kt">ptrdiff_t</span> <span class="n">_ncoded_fragis</span><span class="p">,</span>
<a name="gbab-426"></a> <span class="kt">int</span> <span class="n">_prev_ndct_tokens1</span><span class="p">,</span><span class="kt">int</span> <span class="n">_prev_eob_run1</span><span class="p">);</span>
<a name="gbab-427"></a><span class="kt">void</span> <span class="nf">oc_enc_tokenize_finish</span><span class="p">(</span><span class="n">oc_enc_ctx</span> <span class="o">*</span><span class="n">_enc</span><span class="p">);</span>
<a name="gbab-428"></a>
<a name="gbab-429"></a>
<a name="gbab-430"></a>
<a name="gbab-431"></a><span class="cm">/*Utility routine to encode one of the header packets.*/</span>
<a name="gbab-432"></a><span class="kt">int</span> <span class="nf">oc_state_flushheader</span><span class="p">(</span><span class="n">oc_theora_state</span> <span class="o">*</span><span class="n">_state</span><span class="p">,</span><span class="kt">int</span> <span class="o">*</span><span class="n">_packet_state</span><span class="p">,</span>
<a name="gbab-433"></a> <span class="n">oggpack_buffer</span> <span class="o">*</span><span class="n">_opb</span><span class="p">,</span><span class="k">const</span> <span class="n">th_quant_info</span> <span class="o">*</span><span class="n">_qinfo</span><span class="p">,</span>
<a name="gbab-434"></a> <span class="k">const</span> <span class="n">th_huff_code</span> <span class="n">_codes</span><span class="p">[</span><span class="n">TH_NHUFFMAN_TABLES</span><span class="p">][</span><span class="n">TH_NDCT_TOKENS</span><span class="p">],</span>
<a name="gbab-435"></a> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_vendor</span><span class="p">,</span><span class="n">th_comment</span> <span class="o">*</span><span class="n">_tc</span><span class="p">,</span><span class="n">ogg_packet</span> <span class="o">*</span><span class="n">_op</span><span class="p">);</span>
<a name="gbab-436"></a>
<a name="gbab-437"></a>
<a name="gbab-438"></a>
<a name="gbab-439"></a><span class="cm">/*Encoder-specific accelerated functions.*/</span>
<a name="gbab-440"></a><span class="kt">void</span> <span class="nf">oc_enc_frag_sub</span><span class="p">(</span><span class="k">const</span> <span class="n">oc_enc_ctx</span> <span class="o">*</span><span class="n">_enc</span><span class="p">,</span><span class="n">ogg_int16_t</span> <span class="n">_diff</span><span class="p">[</span><span class="mi">64</span><span class="p">],</span>
<a name="gbab-441"></a> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_src</span><span class="p">,</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_ref</span><span class="p">,</span><span class="kt">int</span> <span class="n">_ystride</span><span class="p">);</span>
<a name="gbab-442"></a><span class="kt">void</span> <span class="nf">oc_enc_frag_sub_128</span><span class="p">(</span><span class="k">const</span> <span class="n">oc_enc_ctx</span> <span class="o">*</span><span class="n">_enc</span><span class="p">,</span><span class="n">ogg_int16_t</span> <span class="n">_diff</span><span class="p">[</span><span class="mi">64</span><span class="p">],</span>
<a name="gbab-443"></a> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_src</span><span class="p">,</span><span class="kt">int</span> <span class="n">_ystride</span><span class="p">);</span>
<a name="gbab-444"></a><span class="kt">unsigned</span> <span class="nf">oc_enc_frag_sad</span><span class="p">(</span><span class="k">const</span> <span class="n">oc_enc_ctx</span> <span class="o">*</span><span class="n">_enc</span><span class="p">,</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_src</span><span class="p">,</span>
<a name="gbab-445"></a> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_ref</span><span class="p">,</span><span class="kt">int</span> <span class="n">_ystride</span><span class="p">);</span>
<a name="gbab-446"></a><span class="kt">unsigned</span> <span class="nf">oc_enc_frag_sad_thresh</span><span class="p">(</span><span class="k">const</span> <span class="n">oc_enc_ctx</span> <span class="o">*</span><span class="n">_enc</span><span class="p">,</span>
<a name="gbab-447"></a> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_src</span><span class="p">,</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_ref</span><span class="p">,</span><span class="kt">int</span> <span class="n">_ystride</span><span class="p">,</span>
<a name="gbab-448"></a> <span class="kt">unsigned</span> <span class="n">_thresh</span><span class="p">);</span>
<a name="gbab-449"></a><span class="kt">unsigned</span> <span class="nf">oc_enc_frag_sad2_thresh</span><span class="p">(</span><span class="k">const</span> <span class="n">oc_enc_ctx</span> <span class="o">*</span><span class="n">_enc</span><span class="p">,</span>
<a name="gbab-450"></a> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_src</span><span class="p">,</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_ref1</span><span class="p">,</span>
<a name="gbab-451"></a> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_ref2</span><span class="p">,</span><span class="kt">int</span> <span class="n">_ystride</span><span class="p">,</span><span class="kt">unsigned</span> <span class="n">_thresh</span><span class="p">);</span>
<a name="gbab-452"></a><span class="kt">unsigned</span> <span class="nf">oc_enc_frag_satd_thresh</span><span class="p">(</span><span class="k">const</span> <span class="n">oc_enc_ctx</span> <span class="o">*</span><span class="n">_enc</span><span class="p">,</span>
<a name="gbab-453"></a> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_src</span><span class="p">,</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_ref</span><span class="p">,</span><span class="kt">int</span> <span class="n">_ystride</span><span class="p">,</span>
<a name="gbab-454"></a> <span class="kt">unsigned</span> <span class="n">_thresh</span><span class="p">);</span>
<a name="gbab-455"></a><span class="kt">unsigned</span> <span class="nf">oc_enc_frag_satd2_thresh</span><span class="p">(</span><span class="k">const</span> <span class="n">oc_enc_ctx</span> <span class="o">*</span><span class="n">_enc</span><span class="p">,</span>
<a name="gbab-456"></a> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_src</span><span class="p">,</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_ref1</span><span class="p">,</span>
<a name="gbab-457"></a> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_ref2</span><span class="p">,</span><span class="kt">int</span> <span class="n">_ystride</span><span class="p">,</span><span class="kt">unsigned</span> <span class="n">_thresh</span><span class="p">);</span>
<a name="gbab-458"></a><span class="kt">unsigned</span> <span class="nf">oc_enc_frag_intra_satd</span><span class="p">(</span><span class="k">const</span> <span class="n">oc_enc_ctx</span> <span class="o">*</span><span class="n">_enc</span><span class="p">,</span>
<a name="gbab-459"></a> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_src</span><span class="p">,</span><span class="kt">int</span> <span class="n">_ystride</span><span class="p">);</span>
<a name="gbab-460"></a><span class="kt">void</span> <span class="nf">oc_enc_frag_copy2</span><span class="p">(</span><span class="k">const</span> <span class="n">oc_enc_ctx</span> <span class="o">*</span><span class="n">_enc</span><span class="p">,</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_dst</span><span class="p">,</span>
<a name="gbab-461"></a> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_src1</span><span class="p">,</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_src2</span><span class="p">,</span><span class="kt">int</span> <span class="n">_ystride</span><span class="p">);</span>
<a name="gbab-462"></a><span class="kt">void</span> <span class="nf">oc_enc_frag_recon_intra</span><span class="p">(</span><span class="k">const</span> <span class="n">oc_enc_ctx</span> <span class="o">*</span><span class="n">_enc</span><span class="p">,</span>
<a name="gbab-463"></a> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_dst</span><span class="p">,</span><span class="kt">int</span> <span class="n">_ystride</span><span class="p">,</span><span class="k">const</span> <span class="n">ogg_int16_t</span> <span class="n">_residue</span><span class="p">[</span><span class="mi">64</span><span class="p">]);</span>
<a name="gbab-464"></a><span class="kt">void</span> <span class="nf">oc_enc_frag_recon_inter</span><span class="p">(</span><span class="k">const</span> <span class="n">oc_enc_ctx</span> <span class="o">*</span><span class="n">_enc</span><span class="p">,</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_dst</span><span class="p">,</span>
<a name="gbab-465"></a> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_src</span><span class="p">,</span><span class="kt">int</span> <span class="n">_ystride</span><span class="p">,</span><span class="k">const</span> <span class="n">ogg_int16_t</span> <span class="n">_residue</span><span class="p">[</span><span class="mi">64</span><span class="p">]);</span>
<a name="gbab-466"></a><span class="kt">void</span> <span class="nf">oc_enc_fdct8x8</span><span class="p">(</span><span class="k">const</span> <span class="n">oc_enc_ctx</span> <span class="o">*</span><span class="n">_enc</span><span class="p">,</span><span class="n">ogg_int16_t</span> <span class="n">_y</span><span class="p">[</span><span class="mi">64</span><span class="p">],</span>
<a name="gbab-467"></a> <span class="k">const</span> <span class="n">ogg_int16_t</span> <span class="n">_x</span><span class="p">[</span><span class="mi">64</span><span class="p">]);</span>
<a name="gbab-468"></a>
<a name="gbab-469"></a><span class="cm">/*Default pure-C implementations.*/</span>
<a name="gbab-470"></a><span class="kt">void</span> <span class="nf">oc_enc_vtable_init_c</span><span class="p">(</span><span class="n">oc_enc_ctx</span> <span class="o">*</span><span class="n">_enc</span><span class="p">);</span>
<a name="gbab-471"></a>
<a name="gbab-472"></a><span class="kt">void</span> <span class="nf">oc_enc_frag_sub_c</span><span class="p">(</span><span class="n">ogg_int16_t</span> <span class="n">_diff</span><span class="p">[</span><span class="mi">64</span><span class="p">],</span>
<a name="gbab-473"></a> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_src</span><span class="p">,</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_ref</span><span class="p">,</span><span class="kt">int</span> <span class="n">_ystride</span><span class="p">);</span>
<a name="gbab-474"></a><span class="kt">void</span> <span class="nf">oc_enc_frag_sub_128_c</span><span class="p">(</span><span class="n">ogg_int16_t</span> <span class="n">_diff</span><span class="p">[</span><span class="mi">64</span><span class="p">],</span>
<a name="gbab-475"></a> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_src</span><span class="p">,</span><span class="kt">int</span> <span class="n">_ystride</span><span class="p">);</span>
<a name="gbab-476"></a><span class="kt">void</span> <span class="nf">oc_enc_frag_copy2_c</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_dst</span><span class="p">,</span>
<a name="gbab-477"></a> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_src1</span><span class="p">,</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_src2</span><span class="p">,</span><span class="kt">int</span> <span class="n">_ystride</span><span class="p">);</span>
<a name="gbab-478"></a><span class="kt">unsigned</span> <span class="nf">oc_enc_frag_sad_c</span><span class="p">(</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_src</span><span class="p">,</span>
<a name="gbab-479"></a> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_ref</span><span class="p">,</span><span class="kt">int</span> <span class="n">_ystride</span><span class="p">);</span>
<a name="gbab-480"></a><span class="kt">unsigned</span> <span class="nf">oc_enc_frag_sad_thresh_c</span><span class="p">(</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_src</span><span class="p">,</span>
<a name="gbab-481"></a> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_ref</span><span class="p">,</span><span class="kt">int</span> <span class="n">_ystride</span><span class="p">,</span><span class="kt">unsigned</span> <span class="n">_thresh</span><span class="p">);</span>
<a name="gbab-482"></a><span class="kt">unsigned</span> <span class="nf">oc_enc_frag_sad2_thresh_c</span><span class="p">(</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_src</span><span class="p">,</span>
<a name="gbab-483"></a> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_ref1</span><span class="p">,</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_ref2</span><span class="p">,</span><span class="kt">int</span> <span class="n">_ystride</span><span class="p">,</span>
<a name="gbab-484"></a> <span class="kt">unsigned</span> <span class="n">_thresh</span><span class="p">);</span>
<a name="gbab-485"></a><span class="kt">unsigned</span> <span class="nf">oc_enc_frag_satd_thresh_c</span><span class="p">(</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_src</span><span class="p">,</span>
<a name="gbab-486"></a> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_ref</span><span class="p">,</span><span class="kt">int</span> <span class="n">_ystride</span><span class="p">,</span><span class="kt">unsigned</span> <span class="n">_thresh</span><span class="p">);</span>
<a name="gbab-487"></a><span class="kt">unsigned</span> <span class="nf">oc_enc_frag_satd2_thresh_c</span><span class="p">(</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_src</span><span class="p">,</span>
<a name="gbab-488"></a> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_ref1</span><span class="p">,</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_ref2</span><span class="p">,</span><span class="kt">int</span> <span class="n">_ystride</span><span class="p">,</span>
<a name="gbab-489"></a> <span class="kt">unsigned</span> <span class="n">_thresh</span><span class="p">);</span>
<a name="gbab-490"></a><span class="kt">unsigned</span> <span class="nf">oc_enc_frag_intra_satd_c</span><span class="p">(</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_src</span><span class="p">,</span><span class="kt">int</span> <span class="n">_ystride</span><span class="p">);</span>
<a name="gbab-491"></a><span class="kt">void</span> <span class="nf">oc_enc_fdct8x8_c</span><span class="p">(</span><span class="n">ogg_int16_t</span> <span class="n">_y</span><span class="p">[</span><span class="mi">64</span><span class="p">],</span><span class="k">const</span> <span class="n">ogg_int16_t</span> <span class="n">_x</span><span class="p">[</span><span class="mi">64</span><span class="p">]);</span>
<a name="gbab-492"></a>
<a name="gbab-493"></a><span class="cp">#endif</span>
</pre></div>
</td></tr></table>
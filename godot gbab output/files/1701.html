<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319</pre></div></td><td class="code"><div class="highlight"><pre><span></span><a name="gbab-1"></a><span class="c1">// jpgd.h - C++ class for JPEG decompression.</span>
<a name="gbab-2"></a><span class="c1">// Public domain, Rich Geldreich &lt;richgel99@gmail.com&gt;</span>
<a name="gbab-3"></a><span class="cp">#ifndef JPEG_DECODER_H</span>
<a name="gbab-4"></a><span class="cp">#define JPEG_DECODER_H</span>
<a name="gbab-5"></a>
<a name="gbab-6"></a><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
<a name="gbab-7"></a><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<a name="gbab-8"></a><span class="cp">#include</span> <span class="cpf">&lt;setjmp.h&gt;</span><span class="cp"></span>
<a name="gbab-9"></a>
<a name="gbab-10"></a><span class="cp">#ifdef _MSC_VER</span>
<a name="gbab-11"></a>  <span class="cp">#define JPGD_NORETURN __declspec(noreturn) </span>
<a name="gbab-12"></a><span class="cp">#elif defined(__GNUC__)</span>
<a name="gbab-13"></a>  <span class="cp">#define JPGD_NORETURN __attribute__ ((noreturn))</span>
<a name="gbab-14"></a><span class="cp">#else</span>
<a name="gbab-15"></a>  <span class="cp">#define JPGD_NORETURN</span>
<a name="gbab-16"></a><span class="cp">#endif</span>
<a name="gbab-17"></a>
<a name="gbab-18"></a><span class="n">namespace</span> <span class="n">jpgd</span>
<a name="gbab-19"></a><span class="p">{</span>
<a name="gbab-20"></a>  <span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="n">uint8</span><span class="p">;</span>
<a name="gbab-21"></a>  <span class="k">typedef</span>   <span class="kt">signed</span> <span class="kt">short</span> <span class="n">int16</span><span class="p">;</span>
<a name="gbab-22"></a>  <span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">uint16</span><span class="p">;</span>
<a name="gbab-23"></a>  <span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">int</span>   <span class="n">uint</span><span class="p">;</span>
<a name="gbab-24"></a>  <span class="k">typedef</span>   <span class="kt">signed</span> <span class="kt">int</span>   <span class="n">int32</span><span class="p">;</span>
<a name="gbab-25"></a>
<a name="gbab-26"></a>  <span class="c1">// Loads a JPEG image from a memory buffer or a file.</span>
<a name="gbab-27"></a>  <span class="c1">// req_comps can be 1 (grayscale), 3 (RGB), or 4 (RGBA).</span>
<a name="gbab-28"></a>  <span class="c1">// On return, width/height will be set to the image&#39;s dimensions, and actual_comps will be set to the either 1 (grayscale) or 3 (RGB).</span>
<a name="gbab-29"></a>  <span class="c1">// Notes: For more control over where and how the source data is read, see the decompress_jpeg_image_from_stream() function below, or call the jpeg_decoder class directly.</span>
<a name="gbab-30"></a>  <span class="c1">// Requesting a 8 or 32bpp image is currently a little faster than 24bpp because the jpeg_decoder class itself currently always unpacks to either 8 or 32bpp.</span>
<a name="gbab-31"></a>  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="nf">decompress_jpeg_image_from_memory</span><span class="p">(</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">pSrc_data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">src_data_size</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">height</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">actual_comps</span><span class="p">,</span> <span class="kt">int</span> <span class="n">req_comps</span><span class="p">);</span>
<a name="gbab-32"></a>  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="nf">decompress_jpeg_image_from_file</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">pSrc_filename</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">height</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">actual_comps</span><span class="p">,</span> <span class="kt">int</span> <span class="n">req_comps</span><span class="p">);</span>
<a name="gbab-33"></a>
<a name="gbab-34"></a>  <span class="c1">// Success/failure error codes.</span>
<a name="gbab-35"></a>  <span class="k">enum</span> <span class="n">jpgd_status</span>
<a name="gbab-36"></a>  <span class="p">{</span>
<a name="gbab-37"></a>    <span class="n">JPGD_SUCCESS</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">JPGD_FAILED</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">JPGD_DONE</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a name="gbab-38"></a>    <span class="n">JPGD_BAD_DHT_COUNTS</span> <span class="o">=</span> <span class="o">-</span><span class="mi">256</span><span class="p">,</span> <span class="n">JPGD_BAD_DHT_INDEX</span><span class="p">,</span> <span class="n">JPGD_BAD_DHT_MARKER</span><span class="p">,</span> <span class="n">JPGD_BAD_DQT_MARKER</span><span class="p">,</span> <span class="n">JPGD_BAD_DQT_TABLE</span><span class="p">,</span> 
<a name="gbab-39"></a>    <span class="n">JPGD_BAD_PRECISION</span><span class="p">,</span> <span class="n">JPGD_BAD_HEIGHT</span><span class="p">,</span> <span class="n">JPGD_BAD_WIDTH</span><span class="p">,</span> <span class="n">JPGD_TOO_MANY_COMPONENTS</span><span class="p">,</span> 
<a name="gbab-40"></a>    <span class="n">JPGD_BAD_SOF_LENGTH</span><span class="p">,</span> <span class="n">JPGD_BAD_VARIABLE_MARKER</span><span class="p">,</span> <span class="n">JPGD_BAD_DRI_LENGTH</span><span class="p">,</span> <span class="n">JPGD_BAD_SOS_LENGTH</span><span class="p">,</span>
<a name="gbab-41"></a>    <span class="n">JPGD_BAD_SOS_COMP_ID</span><span class="p">,</span> <span class="n">JPGD_W_EXTRA_BYTES_BEFORE_MARKER</span><span class="p">,</span> <span class="n">JPGD_NO_ARITHMITIC_SUPPORT</span><span class="p">,</span> <span class="n">JPGD_UNEXPECTED_MARKER</span><span class="p">,</span>
<a name="gbab-42"></a>    <span class="n">JPGD_NOT_JPEG</span><span class="p">,</span> <span class="n">JPGD_UNSUPPORTED_MARKER</span><span class="p">,</span> <span class="n">JPGD_BAD_DQT_LENGTH</span><span class="p">,</span> <span class="n">JPGD_TOO_MANY_BLOCKS</span><span class="p">,</span>
<a name="gbab-43"></a>    <span class="n">JPGD_UNDEFINED_QUANT_TABLE</span><span class="p">,</span> <span class="n">JPGD_UNDEFINED_HUFF_TABLE</span><span class="p">,</span> <span class="n">JPGD_NOT_SINGLE_SCAN</span><span class="p">,</span> <span class="n">JPGD_UNSUPPORTED_COLORSPACE</span><span class="p">,</span>
<a name="gbab-44"></a>    <span class="n">JPGD_UNSUPPORTED_SAMP_FACTORS</span><span class="p">,</span> <span class="n">JPGD_DECODE_ERROR</span><span class="p">,</span> <span class="n">JPGD_BAD_RESTART_MARKER</span><span class="p">,</span> <span class="n">JPGD_ASSERTION_ERROR</span><span class="p">,</span>
<a name="gbab-45"></a>    <span class="n">JPGD_BAD_SOS_SPECTRAL</span><span class="p">,</span> <span class="n">JPGD_BAD_SOS_SUCCESSIVE</span><span class="p">,</span> <span class="n">JPGD_STREAM_READ</span><span class="p">,</span> <span class="n">JPGD_NOTENOUGHMEM</span>
<a name="gbab-46"></a>  <span class="p">};</span>
<a name="gbab-47"></a>    
<a name="gbab-48"></a>  <span class="c1">// Input stream interface.</span>
<a name="gbab-49"></a>  <span class="c1">// Derive from this class to read input data from sources other than files or memory. Set m_eof_flag to true when no more data is available.</span>
<a name="gbab-50"></a>  <span class="c1">// The decoder is rather greedy: it will keep on calling this method until its internal input buffer is full, or until the EOF flag is set.</span>
<a name="gbab-51"></a>  <span class="c1">// It the input stream contains data after the JPEG stream&#39;s EOI (end of image) marker it will probably be pulled into the internal buffer.</span>
<a name="gbab-52"></a>  <span class="c1">// Call the get_total_bytes_read() method to determine the actual size of the JPEG stream after successful decoding.</span>
<a name="gbab-53"></a>  <span class="n">class</span> <span class="n">jpeg_decoder_stream</span>
<a name="gbab-54"></a>  <span class="p">{</span>
<a name="gbab-55"></a>  <span class="nl">public</span><span class="p">:</span>
<a name="gbab-56"></a>    <span class="n">jpeg_decoder_stream</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
<a name="gbab-57"></a>    <span class="n">virtual</span> <span class="o">~</span><span class="n">jpeg_decoder_stream</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
<a name="gbab-58"></a>
<a name="gbab-59"></a>    <span class="c1">// The read() method is called when the internal input buffer is empty.</span>
<a name="gbab-60"></a>    <span class="c1">// Parameters:</span>
<a name="gbab-61"></a>    <span class="c1">// pBuf - input buffer</span>
<a name="gbab-62"></a>    <span class="c1">// max_bytes_to_read - maximum bytes that can be written to pBuf</span>
<a name="gbab-63"></a>    <span class="c1">// pEOF_flag - set this to true if at end of stream (no more bytes remaining)</span>
<a name="gbab-64"></a>    <span class="c1">// Returns -1 on error, otherwise return the number of bytes actually written to the buffer (which may be 0).</span>
<a name="gbab-65"></a>    <span class="c1">// Notes: This method will be called in a loop until you set *pEOF_flag to true or the internal buffer is full.</span>
<a name="gbab-66"></a>    <span class="n">virtual</span> <span class="kt">int</span> <span class="n">read</span><span class="p">(</span><span class="n">uint8</span> <span class="o">*</span><span class="n">pBuf</span><span class="p">,</span> <span class="kt">int</span> <span class="n">max_bytes_to_read</span><span class="p">,</span> <span class="kt">bool</span> <span class="o">*</span><span class="n">pEOF_flag</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<a name="gbab-67"></a>  <span class="p">};</span>
<a name="gbab-68"></a>
<a name="gbab-69"></a>  <span class="c1">// stdio FILE stream class.</span>
<a name="gbab-70"></a>  <span class="n">class</span> <span class="nl">jpeg_decoder_file_stream</span> <span class="p">:</span> <span class="n">public</span> <span class="n">jpeg_decoder_stream</span>
<a name="gbab-71"></a>  <span class="p">{</span>
<a name="gbab-72"></a>    <span class="n">jpeg_decoder_file_stream</span><span class="p">(</span><span class="k">const</span> <span class="n">jpeg_decoder_file_stream</span> <span class="o">&amp;</span><span class="p">);</span>
<a name="gbab-73"></a>    <span class="n">jpeg_decoder_file_stream</span> <span class="o">&amp;</span><span class="n">operator</span> <span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">jpeg_decoder_file_stream</span> <span class="o">&amp;</span><span class="p">);</span>
<a name="gbab-74"></a>
<a name="gbab-75"></a>    <span class="kt">FILE</span> <span class="o">*</span><span class="n">m_pFile</span><span class="p">;</span>
<a name="gbab-76"></a>    <span class="kt">bool</span> <span class="n">m_eof_flag</span><span class="p">,</span> <span class="n">m_error_flag</span><span class="p">;</span>
<a name="gbab-77"></a>
<a name="gbab-78"></a>  <span class="nl">public</span><span class="p">:</span>
<a name="gbab-79"></a>    <span class="n">jpeg_decoder_file_stream</span><span class="p">();</span>
<a name="gbab-80"></a>    <span class="n">virtual</span> <span class="o">~</span><span class="n">jpeg_decoder_file_stream</span><span class="p">();</span>
<a name="gbab-81"></a>    
<a name="gbab-82"></a>    <span class="kt">bool</span> <span class="nf">open</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">Pfilename</span><span class="p">);</span>
<a name="gbab-83"></a>    <span class="kt">void</span> <span class="nf">close</span><span class="p">();</span>
<a name="gbab-84"></a>
<a name="gbab-85"></a>    <span class="n">virtual</span> <span class="kt">int</span> <span class="nf">read</span><span class="p">(</span><span class="n">uint8</span> <span class="o">*</span><span class="n">pBuf</span><span class="p">,</span> <span class="kt">int</span> <span class="n">max_bytes_to_read</span><span class="p">,</span> <span class="kt">bool</span> <span class="o">*</span><span class="n">pEOF_flag</span><span class="p">);</span>
<a name="gbab-86"></a>  <span class="p">};</span>
<a name="gbab-87"></a>
<a name="gbab-88"></a>  <span class="c1">// Memory stream class.</span>
<a name="gbab-89"></a>  <span class="n">class</span> <span class="nl">jpeg_decoder_mem_stream</span> <span class="p">:</span> <span class="n">public</span> <span class="n">jpeg_decoder_stream</span>
<a name="gbab-90"></a>  <span class="p">{</span>
<a name="gbab-91"></a>    <span class="k">const</span> <span class="n">uint8</span> <span class="o">*</span><span class="n">m_pSrc_data</span><span class="p">;</span>
<a name="gbab-92"></a>    <span class="n">uint</span> <span class="n">m_ofs</span><span class="p">,</span> <span class="n">m_size</span><span class="p">;</span>
<a name="gbab-93"></a>
<a name="gbab-94"></a>  <span class="nl">public</span><span class="p">:</span>
<a name="gbab-95"></a>    <span class="n">jpeg_decoder_mem_stream</span><span class="p">()</span> <span class="o">:</span> <span class="n">m_pSrc_data</span><span class="p">(</span><span class="nb">NULL</span><span class="p">),</span> <span class="n">m_ofs</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">m_size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<a name="gbab-96"></a>    <span class="n">jpeg_decoder_mem_stream</span><span class="p">(</span><span class="k">const</span> <span class="n">uint8</span> <span class="o">*</span><span class="n">pSrc_data</span><span class="p">,</span> <span class="n">uint</span> <span class="n">size</span><span class="p">)</span> <span class="o">:</span> <span class="n">m_pSrc_data</span><span class="p">(</span><span class="n">pSrc_data</span><span class="p">),</span> <span class="n">m_ofs</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">m_size</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<a name="gbab-97"></a>
<a name="gbab-98"></a>    <span class="n">virtual</span> <span class="o">~</span><span class="n">jpeg_decoder_mem_stream</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
<a name="gbab-99"></a>
<a name="gbab-100"></a>    <span class="kt">bool</span> <span class="n">open</span><span class="p">(</span><span class="k">const</span> <span class="n">uint8</span> <span class="o">*</span><span class="n">pSrc_data</span><span class="p">,</span> <span class="n">uint</span> <span class="n">size</span><span class="p">);</span>
<a name="gbab-101"></a>    <span class="kt">void</span> <span class="nf">close</span><span class="p">()</span> <span class="p">{</span> <span class="n">m_pSrc_data</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="n">m_ofs</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">m_size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>
<a name="gbab-102"></a>    
<a name="gbab-103"></a>    <span class="n">virtual</span> <span class="kt">int</span> <span class="nf">read</span><span class="p">(</span><span class="n">uint8</span> <span class="o">*</span><span class="n">pBuf</span><span class="p">,</span> <span class="kt">int</span> <span class="n">max_bytes_to_read</span><span class="p">,</span> <span class="kt">bool</span> <span class="o">*</span><span class="n">pEOF_flag</span><span class="p">);</span>
<a name="gbab-104"></a>  <span class="p">};</span>
<a name="gbab-105"></a>
<a name="gbab-106"></a>  <span class="c1">// Loads JPEG file from a jpeg_decoder_stream.</span>
<a name="gbab-107"></a>  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="nf">decompress_jpeg_image_from_stream</span><span class="p">(</span><span class="n">jpeg_decoder_stream</span> <span class="o">*</span><span class="n">pStream</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">height</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">actual_comps</span><span class="p">,</span> <span class="kt">int</span> <span class="n">req_comps</span><span class="p">);</span>
<a name="gbab-108"></a>
<a name="gbab-109"></a>  <span class="k">enum</span> 
<a name="gbab-110"></a>  <span class="p">{</span> 
<a name="gbab-111"></a>    <span class="n">JPGD_IN_BUF_SIZE</span> <span class="o">=</span> <span class="mi">8192</span><span class="p">,</span> <span class="n">JPGD_MAX_BLOCKS_PER_MCU</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">JPGD_MAX_HUFF_TABLES</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> <span class="n">JPGD_MAX_QUANT_TABLES</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> 
<a name="gbab-112"></a>    <span class="n">JPGD_MAX_COMPONENTS</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">JPGD_MAX_COMPS_IN_SCAN</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">JPGD_MAX_BLOCKS_PER_ROW</span> <span class="o">=</span> <span class="mi">8192</span><span class="p">,</span> <span class="n">JPGD_MAX_HEIGHT</span> <span class="o">=</span> <span class="mi">16384</span><span class="p">,</span> <span class="n">JPGD_MAX_WIDTH</span> <span class="o">=</span> <span class="mi">16384</span> 
<a name="gbab-113"></a>  <span class="p">};</span>
<a name="gbab-114"></a>          
<a name="gbab-115"></a>  <span class="k">typedef</span> <span class="n">int16</span> <span class="n">jpgd_quant_t</span><span class="p">;</span>
<a name="gbab-116"></a>  <span class="k">typedef</span> <span class="n">int16</span> <span class="n">jpgd_block_t</span><span class="p">;</span>
<a name="gbab-117"></a>
<a name="gbab-118"></a>  <span class="n">class</span> <span class="n">jpeg_decoder</span>
<a name="gbab-119"></a>  <span class="p">{</span>
<a name="gbab-120"></a>  <span class="nl">public</span><span class="p">:</span>
<a name="gbab-121"></a>    <span class="c1">// Call get_error_code() after constructing to determine if the stream is valid or not. You may call the get_width(), get_height(), etc.</span>
<a name="gbab-122"></a>    <span class="c1">// methods after the constructor is called. You may then either destruct the object, or begin decoding the image by calling begin_decoding(), then decode() on each scanline.</span>
<a name="gbab-123"></a>    <span class="n">jpeg_decoder</span><span class="p">(</span><span class="n">jpeg_decoder_stream</span> <span class="o">*</span><span class="n">pStream</span><span class="p">);</span>
<a name="gbab-124"></a>
<a name="gbab-125"></a>    <span class="o">~</span><span class="n">jpeg_decoder</span><span class="p">();</span>
<a name="gbab-126"></a>
<a name="gbab-127"></a>    <span class="c1">// Call this method after constructing the object to begin decompression.</span>
<a name="gbab-128"></a>    <span class="c1">// If JPGD_SUCCESS is returned you may then call decode() on each scanline.</span>
<a name="gbab-129"></a>    <span class="kt">int</span> <span class="nf">begin_decoding</span><span class="p">();</span>
<a name="gbab-130"></a>
<a name="gbab-131"></a>    <span class="c1">// Returns the next scan line.</span>
<a name="gbab-132"></a>    <span class="c1">// For grayscale images, pScan_line will point to a buffer containing 8-bit pixels (get_bytes_per_pixel() will return 1). </span>
<a name="gbab-133"></a>    <span class="c1">// Otherwise, it will always point to a buffer containing 32-bit RGBA pixels (A will always be 255, and get_bytes_per_pixel() will return 4).</span>
<a name="gbab-134"></a>    <span class="c1">// Returns JPGD_SUCCESS if a scan line has been returned.</span>
<a name="gbab-135"></a>    <span class="c1">// Returns JPGD_DONE if all scan lines have been returned.</span>
<a name="gbab-136"></a>    <span class="c1">// Returns JPGD_FAILED if an error occurred. Call get_error_code() for a more info.</span>
<a name="gbab-137"></a>    <span class="kt">int</span> <span class="nf">decode</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span><span class="o">**</span> <span class="n">pScan_line</span><span class="p">,</span> <span class="n">uint</span><span class="o">*</span> <span class="n">pScan_line_len</span><span class="p">);</span>
<a name="gbab-138"></a>    
<a name="gbab-139"></a>    <span class="kr">inline</span> <span class="n">jpgd_status</span> <span class="nf">get_error_code</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_error_code</span><span class="p">;</span> <span class="p">}</span>
<a name="gbab-140"></a>
<a name="gbab-141"></a>    <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">get_width</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_image_x_size</span><span class="p">;</span> <span class="p">}</span>
<a name="gbab-142"></a>    <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">get_height</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_image_y_size</span><span class="p">;</span> <span class="p">}</span>
<a name="gbab-143"></a>
<a name="gbab-144"></a>    <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">get_num_components</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_comps_in_frame</span><span class="p">;</span> <span class="p">}</span>
<a name="gbab-145"></a>
<a name="gbab-146"></a>    <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">get_bytes_per_pixel</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_dest_bytes_per_pixel</span><span class="p">;</span> <span class="p">}</span>
<a name="gbab-147"></a>    <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">get_bytes_per_scan_line</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_image_x_size</span> <span class="o">*</span> <span class="n">get_bytes_per_pixel</span><span class="p">();</span> <span class="p">}</span>
<a name="gbab-148"></a>
<a name="gbab-149"></a>    <span class="c1">// Returns the total number of bytes actually consumed by the decoder (which should equal the actual size of the JPEG file).</span>
<a name="gbab-150"></a>    <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">get_total_bytes_read</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_total_bytes_read</span><span class="p">;</span> <span class="p">}</span>
<a name="gbab-151"></a>    
<a name="gbab-152"></a>  <span class="nl">private</span><span class="p">:</span>
<a name="gbab-153"></a>    <span class="n">jpeg_decoder</span><span class="p">(</span><span class="k">const</span> <span class="n">jpeg_decoder</span> <span class="o">&amp;</span><span class="p">);</span>
<a name="gbab-154"></a>    <span class="n">jpeg_decoder</span> <span class="o">&amp;</span><span class="n">operator</span> <span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">jpeg_decoder</span> <span class="o">&amp;</span><span class="p">);</span>
<a name="gbab-155"></a>
<a name="gbab-156"></a>    <span class="k">typedef</span> <span class="nf">void</span> <span class="p">(</span><span class="o">*</span><span class="n">pDecode_block_func</span><span class="p">)(</span><span class="n">jpeg_decoder</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<a name="gbab-157"></a>
<a name="gbab-158"></a>    <span class="k">struct</span> <span class="n">huff_tables</span>
<a name="gbab-159"></a>    <span class="p">{</span>
<a name="gbab-160"></a>      <span class="kt">bool</span> <span class="n">ac_table</span><span class="p">;</span>
<a name="gbab-161"></a>      <span class="n">uint</span>  <span class="n">look_up</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
<a name="gbab-162"></a>      <span class="n">uint</span>  <span class="n">look_up2</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
<a name="gbab-163"></a>      <span class="n">uint8</span> <span class="n">code_size</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
<a name="gbab-164"></a>      <span class="n">uint</span>  <span class="n">tree</span><span class="p">[</span><span class="mi">512</span><span class="p">];</span>
<a name="gbab-165"></a>    <span class="p">};</span>
<a name="gbab-166"></a>
<a name="gbab-167"></a>    <span class="k">struct</span> <span class="n">coeff_buf</span>
<a name="gbab-168"></a>    <span class="p">{</span>
<a name="gbab-169"></a>      <span class="n">uint8</span> <span class="o">*</span><span class="n">pData</span><span class="p">;</span>
<a name="gbab-170"></a>      <span class="kt">int</span> <span class="n">block_num_x</span><span class="p">,</span> <span class="n">block_num_y</span><span class="p">;</span>
<a name="gbab-171"></a>      <span class="kt">int</span> <span class="n">block_len_x</span><span class="p">,</span> <span class="n">block_len_y</span><span class="p">;</span>
<a name="gbab-172"></a>      <span class="kt">int</span> <span class="n">block_size</span><span class="p">;</span>
<a name="gbab-173"></a>    <span class="p">};</span>
<a name="gbab-174"></a>
<a name="gbab-175"></a>    <span class="k">struct</span> <span class="n">mem_block</span>
<a name="gbab-176"></a>    <span class="p">{</span>
<a name="gbab-177"></a>      <span class="n">mem_block</span> <span class="o">*</span><span class="n">m_pNext</span><span class="p">;</span>
<a name="gbab-178"></a>      <span class="kt">size_t</span> <span class="n">m_used_count</span><span class="p">;</span>
<a name="gbab-179"></a>      <span class="kt">size_t</span> <span class="n">m_size</span><span class="p">;</span>
<a name="gbab-180"></a>      <span class="kt">char</span> <span class="n">m_data</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<a name="gbab-181"></a>    <span class="p">};</span>
<a name="gbab-182"></a>
<a name="gbab-183"></a>    <span class="kt">jmp_buf</span> <span class="n">m_jmp_state</span><span class="p">;</span>
<a name="gbab-184"></a>    <span class="n">mem_block</span> <span class="o">*</span><span class="n">m_pMem_blocks</span><span class="p">;</span>
<a name="gbab-185"></a>    <span class="kt">int</span> <span class="n">m_image_x_size</span><span class="p">;</span>
<a name="gbab-186"></a>    <span class="kt">int</span> <span class="n">m_image_y_size</span><span class="p">;</span>
<a name="gbab-187"></a>    <span class="n">jpeg_decoder_stream</span> <span class="o">*</span><span class="n">m_pStream</span><span class="p">;</span>
<a name="gbab-188"></a>    <span class="kt">int</span> <span class="n">m_progressive_flag</span><span class="p">;</span>
<a name="gbab-189"></a>    <span class="n">uint8</span> <span class="n">m_huff_ac</span><span class="p">[</span><span class="n">JPGD_MAX_HUFF_TABLES</span><span class="p">];</span>
<a name="gbab-190"></a>    <span class="n">uint8</span><span class="o">*</span> <span class="n">m_huff_num</span><span class="p">[</span><span class="n">JPGD_MAX_HUFF_TABLES</span><span class="p">];</span>      <span class="c1">// pointer to number of Huffman codes per bit size</span>
<a name="gbab-191"></a>    <span class="n">uint8</span><span class="o">*</span> <span class="n">m_huff_val</span><span class="p">[</span><span class="n">JPGD_MAX_HUFF_TABLES</span><span class="p">];</span>      <span class="c1">// pointer to Huffman codes per bit size</span>
<a name="gbab-192"></a>    <span class="n">jpgd_quant_t</span><span class="o">*</span> <span class="n">m_quant</span><span class="p">[</span><span class="n">JPGD_MAX_QUANT_TABLES</span><span class="p">];</span> <span class="c1">// pointer to quantization tables</span>
<a name="gbab-193"></a>    <span class="kt">int</span> <span class="n">m_scan_type</span><span class="p">;</span>                              <span class="c1">// Gray, Yh1v1, Yh1v2, Yh2v1, Yh2v2 (CMYK111, CMYK4114 no longer supported)</span>
<a name="gbab-194"></a>    <span class="kt">int</span> <span class="n">m_comps_in_frame</span><span class="p">;</span>                         <span class="c1">// # of components in frame</span>
<a name="gbab-195"></a>    <span class="kt">int</span> <span class="n">m_comp_h_samp</span><span class="p">[</span><span class="n">JPGD_MAX_COMPONENTS</span><span class="p">];</span>       <span class="c1">// component&#39;s horizontal sampling factor</span>
<a name="gbab-196"></a>    <span class="kt">int</span> <span class="n">m_comp_v_samp</span><span class="p">[</span><span class="n">JPGD_MAX_COMPONENTS</span><span class="p">];</span>       <span class="c1">// component&#39;s vertical sampling factor</span>
<a name="gbab-197"></a>    <span class="kt">int</span> <span class="n">m_comp_quant</span><span class="p">[</span><span class="n">JPGD_MAX_COMPONENTS</span><span class="p">];</span>        <span class="c1">// component&#39;s quantization table selector</span>
<a name="gbab-198"></a>    <span class="kt">int</span> <span class="n">m_comp_ident</span><span class="p">[</span><span class="n">JPGD_MAX_COMPONENTS</span><span class="p">];</span>        <span class="c1">// component&#39;s ID</span>
<a name="gbab-199"></a>    <span class="kt">int</span> <span class="n">m_comp_h_blocks</span><span class="p">[</span><span class="n">JPGD_MAX_COMPONENTS</span><span class="p">];</span>
<a name="gbab-200"></a>    <span class="kt">int</span> <span class="n">m_comp_v_blocks</span><span class="p">[</span><span class="n">JPGD_MAX_COMPONENTS</span><span class="p">];</span>
<a name="gbab-201"></a>    <span class="kt">int</span> <span class="n">m_comps_in_scan</span><span class="p">;</span>                          <span class="c1">// # of components in scan</span>
<a name="gbab-202"></a>    <span class="kt">int</span> <span class="n">m_comp_list</span><span class="p">[</span><span class="n">JPGD_MAX_COMPS_IN_SCAN</span><span class="p">];</span>      <span class="c1">// components in this scan</span>
<a name="gbab-203"></a>    <span class="kt">int</span> <span class="n">m_comp_dc_tab</span><span class="p">[</span><span class="n">JPGD_MAX_COMPONENTS</span><span class="p">];</span>       <span class="c1">// component&#39;s DC Huffman coding table selector</span>
<a name="gbab-204"></a>    <span class="kt">int</span> <span class="n">m_comp_ac_tab</span><span class="p">[</span><span class="n">JPGD_MAX_COMPONENTS</span><span class="p">];</span>       <span class="c1">// component&#39;s AC Huffman coding table selector</span>
<a name="gbab-205"></a>    <span class="kt">int</span> <span class="n">m_spectral_start</span><span class="p">;</span>                         <span class="c1">// spectral selection start</span>
<a name="gbab-206"></a>    <span class="kt">int</span> <span class="n">m_spectral_end</span><span class="p">;</span>                           <span class="c1">// spectral selection end</span>
<a name="gbab-207"></a>    <span class="kt">int</span> <span class="n">m_successive_low</span><span class="p">;</span>                         <span class="c1">// successive approximation low</span>
<a name="gbab-208"></a>    <span class="kt">int</span> <span class="n">m_successive_high</span><span class="p">;</span>                        <span class="c1">// successive approximation high</span>
<a name="gbab-209"></a>    <span class="kt">int</span> <span class="n">m_max_mcu_x_size</span><span class="p">;</span>                         <span class="c1">// MCU&#39;s max. X size in pixels</span>
<a name="gbab-210"></a>    <span class="kt">int</span> <span class="n">m_max_mcu_y_size</span><span class="p">;</span>                         <span class="c1">// MCU&#39;s max. Y size in pixels</span>
<a name="gbab-211"></a>    <span class="kt">int</span> <span class="n">m_blocks_per_mcu</span><span class="p">;</span>
<a name="gbab-212"></a>    <span class="kt">int</span> <span class="n">m_max_blocks_per_row</span><span class="p">;</span>
<a name="gbab-213"></a>    <span class="kt">int</span> <span class="n">m_mcus_per_row</span><span class="p">,</span> <span class="n">m_mcus_per_col</span><span class="p">;</span>
<a name="gbab-214"></a>    <span class="kt">int</span> <span class="n">m_mcu_org</span><span class="p">[</span><span class="n">JPGD_MAX_BLOCKS_PER_MCU</span><span class="p">];</span>
<a name="gbab-215"></a>    <span class="kt">int</span> <span class="n">m_total_lines_left</span><span class="p">;</span>                       <span class="c1">// total # lines left in image</span>
<a name="gbab-216"></a>    <span class="kt">int</span> <span class="n">m_mcu_lines_left</span><span class="p">;</span>                         <span class="c1">// total # lines left in this MCU</span>
<a name="gbab-217"></a>    <span class="kt">int</span> <span class="n">m_real_dest_bytes_per_scan_line</span><span class="p">;</span>
<a name="gbab-218"></a>    <span class="kt">int</span> <span class="n">m_dest_bytes_per_scan_line</span><span class="p">;</span>               <span class="c1">// rounded up</span>
<a name="gbab-219"></a>    <span class="kt">int</span> <span class="n">m_dest_bytes_per_pixel</span><span class="p">;</span>                   <span class="c1">// 4 (RGB) or 1 (Y)</span>
<a name="gbab-220"></a>    <span class="n">huff_tables</span><span class="o">*</span> <span class="n">m_pHuff_tabs</span><span class="p">[</span><span class="n">JPGD_MAX_HUFF_TABLES</span><span class="p">];</span>
<a name="gbab-221"></a>    <span class="n">coeff_buf</span><span class="o">*</span> <span class="n">m_dc_coeffs</span><span class="p">[</span><span class="n">JPGD_MAX_COMPONENTS</span><span class="p">];</span>
<a name="gbab-222"></a>    <span class="n">coeff_buf</span><span class="o">*</span> <span class="n">m_ac_coeffs</span><span class="p">[</span><span class="n">JPGD_MAX_COMPONENTS</span><span class="p">];</span>
<a name="gbab-223"></a>    <span class="kt">int</span> <span class="n">m_eob_run</span><span class="p">;</span>
<a name="gbab-224"></a>    <span class="kt">int</span> <span class="n">m_block_y_mcu</span><span class="p">[</span><span class="n">JPGD_MAX_COMPONENTS</span><span class="p">];</span>
<a name="gbab-225"></a>    <span class="n">uint8</span><span class="o">*</span> <span class="n">m_pIn_buf_ofs</span><span class="p">;</span>
<a name="gbab-226"></a>    <span class="kt">int</span> <span class="n">m_in_buf_left</span><span class="p">;</span>
<a name="gbab-227"></a>    <span class="kt">int</span> <span class="n">m_tem_flag</span><span class="p">;</span>
<a name="gbab-228"></a>    <span class="kt">bool</span> <span class="n">m_eof_flag</span><span class="p">;</span>
<a name="gbab-229"></a>    <span class="n">uint8</span> <span class="n">m_in_buf_pad_start</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>
<a name="gbab-230"></a>    <span class="n">uint8</span> <span class="n">m_in_buf</span><span class="p">[</span><span class="n">JPGD_IN_BUF_SIZE</span> <span class="o">+</span> <span class="mi">128</span><span class="p">];</span>
<a name="gbab-231"></a>    <span class="n">uint8</span> <span class="n">m_in_buf_pad_end</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>
<a name="gbab-232"></a>    <span class="kt">int</span> <span class="n">m_bits_left</span><span class="p">;</span>
<a name="gbab-233"></a>    <span class="n">uint</span> <span class="n">m_bit_buf</span><span class="p">;</span>
<a name="gbab-234"></a>    <span class="kt">int</span> <span class="n">m_restart_interval</span><span class="p">;</span>
<a name="gbab-235"></a>    <span class="kt">int</span> <span class="n">m_restarts_left</span><span class="p">;</span>
<a name="gbab-236"></a>    <span class="kt">int</span> <span class="n">m_next_restart_num</span><span class="p">;</span>
<a name="gbab-237"></a>    <span class="kt">int</span> <span class="n">m_max_mcus_per_row</span><span class="p">;</span>
<a name="gbab-238"></a>    <span class="kt">int</span> <span class="n">m_max_blocks_per_mcu</span><span class="p">;</span>
<a name="gbab-239"></a>    <span class="kt">int</span> <span class="n">m_expanded_blocks_per_mcu</span><span class="p">;</span>
<a name="gbab-240"></a>    <span class="kt">int</span> <span class="n">m_expanded_blocks_per_row</span><span class="p">;</span>
<a name="gbab-241"></a>    <span class="kt">int</span> <span class="n">m_expanded_blocks_per_component</span><span class="p">;</span>
<a name="gbab-242"></a>    <span class="kt">bool</span>  <span class="n">m_freq_domain_chroma_upsample</span><span class="p">;</span>
<a name="gbab-243"></a>    <span class="kt">int</span> <span class="n">m_max_mcus_per_col</span><span class="p">;</span>
<a name="gbab-244"></a>    <span class="n">uint</span> <span class="n">m_last_dc_val</span><span class="p">[</span><span class="n">JPGD_MAX_COMPONENTS</span><span class="p">];</span>
<a name="gbab-245"></a>    <span class="n">jpgd_block_t</span><span class="o">*</span> <span class="n">m_pMCU_coefficients</span><span class="p">;</span>
<a name="gbab-246"></a>    <span class="kt">int</span> <span class="n">m_mcu_block_max_zag</span><span class="p">[</span><span class="n">JPGD_MAX_BLOCKS_PER_MCU</span><span class="p">];</span>
<a name="gbab-247"></a>    <span class="n">uint8</span><span class="o">*</span> <span class="n">m_pSample_buf</span><span class="p">;</span>
<a name="gbab-248"></a>    <span class="kt">int</span> <span class="n">m_crr</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
<a name="gbab-249"></a>    <span class="kt">int</span> <span class="n">m_cbb</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
<a name="gbab-250"></a>    <span class="kt">int</span> <span class="n">m_crg</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
<a name="gbab-251"></a>    <span class="kt">int</span> <span class="n">m_cbg</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
<a name="gbab-252"></a>    <span class="n">uint8</span><span class="o">*</span> <span class="n">m_pScan_line_0</span><span class="p">;</span>
<a name="gbab-253"></a>    <span class="n">uint8</span><span class="o">*</span> <span class="n">m_pScan_line_1</span><span class="p">;</span>
<a name="gbab-254"></a>    <span class="n">jpgd_status</span> <span class="n">m_error_code</span><span class="p">;</span>
<a name="gbab-255"></a>    <span class="kt">bool</span> <span class="n">m_ready_flag</span><span class="p">;</span>
<a name="gbab-256"></a>    <span class="kt">int</span> <span class="n">m_total_bytes_read</span><span class="p">;</span>
<a name="gbab-257"></a>
<a name="gbab-258"></a>    <span class="kt">void</span> <span class="nf">free_all_blocks</span><span class="p">();</span>
<a name="gbab-259"></a>    <span class="n">JPGD_NORETURN</span> <span class="kt">void</span> <span class="nf">stop_decoding</span><span class="p">(</span><span class="n">jpgd_status</span> <span class="n">status</span><span class="p">);</span>
<a name="gbab-260"></a>    <span class="kt">void</span> <span class="o">*</span><span class="nf">alloc</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">n</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">zero</span> <span class="o">=</span> <span class="nb">false</span><span class="p">);</span>
<a name="gbab-261"></a>    <span class="kt">void</span> <span class="nf">word_clear</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="n">uint16</span> <span class="n">c</span><span class="p">,</span> <span class="n">uint</span> <span class="n">n</span><span class="p">);</span>
<a name="gbab-262"></a>    <span class="kt">void</span> <span class="nf">prep_in_buffer</span><span class="p">();</span>
<a name="gbab-263"></a>    <span class="kt">void</span> <span class="nf">read_dht_marker</span><span class="p">();</span>
<a name="gbab-264"></a>    <span class="kt">void</span> <span class="nf">read_dqt_marker</span><span class="p">();</span>
<a name="gbab-265"></a>    <span class="kt">void</span> <span class="nf">read_sof_marker</span><span class="p">();</span>
<a name="gbab-266"></a>    <span class="kt">void</span> <span class="nf">skip_variable_marker</span><span class="p">();</span>
<a name="gbab-267"></a>    <span class="kt">void</span> <span class="nf">read_dri_marker</span><span class="p">();</span>
<a name="gbab-268"></a>    <span class="kt">void</span> <span class="nf">read_sos_marker</span><span class="p">();</span>
<a name="gbab-269"></a>    <span class="kt">int</span> <span class="nf">next_marker</span><span class="p">();</span>
<a name="gbab-270"></a>    <span class="kt">int</span> <span class="nf">process_markers</span><span class="p">();</span>
<a name="gbab-271"></a>    <span class="kt">void</span> <span class="nf">locate_soi_marker</span><span class="p">();</span>
<a name="gbab-272"></a>    <span class="kt">void</span> <span class="nf">locate_sof_marker</span><span class="p">();</span>
<a name="gbab-273"></a>    <span class="kt">int</span> <span class="nf">locate_sos_marker</span><span class="p">();</span>
<a name="gbab-274"></a>    <span class="kt">void</span> <span class="nf">init</span><span class="p">(</span><span class="n">jpeg_decoder_stream</span> <span class="o">*</span> <span class="n">pStream</span><span class="p">);</span>
<a name="gbab-275"></a>    <span class="kt">void</span> <span class="nf">create_look_ups</span><span class="p">();</span>
<a name="gbab-276"></a>    <span class="kt">void</span> <span class="nf">fix_in_buffer</span><span class="p">();</span>
<a name="gbab-277"></a>    <span class="kt">void</span> <span class="nf">transform_mcu</span><span class="p">(</span><span class="kt">int</span> <span class="n">mcu_row</span><span class="p">);</span>
<a name="gbab-278"></a>    <span class="kt">void</span> <span class="nf">transform_mcu_expand</span><span class="p">(</span><span class="kt">int</span> <span class="n">mcu_row</span><span class="p">);</span>
<a name="gbab-279"></a>    <span class="n">coeff_buf</span><span class="o">*</span> <span class="nf">coeff_buf_open</span><span class="p">(</span><span class="kt">int</span> <span class="n">block_num_x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">block_num_y</span><span class="p">,</span> <span class="kt">int</span> <span class="n">block_len_x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">block_len_y</span><span class="p">);</span>
<a name="gbab-280"></a>    <span class="kr">inline</span> <span class="n">jpgd_block_t</span> <span class="o">*</span><span class="nf">coeff_buf_getp</span><span class="p">(</span><span class="n">coeff_buf</span> <span class="o">*</span><span class="n">cb</span><span class="p">,</span> <span class="kt">int</span> <span class="n">block_x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">block_y</span><span class="p">);</span>
<a name="gbab-281"></a>    <span class="kt">void</span> <span class="nf">load_next_row</span><span class="p">();</span>
<a name="gbab-282"></a>    <span class="kt">void</span> <span class="nf">decode_next_row</span><span class="p">();</span>
<a name="gbab-283"></a>    <span class="kt">void</span> <span class="nf">make_huff_table</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">,</span> <span class="n">huff_tables</span> <span class="o">*</span><span class="n">pH</span><span class="p">);</span>
<a name="gbab-284"></a>    <span class="kt">void</span> <span class="nf">check_quant_tables</span><span class="p">();</span>
<a name="gbab-285"></a>    <span class="kt">void</span> <span class="nf">check_huff_tables</span><span class="p">();</span>
<a name="gbab-286"></a>    <span class="kt">void</span> <span class="nf">calc_mcu_block_order</span><span class="p">();</span>
<a name="gbab-287"></a>    <span class="kt">int</span> <span class="nf">init_scan</span><span class="p">();</span>
<a name="gbab-288"></a>    <span class="kt">void</span> <span class="nf">init_frame</span><span class="p">();</span>
<a name="gbab-289"></a>    <span class="kt">void</span> <span class="nf">process_restart</span><span class="p">();</span>
<a name="gbab-290"></a>    <span class="kt">void</span> <span class="nf">decode_scan</span><span class="p">(</span><span class="n">pDecode_block_func</span> <span class="n">decode_block_func</span><span class="p">);</span>
<a name="gbab-291"></a>    <span class="kt">void</span> <span class="nf">init_progressive</span><span class="p">();</span>
<a name="gbab-292"></a>    <span class="kt">void</span> <span class="nf">init_sequential</span><span class="p">();</span>
<a name="gbab-293"></a>    <span class="kt">void</span> <span class="nf">decode_start</span><span class="p">();</span>
<a name="gbab-294"></a>    <span class="kt">void</span> <span class="nf">decode_init</span><span class="p">(</span><span class="n">jpeg_decoder_stream</span> <span class="o">*</span> <span class="n">pStream</span><span class="p">);</span>
<a name="gbab-295"></a>    <span class="kt">void</span> <span class="nf">H2V2Convert</span><span class="p">();</span>
<a name="gbab-296"></a>    <span class="kt">void</span> <span class="nf">H2V1Convert</span><span class="p">();</span>
<a name="gbab-297"></a>    <span class="kt">void</span> <span class="nf">H1V2Convert</span><span class="p">();</span>
<a name="gbab-298"></a>    <span class="kt">void</span> <span class="nf">H1V1Convert</span><span class="p">();</span>
<a name="gbab-299"></a>    <span class="kt">void</span> <span class="nf">gray_convert</span><span class="p">();</span>
<a name="gbab-300"></a>    <span class="kt">void</span> <span class="nf">expanded_convert</span><span class="p">();</span>
<a name="gbab-301"></a>    <span class="kt">void</span> <span class="nf">find_eoi</span><span class="p">();</span>
<a name="gbab-302"></a>    <span class="kr">inline</span> <span class="n">uint</span> <span class="nf">get_char</span><span class="p">();</span>
<a name="gbab-303"></a>    <span class="kr">inline</span> <span class="n">uint</span> <span class="nf">get_char</span><span class="p">(</span><span class="kt">bool</span> <span class="o">*</span><span class="n">pPadding_flag</span><span class="p">);</span>
<a name="gbab-304"></a>    <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">stuff_char</span><span class="p">(</span><span class="n">uint8</span> <span class="n">q</span><span class="p">);</span>
<a name="gbab-305"></a>    <span class="kr">inline</span> <span class="n">uint8</span> <span class="nf">get_octet</span><span class="p">();</span>
<a name="gbab-306"></a>    <span class="kr">inline</span> <span class="n">uint</span> <span class="nf">get_bits</span><span class="p">(</span><span class="kt">int</span> <span class="n">num_bits</span><span class="p">);</span>
<a name="gbab-307"></a>    <span class="kr">inline</span> <span class="n">uint</span> <span class="nf">get_bits_no_markers</span><span class="p">(</span><span class="kt">int</span> <span class="n">numbits</span><span class="p">);</span>
<a name="gbab-308"></a>    <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">huff_decode</span><span class="p">(</span><span class="n">huff_tables</span> <span class="o">*</span><span class="n">pH</span><span class="p">);</span>
<a name="gbab-309"></a>    <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">huff_decode</span><span class="p">(</span><span class="n">huff_tables</span> <span class="o">*</span><span class="n">pH</span><span class="p">,</span> <span class="kt">int</span><span class="o">&amp;</span> <span class="n">extrabits</span><span class="p">);</span>
<a name="gbab-310"></a>    <span class="k">static</span> <span class="kr">inline</span> <span class="n">uint8</span> <span class="nf">clamp</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">);</span>
<a name="gbab-311"></a>    <span class="k">static</span> <span class="kt">void</span> <span class="nf">decode_block_dc_first</span><span class="p">(</span><span class="n">jpeg_decoder</span> <span class="o">*</span><span class="n">pD</span><span class="p">,</span> <span class="kt">int</span> <span class="n">component_id</span><span class="p">,</span> <span class="kt">int</span> <span class="n">block_x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">block_y</span><span class="p">);</span>
<a name="gbab-312"></a>    <span class="k">static</span> <span class="kt">void</span> <span class="nf">decode_block_dc_refine</span><span class="p">(</span><span class="n">jpeg_decoder</span> <span class="o">*</span><span class="n">pD</span><span class="p">,</span> <span class="kt">int</span> <span class="n">component_id</span><span class="p">,</span> <span class="kt">int</span> <span class="n">block_x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">block_y</span><span class="p">);</span>
<a name="gbab-313"></a>    <span class="k">static</span> <span class="kt">void</span> <span class="nf">decode_block_ac_first</span><span class="p">(</span><span class="n">jpeg_decoder</span> <span class="o">*</span><span class="n">pD</span><span class="p">,</span> <span class="kt">int</span> <span class="n">component_id</span><span class="p">,</span> <span class="kt">int</span> <span class="n">block_x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">block_y</span><span class="p">);</span>
<a name="gbab-314"></a>    <span class="k">static</span> <span class="kt">void</span> <span class="nf">decode_block_ac_refine</span><span class="p">(</span><span class="n">jpeg_decoder</span> <span class="o">*</span><span class="n">pD</span><span class="p">,</span> <span class="kt">int</span> <span class="n">component_id</span><span class="p">,</span> <span class="kt">int</span> <span class="n">block_x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">block_y</span><span class="p">);</span>
<a name="gbab-315"></a>  <span class="p">};</span>
<a name="gbab-316"></a>  
<a name="gbab-317"></a><span class="p">}</span> <span class="c1">// namespace jpgd</span>
<a name="gbab-318"></a>
<a name="gbab-319"></a><span class="cp">#endif </span><span class="c1">// JPEG_DECODER_H</span>
</pre></div>
</td></tr></table>
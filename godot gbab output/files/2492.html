<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527</pre></div></td><td class="code"><div class="highlight"><pre><span></span><a name="gbab-1"></a><span class="c1">// Copyright 2011 Google Inc. All Rights Reserved.</span>
<a name="gbab-2"></a><span class="c1">//</span>
<a name="gbab-3"></a><span class="c1">// Use of this source code is governed by a BSD-style license</span>
<a name="gbab-4"></a><span class="c1">// that can be found in the COPYING file in the root of the source</span>
<a name="gbab-5"></a><span class="c1">// tree. An additional intellectual property rights grant can be found</span>
<a name="gbab-6"></a><span class="c1">// in the file PATENTS. All contributing project authors may</span>
<a name="gbab-7"></a><span class="c1">// be found in the AUTHORS file in the root of the source tree.</span>
<a name="gbab-8"></a><span class="c1">// -----------------------------------------------------------------------------</span>
<a name="gbab-9"></a><span class="c1">//</span>
<a name="gbab-10"></a><span class="c1">//   WebP encoder: main interface</span>
<a name="gbab-11"></a><span class="c1">//</span>
<a name="gbab-12"></a><span class="c1">// Author: Skal (pascal.massimino@gmail.com)</span>
<a name="gbab-13"></a>
<a name="gbab-14"></a><span class="cp">#ifndef WEBP_WEBP_ENCODE_H_</span>
<a name="gbab-15"></a><span class="cp">#define WEBP_WEBP_ENCODE_H_</span>
<a name="gbab-16"></a>
<a name="gbab-17"></a><span class="cp">#include</span> <span class="cpf">&quot;./types.h&quot;</span><span class="cp"></span>
<a name="gbab-18"></a>
<a name="gbab-19"></a><span class="cp">#ifdef __cplusplus</span>
<a name="gbab-20"></a><span class="k">extern</span> <span class="s">&quot;C&quot;</span> <span class="p">{</span>
<a name="gbab-21"></a><span class="cp">#endif</span>
<a name="gbab-22"></a>
<a name="gbab-23"></a><span class="cp">#define WEBP_ENCODER_ABI_VERSION 0x0209    </span><span class="c1">// MAJOR(8b) + MINOR(8b)</span>
<a name="gbab-24"></a>
<a name="gbab-25"></a><span class="c1">// Note: forward declaring enumerations is not allowed in (strict) C and C++,</span>
<a name="gbab-26"></a><span class="c1">// the types are left here for reference.</span>
<a name="gbab-27"></a><span class="c1">// typedef enum WebPImageHint WebPImageHint;</span>
<a name="gbab-28"></a><span class="c1">// typedef enum WebPEncCSP WebPEncCSP;</span>
<a name="gbab-29"></a><span class="c1">// typedef enum WebPPreset WebPPreset;</span>
<a name="gbab-30"></a><span class="c1">// typedef enum WebPEncodingError WebPEncodingError;</span>
<a name="gbab-31"></a><span class="k">typedef</span> <span class="k">struct</span> <span class="n">WebPConfig</span> <span class="n">WebPConfig</span><span class="p">;</span>
<a name="gbab-32"></a><span class="k">typedef</span> <span class="k">struct</span> <span class="n">WebPPicture</span> <span class="n">WebPPicture</span><span class="p">;</span>   <span class="c1">// main structure for I/O</span>
<a name="gbab-33"></a><span class="k">typedef</span> <span class="k">struct</span> <span class="n">WebPAuxStats</span> <span class="n">WebPAuxStats</span><span class="p">;</span>
<a name="gbab-34"></a><span class="k">typedef</span> <span class="k">struct</span> <span class="n">WebPMemoryWriter</span> <span class="n">WebPMemoryWriter</span><span class="p">;</span>
<a name="gbab-35"></a>
<a name="gbab-36"></a><span class="c1">// Return the encoder&#39;s version number, packed in hexadecimal using 8bits for</span>
<a name="gbab-37"></a><span class="c1">// each of major/minor/revision. E.g: v2.5.7 is 0x020507.</span>
<a name="gbab-38"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">WebPGetEncoderVersion</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<a name="gbab-39"></a>
<a name="gbab-40"></a><span class="c1">//------------------------------------------------------------------------------</span>
<a name="gbab-41"></a><span class="c1">// One-stop-shop call! No questions asked:</span>
<a name="gbab-42"></a>
<a name="gbab-43"></a><span class="c1">// Returns the size of the compressed data (pointed to by *output), or 0 if</span>
<a name="gbab-44"></a><span class="c1">// an error occurred. The compressed data must be released by the caller</span>
<a name="gbab-45"></a><span class="c1">// using the call &#39;WebPFree(*output)&#39;.</span>
<a name="gbab-46"></a><span class="c1">// These functions compress using the lossy format, and the quality_factor</span>
<a name="gbab-47"></a><span class="c1">// can go from 0 (smaller output, lower quality) to 100 (best quality,</span>
<a name="gbab-48"></a><span class="c1">// larger output).</span>
<a name="gbab-49"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">size_t</span><span class="p">)</span> <span class="n">WebPEncodeRGB</span><span class="p">(</span><span class="k">const</span> <span class="kt">uint8_t</span><span class="o">*</span> <span class="n">rgb</span><span class="p">,</span>
<a name="gbab-50"></a>                                  <span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">,</span> <span class="kt">int</span> <span class="n">stride</span><span class="p">,</span>
<a name="gbab-51"></a>                                  <span class="kt">float</span> <span class="n">quality_factor</span><span class="p">,</span> <span class="kt">uint8_t</span><span class="o">**</span> <span class="n">output</span><span class="p">);</span>
<a name="gbab-52"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">size_t</span><span class="p">)</span> <span class="n">WebPEncodeBGR</span><span class="p">(</span><span class="k">const</span> <span class="kt">uint8_t</span><span class="o">*</span> <span class="n">bgr</span><span class="p">,</span>
<a name="gbab-53"></a>                                  <span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">,</span> <span class="kt">int</span> <span class="n">stride</span><span class="p">,</span>
<a name="gbab-54"></a>                                  <span class="kt">float</span> <span class="n">quality_factor</span><span class="p">,</span> <span class="kt">uint8_t</span><span class="o">**</span> <span class="n">output</span><span class="p">);</span>
<a name="gbab-55"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">size_t</span><span class="p">)</span> <span class="n">WebPEncodeRGBA</span><span class="p">(</span><span class="k">const</span> <span class="kt">uint8_t</span><span class="o">*</span> <span class="n">rgba</span><span class="p">,</span>
<a name="gbab-56"></a>                                   <span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">,</span> <span class="kt">int</span> <span class="n">stride</span><span class="p">,</span>
<a name="gbab-57"></a>                                   <span class="kt">float</span> <span class="n">quality_factor</span><span class="p">,</span> <span class="kt">uint8_t</span><span class="o">**</span> <span class="n">output</span><span class="p">);</span>
<a name="gbab-58"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">size_t</span><span class="p">)</span> <span class="n">WebPEncodeBGRA</span><span class="p">(</span><span class="k">const</span> <span class="kt">uint8_t</span><span class="o">*</span> <span class="n">bgra</span><span class="p">,</span>
<a name="gbab-59"></a>                                   <span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">,</span> <span class="kt">int</span> <span class="n">stride</span><span class="p">,</span>
<a name="gbab-60"></a>                                   <span class="kt">float</span> <span class="n">quality_factor</span><span class="p">,</span> <span class="kt">uint8_t</span><span class="o">**</span> <span class="n">output</span><span class="p">);</span>
<a name="gbab-61"></a>
<a name="gbab-62"></a><span class="c1">// These functions are the equivalent of the above, but compressing in a</span>
<a name="gbab-63"></a><span class="c1">// lossless manner. Files are usually larger than lossy format, but will</span>
<a name="gbab-64"></a><span class="c1">// not suffer any compression loss.</span>
<a name="gbab-65"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">size_t</span><span class="p">)</span> <span class="n">WebPEncodeLosslessRGB</span><span class="p">(</span><span class="k">const</span> <span class="kt">uint8_t</span><span class="o">*</span> <span class="n">rgb</span><span class="p">,</span>
<a name="gbab-66"></a>                                          <span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">,</span> <span class="kt">int</span> <span class="n">stride</span><span class="p">,</span>
<a name="gbab-67"></a>                                          <span class="kt">uint8_t</span><span class="o">**</span> <span class="n">output</span><span class="p">);</span>
<a name="gbab-68"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">size_t</span><span class="p">)</span> <span class="n">WebPEncodeLosslessBGR</span><span class="p">(</span><span class="k">const</span> <span class="kt">uint8_t</span><span class="o">*</span> <span class="n">bgr</span><span class="p">,</span>
<a name="gbab-69"></a>                                          <span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">,</span> <span class="kt">int</span> <span class="n">stride</span><span class="p">,</span>
<a name="gbab-70"></a>                                          <span class="kt">uint8_t</span><span class="o">**</span> <span class="n">output</span><span class="p">);</span>
<a name="gbab-71"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">size_t</span><span class="p">)</span> <span class="n">WebPEncodeLosslessRGBA</span><span class="p">(</span><span class="k">const</span> <span class="kt">uint8_t</span><span class="o">*</span> <span class="n">rgba</span><span class="p">,</span>
<a name="gbab-72"></a>                                           <span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">,</span> <span class="kt">int</span> <span class="n">stride</span><span class="p">,</span>
<a name="gbab-73"></a>                                           <span class="kt">uint8_t</span><span class="o">**</span> <span class="n">output</span><span class="p">);</span>
<a name="gbab-74"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">size_t</span><span class="p">)</span> <span class="n">WebPEncodeLosslessBGRA</span><span class="p">(</span><span class="k">const</span> <span class="kt">uint8_t</span><span class="o">*</span> <span class="n">bgra</span><span class="p">,</span>
<a name="gbab-75"></a>                                           <span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">,</span> <span class="kt">int</span> <span class="n">stride</span><span class="p">,</span>
<a name="gbab-76"></a>                                           <span class="kt">uint8_t</span><span class="o">**</span> <span class="n">output</span><span class="p">);</span>
<a name="gbab-77"></a>
<a name="gbab-78"></a><span class="c1">// Releases memory returned by the WebPEncode*() functions above.</span>
<a name="gbab-79"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="n">WebPFree</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">ptr</span><span class="p">);</span>
<a name="gbab-80"></a>
<a name="gbab-81"></a><span class="c1">//------------------------------------------------------------------------------</span>
<a name="gbab-82"></a><span class="c1">// Coding parameters</span>
<a name="gbab-83"></a>
<a name="gbab-84"></a><span class="c1">// Image characteristics hint for the underlying encoder.</span>
<a name="gbab-85"></a><span class="k">typedef</span> <span class="k">enum</span> <span class="n">WebPImageHint</span> <span class="p">{</span>
<a name="gbab-86"></a>  <span class="n">WEBP_HINT_DEFAULT</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1">// default preset.</span>
<a name="gbab-87"></a>  <span class="n">WEBP_HINT_PICTURE</span><span class="p">,</span>      <span class="c1">// digital picture, like portrait, inner shot</span>
<a name="gbab-88"></a>  <span class="n">WEBP_HINT_PHOTO</span><span class="p">,</span>        <span class="c1">// outdoor photograph, with natural lighting</span>
<a name="gbab-89"></a>  <span class="n">WEBP_HINT_GRAPH</span><span class="p">,</span>        <span class="c1">// Discrete tone image (graph, map-tile etc).</span>
<a name="gbab-90"></a>  <span class="n">WEBP_HINT_LAST</span>
<a name="gbab-91"></a><span class="p">}</span> <span class="n">WebPImageHint</span><span class="p">;</span>
<a name="gbab-92"></a>
<a name="gbab-93"></a><span class="c1">// Compression parameters.</span>
<a name="gbab-94"></a><span class="k">struct</span> <span class="n">WebPConfig</span> <span class="p">{</span>
<a name="gbab-95"></a>  <span class="kt">int</span> <span class="n">lossless</span><span class="p">;</span>           <span class="c1">// Lossless encoding (0=lossy(default), 1=lossless).</span>
<a name="gbab-96"></a>  <span class="kt">float</span> <span class="n">quality</span><span class="p">;</span>          <span class="c1">// between 0 (smallest file) and 100 (biggest)</span>
<a name="gbab-97"></a>  <span class="kt">int</span> <span class="n">method</span><span class="p">;</span>             <span class="c1">// quality/speed trade-off (0=fast, 6=slower-better)</span>
<a name="gbab-98"></a>
<a name="gbab-99"></a>  <span class="n">WebPImageHint</span> <span class="n">image_hint</span><span class="p">;</span>  <span class="c1">// Hint for image type (lossless only for now).</span>
<a name="gbab-100"></a>
<a name="gbab-101"></a>  <span class="c1">// Parameters related to lossy compression only:</span>
<a name="gbab-102"></a>  <span class="kt">int</span> <span class="n">target_size</span><span class="p">;</span>        <span class="c1">// if non-zero, set the desired target size in bytes.</span>
<a name="gbab-103"></a>                          <span class="c1">// Takes precedence over the &#39;compression&#39; parameter.</span>
<a name="gbab-104"></a>  <span class="kt">float</span> <span class="n">target_PSNR</span><span class="p">;</span>      <span class="c1">// if non-zero, specifies the minimal distortion to</span>
<a name="gbab-105"></a>                          <span class="c1">// try to achieve. Takes precedence over target_size.</span>
<a name="gbab-106"></a>  <span class="kt">int</span> <span class="n">segments</span><span class="p">;</span>           <span class="c1">// maximum number of segments to use, in [1..4]</span>
<a name="gbab-107"></a>  <span class="kt">int</span> <span class="n">sns_strength</span><span class="p">;</span>       <span class="c1">// Spatial Noise Shaping. 0=off, 100=maximum.</span>
<a name="gbab-108"></a>  <span class="kt">int</span> <span class="n">filter_strength</span><span class="p">;</span>    <span class="c1">// range: [0 = off .. 100 = strongest]</span>
<a name="gbab-109"></a>  <span class="kt">int</span> <span class="n">filter_sharpness</span><span class="p">;</span>   <span class="c1">// range: [0 = off .. 7 = least sharp]</span>
<a name="gbab-110"></a>  <span class="kt">int</span> <span class="n">filter_type</span><span class="p">;</span>        <span class="c1">// filtering type: 0 = simple, 1 = strong (only used</span>
<a name="gbab-111"></a>                          <span class="c1">// if filter_strength &gt; 0 or autofilter &gt; 0)</span>
<a name="gbab-112"></a>  <span class="kt">int</span> <span class="n">autofilter</span><span class="p">;</span>         <span class="c1">// Auto adjust filter&#39;s strength [0 = off, 1 = on]</span>
<a name="gbab-113"></a>  <span class="kt">int</span> <span class="n">alpha_compression</span><span class="p">;</span>  <span class="c1">// Algorithm for encoding the alpha plane (0 = none,</span>
<a name="gbab-114"></a>                          <span class="c1">// 1 = compressed with WebP lossless). Default is 1.</span>
<a name="gbab-115"></a>  <span class="kt">int</span> <span class="n">alpha_filtering</span><span class="p">;</span>    <span class="c1">// Predictive filtering method for alpha plane.</span>
<a name="gbab-116"></a>                          <span class="c1">//  0: none, 1: fast, 2: best. Default if 1.</span>
<a name="gbab-117"></a>  <span class="kt">int</span> <span class="n">alpha_quality</span><span class="p">;</span>      <span class="c1">// Between 0 (smallest size) and 100 (lossless).</span>
<a name="gbab-118"></a>                          <span class="c1">// Default is 100.</span>
<a name="gbab-119"></a>  <span class="kt">int</span> <span class="n">pass</span><span class="p">;</span>               <span class="c1">// number of entropy-analysis passes (in [1..10]).</span>
<a name="gbab-120"></a>
<a name="gbab-121"></a>  <span class="kt">int</span> <span class="n">show_compressed</span><span class="p">;</span>    <span class="c1">// if true, export the compressed picture back.</span>
<a name="gbab-122"></a>                          <span class="c1">// In-loop filtering is not applied.</span>
<a name="gbab-123"></a>  <span class="kt">int</span> <span class="n">preprocessing</span><span class="p">;</span>      <span class="c1">// preprocessing filter:</span>
<a name="gbab-124"></a>                          <span class="c1">// 0=none, 1=segment-smooth, 2=pseudo-random dithering</span>
<a name="gbab-125"></a>  <span class="kt">int</span> <span class="n">partitions</span><span class="p">;</span>         <span class="c1">// log2(number of token partitions) in [0..3]. Default</span>
<a name="gbab-126"></a>                          <span class="c1">// is set to 0 for easier progressive decoding.</span>
<a name="gbab-127"></a>  <span class="kt">int</span> <span class="n">partition_limit</span><span class="p">;</span>    <span class="c1">// quality degradation allowed to fit the 512k limit</span>
<a name="gbab-128"></a>                          <span class="c1">// on prediction modes coding (0: no degradation,</span>
<a name="gbab-129"></a>                          <span class="c1">// 100: maximum possible degradation).</span>
<a name="gbab-130"></a>  <span class="kt">int</span> <span class="n">emulate_jpeg_size</span><span class="p">;</span>  <span class="c1">// If true, compression parameters will be remapped</span>
<a name="gbab-131"></a>                          <span class="c1">// to better match the expected output size from</span>
<a name="gbab-132"></a>                          <span class="c1">// JPEG compression. Generally, the output size will</span>
<a name="gbab-133"></a>                          <span class="c1">// be similar but the degradation will be lower.</span>
<a name="gbab-134"></a>  <span class="kt">int</span> <span class="n">thread_level</span><span class="p">;</span>       <span class="c1">// If non-zero, try and use multi-threaded encoding.</span>
<a name="gbab-135"></a>  <span class="kt">int</span> <span class="n">low_memory</span><span class="p">;</span>         <span class="c1">// If set, reduce memory usage (but increase CPU use).</span>
<a name="gbab-136"></a>
<a name="gbab-137"></a>  <span class="kt">int</span> <span class="n">near_lossless</span><span class="p">;</span>      <span class="c1">// Near lossless encoding [0 = max loss .. 100 = off</span>
<a name="gbab-138"></a>                          <span class="c1">// (default)].</span>
<a name="gbab-139"></a>  <span class="kt">int</span> <span class="n">exact</span><span class="p">;</span>              <span class="c1">// if non-zero, preserve the exact RGB values under</span>
<a name="gbab-140"></a>                          <span class="c1">// transparent area. Otherwise, discard this invisible</span>
<a name="gbab-141"></a>                          <span class="c1">// RGB information for better compression. The default</span>
<a name="gbab-142"></a>                          <span class="c1">// value is 0.</span>
<a name="gbab-143"></a>
<a name="gbab-144"></a><span class="cp">#ifdef WEBP_EXPERIMENTAL_FEATURES</span>
<a name="gbab-145"></a>  <span class="kt">int</span> <span class="n">delta_palettization</span><span class="p">;</span>
<a name="gbab-146"></a>  <span class="kt">uint32_t</span> <span class="n">pad</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>        <span class="c1">// padding for later use</span>
<a name="gbab-147"></a><span class="cp">#else</span>
<a name="gbab-148"></a>  <span class="kt">uint32_t</span> <span class="n">pad</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>        <span class="c1">// padding for later use</span>
<a name="gbab-149"></a><span class="cp">#endif  </span><span class="c1">// WEBP_EXPERIMENTAL_FEATURES</span>
<a name="gbab-150"></a><span class="p">};</span>
<a name="gbab-151"></a>
<a name="gbab-152"></a><span class="c1">// Enumerate some predefined settings for WebPConfig, depending on the type</span>
<a name="gbab-153"></a><span class="c1">// of source picture. These presets are used when calling WebPConfigPreset().</span>
<a name="gbab-154"></a><span class="k">typedef</span> <span class="k">enum</span> <span class="n">WebPPreset</span> <span class="p">{</span>
<a name="gbab-155"></a>  <span class="n">WEBP_PRESET_DEFAULT</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1">// default preset.</span>
<a name="gbab-156"></a>  <span class="n">WEBP_PRESET_PICTURE</span><span class="p">,</span>      <span class="c1">// digital picture, like portrait, inner shot</span>
<a name="gbab-157"></a>  <span class="n">WEBP_PRESET_PHOTO</span><span class="p">,</span>        <span class="c1">// outdoor photograph, with natural lighting</span>
<a name="gbab-158"></a>  <span class="n">WEBP_PRESET_DRAWING</span><span class="p">,</span>      <span class="c1">// hand or line drawing, with high-contrast details</span>
<a name="gbab-159"></a>  <span class="n">WEBP_PRESET_ICON</span><span class="p">,</span>         <span class="c1">// small-sized colorful images</span>
<a name="gbab-160"></a>  <span class="n">WEBP_PRESET_TEXT</span>          <span class="c1">// text-like</span>
<a name="gbab-161"></a><span class="p">}</span> <span class="n">WebPPreset</span><span class="p">;</span>
<a name="gbab-162"></a>
<a name="gbab-163"></a><span class="c1">// Internal, version-checked, entry point</span>
<a name="gbab-164"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">WebPConfigInitInternal</span><span class="p">(</span><span class="n">WebPConfig</span><span class="o">*</span><span class="p">,</span> <span class="n">WebPPreset</span><span class="p">,</span> <span class="kt">float</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<a name="gbab-165"></a>
<a name="gbab-166"></a><span class="c1">// Should always be called, to initialize a fresh WebPConfig structure before</span>
<a name="gbab-167"></a><span class="c1">// modification. Returns false in case of version mismatch. WebPConfigInit()</span>
<a name="gbab-168"></a><span class="c1">// must have succeeded before using the &#39;config&#39; object.</span>
<a name="gbab-169"></a><span class="c1">// Note that the default values are lossless=0 and quality=75.</span>
<a name="gbab-170"></a><span class="k">static</span> <span class="n">WEBP_INLINE</span> <span class="kt">int</span> <span class="nf">WebPConfigInit</span><span class="p">(</span><span class="n">WebPConfig</span><span class="o">*</span> <span class="n">config</span><span class="p">)</span> <span class="p">{</span>
<a name="gbab-171"></a>  <span class="k">return</span> <span class="n">WebPConfigInitInternal</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">WEBP_PRESET_DEFAULT</span><span class="p">,</span> <span class="mf">75.f</span><span class="p">,</span>
<a name="gbab-172"></a>                                <span class="n">WEBP_ENCODER_ABI_VERSION</span><span class="p">);</span>
<a name="gbab-173"></a><span class="p">}</span>
<a name="gbab-174"></a>
<a name="gbab-175"></a><span class="c1">// This function will initialize the configuration according to a predefined</span>
<a name="gbab-176"></a><span class="c1">// set of parameters (referred to by &#39;preset&#39;) and a given quality factor.</span>
<a name="gbab-177"></a><span class="c1">// This function can be called as a replacement to WebPConfigInit(). Will</span>
<a name="gbab-178"></a><span class="c1">// return false in case of error.</span>
<a name="gbab-179"></a><span class="k">static</span> <span class="n">WEBP_INLINE</span> <span class="kt">int</span> <span class="nf">WebPConfigPreset</span><span class="p">(</span><span class="n">WebPConfig</span><span class="o">*</span> <span class="n">config</span><span class="p">,</span>
<a name="gbab-180"></a>                                        <span class="n">WebPPreset</span> <span class="n">preset</span><span class="p">,</span> <span class="kt">float</span> <span class="n">quality</span><span class="p">)</span> <span class="p">{</span>
<a name="gbab-181"></a>  <span class="k">return</span> <span class="n">WebPConfigInitInternal</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">preset</span><span class="p">,</span> <span class="n">quality</span><span class="p">,</span>
<a name="gbab-182"></a>                                <span class="n">WEBP_ENCODER_ABI_VERSION</span><span class="p">);</span>
<a name="gbab-183"></a><span class="p">}</span>
<a name="gbab-184"></a>
<a name="gbab-185"></a><span class="c1">// Activate the lossless compression mode with the desired efficiency level</span>
<a name="gbab-186"></a><span class="c1">// between 0 (fastest, lowest compression) and 9 (slower, best compression).</span>
<a name="gbab-187"></a><span class="c1">// A good default level is &#39;6&#39;, providing a fair tradeoff between compression</span>
<a name="gbab-188"></a><span class="c1">// speed and final compressed size.</span>
<a name="gbab-189"></a><span class="c1">// This function will overwrite several fields from config: &#39;method&#39;, &#39;quality&#39;</span>
<a name="gbab-190"></a><span class="c1">// and &#39;lossless&#39;. Returns false in case of parameter error.</span>
<a name="gbab-191"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">WebPConfigLosslessPreset</span><span class="p">(</span><span class="n">WebPConfig</span><span class="o">*</span> <span class="n">config</span><span class="p">,</span> <span class="kt">int</span> <span class="n">level</span><span class="p">);</span>
<a name="gbab-192"></a>
<a name="gbab-193"></a><span class="c1">// Returns true if &#39;config&#39; is non-NULL and all configuration parameters are</span>
<a name="gbab-194"></a><span class="c1">// within their valid ranges.</span>
<a name="gbab-195"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">WebPValidateConfig</span><span class="p">(</span><span class="k">const</span> <span class="n">WebPConfig</span><span class="o">*</span> <span class="n">config</span><span class="p">);</span>
<a name="gbab-196"></a>
<a name="gbab-197"></a><span class="c1">//------------------------------------------------------------------------------</span>
<a name="gbab-198"></a><span class="c1">// Input / Output</span>
<a name="gbab-199"></a><span class="c1">// Structure for storing auxiliary statistics (mostly for lossy encoding).</span>
<a name="gbab-200"></a>
<a name="gbab-201"></a><span class="k">struct</span> <span class="n">WebPAuxStats</span> <span class="p">{</span>
<a name="gbab-202"></a>  <span class="kt">int</span> <span class="n">coded_size</span><span class="p">;</span>         <span class="c1">// final size</span>
<a name="gbab-203"></a>
<a name="gbab-204"></a>  <span class="kt">float</span> <span class="n">PSNR</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>          <span class="c1">// peak-signal-to-noise ratio for Y/U/V/All/Alpha</span>
<a name="gbab-205"></a>  <span class="kt">int</span> <span class="n">block_count</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>     <span class="c1">// number of intra4/intra16/skipped macroblocks</span>
<a name="gbab-206"></a>  <span class="kt">int</span> <span class="n">header_bytes</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>    <span class="c1">// approximate number of bytes spent for header</span>
<a name="gbab-207"></a>                          <span class="c1">// and mode-partition #0</span>
<a name="gbab-208"></a>  <span class="kt">int</span> <span class="n">residual_bytes</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">4</span><span class="p">];</span>  <span class="c1">// approximate number of bytes spent for</span>
<a name="gbab-209"></a>                             <span class="c1">// DC/AC/uv coefficients for each (0..3) segments.</span>
<a name="gbab-210"></a>  <span class="kt">int</span> <span class="n">segment_size</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>    <span class="c1">// number of macroblocks in each segments</span>
<a name="gbab-211"></a>  <span class="kt">int</span> <span class="n">segment_quant</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>   <span class="c1">// quantizer values for each segments</span>
<a name="gbab-212"></a>  <span class="kt">int</span> <span class="n">segment_level</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>   <span class="c1">// filtering strength for each segments [0..63]</span>
<a name="gbab-213"></a>
<a name="gbab-214"></a>  <span class="kt">int</span> <span class="n">alpha_data_size</span><span class="p">;</span>    <span class="c1">// size of the transparency data</span>
<a name="gbab-215"></a>  <span class="kt">int</span> <span class="n">layer_data_size</span><span class="p">;</span>    <span class="c1">// size of the enhancement layer data</span>
<a name="gbab-216"></a>
<a name="gbab-217"></a>  <span class="c1">// lossless encoder statistics</span>
<a name="gbab-218"></a>  <span class="kt">uint32_t</span> <span class="n">lossless_features</span><span class="p">;</span>  <span class="c1">// bit0:predictor bit1:cross-color transform</span>
<a name="gbab-219"></a>                               <span class="c1">// bit2:subtract-green bit3:color indexing</span>
<a name="gbab-220"></a>  <span class="kt">int</span> <span class="n">histogram_bits</span><span class="p">;</span>          <span class="c1">// number of precision bits of histogram</span>
<a name="gbab-221"></a>  <span class="kt">int</span> <span class="n">transform_bits</span><span class="p">;</span>          <span class="c1">// precision bits for transform</span>
<a name="gbab-222"></a>  <span class="kt">int</span> <span class="n">cache_bits</span><span class="p">;</span>              <span class="c1">// number of bits for color cache lookup</span>
<a name="gbab-223"></a>  <span class="kt">int</span> <span class="n">palette_size</span><span class="p">;</span>            <span class="c1">// number of color in palette, if used</span>
<a name="gbab-224"></a>  <span class="kt">int</span> <span class="n">lossless_size</span><span class="p">;</span>           <span class="c1">// final lossless size</span>
<a name="gbab-225"></a>  <span class="kt">int</span> <span class="n">lossless_hdr_size</span><span class="p">;</span>       <span class="c1">// lossless header (transform, huffman etc) size</span>
<a name="gbab-226"></a>  <span class="kt">int</span> <span class="n">lossless_data_size</span><span class="p">;</span>      <span class="c1">// lossless image data size</span>
<a name="gbab-227"></a>
<a name="gbab-228"></a>  <span class="kt">uint32_t</span> <span class="n">pad</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>        <span class="c1">// padding for later use</span>
<a name="gbab-229"></a><span class="p">};</span>
<a name="gbab-230"></a>
<a name="gbab-231"></a><span class="c1">// Signature for output function. Should return true if writing was successful.</span>
<a name="gbab-232"></a><span class="c1">// data/data_size is the segment of data to write, and &#39;picture&#39; is for</span>
<a name="gbab-233"></a><span class="c1">// reference (and so one can make use of picture-&gt;custom_ptr).</span>
<a name="gbab-234"></a><span class="k">typedef</span> <span class="nf">int</span> <span class="p">(</span><span class="o">*</span><span class="n">WebPWriterFunction</span><span class="p">)(</span><span class="k">const</span> <span class="kt">uint8_t</span><span class="o">*</span> <span class="n">data</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">data_size</span><span class="p">,</span>
<a name="gbab-235"></a>                                  <span class="k">const</span> <span class="n">WebPPicture</span><span class="o">*</span> <span class="n">picture</span><span class="p">);</span>
<a name="gbab-236"></a>
<a name="gbab-237"></a><span class="c1">// WebPMemoryWrite: a special WebPWriterFunction that writes to memory using</span>
<a name="gbab-238"></a><span class="c1">// the following WebPMemoryWriter object (to be set as a custom_ptr).</span>
<a name="gbab-239"></a><span class="k">struct</span> <span class="n">WebPMemoryWriter</span> <span class="p">{</span>
<a name="gbab-240"></a>  <span class="kt">uint8_t</span><span class="o">*</span> <span class="n">mem</span><span class="p">;</span>       <span class="c1">// final buffer (of size &#39;max_size&#39;, larger than &#39;size&#39;).</span>
<a name="gbab-241"></a>  <span class="kt">size_t</span>   <span class="n">size</span><span class="p">;</span>      <span class="c1">// final size</span>
<a name="gbab-242"></a>  <span class="kt">size_t</span>   <span class="n">max_size</span><span class="p">;</span>  <span class="c1">// total capacity</span>
<a name="gbab-243"></a>  <span class="kt">uint32_t</span> <span class="n">pad</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>    <span class="c1">// padding for later use</span>
<a name="gbab-244"></a><span class="p">};</span>
<a name="gbab-245"></a>
<a name="gbab-246"></a><span class="c1">// The following must be called first before any use.</span>
<a name="gbab-247"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="n">WebPMemoryWriterInit</span><span class="p">(</span><span class="n">WebPMemoryWriter</span><span class="o">*</span> <span class="n">writer</span><span class="p">);</span>
<a name="gbab-248"></a>
<a name="gbab-249"></a><span class="c1">// The following must be called to deallocate writer-&gt;mem memory. The &#39;writer&#39;</span>
<a name="gbab-250"></a><span class="c1">// object itself is not deallocated.</span>
<a name="gbab-251"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="n">WebPMemoryWriterClear</span><span class="p">(</span><span class="n">WebPMemoryWriter</span><span class="o">*</span> <span class="n">writer</span><span class="p">);</span>
<a name="gbab-252"></a><span class="c1">// The custom writer to be used with WebPMemoryWriter as custom_ptr. Upon</span>
<a name="gbab-253"></a><span class="c1">// completion, writer.mem and writer.size will hold the coded data.</span>
<a name="gbab-254"></a><span class="c1">// writer.mem must be freed by calling WebPMemoryWriterClear.</span>
<a name="gbab-255"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">WebPMemoryWrite</span><span class="p">(</span><span class="k">const</span> <span class="kt">uint8_t</span><span class="o">*</span> <span class="n">data</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">data_size</span><span class="p">,</span>
<a name="gbab-256"></a>                                 <span class="k">const</span> <span class="n">WebPPicture</span><span class="o">*</span> <span class="n">picture</span><span class="p">);</span>
<a name="gbab-257"></a>
<a name="gbab-258"></a><span class="c1">// Progress hook, called from time to time to report progress. It can return</span>
<a name="gbab-259"></a><span class="c1">// false to request an abort of the encoding process, or true otherwise if</span>
<a name="gbab-260"></a><span class="c1">// everything is OK.</span>
<a name="gbab-261"></a><span class="k">typedef</span> <span class="nf">int</span> <span class="p">(</span><span class="o">*</span><span class="n">WebPProgressHook</span><span class="p">)(</span><span class="kt">int</span> <span class="n">percent</span><span class="p">,</span> <span class="k">const</span> <span class="n">WebPPicture</span><span class="o">*</span> <span class="n">picture</span><span class="p">);</span>
<a name="gbab-262"></a>
<a name="gbab-263"></a><span class="c1">// Color spaces.</span>
<a name="gbab-264"></a><span class="k">typedef</span> <span class="k">enum</span> <span class="n">WebPEncCSP</span> <span class="p">{</span>
<a name="gbab-265"></a>  <span class="c1">// chroma sampling</span>
<a name="gbab-266"></a>  <span class="n">WEBP_YUV420</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>   <span class="c1">// 4:2:0</span>
<a name="gbab-267"></a>  <span class="n">WEBP_YUV420A</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>        <span class="c1">// alpha channel variant</span>
<a name="gbab-268"></a>  <span class="n">WEBP_CSP_UV_MASK</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>   <span class="c1">// bit-mask to get the UV sampling factors</span>
<a name="gbab-269"></a>  <span class="n">WEBP_CSP_ALPHA_BIT</span> <span class="o">=</span> <span class="mi">4</span>   <span class="c1">// bit that is set if alpha is present</span>
<a name="gbab-270"></a><span class="p">}</span> <span class="n">WebPEncCSP</span><span class="p">;</span>
<a name="gbab-271"></a>
<a name="gbab-272"></a><span class="c1">// Encoding error conditions.</span>
<a name="gbab-273"></a><span class="k">typedef</span> <span class="k">enum</span> <span class="n">WebPEncodingError</span> <span class="p">{</span>
<a name="gbab-274"></a>  <span class="n">VP8_ENC_OK</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<a name="gbab-275"></a>  <span class="n">VP8_ENC_ERROR_OUT_OF_MEMORY</span><span class="p">,</span>            <span class="c1">// memory error allocating objects</span>
<a name="gbab-276"></a>  <span class="n">VP8_ENC_ERROR_BITSTREAM_OUT_OF_MEMORY</span><span class="p">,</span>  <span class="c1">// memory error while flushing bits</span>
<a name="gbab-277"></a>  <span class="n">VP8_ENC_ERROR_NULL_PARAMETER</span><span class="p">,</span>           <span class="c1">// a pointer parameter is NULL</span>
<a name="gbab-278"></a>  <span class="n">VP8_ENC_ERROR_INVALID_CONFIGURATION</span><span class="p">,</span>    <span class="c1">// configuration is invalid</span>
<a name="gbab-279"></a>  <span class="n">VP8_ENC_ERROR_BAD_DIMENSION</span><span class="p">,</span>            <span class="c1">// picture has invalid width/height</span>
<a name="gbab-280"></a>  <span class="n">VP8_ENC_ERROR_PARTITION0_OVERFLOW</span><span class="p">,</span>      <span class="c1">// partition is bigger than 512k</span>
<a name="gbab-281"></a>  <span class="n">VP8_ENC_ERROR_PARTITION_OVERFLOW</span><span class="p">,</span>       <span class="c1">// partition is bigger than 16M</span>
<a name="gbab-282"></a>  <span class="n">VP8_ENC_ERROR_BAD_WRITE</span><span class="p">,</span>                <span class="c1">// error while flushing bytes</span>
<a name="gbab-283"></a>  <span class="n">VP8_ENC_ERROR_FILE_TOO_BIG</span><span class="p">,</span>             <span class="c1">// file is bigger than 4G</span>
<a name="gbab-284"></a>  <span class="n">VP8_ENC_ERROR_USER_ABORT</span><span class="p">,</span>               <span class="c1">// abort request by user</span>
<a name="gbab-285"></a>  <span class="n">VP8_ENC_ERROR_LAST</span>                      <span class="c1">// list terminator. always last.</span>
<a name="gbab-286"></a><span class="p">}</span> <span class="n">WebPEncodingError</span><span class="p">;</span>
<a name="gbab-287"></a>
<a name="gbab-288"></a><span class="c1">// maximum width/height allowed (inclusive), in pixels</span>
<a name="gbab-289"></a><span class="cp">#define WEBP_MAX_DIMENSION 16383</span>
<a name="gbab-290"></a>
<a name="gbab-291"></a><span class="c1">// Main exchange structure (input samples, output bytes, statistics)</span>
<a name="gbab-292"></a><span class="k">struct</span> <span class="n">WebPPicture</span> <span class="p">{</span>
<a name="gbab-293"></a>  <span class="c1">//   INPUT</span>
<a name="gbab-294"></a>  <span class="c1">//////////////</span>
<a name="gbab-295"></a>  <span class="c1">// Main flag for encoder selecting between ARGB or YUV input.</span>
<a name="gbab-296"></a>  <span class="c1">// It is recommended to use ARGB input (*argb, argb_stride) for lossless</span>
<a name="gbab-297"></a>  <span class="c1">// compression, and YUV input (*y, *u, *v, etc.) for lossy compression</span>
<a name="gbab-298"></a>  <span class="c1">// since these are the respective native colorspace for these formats.</span>
<a name="gbab-299"></a>  <span class="kt">int</span> <span class="n">use_argb</span><span class="p">;</span>
<a name="gbab-300"></a>
<a name="gbab-301"></a>  <span class="c1">// YUV input (mostly used for input to lossy compression)</span>
<a name="gbab-302"></a>  <span class="n">WebPEncCSP</span> <span class="n">colorspace</span><span class="p">;</span>     <span class="c1">// colorspace: should be YUV420 for now (=Y&#39;CbCr).</span>
<a name="gbab-303"></a>  <span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">;</span>         <span class="c1">// dimensions (less or equal to WEBP_MAX_DIMENSION)</span>
<a name="gbab-304"></a>  <span class="kt">uint8_t</span> <span class="o">*</span><span class="n">y</span><span class="p">,</span> <span class="o">*</span><span class="n">u</span><span class="p">,</span> <span class="o">*</span><span class="n">v</span><span class="p">;</span>        <span class="c1">// pointers to luma/chroma planes.</span>
<a name="gbab-305"></a>  <span class="kt">int</span> <span class="n">y_stride</span><span class="p">,</span> <span class="n">uv_stride</span><span class="p">;</span>   <span class="c1">// luma/chroma strides.</span>
<a name="gbab-306"></a>  <span class="kt">uint8_t</span><span class="o">*</span> <span class="n">a</span><span class="p">;</span>                <span class="c1">// pointer to the alpha plane</span>
<a name="gbab-307"></a>  <span class="kt">int</span> <span class="n">a_stride</span><span class="p">;</span>              <span class="c1">// stride of the alpha plane</span>
<a name="gbab-308"></a>  <span class="kt">uint32_t</span> <span class="n">pad1</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>          <span class="c1">// padding for later use</span>
<a name="gbab-309"></a>
<a name="gbab-310"></a>  <span class="c1">// ARGB input (mostly used for input to lossless compression)</span>
<a name="gbab-311"></a>  <span class="kt">uint32_t</span><span class="o">*</span> <span class="n">argb</span><span class="p">;</span>            <span class="c1">// Pointer to argb (32 bit) plane.</span>
<a name="gbab-312"></a>  <span class="kt">int</span> <span class="n">argb_stride</span><span class="p">;</span>           <span class="c1">// This is stride in pixels units, not bytes.</span>
<a name="gbab-313"></a>  <span class="kt">uint32_t</span> <span class="n">pad2</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>          <span class="c1">// padding for later use</span>
<a name="gbab-314"></a>
<a name="gbab-315"></a>  <span class="c1">//   OUTPUT</span>
<a name="gbab-316"></a>  <span class="c1">///////////////</span>
<a name="gbab-317"></a>  <span class="c1">// Byte-emission hook, to store compressed bytes as they are ready.</span>
<a name="gbab-318"></a>  <span class="n">WebPWriterFunction</span> <span class="n">writer</span><span class="p">;</span>  <span class="c1">// can be NULL</span>
<a name="gbab-319"></a>  <span class="kt">void</span><span class="o">*</span> <span class="n">custom_ptr</span><span class="p">;</span>           <span class="c1">// can be used by the writer.</span>
<a name="gbab-320"></a>
<a name="gbab-321"></a>  <span class="c1">// map for extra information (only for lossy compression mode)</span>
<a name="gbab-322"></a>  <span class="kt">int</span> <span class="n">extra_info_type</span><span class="p">;</span>    <span class="c1">// 1: intra type, 2: segment, 3: quant</span>
<a name="gbab-323"></a>                          <span class="c1">// 4: intra-16 prediction mode,</span>
<a name="gbab-324"></a>                          <span class="c1">// 5: chroma prediction mode,</span>
<a name="gbab-325"></a>                          <span class="c1">// 6: bit cost, 7: distortion</span>
<a name="gbab-326"></a>  <span class="kt">uint8_t</span><span class="o">*</span> <span class="n">extra_info</span><span class="p">;</span>    <span class="c1">// if not NULL, points to an array of size</span>
<a name="gbab-327"></a>                          <span class="c1">// ((width + 15) / 16) * ((height + 15) / 16) that</span>
<a name="gbab-328"></a>                          <span class="c1">// will be filled with a macroblock map, depending</span>
<a name="gbab-329"></a>                          <span class="c1">// on extra_info_type.</span>
<a name="gbab-330"></a>
<a name="gbab-331"></a>  <span class="c1">//   STATS AND REPORTS</span>
<a name="gbab-332"></a>  <span class="c1">///////////////////////////</span>
<a name="gbab-333"></a>  <span class="c1">// Pointer to side statistics (updated only if not NULL)</span>
<a name="gbab-334"></a>  <span class="n">WebPAuxStats</span><span class="o">*</span> <span class="n">stats</span><span class="p">;</span>
<a name="gbab-335"></a>
<a name="gbab-336"></a>  <span class="c1">// Error code for the latest error encountered during encoding</span>
<a name="gbab-337"></a>  <span class="n">WebPEncodingError</span> <span class="n">error_code</span><span class="p">;</span>
<a name="gbab-338"></a>
<a name="gbab-339"></a>  <span class="c1">// If not NULL, report progress during encoding.</span>
<a name="gbab-340"></a>  <span class="n">WebPProgressHook</span> <span class="n">progress_hook</span><span class="p">;</span>
<a name="gbab-341"></a>
<a name="gbab-342"></a>  <span class="kt">void</span><span class="o">*</span> <span class="n">user_data</span><span class="p">;</span>        <span class="c1">// this field is free to be set to any value and</span>
<a name="gbab-343"></a>                          <span class="c1">// used during callbacks (like progress-report e.g.).</span>
<a name="gbab-344"></a>
<a name="gbab-345"></a>  <span class="kt">uint32_t</span> <span class="n">pad3</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>       <span class="c1">// padding for later use</span>
<a name="gbab-346"></a>
<a name="gbab-347"></a>  <span class="c1">// Unused for now</span>
<a name="gbab-348"></a>  <span class="kt">uint8_t</span> <span class="o">*</span><span class="n">pad4</span><span class="p">,</span> <span class="o">*</span><span class="n">pad5</span><span class="p">;</span>
<a name="gbab-349"></a>  <span class="kt">uint32_t</span> <span class="n">pad6</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>       <span class="c1">// padding for later use</span>
<a name="gbab-350"></a>
<a name="gbab-351"></a>  <span class="c1">// PRIVATE FIELDS</span>
<a name="gbab-352"></a>  <span class="c1">////////////////////</span>
<a name="gbab-353"></a>  <span class="kt">void</span><span class="o">*</span> <span class="n">memory_</span><span class="p">;</span>          <span class="c1">// row chunk of memory for yuva planes</span>
<a name="gbab-354"></a>  <span class="kt">void</span><span class="o">*</span> <span class="n">memory_argb_</span><span class="p">;</span>     <span class="c1">// and for argb too.</span>
<a name="gbab-355"></a>  <span class="kt">void</span><span class="o">*</span> <span class="n">pad7</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>          <span class="c1">// padding for later use</span>
<a name="gbab-356"></a><span class="p">};</span>
<a name="gbab-357"></a>
<a name="gbab-358"></a><span class="c1">// Internal, version-checked, entry point</span>
<a name="gbab-359"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">WebPPictureInitInternal</span><span class="p">(</span><span class="n">WebPPicture</span><span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<a name="gbab-360"></a>
<a name="gbab-361"></a><span class="c1">// Should always be called, to initialize the structure. Returns false in case</span>
<a name="gbab-362"></a><span class="c1">// of version mismatch. WebPPictureInit() must have succeeded before using the</span>
<a name="gbab-363"></a><span class="c1">// &#39;picture&#39; object.</span>
<a name="gbab-364"></a><span class="c1">// Note that, by default, use_argb is false and colorspace is WEBP_YUV420.</span>
<a name="gbab-365"></a><span class="k">static</span> <span class="n">WEBP_INLINE</span> <span class="kt">int</span> <span class="nf">WebPPictureInit</span><span class="p">(</span><span class="n">WebPPicture</span><span class="o">*</span> <span class="n">picture</span><span class="p">)</span> <span class="p">{</span>
<a name="gbab-366"></a>  <span class="k">return</span> <span class="n">WebPPictureInitInternal</span><span class="p">(</span><span class="n">picture</span><span class="p">,</span> <span class="n">WEBP_ENCODER_ABI_VERSION</span><span class="p">);</span>
<a name="gbab-367"></a><span class="p">}</span>
<a name="gbab-368"></a>
<a name="gbab-369"></a><span class="c1">//------------------------------------------------------------------------------</span>
<a name="gbab-370"></a><span class="c1">// WebPPicture utils</span>
<a name="gbab-371"></a>
<a name="gbab-372"></a><span class="c1">// Convenience allocation / deallocation based on picture-&gt;width/height:</span>
<a name="gbab-373"></a><span class="c1">// Allocate y/u/v buffers as per colorspace/width/height specification.</span>
<a name="gbab-374"></a><span class="c1">// Note! This function will free the previous buffer if needed.</span>
<a name="gbab-375"></a><span class="c1">// Returns false in case of memory error.</span>
<a name="gbab-376"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">WebPPictureAlloc</span><span class="p">(</span><span class="n">WebPPicture</span><span class="o">*</span> <span class="n">picture</span><span class="p">);</span>
<a name="gbab-377"></a>
<a name="gbab-378"></a><span class="c1">// Release the memory allocated by WebPPictureAlloc() or WebPPictureImport*().</span>
<a name="gbab-379"></a><span class="c1">// Note that this function does _not_ free the memory used by the &#39;picture&#39;</span>
<a name="gbab-380"></a><span class="c1">// object itself.</span>
<a name="gbab-381"></a><span class="c1">// Besides memory (which is reclaimed) all other fields of &#39;picture&#39; are</span>
<a name="gbab-382"></a><span class="c1">// preserved.</span>
<a name="gbab-383"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="n">WebPPictureFree</span><span class="p">(</span><span class="n">WebPPicture</span><span class="o">*</span> <span class="n">picture</span><span class="p">);</span>
<a name="gbab-384"></a>
<a name="gbab-385"></a><span class="c1">// Copy the pixels of *src into *dst, using WebPPictureAlloc. Upon return, *dst</span>
<a name="gbab-386"></a><span class="c1">// will fully own the copied pixels (this is not a view). The &#39;dst&#39; picture need</span>
<a name="gbab-387"></a><span class="c1">// not be initialized as its content is overwritten.</span>
<a name="gbab-388"></a><span class="c1">// Returns false in case of memory allocation error.</span>
<a name="gbab-389"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">WebPPictureCopy</span><span class="p">(</span><span class="k">const</span> <span class="n">WebPPicture</span><span class="o">*</span> <span class="n">src</span><span class="p">,</span> <span class="n">WebPPicture</span><span class="o">*</span> <span class="n">dst</span><span class="p">);</span>
<a name="gbab-390"></a>
<a name="gbab-391"></a><span class="c1">// Compute PSNR, SSIM or LSIM distortion metric between two pictures. Results</span>
<a name="gbab-392"></a><span class="c1">// are in dB, stored in result[] in the Y/U/V/Alpha/All or B/G/R/A/All order.</span>
<a name="gbab-393"></a><span class="c1">// Returns false in case of error (src and ref don&#39;t have same dimension, ...)</span>
<a name="gbab-394"></a><span class="c1">// Warning: this function is rather CPU-intensive.</span>
<a name="gbab-395"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">WebPPictureDistortion</span><span class="p">(</span>
<a name="gbab-396"></a>    <span class="k">const</span> <span class="n">WebPPicture</span><span class="o">*</span> <span class="n">src</span><span class="p">,</span> <span class="k">const</span> <span class="n">WebPPicture</span><span class="o">*</span> <span class="n">ref</span><span class="p">,</span>
<a name="gbab-397"></a>    <span class="kt">int</span> <span class="n">metric_type</span><span class="p">,</span>           <span class="c1">// 0 = PSNR, 1 = SSIM, 2 = LSIM</span>
<a name="gbab-398"></a>    <span class="kt">float</span> <span class="n">result</span><span class="p">[</span><span class="mi">5</span><span class="p">]);</span>
<a name="gbab-399"></a>
<a name="gbab-400"></a><span class="c1">// self-crops a picture to the rectangle defined by top/left/width/height.</span>
<a name="gbab-401"></a><span class="c1">// Returns false in case of memory allocation error, or if the rectangle is</span>
<a name="gbab-402"></a><span class="c1">// outside of the source picture.</span>
<a name="gbab-403"></a><span class="c1">// The rectangle for the view is defined by the top-left corner pixel</span>
<a name="gbab-404"></a><span class="c1">// coordinates (left, top) as well as its width and height. This rectangle</span>
<a name="gbab-405"></a><span class="c1">// must be fully be comprised inside the &#39;src&#39; source picture. If the source</span>
<a name="gbab-406"></a><span class="c1">// picture uses the YUV420 colorspace, the top and left coordinates will be</span>
<a name="gbab-407"></a><span class="c1">// snapped to even values.</span>
<a name="gbab-408"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">WebPPictureCrop</span><span class="p">(</span><span class="n">WebPPicture</span><span class="o">*</span> <span class="n">picture</span><span class="p">,</span>
<a name="gbab-409"></a>                                 <span class="kt">int</span> <span class="n">left</span><span class="p">,</span> <span class="kt">int</span> <span class="n">top</span><span class="p">,</span> <span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">);</span>
<a name="gbab-410"></a>
<a name="gbab-411"></a><span class="c1">// Extracts a view from &#39;src&#39; picture into &#39;dst&#39;. The rectangle for the view</span>
<a name="gbab-412"></a><span class="c1">// is defined by the top-left corner pixel coordinates (left, top) as well</span>
<a name="gbab-413"></a><span class="c1">// as its width and height. This rectangle must be fully be comprised inside</span>
<a name="gbab-414"></a><span class="c1">// the &#39;src&#39; source picture. If the source picture uses the YUV420 colorspace,</span>
<a name="gbab-415"></a><span class="c1">// the top and left coordinates will be snapped to even values.</span>
<a name="gbab-416"></a><span class="c1">// Picture &#39;src&#39; must out-live &#39;dst&#39; picture. Self-extraction of view is allowed</span>
<a name="gbab-417"></a><span class="c1">// (&#39;src&#39; equal to &#39;dst&#39;) as a mean of fast-cropping (but note that doing so,</span>
<a name="gbab-418"></a><span class="c1">// the original dimension will be lost). Picture &#39;dst&#39; need not be initialized</span>
<a name="gbab-419"></a><span class="c1">// with WebPPictureInit() if it is different from &#39;src&#39;, since its content will</span>
<a name="gbab-420"></a><span class="c1">// be overwritten.</span>
<a name="gbab-421"></a><span class="c1">// Returns false in case of memory allocation error or invalid parameters.</span>
<a name="gbab-422"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">WebPPictureView</span><span class="p">(</span><span class="k">const</span> <span class="n">WebPPicture</span><span class="o">*</span> <span class="n">src</span><span class="p">,</span>
<a name="gbab-423"></a>                                 <span class="kt">int</span> <span class="n">left</span><span class="p">,</span> <span class="kt">int</span> <span class="n">top</span><span class="p">,</span> <span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">,</span>
<a name="gbab-424"></a>                                 <span class="n">WebPPicture</span><span class="o">*</span> <span class="n">dst</span><span class="p">);</span>
<a name="gbab-425"></a>
<a name="gbab-426"></a><span class="c1">// Returns true if the &#39;picture&#39; is actually a view and therefore does</span>
<a name="gbab-427"></a><span class="c1">// not own the memory for pixels.</span>
<a name="gbab-428"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">WebPPictureIsView</span><span class="p">(</span><span class="k">const</span> <span class="n">WebPPicture</span><span class="o">*</span> <span class="n">picture</span><span class="p">);</span>
<a name="gbab-429"></a>
<a name="gbab-430"></a><span class="c1">// Rescale a picture to new dimension width x height.</span>
<a name="gbab-431"></a><span class="c1">// If either &#39;width&#39; or &#39;height&#39; (but not both) is 0 the corresponding</span>
<a name="gbab-432"></a><span class="c1">// dimension will be calculated preserving the aspect ratio.</span>
<a name="gbab-433"></a><span class="c1">// No gamma correction is applied.</span>
<a name="gbab-434"></a><span class="c1">// Returns false in case of error (invalid parameter or insufficient memory).</span>
<a name="gbab-435"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">WebPPictureRescale</span><span class="p">(</span><span class="n">WebPPicture</span><span class="o">*</span> <span class="n">pic</span><span class="p">,</span> <span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">);</span>
<a name="gbab-436"></a>
<a name="gbab-437"></a><span class="c1">// Colorspace conversion function to import RGB samples.</span>
<a name="gbab-438"></a><span class="c1">// Previous buffer will be free&#39;d, if any.</span>
<a name="gbab-439"></a><span class="c1">// *rgb buffer should have a size of at least height * rgb_stride.</span>
<a name="gbab-440"></a><span class="c1">// Returns false in case of memory error.</span>
<a name="gbab-441"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">WebPPictureImportRGB</span><span class="p">(</span>
<a name="gbab-442"></a>    <span class="n">WebPPicture</span><span class="o">*</span> <span class="n">picture</span><span class="p">,</span> <span class="k">const</span> <span class="kt">uint8_t</span><span class="o">*</span> <span class="n">rgb</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rgb_stride</span><span class="p">);</span>
<a name="gbab-443"></a><span class="c1">// Same, but for RGBA buffer.</span>
<a name="gbab-444"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">WebPPictureImportRGBA</span><span class="p">(</span>
<a name="gbab-445"></a>    <span class="n">WebPPicture</span><span class="o">*</span> <span class="n">picture</span><span class="p">,</span> <span class="k">const</span> <span class="kt">uint8_t</span><span class="o">*</span> <span class="n">rgba</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rgba_stride</span><span class="p">);</span>
<a name="gbab-446"></a><span class="c1">// Same, but for RGBA buffer. Imports the RGB direct from the 32-bit format</span>
<a name="gbab-447"></a><span class="c1">// input buffer ignoring the alpha channel. Avoids needing to copy the data</span>
<a name="gbab-448"></a><span class="c1">// to a temporary 24-bit RGB buffer to import the RGB only.</span>
<a name="gbab-449"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">WebPPictureImportRGBX</span><span class="p">(</span>
<a name="gbab-450"></a>    <span class="n">WebPPicture</span><span class="o">*</span> <span class="n">picture</span><span class="p">,</span> <span class="k">const</span> <span class="kt">uint8_t</span><span class="o">*</span> <span class="n">rgbx</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rgbx_stride</span><span class="p">);</span>
<a name="gbab-451"></a>
<a name="gbab-452"></a><span class="c1">// Variants of the above, but taking BGR(A|X) input.</span>
<a name="gbab-453"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">WebPPictureImportBGR</span><span class="p">(</span>
<a name="gbab-454"></a>    <span class="n">WebPPicture</span><span class="o">*</span> <span class="n">picture</span><span class="p">,</span> <span class="k">const</span> <span class="kt">uint8_t</span><span class="o">*</span> <span class="n">bgr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">bgr_stride</span><span class="p">);</span>
<a name="gbab-455"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">WebPPictureImportBGRA</span><span class="p">(</span>
<a name="gbab-456"></a>    <span class="n">WebPPicture</span><span class="o">*</span> <span class="n">picture</span><span class="p">,</span> <span class="k">const</span> <span class="kt">uint8_t</span><span class="o">*</span> <span class="n">bgra</span><span class="p">,</span> <span class="kt">int</span> <span class="n">bgra_stride</span><span class="p">);</span>
<a name="gbab-457"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">WebPPictureImportBGRX</span><span class="p">(</span>
<a name="gbab-458"></a>    <span class="n">WebPPicture</span><span class="o">*</span> <span class="n">picture</span><span class="p">,</span> <span class="k">const</span> <span class="kt">uint8_t</span><span class="o">*</span> <span class="n">bgrx</span><span class="p">,</span> <span class="kt">int</span> <span class="n">bgrx_stride</span><span class="p">);</span>
<a name="gbab-459"></a>
<a name="gbab-460"></a><span class="c1">// Converts picture-&gt;argb data to the YUV420A format. The &#39;colorspace&#39;</span>
<a name="gbab-461"></a><span class="c1">// parameter is deprecated and should be equal to WEBP_YUV420.</span>
<a name="gbab-462"></a><span class="c1">// Upon return, picture-&gt;use_argb is set to false. The presence of real</span>
<a name="gbab-463"></a><span class="c1">// non-opaque transparent values is detected, and &#39;colorspace&#39; will be</span>
<a name="gbab-464"></a><span class="c1">// adjusted accordingly. Note that this method is lossy.</span>
<a name="gbab-465"></a><span class="c1">// Returns false in case of error.</span>
<a name="gbab-466"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">WebPPictureARGBToYUVA</span><span class="p">(</span><span class="n">WebPPicture</span><span class="o">*</span> <span class="n">picture</span><span class="p">,</span>
<a name="gbab-467"></a>                                       <span class="n">WebPEncCSP</span> <span class="cm">/*colorspace = WEBP_YUV420*/</span><span class="p">);</span>
<a name="gbab-468"></a>
<a name="gbab-469"></a><span class="c1">// Same as WebPPictureARGBToYUVA(), but the conversion is done using</span>
<a name="gbab-470"></a><span class="c1">// pseudo-random dithering with a strength &#39;dithering&#39; between</span>
<a name="gbab-471"></a><span class="c1">// 0.0 (no dithering) and 1.0 (maximum dithering). This is useful</span>
<a name="gbab-472"></a><span class="c1">// for photographic picture.</span>
<a name="gbab-473"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">WebPPictureARGBToYUVADithered</span><span class="p">(</span>
<a name="gbab-474"></a>    <span class="n">WebPPicture</span><span class="o">*</span> <span class="n">picture</span><span class="p">,</span> <span class="n">WebPEncCSP</span> <span class="n">colorspace</span><span class="p">,</span> <span class="kt">float</span> <span class="n">dithering</span><span class="p">);</span>
<a name="gbab-475"></a>
<a name="gbab-476"></a><span class="c1">// Performs &#39;smart&#39; RGBA-&gt;YUVA420 downsampling and colorspace conversion.</span>
<a name="gbab-477"></a><span class="c1">// Downsampling is handled with extra care in case of color clipping. This</span>
<a name="gbab-478"></a><span class="c1">// method is roughly 2x slower than WebPPictureARGBToYUVA() but produces better</span>
<a name="gbab-479"></a><span class="c1">// YUV representation.</span>
<a name="gbab-480"></a><span class="c1">// Returns false in case of error.</span>
<a name="gbab-481"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">WebPPictureSmartARGBToYUVA</span><span class="p">(</span><span class="n">WebPPicture</span><span class="o">*</span> <span class="n">picture</span><span class="p">);</span>
<a name="gbab-482"></a>
<a name="gbab-483"></a><span class="c1">// Converts picture-&gt;yuv to picture-&gt;argb and sets picture-&gt;use_argb to true.</span>
<a name="gbab-484"></a><span class="c1">// The input format must be YUV_420 or YUV_420A.</span>
<a name="gbab-485"></a><span class="c1">// Note that the use of this method is discouraged if one has access to the</span>
<a name="gbab-486"></a><span class="c1">// raw ARGB samples, since using YUV420 is comparatively lossy. Also, the</span>
<a name="gbab-487"></a><span class="c1">// conversion from YUV420 to ARGB incurs a small loss too.</span>
<a name="gbab-488"></a><span class="c1">// Returns false in case of error.</span>
<a name="gbab-489"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">WebPPictureYUVAToARGB</span><span class="p">(</span><span class="n">WebPPicture</span><span class="o">*</span> <span class="n">picture</span><span class="p">);</span>
<a name="gbab-490"></a>
<a name="gbab-491"></a><span class="c1">// Helper function: given a width x height plane of RGBA or YUV(A) samples</span>
<a name="gbab-492"></a><span class="c1">// clean-up the YUV or RGB samples under fully transparent area, to help</span>
<a name="gbab-493"></a><span class="c1">// compressibility (no guarantee, though).</span>
<a name="gbab-494"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="n">WebPCleanupTransparentArea</span><span class="p">(</span><span class="n">WebPPicture</span><span class="o">*</span> <span class="n">picture</span><span class="p">);</span>
<a name="gbab-495"></a>
<a name="gbab-496"></a><span class="c1">// Scan the picture &#39;picture&#39; for the presence of non fully opaque alpha values.</span>
<a name="gbab-497"></a><span class="c1">// Returns true in such case. Otherwise returns false (indicating that the</span>
<a name="gbab-498"></a><span class="c1">// alpha plane can be ignored altogether e.g.).</span>
<a name="gbab-499"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">WebPPictureHasTransparency</span><span class="p">(</span><span class="k">const</span> <span class="n">WebPPicture</span><span class="o">*</span> <span class="n">picture</span><span class="p">);</span>
<a name="gbab-500"></a>
<a name="gbab-501"></a><span class="c1">// Remove the transparency information (if present) by blending the color with</span>
<a name="gbab-502"></a><span class="c1">// the background color &#39;background_rgb&#39; (specified as 24bit RGB triplet).</span>
<a name="gbab-503"></a><span class="c1">// After this call, all alpha values are reset to 0xff.</span>
<a name="gbab-504"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="n">WebPBlendAlpha</span><span class="p">(</span><span class="n">WebPPicture</span><span class="o">*</span> <span class="n">pic</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">background_rgb</span><span class="p">);</span>
<a name="gbab-505"></a>
<a name="gbab-506"></a><span class="c1">//------------------------------------------------------------------------------</span>
<a name="gbab-507"></a><span class="c1">// Main call</span>
<a name="gbab-508"></a>
<a name="gbab-509"></a><span class="c1">// Main encoding call, after config and picture have been initialized.</span>
<a name="gbab-510"></a><span class="c1">// &#39;picture&#39; must be less than 16384x16384 in dimension (cf WEBP_MAX_DIMENSION),</span>
<a name="gbab-511"></a><span class="c1">// and the &#39;config&#39; object must be a valid one.</span>
<a name="gbab-512"></a><span class="c1">// Returns false in case of error, true otherwise.</span>
<a name="gbab-513"></a><span class="c1">// In case of error, picture-&gt;error_code is updated accordingly.</span>
<a name="gbab-514"></a><span class="c1">// &#39;picture&#39; can hold the source samples in both YUV(A) or ARGB input, depending</span>
<a name="gbab-515"></a><span class="c1">// on the value of &#39;picture-&gt;use_argb&#39;. It is highly recommended to use</span>
<a name="gbab-516"></a><span class="c1">// the former for lossy encoding, and the latter for lossless encoding</span>
<a name="gbab-517"></a><span class="c1">// (when config.lossless is true). Automatic conversion from one format to</span>
<a name="gbab-518"></a><span class="c1">// another is provided but they both incur some loss.</span>
<a name="gbab-519"></a><span class="n">WEBP_EXTERN</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">WebPEncode</span><span class="p">(</span><span class="k">const</span> <span class="n">WebPConfig</span><span class="o">*</span> <span class="n">config</span><span class="p">,</span> <span class="n">WebPPicture</span><span class="o">*</span> <span class="n">picture</span><span class="p">);</span>
<a name="gbab-520"></a>
<a name="gbab-521"></a><span class="c1">//------------------------------------------------------------------------------</span>
<a name="gbab-522"></a>
<a name="gbab-523"></a><span class="cp">#ifdef __cplusplus</span>
<a name="gbab-524"></a><span class="p">}</span>    <span class="c1">// extern &quot;C&quot;</span>
<a name="gbab-525"></a><span class="cp">#endif</span>
<a name="gbab-526"></a>
<a name="gbab-527"></a><span class="cp">#endif  </span><span class="cm">/* WEBP_WEBP_ENCODE_H_ */</span><span class="cp"></span>
</pre></div>
</td></tr></table>
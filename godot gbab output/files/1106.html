<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673
674
675
676
677
678
679
680
681
682
683
684
685
686
687
688
689
690
691
692
693
694
695
696
697
698
699
700
701
702
703
704
705
706
707
708
709
710
711
712
713
714
715
716
717
718
719
720
721
722
723
724
725
726
727
728
729
730
731
732
733
734
735
736
737
738
739
740
741
742
743
744
745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862</pre></div></td><td class="code"><div class="highlight"><pre><span></span><a name="gbab-1"></a><span class="cm">/* crypto/ts/ts.h */</span>
<a name="gbab-2"></a><span class="cm">/*</span>
<a name="gbab-3"></a><span class="cm"> * Written by Zoltan Glozik (zglozik@opentsa.org) for the OpenSSL project</span>
<a name="gbab-4"></a><span class="cm"> * 2002, 2003, 2004.</span>
<a name="gbab-5"></a><span class="cm"> */</span>
<a name="gbab-6"></a><span class="cm">/* ====================================================================</span>
<a name="gbab-7"></a><span class="cm"> * Copyright (c) 2006 The OpenSSL Project.  All rights reserved.</span>
<a name="gbab-8"></a><span class="cm"> *</span>
<a name="gbab-9"></a><span class="cm"> * Redistribution and use in source and binary forms, with or without</span>
<a name="gbab-10"></a><span class="cm"> * modification, are permitted provided that the following conditions</span>
<a name="gbab-11"></a><span class="cm"> * are met:</span>
<a name="gbab-12"></a><span class="cm"> *</span>
<a name="gbab-13"></a><span class="cm"> * 1. Redistributions of source code must retain the above copyright</span>
<a name="gbab-14"></a><span class="cm"> *    notice, this list of conditions and the following disclaimer. </span>
<a name="gbab-15"></a><span class="cm"> *</span>
<a name="gbab-16"></a><span class="cm"> * 2. Redistributions in binary form must reproduce the above copyright</span>
<a name="gbab-17"></a><span class="cm"> *    notice, this list of conditions and the following disclaimer in</span>
<a name="gbab-18"></a><span class="cm"> *    the documentation and/or other materials provided with the</span>
<a name="gbab-19"></a><span class="cm"> *    distribution.</span>
<a name="gbab-20"></a><span class="cm"> *</span>
<a name="gbab-21"></a><span class="cm"> * 3. All advertising materials mentioning features or use of this</span>
<a name="gbab-22"></a><span class="cm"> *    software must display the following acknowledgment:</span>
<a name="gbab-23"></a><span class="cm"> *    &quot;This product includes software developed by the OpenSSL Project</span>
<a name="gbab-24"></a><span class="cm"> *    for use in the OpenSSL Toolkit. (http://www.OpenSSL.org/)&quot;</span>
<a name="gbab-25"></a><span class="cm"> *</span>
<a name="gbab-26"></a><span class="cm"> * 4. The names &quot;OpenSSL Toolkit&quot; and &quot;OpenSSL Project&quot; must not be used to</span>
<a name="gbab-27"></a><span class="cm"> *    endorse or promote products derived from this software without</span>
<a name="gbab-28"></a><span class="cm"> *    prior written permission. For written permission, please contact</span>
<a name="gbab-29"></a><span class="cm"> *    licensing@OpenSSL.org.</span>
<a name="gbab-30"></a><span class="cm"> *</span>
<a name="gbab-31"></a><span class="cm"> * 5. Products derived from this software may not be called &quot;OpenSSL&quot;</span>
<a name="gbab-32"></a><span class="cm"> *    nor may &quot;OpenSSL&quot; appear in their names without prior written</span>
<a name="gbab-33"></a><span class="cm"> *    permission of the OpenSSL Project.</span>
<a name="gbab-34"></a><span class="cm"> *</span>
<a name="gbab-35"></a><span class="cm"> * 6. Redistributions of any form whatsoever must retain the following</span>
<a name="gbab-36"></a><span class="cm"> *    acknowledgment:</span>
<a name="gbab-37"></a><span class="cm"> *    &quot;This product includes software developed by the OpenSSL Project</span>
<a name="gbab-38"></a><span class="cm"> *    for use in the OpenSSL Toolkit (http://www.OpenSSL.org/)&quot;</span>
<a name="gbab-39"></a><span class="cm"> *</span>
<a name="gbab-40"></a><span class="cm"> * THIS SOFTWARE IS PROVIDED BY THE OpenSSL PROJECT ``AS IS&#39;&#39; AND ANY</span>
<a name="gbab-41"></a><span class="cm"> * EXPRESSED OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
<a name="gbab-42"></a><span class="cm"> * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR</span>
<a name="gbab-43"></a><span class="cm"> * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE OpenSSL PROJECT OR</span>
<a name="gbab-44"></a><span class="cm"> * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<a name="gbab-45"></a><span class="cm"> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT</span>
<a name="gbab-46"></a><span class="cm"> * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;</span>
<a name="gbab-47"></a><span class="cm"> * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)</span>
<a name="gbab-48"></a><span class="cm"> * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,</span>
<a name="gbab-49"></a><span class="cm"> * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</span>
<a name="gbab-50"></a><span class="cm"> * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED</span>
<a name="gbab-51"></a><span class="cm"> * OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="gbab-52"></a><span class="cm"> * ====================================================================</span>
<a name="gbab-53"></a><span class="cm"> *</span>
<a name="gbab-54"></a><span class="cm"> * This product includes cryptographic software written by Eric Young</span>
<a name="gbab-55"></a><span class="cm"> * (eay@cryptsoft.com).  This product includes software written by Tim</span>
<a name="gbab-56"></a><span class="cm"> * Hudson (tjh@cryptsoft.com).</span>
<a name="gbab-57"></a><span class="cm"> *</span>
<a name="gbab-58"></a><span class="cm"> */</span>
<a name="gbab-59"></a>
<a name="gbab-60"></a><span class="cp">#ifndef HEADER_TS_H</span>
<a name="gbab-61"></a><span class="cp">#define HEADER_TS_H</span>
<a name="gbab-62"></a>
<a name="gbab-63"></a><span class="cp">#include</span> <span class="cpf">&lt;openssl/opensslconf.h&gt;</span><span class="cp"></span>
<a name="gbab-64"></a><span class="cp">#include</span> <span class="cpf">&lt;openssl/symhacks.h&gt;</span><span class="cp"></span>
<a name="gbab-65"></a><span class="cp">#ifndef OPENSSL_NO_BUFFER</span>
<a name="gbab-66"></a><span class="cp">#include</span> <span class="cpf">&lt;openssl/buffer.h&gt;</span><span class="cp"></span>
<a name="gbab-67"></a><span class="cp">#endif</span>
<a name="gbab-68"></a><span class="cp">#ifndef OPENSSL_NO_EVP</span>
<a name="gbab-69"></a><span class="cp">#include</span> <span class="cpf">&lt;openssl/evp.h&gt;</span><span class="cp"></span>
<a name="gbab-70"></a><span class="cp">#endif</span>
<a name="gbab-71"></a><span class="cp">#ifndef OPENSSL_NO_BIO</span>
<a name="gbab-72"></a><span class="cp">#include</span> <span class="cpf">&lt;openssl/bio.h&gt;</span><span class="cp"></span>
<a name="gbab-73"></a><span class="cp">#endif</span>
<a name="gbab-74"></a><span class="cp">#include</span> <span class="cpf">&lt;openssl/stack.h&gt;</span><span class="cp"></span>
<a name="gbab-75"></a><span class="cp">#include</span> <span class="cpf">&lt;openssl/asn1.h&gt;</span><span class="cp"></span>
<a name="gbab-76"></a><span class="cp">#include</span> <span class="cpf">&lt;openssl/safestack.h&gt;</span><span class="cp"></span>
<a name="gbab-77"></a>
<a name="gbab-78"></a><span class="cp">#ifndef OPENSSL_NO_RSA</span>
<a name="gbab-79"></a><span class="cp">#include</span> <span class="cpf">&lt;openssl/rsa.h&gt;</span><span class="cp"></span>
<a name="gbab-80"></a><span class="cp">#endif</span>
<a name="gbab-81"></a>
<a name="gbab-82"></a><span class="cp">#ifndef OPENSSL_NO_DSA</span>
<a name="gbab-83"></a><span class="cp">#include</span> <span class="cpf">&lt;openssl/dsa.h&gt;</span><span class="cp"></span>
<a name="gbab-84"></a><span class="cp">#endif</span>
<a name="gbab-85"></a>
<a name="gbab-86"></a><span class="cp">#ifndef OPENSSL_NO_DH</span>
<a name="gbab-87"></a><span class="cp">#include</span> <span class="cpf">&lt;openssl/dh.h&gt;</span><span class="cp"></span>
<a name="gbab-88"></a><span class="cp">#endif</span>
<a name="gbab-89"></a>
<a name="gbab-90"></a><span class="cp">#ifdef  __cplusplus</span>
<a name="gbab-91"></a><span class="k">extern</span> <span class="s">&quot;C&quot;</span> <span class="p">{</span>
<a name="gbab-92"></a><span class="cp">#endif</span>
<a name="gbab-93"></a>
<a name="gbab-94"></a><span class="cp">#ifdef WIN32</span>
<a name="gbab-95"></a><span class="cm">/* Under Win32 this is defined in wincrypt.h */</span>
<a name="gbab-96"></a><span class="cp">#undef X509_NAME</span>
<a name="gbab-97"></a><span class="cp">#endif</span>
<a name="gbab-98"></a>
<a name="gbab-99"></a><span class="cp">#include</span> <span class="cpf">&lt;openssl/x509.h&gt;</span><span class="cp"></span>
<a name="gbab-100"></a><span class="cp">#include</span> <span class="cpf">&lt;openssl/x509v3.h&gt;</span><span class="cp"></span>
<a name="gbab-101"></a>
<a name="gbab-102"></a><span class="cm">/*-</span>
<a name="gbab-103"></a><span class="cm">MessageImprint ::= SEQUENCE  {</span>
<a name="gbab-104"></a><span class="cm">     hashAlgorithm                AlgorithmIdentifier,</span>
<a name="gbab-105"></a><span class="cm">     hashedMessage                OCTET STRING  }</span>
<a name="gbab-106"></a><span class="cm">*/</span>
<a name="gbab-107"></a>
<a name="gbab-108"></a><span class="k">typedef</span> <span class="k">struct</span> <span class="n">TS_msg_imprint_st</span> <span class="p">{</span>
<a name="gbab-109"></a>	<span class="n">X509_ALGOR</span> <span class="o">*</span><span class="n">hash_algo</span><span class="p">;</span>
<a name="gbab-110"></a>	<span class="n">ASN1_OCTET_STRING</span> <span class="o">*</span><span class="n">hashed_msg</span><span class="p">;</span>
<a name="gbab-111"></a>	<span class="p">}</span> <span class="n">TS_MSG_IMPRINT</span><span class="p">;</span>
<a name="gbab-112"></a>
<a name="gbab-113"></a><span class="cm">/*-</span>
<a name="gbab-114"></a><span class="cm">TimeStampReq ::= SEQUENCE  {</span>
<a name="gbab-115"></a><span class="cm">   version                  INTEGER  { v1(1) },</span>
<a name="gbab-116"></a><span class="cm">   messageImprint           MessageImprint,</span>
<a name="gbab-117"></a><span class="cm">     --a hash algorithm OID and the hash value of the data to be</span>
<a name="gbab-118"></a><span class="cm">     --time-stamped</span>
<a name="gbab-119"></a><span class="cm">   reqPolicy                TSAPolicyId                OPTIONAL,</span>
<a name="gbab-120"></a><span class="cm">   nonce                    INTEGER                    OPTIONAL,</span>
<a name="gbab-121"></a><span class="cm">   certReq                  BOOLEAN                    DEFAULT FALSE,</span>
<a name="gbab-122"></a><span class="cm">   extensions               [0] IMPLICIT Extensions    OPTIONAL  }</span>
<a name="gbab-123"></a><span class="cm">*/</span>
<a name="gbab-124"></a>
<a name="gbab-125"></a><span class="k">typedef</span> <span class="k">struct</span> <span class="n">TS_req_st</span> <span class="p">{</span>
<a name="gbab-126"></a>	<span class="n">ASN1_INTEGER</span> <span class="o">*</span><span class="n">version</span><span class="p">;</span>
<a name="gbab-127"></a>	<span class="n">TS_MSG_IMPRINT</span> <span class="o">*</span><span class="n">msg_imprint</span><span class="p">;</span>
<a name="gbab-128"></a>	<span class="n">ASN1_OBJECT</span> <span class="o">*</span><span class="n">policy_id</span><span class="p">;</span>		<span class="cm">/* OPTIONAL */</span>
<a name="gbab-129"></a>	<span class="n">ASN1_INTEGER</span> <span class="o">*</span><span class="n">nonce</span><span class="p">;</span>		<span class="cm">/* OPTIONAL */</span>
<a name="gbab-130"></a>	<span class="n">ASN1_BOOLEAN</span> <span class="n">cert_req</span><span class="p">;</span>		<span class="cm">/* DEFAULT FALSE */</span>
<a name="gbab-131"></a>	<span class="n">STACK_OF</span><span class="p">(</span><span class="n">X509_EXTENSION</span><span class="p">)</span> <span class="o">*</span><span class="n">extensions</span><span class="p">;</span>	<span class="cm">/* [0] OPTIONAL */</span>
<a name="gbab-132"></a>	<span class="p">}</span> <span class="n">TS_REQ</span><span class="p">;</span>
<a name="gbab-133"></a>
<a name="gbab-134"></a><span class="cm">/*-</span>
<a name="gbab-135"></a><span class="cm">Accuracy ::= SEQUENCE {</span>
<a name="gbab-136"></a><span class="cm">                seconds        INTEGER           OPTIONAL,</span>
<a name="gbab-137"></a><span class="cm">                millis     [0] INTEGER  (1..999) OPTIONAL,</span>
<a name="gbab-138"></a><span class="cm">                micros     [1] INTEGER  (1..999) OPTIONAL  }</span>
<a name="gbab-139"></a><span class="cm">*/</span>
<a name="gbab-140"></a>
<a name="gbab-141"></a><span class="k">typedef</span> <span class="k">struct</span> <span class="n">TS_accuracy_st</span> <span class="p">{</span>
<a name="gbab-142"></a>	<span class="n">ASN1_INTEGER</span> <span class="o">*</span><span class="n">seconds</span><span class="p">;</span>
<a name="gbab-143"></a>	<span class="n">ASN1_INTEGER</span> <span class="o">*</span><span class="n">millis</span><span class="p">;</span>
<a name="gbab-144"></a>	<span class="n">ASN1_INTEGER</span> <span class="o">*</span><span class="n">micros</span><span class="p">;</span>
<a name="gbab-145"></a>	<span class="p">}</span> <span class="n">TS_ACCURACY</span><span class="p">;</span>
<a name="gbab-146"></a>
<a name="gbab-147"></a><span class="cm">/*-</span>
<a name="gbab-148"></a><span class="cm">TSTInfo ::= SEQUENCE  {</span>
<a name="gbab-149"></a><span class="cm">    version                      INTEGER  { v1(1) },</span>
<a name="gbab-150"></a><span class="cm">    policy                       TSAPolicyId,</span>
<a name="gbab-151"></a><span class="cm">    messageImprint               MessageImprint,</span>
<a name="gbab-152"></a><span class="cm">      -- MUST have the same value as the similar field in</span>
<a name="gbab-153"></a><span class="cm">      -- TimeStampReq</span>
<a name="gbab-154"></a><span class="cm">    serialNumber                 INTEGER,</span>
<a name="gbab-155"></a><span class="cm">     -- Time-Stamping users MUST be ready to accommodate integers</span>
<a name="gbab-156"></a><span class="cm">     -- up to 160 bits.</span>
<a name="gbab-157"></a><span class="cm">    genTime                      GeneralizedTime,</span>
<a name="gbab-158"></a><span class="cm">    accuracy                     Accuracy                 OPTIONAL,</span>
<a name="gbab-159"></a><span class="cm">    ordering                     BOOLEAN             DEFAULT FALSE,</span>
<a name="gbab-160"></a><span class="cm">    nonce                        INTEGER                  OPTIONAL,</span>
<a name="gbab-161"></a><span class="cm">      -- MUST be present if the similar field was present</span>
<a name="gbab-162"></a><span class="cm">      -- in TimeStampReq.  In that case it MUST have the same value.</span>
<a name="gbab-163"></a><span class="cm">    tsa                          [0] GeneralName          OPTIONAL,</span>
<a name="gbab-164"></a><span class="cm">    extensions                   [1] IMPLICIT Extensions  OPTIONAL   }</span>
<a name="gbab-165"></a><span class="cm">*/</span>
<a name="gbab-166"></a>
<a name="gbab-167"></a><span class="k">typedef</span> <span class="k">struct</span> <span class="n">TS_tst_info_st</span> <span class="p">{</span>
<a name="gbab-168"></a>	<span class="n">ASN1_INTEGER</span> <span class="o">*</span><span class="n">version</span><span class="p">;</span>
<a name="gbab-169"></a>	<span class="n">ASN1_OBJECT</span> <span class="o">*</span><span class="n">policy_id</span><span class="p">;</span>
<a name="gbab-170"></a>	<span class="n">TS_MSG_IMPRINT</span> <span class="o">*</span><span class="n">msg_imprint</span><span class="p">;</span>
<a name="gbab-171"></a>	<span class="n">ASN1_INTEGER</span> <span class="o">*</span><span class="n">serial</span><span class="p">;</span>
<a name="gbab-172"></a>	<span class="n">ASN1_GENERALIZEDTIME</span> <span class="o">*</span><span class="n">time</span><span class="p">;</span>
<a name="gbab-173"></a>	<span class="n">TS_ACCURACY</span> <span class="o">*</span><span class="n">accuracy</span><span class="p">;</span>
<a name="gbab-174"></a>	<span class="n">ASN1_BOOLEAN</span> <span class="n">ordering</span><span class="p">;</span>
<a name="gbab-175"></a>	<span class="n">ASN1_INTEGER</span> <span class="o">*</span><span class="n">nonce</span><span class="p">;</span>
<a name="gbab-176"></a>	<span class="n">GENERAL_NAME</span> <span class="o">*</span><span class="n">tsa</span><span class="p">;</span>
<a name="gbab-177"></a>	<span class="n">STACK_OF</span><span class="p">(</span><span class="n">X509_EXTENSION</span><span class="p">)</span> <span class="o">*</span><span class="n">extensions</span><span class="p">;</span>
<a name="gbab-178"></a>	<span class="p">}</span> <span class="n">TS_TST_INFO</span><span class="p">;</span>	
<a name="gbab-179"></a>
<a name="gbab-180"></a><span class="cm">/*-</span>
<a name="gbab-181"></a><span class="cm">PKIStatusInfo ::= SEQUENCE {</span>
<a name="gbab-182"></a><span class="cm">    status        PKIStatus,</span>
<a name="gbab-183"></a><span class="cm">    statusString  PKIFreeText     OPTIONAL,</span>
<a name="gbab-184"></a><span class="cm">    failInfo      PKIFailureInfo  OPTIONAL  }</span>
<a name="gbab-185"></a>
<a name="gbab-186"></a><span class="cm">From RFC 1510 - section 3.1.1:</span>
<a name="gbab-187"></a><span class="cm">PKIFreeText ::= SEQUENCE SIZE (1..MAX) OF UTF8String</span>
<a name="gbab-188"></a><span class="cm">	-- text encoded as UTF-8 String (note:  each UTF8String SHOULD</span>
<a name="gbab-189"></a><span class="cm">	-- include an RFC 1766 language tag to indicate the language</span>
<a name="gbab-190"></a><span class="cm">	-- of the contained text)</span>
<a name="gbab-191"></a><span class="cm">*/</span>
<a name="gbab-192"></a>
<a name="gbab-193"></a><span class="cm">/* Possible values for status. See ts_resp_print.c &amp;&amp; ts_resp_verify.c. */</span>
<a name="gbab-194"></a>
<a name="gbab-195"></a><span class="cp">#define	TS_STATUS_GRANTED			0</span>
<a name="gbab-196"></a><span class="cp">#define	TS_STATUS_GRANTED_WITH_MODS		1</span>
<a name="gbab-197"></a><span class="cp">#define	TS_STATUS_REJECTION			2</span>
<a name="gbab-198"></a><span class="cp">#define	TS_STATUS_WAITING			3</span>
<a name="gbab-199"></a><span class="cp">#define	TS_STATUS_REVOCATION_WARNING		4</span>
<a name="gbab-200"></a><span class="cp">#define	TS_STATUS_REVOCATION_NOTIFICATION	5</span>
<a name="gbab-201"></a>
<a name="gbab-202"></a><span class="cm">/*</span>
<a name="gbab-203"></a><span class="cm"> * Possible values for failure_info. See ts_resp_print.c &amp;&amp; ts_resp_verify.c</span>
<a name="gbab-204"></a><span class="cm"> */</span>
<a name="gbab-205"></a>
<a name="gbab-206"></a><span class="cp">#define	TS_INFO_BAD_ALG			0</span>
<a name="gbab-207"></a><span class="cp">#define	TS_INFO_BAD_REQUEST		2</span>
<a name="gbab-208"></a><span class="cp">#define	TS_INFO_BAD_DATA_FORMAT		5</span>
<a name="gbab-209"></a><span class="cp">#define	TS_INFO_TIME_NOT_AVAILABLE	14</span>
<a name="gbab-210"></a><span class="cp">#define	TS_INFO_UNACCEPTED_POLICY	15</span>
<a name="gbab-211"></a><span class="cp">#define	TS_INFO_UNACCEPTED_EXTENSION	16</span>
<a name="gbab-212"></a><span class="cp">#define	TS_INFO_ADD_INFO_NOT_AVAILABLE	17</span>
<a name="gbab-213"></a><span class="cp">#define	TS_INFO_SYSTEM_FAILURE		25</span>
<a name="gbab-214"></a>
<a name="gbab-215"></a><span class="k">typedef</span> <span class="k">struct</span> <span class="n">TS_status_info_st</span> <span class="p">{</span>
<a name="gbab-216"></a>	<span class="n">ASN1_INTEGER</span> <span class="o">*</span><span class="n">status</span><span class="p">;</span>
<a name="gbab-217"></a>	<span class="n">STACK_OF</span><span class="p">(</span><span class="n">ASN1_UTF8STRING</span><span class="p">)</span> <span class="o">*</span><span class="n">text</span><span class="p">;</span>
<a name="gbab-218"></a>	<span class="n">ASN1_BIT_STRING</span> <span class="o">*</span><span class="n">failure_info</span><span class="p">;</span>
<a name="gbab-219"></a>	<span class="p">}</span> <span class="n">TS_STATUS_INFO</span><span class="p">;</span>
<a name="gbab-220"></a>
<a name="gbab-221"></a><span class="n">DECLARE_STACK_OF</span><span class="p">(</span><span class="n">ASN1_UTF8STRING</span><span class="p">)</span>
<a name="gbab-222"></a><span class="n">DECLARE_ASN1_SET_OF</span><span class="p">(</span><span class="n">ASN1_UTF8STRING</span><span class="p">)</span>
<a name="gbab-223"></a>
<a name="gbab-224"></a><span class="cm">/*-</span>
<a name="gbab-225"></a><span class="cm">TimeStampResp ::= SEQUENCE  {</span>
<a name="gbab-226"></a><span class="cm">     status                  PKIStatusInfo,</span>
<a name="gbab-227"></a><span class="cm">     timeStampToken          TimeStampToken     OPTIONAL }</span>
<a name="gbab-228"></a><span class="cm">*/</span>
<a name="gbab-229"></a>
<a name="gbab-230"></a><span class="k">typedef</span> <span class="k">struct</span> <span class="n">TS_resp_st</span> <span class="p">{</span>
<a name="gbab-231"></a>	<span class="n">TS_STATUS_INFO</span> <span class="o">*</span><span class="n">status_info</span><span class="p">;</span>
<a name="gbab-232"></a>	<span class="n">PKCS7</span> <span class="o">*</span><span class="n">token</span><span class="p">;</span>
<a name="gbab-233"></a>	<span class="n">TS_TST_INFO</span> <span class="o">*</span><span class="n">tst_info</span><span class="p">;</span>
<a name="gbab-234"></a>	<span class="p">}</span> <span class="n">TS_RESP</span><span class="p">;</span>
<a name="gbab-235"></a>
<a name="gbab-236"></a><span class="cm">/* The structure below would belong to the ESS component. */</span>
<a name="gbab-237"></a>
<a name="gbab-238"></a><span class="cm">/*-</span>
<a name="gbab-239"></a><span class="cm">IssuerSerial ::= SEQUENCE {</span>
<a name="gbab-240"></a><span class="cm">	issuer                   GeneralNames,</span>
<a name="gbab-241"></a><span class="cm">	serialNumber             CertificateSerialNumber</span>
<a name="gbab-242"></a><span class="cm">	}</span>
<a name="gbab-243"></a><span class="cm">*/</span>
<a name="gbab-244"></a>
<a name="gbab-245"></a><span class="k">typedef</span> <span class="k">struct</span> <span class="n">ESS_issuer_serial</span> <span class="p">{</span>
<a name="gbab-246"></a>	<span class="n">STACK_OF</span><span class="p">(</span><span class="n">GENERAL_NAME</span><span class="p">)</span>	<span class="o">*</span><span class="n">issuer</span><span class="p">;</span>
<a name="gbab-247"></a>	<span class="n">ASN1_INTEGER</span>		<span class="o">*</span><span class="n">serial</span><span class="p">;</span>
<a name="gbab-248"></a>	<span class="p">}</span> <span class="n">ESS_ISSUER_SERIAL</span><span class="p">;</span>
<a name="gbab-249"></a>
<a name="gbab-250"></a><span class="cm">/*-</span>
<a name="gbab-251"></a><span class="cm">ESSCertID ::=  SEQUENCE {</span>
<a name="gbab-252"></a><span class="cm">        certHash                 Hash,</span>
<a name="gbab-253"></a><span class="cm">        issuerSerial             IssuerSerial OPTIONAL</span>
<a name="gbab-254"></a><span class="cm">}</span>
<a name="gbab-255"></a><span class="cm">*/</span>
<a name="gbab-256"></a>
<a name="gbab-257"></a><span class="k">typedef</span> <span class="k">struct</span> <span class="n">ESS_cert_id</span> <span class="p">{</span>
<a name="gbab-258"></a>	<span class="n">ASN1_OCTET_STRING</span> <span class="o">*</span><span class="n">hash</span><span class="p">;</span>	<span class="cm">/* Always SHA-1 digest. */</span>
<a name="gbab-259"></a>	<span class="n">ESS_ISSUER_SERIAL</span> <span class="o">*</span><span class="n">issuer_serial</span><span class="p">;</span>
<a name="gbab-260"></a>	<span class="p">}</span> <span class="n">ESS_CERT_ID</span><span class="p">;</span>
<a name="gbab-261"></a>
<a name="gbab-262"></a><span class="n">DECLARE_STACK_OF</span><span class="p">(</span><span class="n">ESS_CERT_ID</span><span class="p">)</span>
<a name="gbab-263"></a><span class="n">DECLARE_ASN1_SET_OF</span><span class="p">(</span><span class="n">ESS_CERT_ID</span><span class="p">)</span>
<a name="gbab-264"></a>
<a name="gbab-265"></a><span class="cm">/*-</span>
<a name="gbab-266"></a><span class="cm">SigningCertificate ::=  SEQUENCE {</span>
<a name="gbab-267"></a><span class="cm">       certs        SEQUENCE OF ESSCertID,</span>
<a name="gbab-268"></a><span class="cm">       policies     SEQUENCE OF PolicyInformation OPTIONAL</span>
<a name="gbab-269"></a><span class="cm">}</span>
<a name="gbab-270"></a><span class="cm">*/</span>
<a name="gbab-271"></a>
<a name="gbab-272"></a><span class="k">typedef</span> <span class="k">struct</span> <span class="n">ESS_signing_cert</span> <span class="p">{</span>
<a name="gbab-273"></a>	<span class="n">STACK_OF</span><span class="p">(</span><span class="n">ESS_CERT_ID</span><span class="p">)</span> <span class="o">*</span><span class="n">cert_ids</span><span class="p">;</span>
<a name="gbab-274"></a>	<span class="n">STACK_OF</span><span class="p">(</span><span class="n">POLICYINFO</span><span class="p">)</span> <span class="o">*</span><span class="n">policy_info</span><span class="p">;</span>
<a name="gbab-275"></a>	<span class="p">}</span> <span class="n">ESS_SIGNING_CERT</span><span class="p">;</span>
<a name="gbab-276"></a>
<a name="gbab-277"></a><span class="n">TS_REQ</span>	<span class="o">*</span><span class="nf">TS_REQ_new</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<a name="gbab-278"></a><span class="kt">void</span>	<span class="nf">TS_REQ_free</span><span class="p">(</span><span class="n">TS_REQ</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-279"></a><span class="kt">int</span>	<span class="nf">i2d_TS_REQ</span><span class="p">(</span><span class="k">const</span> <span class="n">TS_REQ</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">**</span><span class="n">pp</span><span class="p">);</span>
<a name="gbab-280"></a><span class="n">TS_REQ</span>	<span class="o">*</span><span class="nf">d2i_TS_REQ</span><span class="p">(</span><span class="n">TS_REQ</span> <span class="o">**</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">**</span><span class="n">pp</span><span class="p">,</span> <span class="kt">long</span> <span class="n">length</span><span class="p">);</span>
<a name="gbab-281"></a>
<a name="gbab-282"></a><span class="n">TS_REQ</span>	<span class="o">*</span><span class="nf">TS_REQ_dup</span><span class="p">(</span><span class="n">TS_REQ</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-283"></a>
<a name="gbab-284"></a><span class="n">TS_REQ</span>	<span class="o">*</span><span class="nf">d2i_TS_REQ_fp</span><span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">fp</span><span class="p">,</span> <span class="n">TS_REQ</span> <span class="o">**</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-285"></a><span class="kt">int</span>	<span class="nf">i2d_TS_REQ_fp</span><span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">fp</span><span class="p">,</span> <span class="n">TS_REQ</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-286"></a><span class="n">TS_REQ</span>	<span class="o">*</span><span class="nf">d2i_TS_REQ_bio</span><span class="p">(</span><span class="n">BIO</span> <span class="o">*</span><span class="n">fp</span><span class="p">,</span> <span class="n">TS_REQ</span> <span class="o">**</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-287"></a><span class="kt">int</span>	<span class="nf">i2d_TS_REQ_bio</span><span class="p">(</span><span class="n">BIO</span> <span class="o">*</span><span class="n">fp</span><span class="p">,</span> <span class="n">TS_REQ</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-288"></a>
<a name="gbab-289"></a><span class="n">TS_MSG_IMPRINT</span>	<span class="o">*</span><span class="nf">TS_MSG_IMPRINT_new</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<a name="gbab-290"></a><span class="kt">void</span>		<span class="nf">TS_MSG_IMPRINT_free</span><span class="p">(</span><span class="n">TS_MSG_IMPRINT</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-291"></a><span class="kt">int</span>		<span class="nf">i2d_TS_MSG_IMPRINT</span><span class="p">(</span><span class="k">const</span> <span class="n">TS_MSG_IMPRINT</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">**</span><span class="n">pp</span><span class="p">);</span>
<a name="gbab-292"></a><span class="n">TS_MSG_IMPRINT</span>	<span class="o">*</span><span class="nf">d2i_TS_MSG_IMPRINT</span><span class="p">(</span><span class="n">TS_MSG_IMPRINT</span> <span class="o">**</span><span class="n">a</span><span class="p">,</span>
<a name="gbab-293"></a>				    <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">**</span><span class="n">pp</span><span class="p">,</span> <span class="kt">long</span> <span class="n">length</span><span class="p">);</span>
<a name="gbab-294"></a>
<a name="gbab-295"></a><span class="n">TS_MSG_IMPRINT</span>	<span class="o">*</span><span class="nf">TS_MSG_IMPRINT_dup</span><span class="p">(</span><span class="n">TS_MSG_IMPRINT</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-296"></a>
<a name="gbab-297"></a><span class="n">TS_MSG_IMPRINT</span>	<span class="o">*</span><span class="nf">d2i_TS_MSG_IMPRINT_fp</span><span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">fp</span><span class="p">,</span> <span class="n">TS_MSG_IMPRINT</span> <span class="o">**</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-298"></a><span class="kt">int</span>		<span class="nf">i2d_TS_MSG_IMPRINT_fp</span><span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">fp</span><span class="p">,</span> <span class="n">TS_MSG_IMPRINT</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-299"></a><span class="n">TS_MSG_IMPRINT</span>	<span class="o">*</span><span class="nf">d2i_TS_MSG_IMPRINT_bio</span><span class="p">(</span><span class="n">BIO</span> <span class="o">*</span><span class="n">fp</span><span class="p">,</span> <span class="n">TS_MSG_IMPRINT</span> <span class="o">**</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-300"></a><span class="kt">int</span>		<span class="nf">i2d_TS_MSG_IMPRINT_bio</span><span class="p">(</span><span class="n">BIO</span> <span class="o">*</span><span class="n">fp</span><span class="p">,</span> <span class="n">TS_MSG_IMPRINT</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-301"></a>
<a name="gbab-302"></a><span class="n">TS_RESP</span>	<span class="o">*</span><span class="nf">TS_RESP_new</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<a name="gbab-303"></a><span class="kt">void</span>	<span class="nf">TS_RESP_free</span><span class="p">(</span><span class="n">TS_RESP</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-304"></a><span class="kt">int</span>	<span class="nf">i2d_TS_RESP</span><span class="p">(</span><span class="k">const</span> <span class="n">TS_RESP</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">**</span><span class="n">pp</span><span class="p">);</span>
<a name="gbab-305"></a><span class="n">TS_RESP</span>	<span class="o">*</span><span class="nf">d2i_TS_RESP</span><span class="p">(</span><span class="n">TS_RESP</span> <span class="o">**</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">**</span><span class="n">pp</span><span class="p">,</span> <span class="kt">long</span> <span class="n">length</span><span class="p">);</span>
<a name="gbab-306"></a><span class="n">TS_TST_INFO</span> <span class="o">*</span><span class="nf">PKCS7_to_TS_TST_INFO</span><span class="p">(</span><span class="n">PKCS7</span> <span class="o">*</span><span class="n">token</span><span class="p">);</span>
<a name="gbab-307"></a><span class="n">TS_RESP</span>	<span class="o">*</span><span class="nf">TS_RESP_dup</span><span class="p">(</span><span class="n">TS_RESP</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-308"></a>
<a name="gbab-309"></a><span class="n">TS_RESP</span>	<span class="o">*</span><span class="nf">d2i_TS_RESP_fp</span><span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">fp</span><span class="p">,</span> <span class="n">TS_RESP</span> <span class="o">**</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-310"></a><span class="kt">int</span>	<span class="nf">i2d_TS_RESP_fp</span><span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">fp</span><span class="p">,</span> <span class="n">TS_RESP</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-311"></a><span class="n">TS_RESP</span>	<span class="o">*</span><span class="nf">d2i_TS_RESP_bio</span><span class="p">(</span><span class="n">BIO</span> <span class="o">*</span><span class="n">fp</span><span class="p">,</span> <span class="n">TS_RESP</span> <span class="o">**</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-312"></a><span class="kt">int</span>	<span class="nf">i2d_TS_RESP_bio</span><span class="p">(</span><span class="n">BIO</span> <span class="o">*</span><span class="n">fp</span><span class="p">,</span> <span class="n">TS_RESP</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-313"></a>
<a name="gbab-314"></a><span class="n">TS_STATUS_INFO</span>	<span class="o">*</span><span class="nf">TS_STATUS_INFO_new</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<a name="gbab-315"></a><span class="kt">void</span>		<span class="nf">TS_STATUS_INFO_free</span><span class="p">(</span><span class="n">TS_STATUS_INFO</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-316"></a><span class="kt">int</span>		<span class="nf">i2d_TS_STATUS_INFO</span><span class="p">(</span><span class="k">const</span> <span class="n">TS_STATUS_INFO</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">**</span><span class="n">pp</span><span class="p">);</span>
<a name="gbab-317"></a><span class="n">TS_STATUS_INFO</span>	<span class="o">*</span><span class="nf">d2i_TS_STATUS_INFO</span><span class="p">(</span><span class="n">TS_STATUS_INFO</span> <span class="o">**</span><span class="n">a</span><span class="p">,</span> 
<a name="gbab-318"></a>				    <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">**</span><span class="n">pp</span><span class="p">,</span> <span class="kt">long</span> <span class="n">length</span><span class="p">);</span>
<a name="gbab-319"></a><span class="n">TS_STATUS_INFO</span>	<span class="o">*</span><span class="nf">TS_STATUS_INFO_dup</span><span class="p">(</span><span class="n">TS_STATUS_INFO</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-320"></a>
<a name="gbab-321"></a><span class="n">TS_TST_INFO</span>	<span class="o">*</span><span class="nf">TS_TST_INFO_new</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<a name="gbab-322"></a><span class="kt">void</span>		<span class="nf">TS_TST_INFO_free</span><span class="p">(</span><span class="n">TS_TST_INFO</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-323"></a><span class="kt">int</span>		<span class="nf">i2d_TS_TST_INFO</span><span class="p">(</span><span class="k">const</span> <span class="n">TS_TST_INFO</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">**</span><span class="n">pp</span><span class="p">);</span>
<a name="gbab-324"></a><span class="n">TS_TST_INFO</span>	<span class="o">*</span><span class="nf">d2i_TS_TST_INFO</span><span class="p">(</span><span class="n">TS_TST_INFO</span> <span class="o">**</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">**</span><span class="n">pp</span><span class="p">,</span>
<a name="gbab-325"></a>				    <span class="kt">long</span> <span class="n">length</span><span class="p">);</span>
<a name="gbab-326"></a><span class="n">TS_TST_INFO</span>	<span class="o">*</span><span class="nf">TS_TST_INFO_dup</span><span class="p">(</span><span class="n">TS_TST_INFO</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-327"></a>
<a name="gbab-328"></a><span class="n">TS_TST_INFO</span>	<span class="o">*</span><span class="nf">d2i_TS_TST_INFO_fp</span><span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">fp</span><span class="p">,</span> <span class="n">TS_TST_INFO</span> <span class="o">**</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-329"></a><span class="kt">int</span>		<span class="nf">i2d_TS_TST_INFO_fp</span><span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">fp</span><span class="p">,</span> <span class="n">TS_TST_INFO</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-330"></a><span class="n">TS_TST_INFO</span>	<span class="o">*</span><span class="nf">d2i_TS_TST_INFO_bio</span><span class="p">(</span><span class="n">BIO</span> <span class="o">*</span><span class="n">fp</span><span class="p">,</span> <span class="n">TS_TST_INFO</span> <span class="o">**</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-331"></a><span class="kt">int</span>		<span class="nf">i2d_TS_TST_INFO_bio</span><span class="p">(</span><span class="n">BIO</span> <span class="o">*</span><span class="n">fp</span><span class="p">,</span> <span class="n">TS_TST_INFO</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-332"></a>
<a name="gbab-333"></a><span class="n">TS_ACCURACY</span>	<span class="o">*</span><span class="nf">TS_ACCURACY_new</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<a name="gbab-334"></a><span class="kt">void</span>		<span class="nf">TS_ACCURACY_free</span><span class="p">(</span><span class="n">TS_ACCURACY</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-335"></a><span class="kt">int</span>		<span class="nf">i2d_TS_ACCURACY</span><span class="p">(</span><span class="k">const</span> <span class="n">TS_ACCURACY</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">**</span><span class="n">pp</span><span class="p">);</span>
<a name="gbab-336"></a><span class="n">TS_ACCURACY</span>	<span class="o">*</span><span class="nf">d2i_TS_ACCURACY</span><span class="p">(</span><span class="n">TS_ACCURACY</span> <span class="o">**</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">**</span><span class="n">pp</span><span class="p">,</span>
<a name="gbab-337"></a>				    <span class="kt">long</span> <span class="n">length</span><span class="p">);</span>
<a name="gbab-338"></a><span class="n">TS_ACCURACY</span>	<span class="o">*</span><span class="nf">TS_ACCURACY_dup</span><span class="p">(</span><span class="n">TS_ACCURACY</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-339"></a>
<a name="gbab-340"></a><span class="n">ESS_ISSUER_SERIAL</span> <span class="o">*</span><span class="nf">ESS_ISSUER_SERIAL_new</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<a name="gbab-341"></a><span class="kt">void</span>		  <span class="nf">ESS_ISSUER_SERIAL_free</span><span class="p">(</span><span class="n">ESS_ISSUER_SERIAL</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-342"></a><span class="kt">int</span> <span class="nf">i2d_ESS_ISSUER_SERIAL</span><span class="p">(</span><span class="k">const</span> <span class="n">ESS_ISSUER_SERIAL</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">**</span><span class="n">pp</span><span class="p">);</span>
<a name="gbab-343"></a><span class="n">ESS_ISSUER_SERIAL</span> <span class="o">*</span><span class="nf">d2i_ESS_ISSUER_SERIAL</span><span class="p">(</span><span class="n">ESS_ISSUER_SERIAL</span> <span class="o">**</span><span class="n">a</span><span class="p">,</span>
<a name="gbab-344"></a>                                         <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">**</span><span class="n">pp</span><span class="p">,</span>
<a name="gbab-345"></a>                                         <span class="kt">long</span> <span class="n">length</span><span class="p">);</span>
<a name="gbab-346"></a><span class="n">ESS_ISSUER_SERIAL</span> <span class="o">*</span><span class="nf">ESS_ISSUER_SERIAL_dup</span><span class="p">(</span><span class="n">ESS_ISSUER_SERIAL</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-347"></a>
<a name="gbab-348"></a><span class="n">ESS_CERT_ID</span>	<span class="o">*</span><span class="nf">ESS_CERT_ID_new</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<a name="gbab-349"></a><span class="kt">void</span>		<span class="nf">ESS_CERT_ID_free</span><span class="p">(</span><span class="n">ESS_CERT_ID</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-350"></a><span class="kt">int</span>		<span class="nf">i2d_ESS_CERT_ID</span><span class="p">(</span><span class="k">const</span> <span class="n">ESS_CERT_ID</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">**</span><span class="n">pp</span><span class="p">);</span>
<a name="gbab-351"></a><span class="n">ESS_CERT_ID</span>	<span class="o">*</span><span class="nf">d2i_ESS_CERT_ID</span><span class="p">(</span><span class="n">ESS_CERT_ID</span> <span class="o">**</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">**</span><span class="n">pp</span><span class="p">,</span>
<a name="gbab-352"></a>				 <span class="kt">long</span> <span class="n">length</span><span class="p">);</span>
<a name="gbab-353"></a><span class="n">ESS_CERT_ID</span>	<span class="o">*</span><span class="nf">ESS_CERT_ID_dup</span><span class="p">(</span><span class="n">ESS_CERT_ID</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-354"></a>
<a name="gbab-355"></a><span class="n">ESS_SIGNING_CERT</span> <span class="o">*</span><span class="nf">ESS_SIGNING_CERT_new</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<a name="gbab-356"></a><span class="kt">void</span>		 <span class="nf">ESS_SIGNING_CERT_free</span><span class="p">(</span><span class="n">ESS_SIGNING_CERT</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-357"></a><span class="kt">int</span> <span class="nf">i2d_ESS_SIGNING_CERT</span><span class="p">(</span><span class="k">const</span> <span class="n">ESS_SIGNING_CERT</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">**</span><span class="n">pp</span><span class="p">);</span>
<a name="gbab-358"></a><span class="n">ESS_SIGNING_CERT</span> <span class="o">*</span><span class="nf">d2i_ESS_SIGNING_CERT</span><span class="p">(</span><span class="n">ESS_SIGNING_CERT</span> <span class="o">**</span><span class="n">a</span><span class="p">,</span>
<a name="gbab-359"></a>				       <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">**</span><span class="n">pp</span><span class="p">,</span> <span class="kt">long</span> <span class="n">length</span><span class="p">);</span>
<a name="gbab-360"></a><span class="n">ESS_SIGNING_CERT</span> <span class="o">*</span><span class="nf">ESS_SIGNING_CERT_dup</span><span class="p">(</span><span class="n">ESS_SIGNING_CERT</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-361"></a>
<a name="gbab-362"></a><span class="kt">void</span> <span class="nf">ERR_load_TS_strings</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<a name="gbab-363"></a>
<a name="gbab-364"></a><span class="kt">int</span> <span class="nf">TS_REQ_set_version</span><span class="p">(</span><span class="n">TS_REQ</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">long</span> <span class="n">version</span><span class="p">);</span>
<a name="gbab-365"></a><span class="kt">long</span> <span class="nf">TS_REQ_get_version</span><span class="p">(</span><span class="k">const</span> <span class="n">TS_REQ</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-366"></a>
<a name="gbab-367"></a><span class="kt">int</span> <span class="nf">TS_REQ_set_msg_imprint</span><span class="p">(</span><span class="n">TS_REQ</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="n">TS_MSG_IMPRINT</span> <span class="o">*</span><span class="n">msg_imprint</span><span class="p">);</span>
<a name="gbab-368"></a><span class="n">TS_MSG_IMPRINT</span> <span class="o">*</span><span class="nf">TS_REQ_get_msg_imprint</span><span class="p">(</span><span class="n">TS_REQ</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-369"></a>
<a name="gbab-370"></a><span class="kt">int</span> <span class="nf">TS_MSG_IMPRINT_set_algo</span><span class="p">(</span><span class="n">TS_MSG_IMPRINT</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="n">X509_ALGOR</span> <span class="o">*</span><span class="n">alg</span><span class="p">);</span>
<a name="gbab-371"></a><span class="n">X509_ALGOR</span> <span class="o">*</span><span class="nf">TS_MSG_IMPRINT_get_algo</span><span class="p">(</span><span class="n">TS_MSG_IMPRINT</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-372"></a>
<a name="gbab-373"></a><span class="kt">int</span> <span class="nf">TS_MSG_IMPRINT_set_msg</span><span class="p">(</span><span class="n">TS_MSG_IMPRINT</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">d</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">);</span>
<a name="gbab-374"></a><span class="n">ASN1_OCTET_STRING</span> <span class="o">*</span><span class="nf">TS_MSG_IMPRINT_get_msg</span><span class="p">(</span><span class="n">TS_MSG_IMPRINT</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-375"></a>
<a name="gbab-376"></a><span class="kt">int</span> <span class="nf">TS_REQ_set_policy_id</span><span class="p">(</span><span class="n">TS_REQ</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="n">ASN1_OBJECT</span> <span class="o">*</span><span class="n">policy</span><span class="p">);</span>
<a name="gbab-377"></a><span class="n">ASN1_OBJECT</span> <span class="o">*</span><span class="nf">TS_REQ_get_policy_id</span><span class="p">(</span><span class="n">TS_REQ</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-378"></a>
<a name="gbab-379"></a><span class="kt">int</span> <span class="nf">TS_REQ_set_nonce</span><span class="p">(</span><span class="n">TS_REQ</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">ASN1_INTEGER</span> <span class="o">*</span><span class="n">nonce</span><span class="p">);</span>
<a name="gbab-380"></a><span class="k">const</span> <span class="n">ASN1_INTEGER</span> <span class="o">*</span><span class="nf">TS_REQ_get_nonce</span><span class="p">(</span><span class="k">const</span> <span class="n">TS_REQ</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-381"></a>
<a name="gbab-382"></a><span class="kt">int</span> <span class="nf">TS_REQ_set_cert_req</span><span class="p">(</span><span class="n">TS_REQ</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cert_req</span><span class="p">);</span>
<a name="gbab-383"></a><span class="kt">int</span> <span class="nf">TS_REQ_get_cert_req</span><span class="p">(</span><span class="k">const</span> <span class="n">TS_REQ</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-384"></a>
<a name="gbab-385"></a><span class="n">STACK_OF</span><span class="p">(</span><span class="n">X509_EXTENSION</span><span class="p">)</span> <span class="o">*</span><span class="n">TS_REQ_get_exts</span><span class="p">(</span><span class="n">TS_REQ</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-386"></a><span class="kt">void</span> <span class="nf">TS_REQ_ext_free</span><span class="p">(</span><span class="n">TS_REQ</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-387"></a><span class="kt">int</span> <span class="nf">TS_REQ_get_ext_count</span><span class="p">(</span><span class="n">TS_REQ</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-388"></a><span class="kt">int</span> <span class="nf">TS_REQ_get_ext_by_NID</span><span class="p">(</span><span class="n">TS_REQ</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nid</span><span class="p">,</span> <span class="kt">int</span> <span class="n">lastpos</span><span class="p">);</span>
<a name="gbab-389"></a><span class="kt">int</span> <span class="nf">TS_REQ_get_ext_by_OBJ</span><span class="p">(</span><span class="n">TS_REQ</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="n">ASN1_OBJECT</span> <span class="o">*</span><span class="n">obj</span><span class="p">,</span> <span class="kt">int</span> <span class="n">lastpos</span><span class="p">);</span>
<a name="gbab-390"></a><span class="kt">int</span> <span class="nf">TS_REQ_get_ext_by_critical</span><span class="p">(</span><span class="n">TS_REQ</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">crit</span><span class="p">,</span> <span class="kt">int</span> <span class="n">lastpos</span><span class="p">);</span>
<a name="gbab-391"></a><span class="n">X509_EXTENSION</span> <span class="o">*</span><span class="nf">TS_REQ_get_ext</span><span class="p">(</span><span class="n">TS_REQ</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">loc</span><span class="p">);</span>
<a name="gbab-392"></a><span class="n">X509_EXTENSION</span> <span class="o">*</span><span class="nf">TS_REQ_delete_ext</span><span class="p">(</span><span class="n">TS_REQ</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">loc</span><span class="p">);</span>
<a name="gbab-393"></a><span class="kt">int</span> <span class="nf">TS_REQ_add_ext</span><span class="p">(</span><span class="n">TS_REQ</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="n">X509_EXTENSION</span> <span class="o">*</span><span class="n">ex</span><span class="p">,</span> <span class="kt">int</span> <span class="n">loc</span><span class="p">);</span>
<a name="gbab-394"></a><span class="kt">void</span> <span class="o">*</span><span class="nf">TS_REQ_get_ext_d2i</span><span class="p">(</span><span class="n">TS_REQ</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nid</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">crit</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">idx</span><span class="p">);</span>
<a name="gbab-395"></a>
<a name="gbab-396"></a><span class="cm">/* Function declarations for TS_REQ defined in ts/ts_req_print.c */</span>
<a name="gbab-397"></a>
<a name="gbab-398"></a><span class="kt">int</span> <span class="nf">TS_REQ_print_bio</span><span class="p">(</span><span class="n">BIO</span> <span class="o">*</span><span class="n">bio</span><span class="p">,</span> <span class="n">TS_REQ</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-399"></a>
<a name="gbab-400"></a><span class="cm">/* Function declarations for TS_RESP defined in ts/ts_resp_utils.c */</span>
<a name="gbab-401"></a>
<a name="gbab-402"></a><span class="kt">int</span> <span class="nf">TS_RESP_set_status_info</span><span class="p">(</span><span class="n">TS_RESP</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="n">TS_STATUS_INFO</span> <span class="o">*</span><span class="n">info</span><span class="p">);</span>
<a name="gbab-403"></a><span class="n">TS_STATUS_INFO</span> <span class="o">*</span><span class="nf">TS_RESP_get_status_info</span><span class="p">(</span><span class="n">TS_RESP</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-404"></a>
<a name="gbab-405"></a><span class="cm">/* Caller loses ownership of PKCS7 and TS_TST_INFO objects. */</span>
<a name="gbab-406"></a><span class="kt">void</span> <span class="nf">TS_RESP_set_tst_info</span><span class="p">(</span><span class="n">TS_RESP</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="n">PKCS7</span> <span class="o">*</span><span class="n">p7</span><span class="p">,</span> <span class="n">TS_TST_INFO</span> <span class="o">*</span><span class="n">tst_info</span><span class="p">);</span>
<a name="gbab-407"></a><span class="n">PKCS7</span> <span class="o">*</span><span class="nf">TS_RESP_get_token</span><span class="p">(</span><span class="n">TS_RESP</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-408"></a><span class="n">TS_TST_INFO</span> <span class="o">*</span><span class="nf">TS_RESP_get_tst_info</span><span class="p">(</span><span class="n">TS_RESP</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-409"></a>
<a name="gbab-410"></a><span class="kt">int</span> <span class="nf">TS_TST_INFO_set_version</span><span class="p">(</span><span class="n">TS_TST_INFO</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">long</span> <span class="n">version</span><span class="p">);</span>
<a name="gbab-411"></a><span class="kt">long</span> <span class="nf">TS_TST_INFO_get_version</span><span class="p">(</span><span class="k">const</span> <span class="n">TS_TST_INFO</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-412"></a>
<a name="gbab-413"></a><span class="kt">int</span> <span class="nf">TS_TST_INFO_set_policy_id</span><span class="p">(</span><span class="n">TS_TST_INFO</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="n">ASN1_OBJECT</span> <span class="o">*</span><span class="n">policy_id</span><span class="p">);</span>
<a name="gbab-414"></a><span class="n">ASN1_OBJECT</span> <span class="o">*</span><span class="nf">TS_TST_INFO_get_policy_id</span><span class="p">(</span><span class="n">TS_TST_INFO</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-415"></a>
<a name="gbab-416"></a><span class="kt">int</span> <span class="nf">TS_TST_INFO_set_msg_imprint</span><span class="p">(</span><span class="n">TS_TST_INFO</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="n">TS_MSG_IMPRINT</span> <span class="o">*</span><span class="n">msg_imprint</span><span class="p">);</span>
<a name="gbab-417"></a><span class="n">TS_MSG_IMPRINT</span> <span class="o">*</span><span class="nf">TS_TST_INFO_get_msg_imprint</span><span class="p">(</span><span class="n">TS_TST_INFO</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-418"></a>
<a name="gbab-419"></a><span class="kt">int</span> <span class="nf">TS_TST_INFO_set_serial</span><span class="p">(</span><span class="n">TS_TST_INFO</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">ASN1_INTEGER</span> <span class="o">*</span><span class="n">serial</span><span class="p">);</span>
<a name="gbab-420"></a><span class="k">const</span> <span class="n">ASN1_INTEGER</span> <span class="o">*</span><span class="nf">TS_TST_INFO_get_serial</span><span class="p">(</span><span class="k">const</span> <span class="n">TS_TST_INFO</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-421"></a>
<a name="gbab-422"></a><span class="kt">int</span> <span class="nf">TS_TST_INFO_set_time</span><span class="p">(</span><span class="n">TS_TST_INFO</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">ASN1_GENERALIZEDTIME</span> <span class="o">*</span><span class="n">gtime</span><span class="p">);</span>
<a name="gbab-423"></a><span class="k">const</span> <span class="n">ASN1_GENERALIZEDTIME</span> <span class="o">*</span><span class="nf">TS_TST_INFO_get_time</span><span class="p">(</span><span class="k">const</span> <span class="n">TS_TST_INFO</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-424"></a>
<a name="gbab-425"></a><span class="kt">int</span> <span class="nf">TS_TST_INFO_set_accuracy</span><span class="p">(</span><span class="n">TS_TST_INFO</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="n">TS_ACCURACY</span> <span class="o">*</span><span class="n">accuracy</span><span class="p">);</span>
<a name="gbab-426"></a><span class="n">TS_ACCURACY</span> <span class="o">*</span><span class="nf">TS_TST_INFO_get_accuracy</span><span class="p">(</span><span class="n">TS_TST_INFO</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-427"></a>
<a name="gbab-428"></a><span class="kt">int</span> <span class="nf">TS_ACCURACY_set_seconds</span><span class="p">(</span><span class="n">TS_ACCURACY</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">ASN1_INTEGER</span> <span class="o">*</span><span class="n">seconds</span><span class="p">);</span>
<a name="gbab-429"></a><span class="k">const</span> <span class="n">ASN1_INTEGER</span> <span class="o">*</span><span class="nf">TS_ACCURACY_get_seconds</span><span class="p">(</span><span class="k">const</span> <span class="n">TS_ACCURACY</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-430"></a>
<a name="gbab-431"></a><span class="kt">int</span> <span class="nf">TS_ACCURACY_set_millis</span><span class="p">(</span><span class="n">TS_ACCURACY</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">ASN1_INTEGER</span> <span class="o">*</span><span class="n">millis</span><span class="p">);</span>
<a name="gbab-432"></a><span class="k">const</span> <span class="n">ASN1_INTEGER</span> <span class="o">*</span><span class="nf">TS_ACCURACY_get_millis</span><span class="p">(</span><span class="k">const</span> <span class="n">TS_ACCURACY</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-433"></a>
<a name="gbab-434"></a><span class="kt">int</span> <span class="nf">TS_ACCURACY_set_micros</span><span class="p">(</span><span class="n">TS_ACCURACY</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">ASN1_INTEGER</span> <span class="o">*</span><span class="n">micros</span><span class="p">);</span>
<a name="gbab-435"></a><span class="k">const</span> <span class="n">ASN1_INTEGER</span> <span class="o">*</span><span class="nf">TS_ACCURACY_get_micros</span><span class="p">(</span><span class="k">const</span> <span class="n">TS_ACCURACY</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-436"></a>
<a name="gbab-437"></a><span class="kt">int</span> <span class="nf">TS_TST_INFO_set_ordering</span><span class="p">(</span><span class="n">TS_TST_INFO</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">ordering</span><span class="p">);</span>
<a name="gbab-438"></a><span class="kt">int</span> <span class="nf">TS_TST_INFO_get_ordering</span><span class="p">(</span><span class="k">const</span> <span class="n">TS_TST_INFO</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-439"></a>
<a name="gbab-440"></a><span class="kt">int</span> <span class="nf">TS_TST_INFO_set_nonce</span><span class="p">(</span><span class="n">TS_TST_INFO</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">ASN1_INTEGER</span> <span class="o">*</span><span class="n">nonce</span><span class="p">);</span>
<a name="gbab-441"></a><span class="k">const</span> <span class="n">ASN1_INTEGER</span> <span class="o">*</span><span class="nf">TS_TST_INFO_get_nonce</span><span class="p">(</span><span class="k">const</span> <span class="n">TS_TST_INFO</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-442"></a>
<a name="gbab-443"></a><span class="kt">int</span> <span class="nf">TS_TST_INFO_set_tsa</span><span class="p">(</span><span class="n">TS_TST_INFO</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="n">GENERAL_NAME</span> <span class="o">*</span><span class="n">tsa</span><span class="p">);</span>
<a name="gbab-444"></a><span class="n">GENERAL_NAME</span> <span class="o">*</span><span class="nf">TS_TST_INFO_get_tsa</span><span class="p">(</span><span class="n">TS_TST_INFO</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-445"></a>
<a name="gbab-446"></a><span class="n">STACK_OF</span><span class="p">(</span><span class="n">X509_EXTENSION</span><span class="p">)</span> <span class="o">*</span><span class="n">TS_TST_INFO_get_exts</span><span class="p">(</span><span class="n">TS_TST_INFO</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-447"></a><span class="kt">void</span> <span class="nf">TS_TST_INFO_ext_free</span><span class="p">(</span><span class="n">TS_TST_INFO</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-448"></a><span class="kt">int</span> <span class="nf">TS_TST_INFO_get_ext_count</span><span class="p">(</span><span class="n">TS_TST_INFO</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-449"></a><span class="kt">int</span> <span class="nf">TS_TST_INFO_get_ext_by_NID</span><span class="p">(</span><span class="n">TS_TST_INFO</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nid</span><span class="p">,</span> <span class="kt">int</span> <span class="n">lastpos</span><span class="p">);</span>
<a name="gbab-450"></a><span class="kt">int</span> <span class="nf">TS_TST_INFO_get_ext_by_OBJ</span><span class="p">(</span><span class="n">TS_TST_INFO</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="n">ASN1_OBJECT</span> <span class="o">*</span><span class="n">obj</span><span class="p">,</span> <span class="kt">int</span> <span class="n">lastpos</span><span class="p">);</span>
<a name="gbab-451"></a><span class="kt">int</span> <span class="nf">TS_TST_INFO_get_ext_by_critical</span><span class="p">(</span><span class="n">TS_TST_INFO</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">crit</span><span class="p">,</span> <span class="kt">int</span> <span class="n">lastpos</span><span class="p">);</span>
<a name="gbab-452"></a><span class="n">X509_EXTENSION</span> <span class="o">*</span><span class="nf">TS_TST_INFO_get_ext</span><span class="p">(</span><span class="n">TS_TST_INFO</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">loc</span><span class="p">);</span>
<a name="gbab-453"></a><span class="n">X509_EXTENSION</span> <span class="o">*</span><span class="nf">TS_TST_INFO_delete_ext</span><span class="p">(</span><span class="n">TS_TST_INFO</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">loc</span><span class="p">);</span>
<a name="gbab-454"></a><span class="kt">int</span> <span class="nf">TS_TST_INFO_add_ext</span><span class="p">(</span><span class="n">TS_TST_INFO</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="n">X509_EXTENSION</span> <span class="o">*</span><span class="n">ex</span><span class="p">,</span> <span class="kt">int</span> <span class="n">loc</span><span class="p">);</span>
<a name="gbab-455"></a><span class="kt">void</span> <span class="o">*</span><span class="nf">TS_TST_INFO_get_ext_d2i</span><span class="p">(</span><span class="n">TS_TST_INFO</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nid</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">crit</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">idx</span><span class="p">);</span>
<a name="gbab-456"></a>
<a name="gbab-457"></a><span class="cm">/*</span>
<a name="gbab-458"></a><span class="cm"> * Declarations related to response generation, defined in ts/ts_resp_sign.c.</span>
<a name="gbab-459"></a><span class="cm"> */</span>
<a name="gbab-460"></a>
<a name="gbab-461"></a><span class="cm">/* Optional flags for response generation. */</span>
<a name="gbab-462"></a>
<a name="gbab-463"></a><span class="cm">/* Don&#39;t include the TSA name in response. */</span>
<a name="gbab-464"></a><span class="cp">#define	TS_TSA_NAME		0x01</span>
<a name="gbab-465"></a>
<a name="gbab-466"></a><span class="cm">/* Set ordering to true in response. */</span>
<a name="gbab-467"></a><span class="cp">#define	TS_ORDERING		0x02</span>
<a name="gbab-468"></a>
<a name="gbab-469"></a><span class="cm">/*</span>
<a name="gbab-470"></a><span class="cm"> * Include the signer certificate and the other specified certificates in</span>
<a name="gbab-471"></a><span class="cm"> * the ESS signing certificate attribute beside the PKCS7 signed data.</span>
<a name="gbab-472"></a><span class="cm"> * Only the signer certificates is included by default.</span>
<a name="gbab-473"></a><span class="cm"> */</span>
<a name="gbab-474"></a><span class="cp">#define	TS_ESS_CERT_ID_CHAIN	0x04</span>
<a name="gbab-475"></a>
<a name="gbab-476"></a><span class="cm">/* Forward declaration. */</span>
<a name="gbab-477"></a><span class="k">struct</span> <span class="n">TS_resp_ctx</span><span class="p">;</span>
<a name="gbab-478"></a>
<a name="gbab-479"></a><span class="cm">/* This must return a unique number less than 160 bits long. */</span>
<a name="gbab-480"></a><span class="k">typedef</span> <span class="n">ASN1_INTEGER</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">TS_serial_cb</span><span class="p">)(</span><span class="k">struct</span> <span class="n">TS_resp_ctx</span> <span class="o">*</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="p">);</span>
<a name="gbab-481"></a>
<a name="gbab-482"></a><span class="cm">/*</span>
<a name="gbab-483"></a><span class="cm"> * This must return the seconds and microseconds since Jan 1, 1970 in the sec</span>
<a name="gbab-484"></a><span class="cm"> * and usec variables allocated by the caller. Return non-zero for success</span>
<a name="gbab-485"></a><span class="cm"> * and zero for failure.</span>
<a name="gbab-486"></a><span class="cm"> */</span>
<a name="gbab-487"></a><span class="k">typedef</span> <span class="nf">int</span> <span class="p">(</span><span class="o">*</span><span class="n">TS_time_cb</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">TS_resp_ctx</span> <span class="o">*</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="p">,</span> <span class="kt">long</span> <span class="o">*</span><span class="n">sec</span><span class="p">,</span>
<a name="gbab-488"></a>                           <span class="kt">long</span> <span class="o">*</span><span class="n">usec</span><span class="p">);</span>
<a name="gbab-489"></a>
<a name="gbab-490"></a><span class="cm">/*</span>
<a name="gbab-491"></a><span class="cm"> * This must process the given extension. It can modify the TS_TST_INFO</span>
<a name="gbab-492"></a><span class="cm"> * object of the context. Return values: !0 (processed), 0 (error, it must</span>
<a name="gbab-493"></a><span class="cm"> * set the status info/failure info of the response).</span>
<a name="gbab-494"></a><span class="cm"> */</span>
<a name="gbab-495"></a><span class="k">typedef</span> <span class="nf">int</span> <span class="p">(</span><span class="o">*</span><span class="n">TS_extension_cb</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">TS_resp_ctx</span> <span class="o">*</span><span class="p">,</span> <span class="n">X509_EXTENSION</span> <span class="o">*</span><span class="p">,</span>
<a name="gbab-496"></a>                                <span class="kt">void</span> <span class="o">*</span><span class="p">);</span>
<a name="gbab-497"></a>
<a name="gbab-498"></a><span class="k">typedef</span> <span class="k">struct</span> <span class="n">TS_resp_ctx</span> <span class="p">{</span>
<a name="gbab-499"></a>	<span class="n">X509</span>		<span class="o">*</span><span class="n">signer_cert</span><span class="p">;</span>
<a name="gbab-500"></a>	<span class="n">EVP_PKEY</span>	<span class="o">*</span><span class="n">signer_key</span><span class="p">;</span>
<a name="gbab-501"></a>	<span class="n">STACK_OF</span><span class="p">(</span><span class="n">X509</span><span class="p">)</span>	<span class="o">*</span><span class="n">certs</span><span class="p">;</span>	<span class="cm">/* Certs to include in signed data. */</span>
<a name="gbab-502"></a>	<span class="n">STACK_OF</span><span class="p">(</span><span class="n">ASN1_OBJECT</span><span class="p">)</span>	<span class="o">*</span><span class="n">policies</span><span class="p">;</span>	<span class="cm">/* Acceptable policies. */</span>
<a name="gbab-503"></a>	<span class="n">ASN1_OBJECT</span>	<span class="o">*</span><span class="n">default_policy</span><span class="p">;</span> <span class="cm">/* It may appear in policies, too. */</span>
<a name="gbab-504"></a>	<span class="n">STACK_OF</span><span class="p">(</span><span class="n">EVP_MD</span><span class="p">)</span>	<span class="o">*</span><span class="n">mds</span><span class="p">;</span>	<span class="cm">/* Acceptable message digests. */</span>
<a name="gbab-505"></a>	<span class="n">ASN1_INTEGER</span>	<span class="o">*</span><span class="n">seconds</span><span class="p">;</span>	<span class="cm">/* accuracy, 0 means not specified. */</span>
<a name="gbab-506"></a>	<span class="n">ASN1_INTEGER</span>	<span class="o">*</span><span class="n">millis</span><span class="p">;</span>	<span class="cm">/* accuracy, 0 means not specified. */</span>
<a name="gbab-507"></a>	<span class="n">ASN1_INTEGER</span>	<span class="o">*</span><span class="n">micros</span><span class="p">;</span>	<span class="cm">/* accuracy, 0 means not specified. */</span>
<a name="gbab-508"></a>    <span class="kt">unsigned</span> <span class="n">clock_precision_digits</span><span class="p">;</span> <span class="cm">/* fraction of seconds in time stamp</span>
<a name="gbab-509"></a><span class="cm">                                      * token. */</span>
<a name="gbab-510"></a>	<span class="kt">unsigned</span>	<span class="n">flags</span><span class="p">;</span>		<span class="cm">/* Optional info, see values above. */</span>
<a name="gbab-511"></a>	<span class="cm">/* Callback functions. */</span>
<a name="gbab-512"></a>	<span class="n">TS_serial_cb</span> <span class="n">serial_cb</span><span class="p">;</span>
<a name="gbab-513"></a>	<span class="kt">void</span> <span class="o">*</span><span class="n">serial_cb_data</span><span class="p">;</span>	<span class="cm">/* User data for serial_cb. */</span>
<a name="gbab-514"></a>	<span class="n">TS_time_cb</span> <span class="n">time_cb</span><span class="p">;</span>
<a name="gbab-515"></a>	<span class="kt">void</span> <span class="o">*</span><span class="n">time_cb_data</span><span class="p">;</span>	<span class="cm">/* User data for time_cb. */</span>
<a name="gbab-516"></a>	<span class="n">TS_extension_cb</span> <span class="n">extension_cb</span><span class="p">;</span>
<a name="gbab-517"></a>	<span class="kt">void</span> <span class="o">*</span><span class="n">extension_cb_data</span><span class="p">;</span>	<span class="cm">/* User data for extension_cb. */</span>
<a name="gbab-518"></a>	<span class="cm">/* These members are used only while creating the response. */</span>
<a name="gbab-519"></a>	<span class="n">TS_REQ</span>		<span class="o">*</span><span class="n">request</span><span class="p">;</span>
<a name="gbab-520"></a>	<span class="n">TS_RESP</span>		<span class="o">*</span><span class="n">response</span><span class="p">;</span>
<a name="gbab-521"></a>	<span class="n">TS_TST_INFO</span>	<span class="o">*</span><span class="n">tst_info</span><span class="p">;</span>
<a name="gbab-522"></a>	<span class="p">}</span> <span class="n">TS_RESP_CTX</span><span class="p">;</span>
<a name="gbab-523"></a>
<a name="gbab-524"></a><span class="n">DECLARE_STACK_OF</span><span class="p">(</span><span class="n">EVP_MD</span><span class="p">)</span>
<a name="gbab-525"></a><span class="n">DECLARE_ASN1_SET_OF</span><span class="p">(</span><span class="n">EVP_MD</span><span class="p">)</span>
<a name="gbab-526"></a>
<a name="gbab-527"></a><span class="cm">/* Creates a response context that can be used for generating responses. */</span>
<a name="gbab-528"></a><span class="n">TS_RESP_CTX</span> <span class="o">*</span><span class="n">TS_RESP_CTX_new</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<a name="gbab-529"></a><span class="kt">void</span> <span class="nf">TS_RESP_CTX_free</span><span class="p">(</span><span class="n">TS_RESP_CTX</span> <span class="o">*</span><span class="n">ctx</span><span class="p">);</span>
<a name="gbab-530"></a>
<a name="gbab-531"></a><span class="cm">/* This parameter must be set. */</span>
<a name="gbab-532"></a><span class="kt">int</span> <span class="nf">TS_RESP_CTX_set_signer_cert</span><span class="p">(</span><span class="n">TS_RESP_CTX</span> <span class="o">*</span><span class="n">ctx</span><span class="p">,</span> <span class="n">X509</span> <span class="o">*</span><span class="n">signer</span><span class="p">);</span>
<a name="gbab-533"></a>
<a name="gbab-534"></a><span class="cm">/* This parameter must be set. */</span>
<a name="gbab-535"></a><span class="kt">int</span> <span class="nf">TS_RESP_CTX_set_signer_key</span><span class="p">(</span><span class="n">TS_RESP_CTX</span> <span class="o">*</span><span class="n">ctx</span><span class="p">,</span> <span class="n">EVP_PKEY</span> <span class="o">*</span><span class="n">key</span><span class="p">);</span>
<a name="gbab-536"></a>
<a name="gbab-537"></a><span class="cm">/* This parameter must be set. */</span>
<a name="gbab-538"></a><span class="kt">int</span> <span class="nf">TS_RESP_CTX_set_def_policy</span><span class="p">(</span><span class="n">TS_RESP_CTX</span> <span class="o">*</span><span class="n">ctx</span><span class="p">,</span> <span class="n">ASN1_OBJECT</span> <span class="o">*</span><span class="n">def_policy</span><span class="p">);</span>
<a name="gbab-539"></a>
<a name="gbab-540"></a><span class="cm">/* No additional certs are included in the response by default. */</span>
<a name="gbab-541"></a><span class="kt">int</span> <span class="nf">TS_RESP_CTX_set_certs</span><span class="p">(</span><span class="n">TS_RESP_CTX</span> <span class="o">*</span><span class="n">ctx</span><span class="p">,</span> <span class="n">STACK_OF</span><span class="p">(</span><span class="n">X509</span><span class="p">)</span> <span class="o">*</span><span class="n">certs</span><span class="p">);</span>
<a name="gbab-542"></a>
<a name="gbab-543"></a><span class="cm">/*</span>
<a name="gbab-544"></a><span class="cm"> * Adds a new acceptable policy, only the default policy is accepted by</span>
<a name="gbab-545"></a><span class="cm"> * default.</span>
<a name="gbab-546"></a><span class="cm"> */</span>
<a name="gbab-547"></a><span class="kt">int</span> <span class="nf">TS_RESP_CTX_add_policy</span><span class="p">(</span><span class="n">TS_RESP_CTX</span> <span class="o">*</span><span class="n">ctx</span><span class="p">,</span> <span class="n">ASN1_OBJECT</span> <span class="o">*</span><span class="n">policy</span><span class="p">);</span>
<a name="gbab-548"></a>
<a name="gbab-549"></a><span class="cm">/*</span>
<a name="gbab-550"></a><span class="cm"> * Adds a new acceptable message digest. Note that no message digests are</span>
<a name="gbab-551"></a><span class="cm"> * accepted by default. The md argument is shared with the caller.</span>
<a name="gbab-552"></a><span class="cm"> */</span>
<a name="gbab-553"></a><span class="kt">int</span> <span class="nf">TS_RESP_CTX_add_md</span><span class="p">(</span><span class="n">TS_RESP_CTX</span> <span class="o">*</span><span class="n">ctx</span><span class="p">,</span> <span class="k">const</span> <span class="n">EVP_MD</span> <span class="o">*</span><span class="n">md</span><span class="p">);</span>
<a name="gbab-554"></a>
<a name="gbab-555"></a><span class="cm">/* Accuracy is not included by default. */</span>
<a name="gbab-556"></a><span class="kt">int</span> <span class="nf">TS_RESP_CTX_set_accuracy</span><span class="p">(</span><span class="n">TS_RESP_CTX</span> <span class="o">*</span><span class="n">ctx</span><span class="p">,</span>
<a name="gbab-557"></a>			     <span class="kt">int</span> <span class="n">secs</span><span class="p">,</span> <span class="kt">int</span> <span class="n">millis</span><span class="p">,</span> <span class="kt">int</span> <span class="n">micros</span><span class="p">);</span>
<a name="gbab-558"></a>
<a name="gbab-559"></a><span class="cm">/*</span>
<a name="gbab-560"></a><span class="cm"> * Clock precision digits, i.e. the number of decimal digits: &#39;0&#39; means sec,</span>
<a name="gbab-561"></a><span class="cm"> * &#39;3&#39; msec, &#39;6&#39; usec, and so on. Default is 0.</span>
<a name="gbab-562"></a><span class="cm"> */</span>
<a name="gbab-563"></a><span class="kt">int</span> <span class="nf">TS_RESP_CTX_set_clock_precision_digits</span><span class="p">(</span><span class="n">TS_RESP_CTX</span> <span class="o">*</span><span class="n">ctx</span><span class="p">,</span>
<a name="gbab-564"></a>					   <span class="kt">unsigned</span> <span class="n">clock_precision_digits</span><span class="p">);</span>
<a name="gbab-565"></a><span class="cm">/* At most we accept usec precision. */</span>	
<a name="gbab-566"></a><span class="cp">#define TS_MAX_CLOCK_PRECISION_DIGITS	6</span>
<a name="gbab-567"></a>
<a name="gbab-568"></a><span class="cm">/* No flags are set by default. */</span>
<a name="gbab-569"></a><span class="kt">void</span> <span class="nf">TS_RESP_CTX_add_flags</span><span class="p">(</span><span class="n">TS_RESP_CTX</span> <span class="o">*</span><span class="n">ctx</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">);</span>
<a name="gbab-570"></a>
<a name="gbab-571"></a><span class="cm">/* Default callback always returns a constant. */</span>
<a name="gbab-572"></a><span class="kt">void</span> <span class="nf">TS_RESP_CTX_set_serial_cb</span><span class="p">(</span><span class="n">TS_RESP_CTX</span> <span class="o">*</span><span class="n">ctx</span><span class="p">,</span> <span class="n">TS_serial_cb</span> <span class="n">cb</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>
<a name="gbab-573"></a>
<a name="gbab-574"></a><span class="cm">/* Default callback uses the gettimeofday() and gmtime() system calls. */</span>
<a name="gbab-575"></a><span class="kt">void</span> <span class="nf">TS_RESP_CTX_set_time_cb</span><span class="p">(</span><span class="n">TS_RESP_CTX</span> <span class="o">*</span><span class="n">ctx</span><span class="p">,</span> <span class="n">TS_time_cb</span> <span class="n">cb</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>
<a name="gbab-576"></a>
<a name="gbab-577"></a><span class="cm">/*</span>
<a name="gbab-578"></a><span class="cm"> * Default callback rejects all extensions. The extension callback is called</span>
<a name="gbab-579"></a><span class="cm"> * when the TS_TST_INFO object is already set up and not signed yet.</span>
<a name="gbab-580"></a><span class="cm"> */</span>
<a name="gbab-581"></a><span class="cm">/* FIXME: extension handling is not tested yet. */</span>
<a name="gbab-582"></a><span class="kt">void</span> <span class="nf">TS_RESP_CTX_set_extension_cb</span><span class="p">(</span><span class="n">TS_RESP_CTX</span> <span class="o">*</span><span class="n">ctx</span><span class="p">,</span> 
<a name="gbab-583"></a>				  <span class="n">TS_extension_cb</span> <span class="n">cb</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>
<a name="gbab-584"></a>
<a name="gbab-585"></a><span class="cm">/* The following methods can be used in the callbacks. */</span>
<a name="gbab-586"></a><span class="kt">int</span> <span class="nf">TS_RESP_CTX_set_status_info</span><span class="p">(</span><span class="n">TS_RESP_CTX</span> <span class="o">*</span><span class="n">ctx</span><span class="p">,</span> 
<a name="gbab-587"></a>				<span class="kt">int</span> <span class="n">status</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">text</span><span class="p">);</span>
<a name="gbab-588"></a>
<a name="gbab-589"></a><span class="cm">/* Sets the status info only if it is still TS_STATUS_GRANTED. */</span>
<a name="gbab-590"></a><span class="kt">int</span> <span class="nf">TS_RESP_CTX_set_status_info_cond</span><span class="p">(</span><span class="n">TS_RESP_CTX</span> <span class="o">*</span><span class="n">ctx</span><span class="p">,</span> 
<a name="gbab-591"></a>				     <span class="kt">int</span> <span class="n">status</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">text</span><span class="p">);</span>
<a name="gbab-592"></a>
<a name="gbab-593"></a><span class="kt">int</span> <span class="nf">TS_RESP_CTX_add_failure_info</span><span class="p">(</span><span class="n">TS_RESP_CTX</span> <span class="o">*</span><span class="n">ctx</span><span class="p">,</span> <span class="kt">int</span> <span class="n">failure</span><span class="p">);</span>
<a name="gbab-594"></a>
<a name="gbab-595"></a><span class="cm">/* The get methods below can be used in the extension callback. */</span>
<a name="gbab-596"></a><span class="n">TS_REQ</span> <span class="o">*</span><span class="nf">TS_RESP_CTX_get_request</span><span class="p">(</span><span class="n">TS_RESP_CTX</span> <span class="o">*</span><span class="n">ctx</span><span class="p">);</span>
<a name="gbab-597"></a>
<a name="gbab-598"></a><span class="n">TS_TST_INFO</span> <span class="o">*</span><span class="nf">TS_RESP_CTX_get_tst_info</span><span class="p">(</span><span class="n">TS_RESP_CTX</span> <span class="o">*</span><span class="n">ctx</span><span class="p">);</span>
<a name="gbab-599"></a>
<a name="gbab-600"></a><span class="cm">/* </span>
<a name="gbab-601"></a><span class="cm"> * Creates the signed TS_TST_INFO and puts it in TS_RESP.</span>
<a name="gbab-602"></a><span class="cm"> * In case of errors it sets the status info properly.</span>
<a name="gbab-603"></a><span class="cm"> * Returns NULL only in case of memory allocation/fatal error.</span>
<a name="gbab-604"></a><span class="cm"> */</span>
<a name="gbab-605"></a><span class="n">TS_RESP</span> <span class="o">*</span><span class="nf">TS_RESP_create_response</span><span class="p">(</span><span class="n">TS_RESP_CTX</span> <span class="o">*</span><span class="n">ctx</span><span class="p">,</span> <span class="n">BIO</span> <span class="o">*</span><span class="n">req_bio</span><span class="p">);</span>
<a name="gbab-606"></a>
<a name="gbab-607"></a><span class="cm">/*</span>
<a name="gbab-608"></a><span class="cm"> * Declarations related to response verification,</span>
<a name="gbab-609"></a><span class="cm"> * they are defined in ts/ts_resp_verify.c.</span>
<a name="gbab-610"></a><span class="cm"> */</span>
<a name="gbab-611"></a>
<a name="gbab-612"></a><span class="kt">int</span> <span class="nf">TS_RESP_verify_signature</span><span class="p">(</span><span class="n">PKCS7</span> <span class="o">*</span><span class="n">token</span><span class="p">,</span> <span class="n">STACK_OF</span><span class="p">(</span><span class="n">X509</span><span class="p">)</span> <span class="o">*</span><span class="n">certs</span><span class="p">,</span>
<a name="gbab-613"></a>			     <span class="n">X509_STORE</span> <span class="o">*</span><span class="n">store</span><span class="p">,</span> <span class="n">X509</span> <span class="o">**</span><span class="n">signer_out</span><span class="p">);</span>
<a name="gbab-614"></a>
<a name="gbab-615"></a><span class="cm">/* Context structure for the generic verify method. */</span>
<a name="gbab-616"></a>
<a name="gbab-617"></a><span class="cm">/* Verify the signer&#39;s certificate and the signature of the response. */</span>
<a name="gbab-618"></a><span class="cp">#define	TS_VFY_SIGNATURE	(1u &lt;&lt; 0)</span>
<a name="gbab-619"></a><span class="cm">/* Verify the version number of the response. */</span>
<a name="gbab-620"></a><span class="cp">#define	TS_VFY_VERSION		(1u &lt;&lt; 1)</span>
<a name="gbab-621"></a><span class="cm">/* Verify if the policy supplied by the user matches the policy of the TSA. */</span>
<a name="gbab-622"></a><span class="cp">#define	TS_VFY_POLICY		(1u &lt;&lt; 2)</span>
<a name="gbab-623"></a><span class="cm">/*</span>
<a name="gbab-624"></a><span class="cm"> * Verify the message imprint provided by the user. This flag should not be</span>
<a name="gbab-625"></a><span class="cm"> * specified with TS_VFY_DATA.</span>
<a name="gbab-626"></a><span class="cm"> */</span>
<a name="gbab-627"></a><span class="cp">#define	TS_VFY_IMPRINT		(1u &lt;&lt; 3)</span>
<a name="gbab-628"></a><span class="cm">/*</span>
<a name="gbab-629"></a><span class="cm"> * Verify the message imprint computed by the verify method from the user</span>
<a name="gbab-630"></a><span class="cm"> * provided data and the MD algorithm of the response. This flag should not</span>
<a name="gbab-631"></a><span class="cm"> * be specified with TS_VFY_IMPRINT.</span>
<a name="gbab-632"></a><span class="cm"> */</span>
<a name="gbab-633"></a><span class="cp">#define	TS_VFY_DATA		(1u &lt;&lt; 4)</span>
<a name="gbab-634"></a><span class="cm">/* Verify the nonce value. */</span>
<a name="gbab-635"></a><span class="cp">#define	TS_VFY_NONCE		(1u &lt;&lt; 5)</span>
<a name="gbab-636"></a><span class="cm">/* Verify if the TSA name field matches the signer certificate. */</span>
<a name="gbab-637"></a><span class="cp">#define	TS_VFY_SIGNER		(1u &lt;&lt; 6)</span>
<a name="gbab-638"></a><span class="cm">/* Verify if the TSA name field equals to the user provided name. */</span>
<a name="gbab-639"></a><span class="cp">#define	TS_VFY_TSA_NAME		(1u &lt;&lt; 7)</span>
<a name="gbab-640"></a>
<a name="gbab-641"></a><span class="cm">/* You can use the following convenience constants. */</span>
<a name="gbab-642"></a><span class="cp">#define	TS_VFY_ALL_IMPRINT	(TS_VFY_SIGNATURE	\</span>
<a name="gbab-643"></a><span class="cp">				 | TS_VFY_VERSION	\</span>
<a name="gbab-644"></a><span class="cp">				 | TS_VFY_POLICY	\</span>
<a name="gbab-645"></a><span class="cp">				 | TS_VFY_IMPRINT	\</span>
<a name="gbab-646"></a><span class="cp">				 | TS_VFY_NONCE		\</span>
<a name="gbab-647"></a><span class="cp">				 | TS_VFY_SIGNER	\</span>
<a name="gbab-648"></a><span class="cp">				 | TS_VFY_TSA_NAME)</span>
<a name="gbab-649"></a><span class="cp">#define	TS_VFY_ALL_DATA		(TS_VFY_SIGNATURE	\</span>
<a name="gbab-650"></a><span class="cp">				 | TS_VFY_VERSION	\</span>
<a name="gbab-651"></a><span class="cp">				 | TS_VFY_POLICY	\</span>
<a name="gbab-652"></a><span class="cp">				 | TS_VFY_DATA		\</span>
<a name="gbab-653"></a><span class="cp">				 | TS_VFY_NONCE		\</span>
<a name="gbab-654"></a><span class="cp">				 | TS_VFY_SIGNER	\</span>
<a name="gbab-655"></a><span class="cp">				 | TS_VFY_TSA_NAME)</span>
<a name="gbab-656"></a>
<a name="gbab-657"></a><span class="k">typedef</span> <span class="k">struct</span> <span class="n">TS_verify_ctx</span> <span class="p">{</span>
<a name="gbab-658"></a>	<span class="cm">/* Set this to the union of TS_VFY_... flags you want to carry out. */</span>
<a name="gbab-659"></a>	<span class="kt">unsigned</span>	<span class="n">flags</span><span class="p">;</span>
<a name="gbab-660"></a>	<span class="cm">/* Must be set only with TS_VFY_SIGNATURE. certs is optional. */</span>
<a name="gbab-661"></a>	<span class="n">X509_STORE</span>	<span class="o">*</span><span class="n">store</span><span class="p">;</span>
<a name="gbab-662"></a>	<span class="n">STACK_OF</span><span class="p">(</span><span class="n">X509</span><span class="p">)</span>	<span class="o">*</span><span class="n">certs</span><span class="p">;</span>
<a name="gbab-663"></a>	<span class="cm">/* Must be set only with TS_VFY_POLICY. */</span>
<a name="gbab-664"></a>	<span class="n">ASN1_OBJECT</span>	<span class="o">*</span><span class="n">policy</span><span class="p">;</span>
<a name="gbab-665"></a>    <span class="cm">/*</span>
<a name="gbab-666"></a><span class="cm">     * Must be set only with TS_VFY_IMPRINT. If md_alg is NULL, the</span>
<a name="gbab-667"></a><span class="cm">     * algorithm from the response is used.</span>
<a name="gbab-668"></a><span class="cm">     */</span>
<a name="gbab-669"></a>	<span class="n">X509_ALGOR</span>	<span class="o">*</span><span class="n">md_alg</span><span class="p">;</span>
<a name="gbab-670"></a>	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="o">*</span><span class="n">imprint</span><span class="p">;</span>
<a name="gbab-671"></a>	<span class="kt">unsigned</span>	<span class="n">imprint_len</span><span class="p">;</span>
<a name="gbab-672"></a>	<span class="cm">/* Must be set only with TS_VFY_DATA. */</span>
<a name="gbab-673"></a>	<span class="n">BIO</span>		<span class="o">*</span><span class="n">data</span><span class="p">;</span>
<a name="gbab-674"></a>	<span class="cm">/* Must be set only with TS_VFY_TSA_NAME. */</span>
<a name="gbab-675"></a>	<span class="n">ASN1_INTEGER</span>	<span class="o">*</span><span class="n">nonce</span><span class="p">;</span>
<a name="gbab-676"></a>	<span class="cm">/* Must be set only with TS_VFY_TSA_NAME. */</span>
<a name="gbab-677"></a>	<span class="n">GENERAL_NAME</span>	<span class="o">*</span><span class="n">tsa_name</span><span class="p">;</span>
<a name="gbab-678"></a>	<span class="p">}</span> <span class="n">TS_VERIFY_CTX</span><span class="p">;</span>
<a name="gbab-679"></a>
<a name="gbab-680"></a><span class="kt">int</span> <span class="nf">TS_RESP_verify_response</span><span class="p">(</span><span class="n">TS_VERIFY_CTX</span> <span class="o">*</span><span class="n">ctx</span><span class="p">,</span> <span class="n">TS_RESP</span> <span class="o">*</span><span class="n">response</span><span class="p">);</span>
<a name="gbab-681"></a><span class="kt">int</span> <span class="nf">TS_RESP_verify_token</span><span class="p">(</span><span class="n">TS_VERIFY_CTX</span> <span class="o">*</span><span class="n">ctx</span><span class="p">,</span> <span class="n">PKCS7</span> <span class="o">*</span><span class="n">token</span><span class="p">);</span>
<a name="gbab-682"></a>
<a name="gbab-683"></a><span class="cm">/*</span>
<a name="gbab-684"></a><span class="cm"> * Declarations related to response verification context,</span>
<a name="gbab-685"></a><span class="cm"> * they are defined in ts/ts_verify_ctx.c.</span>
<a name="gbab-686"></a><span class="cm"> */</span>
<a name="gbab-687"></a>
<a name="gbab-688"></a><span class="cm">/* Set all fields to zero. */</span>
<a name="gbab-689"></a><span class="n">TS_VERIFY_CTX</span> <span class="o">*</span><span class="nf">TS_VERIFY_CTX_new</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<a name="gbab-690"></a><span class="kt">void</span> <span class="nf">TS_VERIFY_CTX_init</span><span class="p">(</span><span class="n">TS_VERIFY_CTX</span> <span class="o">*</span><span class="n">ctx</span><span class="p">);</span>
<a name="gbab-691"></a><span class="kt">void</span> <span class="nf">TS_VERIFY_CTX_free</span><span class="p">(</span><span class="n">TS_VERIFY_CTX</span> <span class="o">*</span><span class="n">ctx</span><span class="p">);</span>
<a name="gbab-692"></a><span class="kt">void</span> <span class="nf">TS_VERIFY_CTX_cleanup</span><span class="p">(</span><span class="n">TS_VERIFY_CTX</span> <span class="o">*</span><span class="n">ctx</span><span class="p">);</span>
<a name="gbab-693"></a>
<a name="gbab-694"></a><span class="cm">/*-</span>
<a name="gbab-695"></a><span class="cm"> * If ctx is NULL, it allocates and returns a new object, otherwise</span>
<a name="gbab-696"></a><span class="cm"> * it returns ctx. It initialises all the members as follows:</span>
<a name="gbab-697"></a><span class="cm"> * flags = TS_VFY_ALL_IMPRINT &amp; ~(TS_VFY_TSA_NAME | TS_VFY_SIGNATURE)</span>
<a name="gbab-698"></a><span class="cm"> * certs = NULL</span>
<a name="gbab-699"></a><span class="cm"> * store = NULL</span>
<a name="gbab-700"></a><span class="cm"> * policy = policy from the request or NULL if absent (in this case</span>
<a name="gbab-701"></a><span class="cm"> *	TS_VFY_POLICY is cleared from flags as well)</span>
<a name="gbab-702"></a><span class="cm"> * md_alg = MD algorithm from request</span>
<a name="gbab-703"></a><span class="cm"> * imprint, imprint_len = imprint from request</span>
<a name="gbab-704"></a><span class="cm"> * data = NULL</span>
<a name="gbab-705"></a><span class="cm"> * nonce, nonce_len = nonce from the request or NULL if absent (in this case</span>
<a name="gbab-706"></a><span class="cm"> * 	TS_VFY_NONCE is cleared from flags as well)</span>
<a name="gbab-707"></a><span class="cm"> * tsa_name = NULL</span>
<a name="gbab-708"></a><span class="cm"> * Important: after calling this method TS_VFY_SIGNATURE should be added!</span>
<a name="gbab-709"></a><span class="cm"> */</span>
<a name="gbab-710"></a><span class="n">TS_VERIFY_CTX</span> <span class="o">*</span><span class="nf">TS_REQ_to_TS_VERIFY_CTX</span><span class="p">(</span><span class="n">TS_REQ</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span> <span class="n">TS_VERIFY_CTX</span> <span class="o">*</span><span class="n">ctx</span><span class="p">);</span>
<a name="gbab-711"></a>
<a name="gbab-712"></a><span class="cm">/* Function declarations for TS_RESP defined in ts/ts_resp_print.c */</span>
<a name="gbab-713"></a>
<a name="gbab-714"></a><span class="kt">int</span> <span class="nf">TS_RESP_print_bio</span><span class="p">(</span><span class="n">BIO</span> <span class="o">*</span><span class="n">bio</span><span class="p">,</span> <span class="n">TS_RESP</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-715"></a><span class="kt">int</span> <span class="nf">TS_STATUS_INFO_print_bio</span><span class="p">(</span><span class="n">BIO</span> <span class="o">*</span><span class="n">bio</span><span class="p">,</span> <span class="n">TS_STATUS_INFO</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-716"></a><span class="kt">int</span> <span class="nf">TS_TST_INFO_print_bio</span><span class="p">(</span><span class="n">BIO</span> <span class="o">*</span><span class="n">bio</span><span class="p">,</span> <span class="n">TS_TST_INFO</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<a name="gbab-717"></a>
<a name="gbab-718"></a><span class="cm">/* Common utility functions defined in ts/ts_lib.c */</span>
<a name="gbab-719"></a>
<a name="gbab-720"></a><span class="kt">int</span> <span class="nf">TS_ASN1_INTEGER_print_bio</span><span class="p">(</span><span class="n">BIO</span> <span class="o">*</span><span class="n">bio</span><span class="p">,</span> <span class="k">const</span> <span class="n">ASN1_INTEGER</span> <span class="o">*</span><span class="n">num</span><span class="p">);</span>
<a name="gbab-721"></a><span class="kt">int</span> <span class="nf">TS_OBJ_print_bio</span><span class="p">(</span><span class="n">BIO</span> <span class="o">*</span><span class="n">bio</span><span class="p">,</span> <span class="k">const</span> <span class="n">ASN1_OBJECT</span> <span class="o">*</span><span class="n">obj</span><span class="p">);</span>
<a name="gbab-722"></a><span class="kt">int</span> <span class="nf">TS_ext_print_bio</span><span class="p">(</span><span class="n">BIO</span> <span class="o">*</span><span class="n">bio</span><span class="p">,</span> <span class="k">const</span> <span class="n">STACK_OF</span><span class="p">(</span><span class="n">X509_EXTENSION</span><span class="p">)</span> <span class="o">*</span><span class="n">extensions</span><span class="p">);</span>
<a name="gbab-723"></a><span class="kt">int</span> <span class="nf">TS_X509_ALGOR_print_bio</span><span class="p">(</span><span class="n">BIO</span> <span class="o">*</span><span class="n">bio</span><span class="p">,</span> <span class="k">const</span> <span class="n">X509_ALGOR</span> <span class="o">*</span><span class="n">alg</span><span class="p">);</span>
<a name="gbab-724"></a><span class="kt">int</span> <span class="nf">TS_MSG_IMPRINT_print_bio</span><span class="p">(</span><span class="n">BIO</span> <span class="o">*</span><span class="n">bio</span><span class="p">,</span> <span class="n">TS_MSG_IMPRINT</span> <span class="o">*</span><span class="n">msg</span><span class="p">);</span>
<a name="gbab-725"></a>
<a name="gbab-726"></a><span class="cm">/*</span>
<a name="gbab-727"></a><span class="cm"> * Function declarations for handling configuration options, defined in</span>
<a name="gbab-728"></a><span class="cm"> * ts/ts_conf.c</span>
<a name="gbab-729"></a><span class="cm"> */</span>
<a name="gbab-730"></a>
<a name="gbab-731"></a><span class="n">X509</span> <span class="o">*</span><span class="nf">TS_CONF_load_cert</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">file</span><span class="p">);</span>
<a name="gbab-732"></a><span class="n">STACK_OF</span><span class="p">(</span><span class="n">X509</span><span class="p">)</span> <span class="o">*</span><span class="n">TS_CONF_load_certs</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">file</span><span class="p">);</span>
<a name="gbab-733"></a><span class="n">EVP_PKEY</span> <span class="o">*</span><span class="nf">TS_CONF_load_key</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">pass</span><span class="p">);</span>
<a name="gbab-734"></a><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="nf">TS_CONF_get_tsa_section</span><span class="p">(</span><span class="n">CONF</span> <span class="o">*</span><span class="n">conf</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">section</span><span class="p">);</span>
<a name="gbab-735"></a><span class="kt">int</span> <span class="nf">TS_CONF_set_serial</span><span class="p">(</span><span class="n">CONF</span> <span class="o">*</span><span class="n">conf</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">section</span><span class="p">,</span> <span class="n">TS_serial_cb</span> <span class="n">cb</span><span class="p">,</span>
<a name="gbab-736"></a>		       <span class="n">TS_RESP_CTX</span> <span class="o">*</span><span class="n">ctx</span><span class="p">);</span>
<a name="gbab-737"></a><span class="kt">int</span> <span class="nf">TS_CONF_set_crypto_device</span><span class="p">(</span><span class="n">CONF</span> <span class="o">*</span><span class="n">conf</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">section</span><span class="p">,</span>
<a name="gbab-738"></a>			      <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">device</span><span class="p">);</span>
<a name="gbab-739"></a><span class="kt">int</span> <span class="nf">TS_CONF_set_default_engine</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">);</span>
<a name="gbab-740"></a><span class="kt">int</span> <span class="nf">TS_CONF_set_signer_cert</span><span class="p">(</span><span class="n">CONF</span> <span class="o">*</span><span class="n">conf</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">section</span><span class="p">,</span>
<a name="gbab-741"></a>			    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">cert</span><span class="p">,</span> <span class="n">TS_RESP_CTX</span> <span class="o">*</span><span class="n">ctx</span><span class="p">);</span>
<a name="gbab-742"></a><span class="kt">int</span> <span class="nf">TS_CONF_set_certs</span><span class="p">(</span><span class="n">CONF</span> <span class="o">*</span><span class="n">conf</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">section</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">certs</span><span class="p">,</span>
<a name="gbab-743"></a>		      <span class="n">TS_RESP_CTX</span> <span class="o">*</span><span class="n">ctx</span><span class="p">);</span>
<a name="gbab-744"></a><span class="kt">int</span> <span class="nf">TS_CONF_set_signer_key</span><span class="p">(</span><span class="n">CONF</span> <span class="o">*</span><span class="n">conf</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">section</span><span class="p">,</span>
<a name="gbab-745"></a>                           <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">key</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">pass</span><span class="p">,</span>
<a name="gbab-746"></a>                           <span class="n">TS_RESP_CTX</span> <span class="o">*</span><span class="n">ctx</span><span class="p">);</span>
<a name="gbab-747"></a><span class="kt">int</span> <span class="nf">TS_CONF_set_def_policy</span><span class="p">(</span><span class="n">CONF</span> <span class="o">*</span><span class="n">conf</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">section</span><span class="p">,</span>
<a name="gbab-748"></a>			   <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">policy</span><span class="p">,</span> <span class="n">TS_RESP_CTX</span> <span class="o">*</span><span class="n">ctx</span><span class="p">);</span>
<a name="gbab-749"></a><span class="kt">int</span> <span class="nf">TS_CONF_set_policies</span><span class="p">(</span><span class="n">CONF</span> <span class="o">*</span><span class="n">conf</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">section</span><span class="p">,</span> <span class="n">TS_RESP_CTX</span> <span class="o">*</span><span class="n">ctx</span><span class="p">);</span>
<a name="gbab-750"></a><span class="kt">int</span> <span class="nf">TS_CONF_set_digests</span><span class="p">(</span><span class="n">CONF</span> <span class="o">*</span><span class="n">conf</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">section</span><span class="p">,</span> <span class="n">TS_RESP_CTX</span> <span class="o">*</span><span class="n">ctx</span><span class="p">);</span>
<a name="gbab-751"></a><span class="kt">int</span> <span class="nf">TS_CONF_set_accuracy</span><span class="p">(</span><span class="n">CONF</span> <span class="o">*</span><span class="n">conf</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">section</span><span class="p">,</span> <span class="n">TS_RESP_CTX</span> <span class="o">*</span><span class="n">ctx</span><span class="p">);</span>
<a name="gbab-752"></a><span class="kt">int</span> <span class="nf">TS_CONF_set_clock_precision_digits</span><span class="p">(</span><span class="n">CONF</span> <span class="o">*</span><span class="n">conf</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">section</span><span class="p">,</span>
<a name="gbab-753"></a>				       <span class="n">TS_RESP_CTX</span> <span class="o">*</span><span class="n">ctx</span><span class="p">);</span>
<a name="gbab-754"></a><span class="kt">int</span> <span class="nf">TS_CONF_set_ordering</span><span class="p">(</span><span class="n">CONF</span> <span class="o">*</span><span class="n">conf</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">section</span><span class="p">,</span> <span class="n">TS_RESP_CTX</span> <span class="o">*</span><span class="n">ctx</span><span class="p">);</span>
<a name="gbab-755"></a><span class="kt">int</span> <span class="nf">TS_CONF_set_tsa_name</span><span class="p">(</span><span class="n">CONF</span> <span class="o">*</span><span class="n">conf</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">section</span><span class="p">,</span> <span class="n">TS_RESP_CTX</span> <span class="o">*</span><span class="n">ctx</span><span class="p">);</span>
<a name="gbab-756"></a><span class="kt">int</span> <span class="nf">TS_CONF_set_ess_cert_id_chain</span><span class="p">(</span><span class="n">CONF</span> <span class="o">*</span><span class="n">conf</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">section</span><span class="p">,</span>
<a name="gbab-757"></a>				  <span class="n">TS_RESP_CTX</span> <span class="o">*</span><span class="n">ctx</span><span class="p">);</span>
<a name="gbab-758"></a>
<a name="gbab-759"></a><span class="cm">/* -------------------------------------------------- */</span>
<a name="gbab-760"></a><span class="cm">/* BEGIN ERROR CODES */</span>
<a name="gbab-761"></a><span class="cm">/*</span>
<a name="gbab-762"></a><span class="cm"> * The following lines are auto generated by the script mkerr.pl. Any changes</span>
<a name="gbab-763"></a><span class="cm"> * made after this point may be overwritten when the script is next run.</span>
<a name="gbab-764"></a><span class="cm"> */</span>
<a name="gbab-765"></a><span class="kt">void</span> <span class="nf">ERR_load_TS_strings</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<a name="gbab-766"></a>
<a name="gbab-767"></a><span class="cm">/* Error codes for the TS functions. */</span>
<a name="gbab-768"></a>
<a name="gbab-769"></a><span class="cm">/* Function codes. */</span>
<a name="gbab-770"></a><span class="cp">#define TS_F_D2I_TS_RESP				 147</span>
<a name="gbab-771"></a><span class="cp">#define TS_F_DEF_SERIAL_CB				 110</span>
<a name="gbab-772"></a><span class="cp">#define TS_F_DEF_TIME_CB				 111</span>
<a name="gbab-773"></a><span class="cp">#define TS_F_ESS_ADD_SIGNING_CERT			 112</span>
<a name="gbab-774"></a><span class="cp">#define TS_F_ESS_CERT_ID_NEW_INIT			 113</span>
<a name="gbab-775"></a><span class="cp">#define TS_F_ESS_SIGNING_CERT_NEW_INIT			 114</span>
<a name="gbab-776"></a><span class="cp">#define TS_F_INT_TS_RESP_VERIFY_TOKEN			 149</span>
<a name="gbab-777"></a><span class="cp">#define TS_F_PKCS7_TO_TS_TST_INFO			 148</span>
<a name="gbab-778"></a><span class="cp">#define TS_F_TS_ACCURACY_SET_MICROS			 115</span>
<a name="gbab-779"></a><span class="cp">#define TS_F_TS_ACCURACY_SET_MILLIS			 116</span>
<a name="gbab-780"></a><span class="cp">#define TS_F_TS_ACCURACY_SET_SECONDS			 117</span>
<a name="gbab-781"></a><span class="cp">#define TS_F_TS_CHECK_IMPRINTS				 100</span>
<a name="gbab-782"></a><span class="cp">#define TS_F_TS_CHECK_NONCES				 101</span>
<a name="gbab-783"></a><span class="cp">#define TS_F_TS_CHECK_POLICY				 102</span>
<a name="gbab-784"></a><span class="cp">#define TS_F_TS_CHECK_SIGNING_CERTS			 103</span>
<a name="gbab-785"></a><span class="cp">#define TS_F_TS_CHECK_STATUS_INFO			 104</span>
<a name="gbab-786"></a><span class="cp">#define TS_F_TS_COMPUTE_IMPRINT				 145</span>
<a name="gbab-787"></a><span class="cp">#define TS_F_TS_CONF_SET_DEFAULT_ENGINE			 146</span>
<a name="gbab-788"></a><span class="cp">#define TS_F_TS_GET_STATUS_TEXT				 105</span>
<a name="gbab-789"></a><span class="cp">#define TS_F_TS_MSG_IMPRINT_SET_ALGO			 118</span>
<a name="gbab-790"></a><span class="cp">#define TS_F_TS_REQ_SET_MSG_IMPRINT			 119</span>
<a name="gbab-791"></a><span class="cp">#define TS_F_TS_REQ_SET_NONCE				 120</span>
<a name="gbab-792"></a><span class="cp">#define TS_F_TS_REQ_SET_POLICY_ID			 121</span>
<a name="gbab-793"></a><span class="cp">#define TS_F_TS_RESP_CREATE_RESPONSE			 122</span>
<a name="gbab-794"></a><span class="cp">#define TS_F_TS_RESP_CREATE_TST_INFO			 123</span>
<a name="gbab-795"></a><span class="cp">#define TS_F_TS_RESP_CTX_ADD_FAILURE_INFO		 124</span>
<a name="gbab-796"></a><span class="cp">#define TS_F_TS_RESP_CTX_ADD_MD				 125</span>
<a name="gbab-797"></a><span class="cp">#define TS_F_TS_RESP_CTX_ADD_POLICY			 126</span>
<a name="gbab-798"></a><span class="cp">#define TS_F_TS_RESP_CTX_NEW				 127</span>
<a name="gbab-799"></a><span class="cp">#define TS_F_TS_RESP_CTX_SET_ACCURACY			 128</span>
<a name="gbab-800"></a><span class="cp">#define TS_F_TS_RESP_CTX_SET_CERTS			 129</span>
<a name="gbab-801"></a><span class="cp">#define TS_F_TS_RESP_CTX_SET_DEF_POLICY			 130</span>
<a name="gbab-802"></a><span class="cp">#define TS_F_TS_RESP_CTX_SET_SIGNER_CERT		 131</span>
<a name="gbab-803"></a><span class="cp">#define TS_F_TS_RESP_CTX_SET_STATUS_INFO		 132</span>
<a name="gbab-804"></a><span class="cp">#define TS_F_TS_RESP_GET_POLICY				 133</span>
<a name="gbab-805"></a><span class="cp">#define TS_F_TS_RESP_SET_GENTIME_WITH_PRECISION		 134</span>
<a name="gbab-806"></a><span class="cp">#define TS_F_TS_RESP_SET_STATUS_INFO			 135</span>
<a name="gbab-807"></a><span class="cp">#define TS_F_TS_RESP_SET_TST_INFO			 150</span>
<a name="gbab-808"></a><span class="cp">#define TS_F_TS_RESP_SIGN				 136</span>
<a name="gbab-809"></a><span class="cp">#define TS_F_TS_RESP_VERIFY_SIGNATURE			 106</span>
<a name="gbab-810"></a><span class="cp">#define TS_F_TS_RESP_VERIFY_TOKEN			 107</span>
<a name="gbab-811"></a><span class="cp">#define TS_F_TS_TST_INFO_SET_ACCURACY			 137</span>
<a name="gbab-812"></a><span class="cp">#define TS_F_TS_TST_INFO_SET_MSG_IMPRINT		 138</span>
<a name="gbab-813"></a><span class="cp">#define TS_F_TS_TST_INFO_SET_NONCE			 139</span>
<a name="gbab-814"></a><span class="cp">#define TS_F_TS_TST_INFO_SET_POLICY_ID			 140</span>
<a name="gbab-815"></a><span class="cp">#define TS_F_TS_TST_INFO_SET_SERIAL			 141</span>
<a name="gbab-816"></a><span class="cp">#define TS_F_TS_TST_INFO_SET_TIME			 142</span>
<a name="gbab-817"></a><span class="cp">#define TS_F_TS_TST_INFO_SET_TSA			 143</span>
<a name="gbab-818"></a><span class="cp">#define TS_F_TS_VERIFY					 108</span>
<a name="gbab-819"></a><span class="cp">#define TS_F_TS_VERIFY_CERT				 109</span>
<a name="gbab-820"></a><span class="cp">#define TS_F_TS_VERIFY_CTX_NEW				 144</span>
<a name="gbab-821"></a>
<a name="gbab-822"></a><span class="cm">/* Reason codes. */</span>
<a name="gbab-823"></a><span class="cp">#define TS_R_BAD_PKCS7_TYPE				 132</span>
<a name="gbab-824"></a><span class="cp">#define TS_R_BAD_TYPE					 133</span>
<a name="gbab-825"></a><span class="cp">#define TS_R_CERTIFICATE_VERIFY_ERROR			 100</span>
<a name="gbab-826"></a><span class="cp">#define TS_R_COULD_NOT_SET_ENGINE			 127</span>
<a name="gbab-827"></a><span class="cp">#define TS_R_COULD_NOT_SET_TIME				 115</span>
<a name="gbab-828"></a><span class="cp">#define TS_R_D2I_TS_RESP_INT_FAILED			 128</span>
<a name="gbab-829"></a><span class="cp">#define TS_R_DETACHED_CONTENT				 134</span>
<a name="gbab-830"></a><span class="cp">#define TS_R_ESS_ADD_SIGNING_CERT_ERROR			 116</span>
<a name="gbab-831"></a><span class="cp">#define TS_R_ESS_SIGNING_CERTIFICATE_ERROR		 101</span>
<a name="gbab-832"></a><span class="cp">#define TS_R_INVALID_NULL_POINTER			 102</span>
<a name="gbab-833"></a><span class="cp">#define TS_R_INVALID_SIGNER_CERTIFICATE_PURPOSE		 117</span>
<a name="gbab-834"></a><span class="cp">#define TS_R_MESSAGE_IMPRINT_MISMATCH			 103</span>
<a name="gbab-835"></a><span class="cp">#define TS_R_NONCE_MISMATCH				 104</span>
<a name="gbab-836"></a><span class="cp">#define TS_R_NONCE_NOT_RETURNED				 105</span>
<a name="gbab-837"></a><span class="cp">#define TS_R_NO_CONTENT					 106</span>
<a name="gbab-838"></a><span class="cp">#define TS_R_NO_TIME_STAMP_TOKEN			 107</span>
<a name="gbab-839"></a><span class="cp">#define TS_R_PKCS7_ADD_SIGNATURE_ERROR			 118</span>
<a name="gbab-840"></a><span class="cp">#define TS_R_PKCS7_ADD_SIGNED_ATTR_ERROR		 119</span>
<a name="gbab-841"></a><span class="cp">#define TS_R_PKCS7_TO_TS_TST_INFO_FAILED		 129</span>
<a name="gbab-842"></a><span class="cp">#define TS_R_POLICY_MISMATCH				 108</span>
<a name="gbab-843"></a><span class="cp">#define TS_R_PRIVATE_KEY_DOES_NOT_MATCH_CERTIFICATE	 120</span>
<a name="gbab-844"></a><span class="cp">#define TS_R_RESPONSE_SETUP_ERROR			 121</span>
<a name="gbab-845"></a><span class="cp">#define TS_R_SIGNATURE_FAILURE				 109</span>
<a name="gbab-846"></a><span class="cp">#define TS_R_THERE_MUST_BE_ONE_SIGNER			 110</span>
<a name="gbab-847"></a><span class="cp">#define TS_R_TIME_SYSCALL_ERROR				 122</span>
<a name="gbab-848"></a><span class="cp">#define TS_R_TOKEN_NOT_PRESENT				 130</span>
<a name="gbab-849"></a><span class="cp">#define TS_R_TOKEN_PRESENT				 131</span>
<a name="gbab-850"></a><span class="cp">#define TS_R_TSA_NAME_MISMATCH				 111</span>
<a name="gbab-851"></a><span class="cp">#define TS_R_TSA_UNTRUSTED				 112</span>
<a name="gbab-852"></a><span class="cp">#define TS_R_TST_INFO_SETUP_ERROR			 123</span>
<a name="gbab-853"></a><span class="cp">#define TS_R_TS_DATASIGN				 124</span>
<a name="gbab-854"></a><span class="cp">#define TS_R_UNACCEPTABLE_POLICY			 125</span>
<a name="gbab-855"></a><span class="cp">#define TS_R_UNSUPPORTED_MD_ALGORITHM			 126</span>
<a name="gbab-856"></a><span class="cp">#define TS_R_UNSUPPORTED_VERSION			 113</span>
<a name="gbab-857"></a><span class="cp">#define TS_R_WRONG_CONTENT_TYPE				 114</span>
<a name="gbab-858"></a>
<a name="gbab-859"></a><span class="cp">#ifdef  __cplusplus</span>
<a name="gbab-860"></a><span class="p">}</span>
<a name="gbab-861"></a><span class="cp">#endif</span>
<a name="gbab-862"></a><span class="cp">#endif</span>
</pre></div>
</td></tr></table>
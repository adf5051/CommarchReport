<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591</pre></div></td><td class="code"><div class="highlight"><pre><span></span><a name="gbab-1"></a><span class="cm">/********************************************************************</span>
<a name="gbab-2"></a><span class="cm"> *                                                                  *</span>
<a name="gbab-3"></a><span class="cm"> * THIS FILE IS PART OF THE OggTheora SOFTWARE CODEC SOURCE CODE.   *</span>
<a name="gbab-4"></a><span class="cm"> * USE, DISTRIBUTION AND REPRODUCTION OF THIS LIBRARY SOURCE IS     *</span>
<a name="gbab-5"></a><span class="cm"> * GOVERNED BY A BSD-STYLE SOURCE LICENSE INCLUDED WITH THIS SOURCE *</span>
<a name="gbab-6"></a><span class="cm"> * IN &#39;COPYING&#39;. PLEASE READ THESE TERMS BEFORE DISTRIBUTING.       *</span>
<a name="gbab-7"></a><span class="cm"> *                                                                  *</span>
<a name="gbab-8"></a><span class="cm"> * THE Theora SOURCE CODE IS COPYRIGHT (C) 2002-2009                *</span>
<a name="gbab-9"></a><span class="cm"> * by the Xiph.Org Foundation http://www.xiph.org/                  *</span>
<a name="gbab-10"></a><span class="cm"> *                                                                  *</span>
<a name="gbab-11"></a><span class="cm"> ********************************************************************</span>
<a name="gbab-12"></a>
<a name="gbab-13"></a><span class="cm">  function:</span>
<a name="gbab-14"></a><span class="cm">  last mod: $Id: theora.h,v 1.8 2004/03/15 22:17:32 derf Exp $</span>
<a name="gbab-15"></a>
<a name="gbab-16"></a><span class="cm"> ********************************************************************/</span>
<a name="gbab-17"></a>
<a name="gbab-18"></a><span class="cm">/**\mainpage</span>
<a name="gbab-19"></a><span class="cm"> * </span>
<a name="gbab-20"></a><span class="cm"> * \section intro Introduction</span>
<a name="gbab-21"></a><span class="cm"> *</span>
<a name="gbab-22"></a><span class="cm"> * This is the documentation for &lt;tt&gt;libtheora&lt;/tt&gt; C API.</span>
<a name="gbab-23"></a><span class="cm"> * The current reference</span>
<a name="gbab-24"></a><span class="cm"> * implementation for &lt;a href=&quot;http://www.theora.org/&quot;&gt;Theora&lt;/a&gt;, a free,</span>
<a name="gbab-25"></a><span class="cm"> * patent-unencumbered video codec.</span>
<a name="gbab-26"></a><span class="cm"> * Theora is derived from On2&#39;s VP3 codec with additional features and</span>
<a name="gbab-27"></a><span class="cm"> *  integration with Ogg multimedia formats by</span>
<a name="gbab-28"></a><span class="cm"> *  &lt;a href=&quot;http://www.xiph.org/&quot;&gt;the Xiph.Org Foundation&lt;/a&gt;.</span>
<a name="gbab-29"></a><span class="cm"> * Complete documentation of the format itself is available in</span>
<a name="gbab-30"></a><span class="cm"> * &lt;a href=&quot;http://www.theora.org/doc/Theora.pdf&quot;&gt;the Theora</span>
<a name="gbab-31"></a><span class="cm"> *  specification&lt;/a&gt;.</span>
<a name="gbab-32"></a><span class="cm"> *</span>
<a name="gbab-33"></a><span class="cm"> * \subsection Organization</span>
<a name="gbab-34"></a><span class="cm"> *</span>
<a name="gbab-35"></a><span class="cm"> * The functions documented here are actually subdivided into three </span>
<a name="gbab-36"></a><span class="cm"> * separate libraries:</span>
<a name="gbab-37"></a><span class="cm"> * - &lt;tt&gt;libtheoraenc&lt;/tt&gt; contains the encoder interface,</span>
<a name="gbab-38"></a><span class="cm"> *   described in \ref encfuncs.</span>
<a name="gbab-39"></a><span class="cm"> * - &lt;tt&gt;libtheoradec&lt;/tt&gt; contains the decoder interface and</span>
<a name="gbab-40"></a><span class="cm"> *   routines shared with the encoder.</span>
<a name="gbab-41"></a><span class="cm"> *   You must also link to this if you link to &lt;tt&gt;libtheoraenc&lt;/tt&gt;.</span>
<a name="gbab-42"></a><span class="cm"> *   The routines in this library are described in \ref decfuncs and </span>
<a name="gbab-43"></a><span class="cm"> *   \ref basefuncs.</span>
<a name="gbab-44"></a><span class="cm"> * - &lt;tt&gt;libtheora&lt;/tt&gt; contains the \ref oldfuncs.</span>
<a name="gbab-45"></a><span class="cm"> *</span>
<a name="gbab-46"></a><span class="cm"> * New code should link to &lt;tt&gt;libtheoradec&lt;/tt&gt; and, if using encoder</span>
<a name="gbab-47"></a><span class="cm"> * features, &lt;tt&gt;libtheoraenc&lt;/tt&gt;. Together these two export both</span>
<a name="gbab-48"></a><span class="cm"> * the standard and the legacy API, so this is all that is needed by</span>
<a name="gbab-49"></a><span class="cm"> * any code. The older &lt;tt&gt;libtheora&lt;/tt&gt; library is provided just for</span>
<a name="gbab-50"></a><span class="cm"> * compatibility with older build configurations.</span>
<a name="gbab-51"></a><span class="cm"> *</span>
<a name="gbab-52"></a><span class="cm"> * In general the recommended 1.x API symbols can be distinguished</span>
<a name="gbab-53"></a><span class="cm"> * by their &lt;tt&gt;th_&lt;/tt&gt; or &lt;tt&gt;TH_&lt;/tt&gt; namespace prefix.</span>
<a name="gbab-54"></a><span class="cm"> * The older, legacy API uses &lt;tt&gt;theora_&lt;/tt&gt; or &lt;tt&gt;OC_&lt;/tt&gt;</span>
<a name="gbab-55"></a><span class="cm"> * prefixes instead.</span>
<a name="gbab-56"></a><span class="cm"> */</span>
<a name="gbab-57"></a>
<a name="gbab-58"></a><span class="cm">/**\file</span>
<a name="gbab-59"></a><span class="cm"> * The shared &lt;tt&gt;libtheoradec&lt;/tt&gt; and &lt;tt&gt;libtheoraenc&lt;/tt&gt; C API.</span>
<a name="gbab-60"></a><span class="cm"> * You don&#39;t need to include this directly.*/</span>
<a name="gbab-61"></a>
<a name="gbab-62"></a><span class="cp">#if !defined(_O_THEORA_CODEC_H_)</span>
<a name="gbab-63"></a><span class="cp"># define _O_THEORA_CODEC_H_ (1)</span>
<a name="gbab-64"></a><span class="cp"># include &lt;ogg/ogg.h&gt;</span>
<a name="gbab-65"></a>
<a name="gbab-66"></a><span class="cp">#if defined(__cplusplus)</span>
<a name="gbab-67"></a><span class="k">extern</span> <span class="s">&quot;C&quot;</span> <span class="p">{</span>
<a name="gbab-68"></a><span class="cp">#endif</span>
<a name="gbab-69"></a>
<a name="gbab-70"></a>
<a name="gbab-71"></a>
<a name="gbab-72"></a><span class="cm">/**\name Return codes*/</span>
<a name="gbab-73"></a><span class="cm">/*@{*/</span>
<a name="gbab-74"></a><span class="cm">/**An invalid pointer was provided.*/</span>
<a name="gbab-75"></a><span class="cp">#define TH_EFAULT     (-1)</span>
<a name="gbab-76"></a><span class="cm">/**An invalid argument was provided.*/</span>
<a name="gbab-77"></a><span class="cp">#define TH_EINVAL     (-10)</span>
<a name="gbab-78"></a><span class="cm">/**The contents of the header were incomplete, invalid, or unexpected.*/</span>
<a name="gbab-79"></a><span class="cp">#define TH_EBADHEADER (-20)</span>
<a name="gbab-80"></a><span class="cm">/**The header does not belong to a Theora stream.*/</span>
<a name="gbab-81"></a><span class="cp">#define TH_ENOTFORMAT (-21)</span>
<a name="gbab-82"></a><span class="cm">/**The bitstream version is too high.*/</span>
<a name="gbab-83"></a><span class="cp">#define TH_EVERSION   (-22)</span>
<a name="gbab-84"></a><span class="cm">/**The specified function is not implemented.*/</span>
<a name="gbab-85"></a><span class="cp">#define TH_EIMPL      (-23)</span>
<a name="gbab-86"></a><span class="cm">/**There were errors in the video data packet.*/</span>
<a name="gbab-87"></a><span class="cp">#define TH_EBADPACKET (-24)</span>
<a name="gbab-88"></a><span class="cm">/**The decoded packet represented a dropped frame.</span>
<a name="gbab-89"></a><span class="cm">   The player can continue to display the current frame, as the contents of the</span>
<a name="gbab-90"></a><span class="cm">    decoded frame buffer have not changed.*/</span>
<a name="gbab-91"></a><span class="cp">#define TH_DUPFRAME   (1)</span>
<a name="gbab-92"></a><span class="cm">/*@}*/</span>
<a name="gbab-93"></a>
<a name="gbab-94"></a><span class="cm">/**The currently defined color space tags.</span>
<a name="gbab-95"></a><span class="cm"> * See &lt;a href=&quot;http://www.theora.org/doc/Theora.pdf&quot;&gt;the Theora</span>
<a name="gbab-96"></a><span class="cm"> *  specification&lt;/a&gt;, Chapter 4, for exact details on the meaning</span>
<a name="gbab-97"></a><span class="cm"> *  of each of these color spaces.*/</span>
<a name="gbab-98"></a><span class="k">typedef</span> <span class="k">enum</span><span class="p">{</span>
<a name="gbab-99"></a>  <span class="cm">/**The color space was not specified at the encoder.</span>
<a name="gbab-100"></a><span class="cm">      It may be conveyed by an external means.*/</span>
<a name="gbab-101"></a>  <span class="n">TH_CS_UNSPECIFIED</span><span class="p">,</span>
<a name="gbab-102"></a>  <span class="cm">/**A color space designed for NTSC content.*/</span>
<a name="gbab-103"></a>  <span class="n">TH_CS_ITU_REC_470M</span><span class="p">,</span>
<a name="gbab-104"></a>  <span class="cm">/**A color space designed for PAL/SECAM content.*/</span>
<a name="gbab-105"></a>  <span class="n">TH_CS_ITU_REC_470BG</span><span class="p">,</span>
<a name="gbab-106"></a>  <span class="cm">/**The total number of currently defined color spaces.*/</span>
<a name="gbab-107"></a>  <span class="n">TH_CS_NSPACES</span>
<a name="gbab-108"></a><span class="p">}</span><span class="n">th_colorspace</span><span class="p">;</span>
<a name="gbab-109"></a>
<a name="gbab-110"></a><span class="cm">/**The currently defined pixel format tags.</span>
<a name="gbab-111"></a><span class="cm"> * See &lt;a href=&quot;http://www.theora.org/doc/Theora.pdf&quot;&gt;the Theora</span>
<a name="gbab-112"></a><span class="cm"> *  specification&lt;/a&gt;, Section 4.4, for details on the precise sample</span>
<a name="gbab-113"></a><span class="cm"> *  locations.*/</span>
<a name="gbab-114"></a><span class="k">typedef</span> <span class="k">enum</span><span class="p">{</span>
<a name="gbab-115"></a>  <span class="cm">/**Chroma decimation by 2 in both the X and Y directions (4:2:0).</span>
<a name="gbab-116"></a><span class="cm">     The Cb and Cr chroma planes are half the width and half the</span>
<a name="gbab-117"></a><span class="cm">      height of the luma plane.*/</span>
<a name="gbab-118"></a>  <span class="n">TH_PF_420</span><span class="p">,</span>
<a name="gbab-119"></a>  <span class="cm">/**Currently reserved.*/</span>
<a name="gbab-120"></a>  <span class="n">TH_PF_RSVD</span><span class="p">,</span>
<a name="gbab-121"></a>  <span class="cm">/**Chroma decimation by 2 in the X direction (4:2:2).</span>
<a name="gbab-122"></a><span class="cm">     The Cb and Cr chroma planes are half the width of the luma plane, but full</span>
<a name="gbab-123"></a><span class="cm">      height.*/</span>
<a name="gbab-124"></a>  <span class="n">TH_PF_422</span><span class="p">,</span>
<a name="gbab-125"></a>  <span class="cm">/**No chroma decimation (4:4:4).</span>
<a name="gbab-126"></a><span class="cm">     The Cb and Cr chroma planes are full width and full height.*/</span>
<a name="gbab-127"></a>  <span class="n">TH_PF_444</span><span class="p">,</span>
<a name="gbab-128"></a>  <span class="cm">/**The total number of currently defined pixel formats.*/</span>
<a name="gbab-129"></a>  <span class="n">TH_PF_NFORMATS</span>
<a name="gbab-130"></a><span class="p">}</span><span class="n">th_pixel_fmt</span><span class="p">;</span>
<a name="gbab-131"></a>
<a name="gbab-132"></a>
<a name="gbab-133"></a>
<a name="gbab-134"></a><span class="cm">/**A buffer for a single color plane in an uncompressed image.</span>
<a name="gbab-135"></a><span class="cm"> * This contains the image data in a left-to-right, top-down format.</span>
<a name="gbab-136"></a><span class="cm"> * Each row of pixels is stored contiguously in memory, but successive</span>
<a name="gbab-137"></a><span class="cm"> *  rows need not be.</span>
<a name="gbab-138"></a><span class="cm"> * Use \a stride to compute the offset of the next row.</span>
<a name="gbab-139"></a><span class="cm"> * The encoder accepts both positive \a stride values (top-down in memory)</span>
<a name="gbab-140"></a><span class="cm"> *  and negative (bottom-up in memory).</span>
<a name="gbab-141"></a><span class="cm"> * The decoder currently always generates images with positive strides.*/</span>
<a name="gbab-142"></a><span class="k">typedef</span> <span class="k">struct</span><span class="p">{</span>
<a name="gbab-143"></a>  <span class="cm">/**The width of this plane.*/</span>
<a name="gbab-144"></a>  <span class="kt">int</span>            <span class="n">width</span><span class="p">;</span>
<a name="gbab-145"></a>  <span class="cm">/**The height of this plane.*/</span>
<a name="gbab-146"></a>  <span class="kt">int</span>            <span class="n">height</span><span class="p">;</span>
<a name="gbab-147"></a>  <span class="cm">/**The offset in bytes between successive rows.*/</span>
<a name="gbab-148"></a>  <span class="kt">int</span>            <span class="n">stride</span><span class="p">;</span>
<a name="gbab-149"></a>  <span class="cm">/**A pointer to the beginning of the first row.*/</span>
<a name="gbab-150"></a>  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">data</span><span class="p">;</span>
<a name="gbab-151"></a><span class="p">}</span><span class="n">th_img_plane</span><span class="p">;</span>
<a name="gbab-152"></a>
<a name="gbab-153"></a><span class="cm">/**A complete image buffer for an uncompressed frame.</span>
<a name="gbab-154"></a><span class="cm"> * The chroma planes may be decimated by a factor of two in either</span>
<a name="gbab-155"></a><span class="cm"> *  direction, as indicated by th_info#pixel_fmt.</span>
<a name="gbab-156"></a><span class="cm"> * The width and height of the Y&#39; plane must be multiples of 16.</span>
<a name="gbab-157"></a><span class="cm"> * They may need to be cropped for display, using the rectangle</span>
<a name="gbab-158"></a><span class="cm"> *  specified by th_info#pic_x, th_info#pic_y, th_info#pic_width,</span>
<a name="gbab-159"></a><span class="cm"> *  and th_info#pic_height.</span>
<a name="gbab-160"></a><span class="cm"> * All samples are 8 bits.</span>
<a name="gbab-161"></a><span class="cm"> * \note The term YUV often used to describe a colorspace is ambiguous.</span>
<a name="gbab-162"></a><span class="cm"> * The exact parameters of the RGB to YUV conversion process aside, in</span>
<a name="gbab-163"></a><span class="cm"> *  many contexts the U and V channels actually have opposite meanings.</span>
<a name="gbab-164"></a><span class="cm"> * To avoid this confusion, we are explicit: the name of the color</span>
<a name="gbab-165"></a><span class="cm"> *  channels are Y&#39;CbCr, and they appear in that order, always.</span>
<a name="gbab-166"></a><span class="cm"> * The prime symbol denotes that the Y channel is non-linear.</span>
<a name="gbab-167"></a><span class="cm"> * Cb and Cr stand for &quot;Chroma blue&quot; and &quot;Chroma red&quot;, respectively.*/</span>
<a name="gbab-168"></a><span class="k">typedef</span> <span class="n">th_img_plane</span> <span class="n">th_ycbcr_buffer</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<a name="gbab-169"></a>
<a name="gbab-170"></a><span class="cm">/**Theora bitstream information.</span>
<a name="gbab-171"></a><span class="cm"> * This contains the basic playback parameters for a stream, and corresponds to </span>
<a name="gbab-172"></a><span class="cm"> *  the initial &#39;info&#39; header packet.</span>
<a name="gbab-173"></a><span class="cm"> * To initialize an encoder, the application fills in this structure and</span>
<a name="gbab-174"></a><span class="cm"> *  passes it to th_encode_alloc().</span>
<a name="gbab-175"></a><span class="cm"> * A default encoding mode is chosen based on the values of the #quality and</span>
<a name="gbab-176"></a><span class="cm"> *  #target_bitrate fields.</span>
<a name="gbab-177"></a><span class="cm"> * On decode, it is filled in by th_decode_headerin(), and then passed to</span>
<a name="gbab-178"></a><span class="cm"> *  th_decode_alloc().</span>
<a name="gbab-179"></a><span class="cm"> *</span>
<a name="gbab-180"></a><span class="cm"> * Encoded Theora frames must be a multiple of 16 in size;</span>
<a name="gbab-181"></a><span class="cm"> *  this is what the #frame_width and #frame_height members represent.</span>
<a name="gbab-182"></a><span class="cm"> * To handle arbitrary picture sizes, a crop rectangle is specified in the</span>
<a name="gbab-183"></a><span class="cm"> *  #pic_x, #pic_y, #pic_width and #pic_height members.</span>
<a name="gbab-184"></a><span class="cm"> *</span>
<a name="gbab-185"></a><span class="cm"> * All frame buffers contain pointers to the full, padded frame.</span>
<a name="gbab-186"></a><span class="cm"> * However, the current encoder &lt;em&gt;will not&lt;/em&gt; reference pixels outside of</span>
<a name="gbab-187"></a><span class="cm"> *  the cropped picture region, and the application does not need to fill them</span>
<a name="gbab-188"></a><span class="cm"> *  in.</span>
<a name="gbab-189"></a><span class="cm"> * The decoder &lt;em&gt;will&lt;/em&gt; allocate storage for a full frame, but the</span>
<a name="gbab-190"></a><span class="cm"> *  application &lt;em&gt;should not&lt;/em&gt; rely on the padding containing sensible</span>
<a name="gbab-191"></a><span class="cm"> *  data.</span>
<a name="gbab-192"></a><span class="cm"> *</span>
<a name="gbab-193"></a><span class="cm"> * It is also generally recommended that the offsets and sizes should still be</span>
<a name="gbab-194"></a><span class="cm"> *  multiples of 2 to avoid chroma sampling shifts when chroma is sub-sampled.</span>
<a name="gbab-195"></a><span class="cm"> * See &lt;a href=&quot;http://www.theora.org/doc/Theora.pdf&quot;&gt;the Theora</span>
<a name="gbab-196"></a><span class="cm"> *  specification&lt;/a&gt;, Section 4.4, for more details.</span>
<a name="gbab-197"></a><span class="cm"> *</span>
<a name="gbab-198"></a><span class="cm"> * Frame rate, in frames per second, is stored as a rational fraction, as is</span>
<a name="gbab-199"></a><span class="cm"> *  the pixel aspect ratio.</span>
<a name="gbab-200"></a><span class="cm"> * Note that this refers to the aspect ratio of the individual pixels, not of</span>
<a name="gbab-201"></a><span class="cm"> *  the overall frame itself.</span>
<a name="gbab-202"></a><span class="cm"> * The frame aspect ratio can be computed from pixel aspect ratio using the</span>
<a name="gbab-203"></a><span class="cm"> *  image dimensions.*/</span>
<a name="gbab-204"></a><span class="k">typedef</span> <span class="k">struct</span><span class="p">{</span>
<a name="gbab-205"></a>  <span class="cm">/**\name Theora version</span>
<a name="gbab-206"></a><span class="cm">   * Bitstream version information.*/</span>
<a name="gbab-207"></a>  <span class="cm">/*@{*/</span>
<a name="gbab-208"></a>  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">version_major</span><span class="p">;</span>
<a name="gbab-209"></a>  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">version_minor</span><span class="p">;</span>
<a name="gbab-210"></a>  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">version_subminor</span><span class="p">;</span>
<a name="gbab-211"></a>  <span class="cm">/*@}*/</span>
<a name="gbab-212"></a>  <span class="cm">/**The encoded frame width.</span>
<a name="gbab-213"></a><span class="cm">   * This must be a multiple of 16, and less than 1048576.*/</span>
<a name="gbab-214"></a>  <span class="n">ogg_uint32_t</span>  <span class="n">frame_width</span><span class="p">;</span>
<a name="gbab-215"></a>  <span class="cm">/**The encoded frame height.</span>
<a name="gbab-216"></a><span class="cm">   * This must be a multiple of 16, and less than 1048576.*/</span>
<a name="gbab-217"></a>  <span class="n">ogg_uint32_t</span>  <span class="n">frame_height</span><span class="p">;</span>
<a name="gbab-218"></a>  <span class="cm">/**The displayed picture width.</span>
<a name="gbab-219"></a><span class="cm">   * This must be no larger than width.*/</span>
<a name="gbab-220"></a>  <span class="n">ogg_uint32_t</span>  <span class="n">pic_width</span><span class="p">;</span>
<a name="gbab-221"></a>  <span class="cm">/**The displayed picture height.</span>
<a name="gbab-222"></a><span class="cm">   * This must be no larger than height.*/</span>
<a name="gbab-223"></a>  <span class="n">ogg_uint32_t</span>  <span class="n">pic_height</span><span class="p">;</span>
<a name="gbab-224"></a>  <span class="cm">/**The X offset of the displayed picture.</span>
<a name="gbab-225"></a><span class="cm">   * This must be no larger than #frame_width-#pic_width or 255, whichever is</span>
<a name="gbab-226"></a><span class="cm">   *  smaller.*/</span>
<a name="gbab-227"></a>  <span class="n">ogg_uint32_t</span>  <span class="n">pic_x</span><span class="p">;</span>
<a name="gbab-228"></a>  <span class="cm">/**The Y offset of the displayed picture.</span>
<a name="gbab-229"></a><span class="cm">   * This must be no larger than #frame_height-#pic_height, and</span>
<a name="gbab-230"></a><span class="cm">   *  #frame_height-#pic_height-#pic_y must be no larger than 255.</span>
<a name="gbab-231"></a><span class="cm">   * This slightly funny restriction is due to the fact that the offset is</span>
<a name="gbab-232"></a><span class="cm">   *  specified from the top of the image for consistency with the standard</span>
<a name="gbab-233"></a><span class="cm">   *  graphics left-handed coordinate system used throughout this API, while</span>
<a name="gbab-234"></a><span class="cm">   *  it is stored in the encoded stream as an offset from the bottom.*/</span>
<a name="gbab-235"></a>  <span class="n">ogg_uint32_t</span>  <span class="n">pic_y</span><span class="p">;</span>
<a name="gbab-236"></a>  <span class="cm">/**\name Frame rate</span>
<a name="gbab-237"></a><span class="cm">   * The frame rate, as a fraction.</span>
<a name="gbab-238"></a><span class="cm">   * If either is 0, the frame rate is undefined.*/</span>
<a name="gbab-239"></a>  <span class="cm">/*@{*/</span>
<a name="gbab-240"></a>  <span class="n">ogg_uint32_t</span>  <span class="n">fps_numerator</span><span class="p">;</span>
<a name="gbab-241"></a>  <span class="n">ogg_uint32_t</span>  <span class="n">fps_denominator</span><span class="p">;</span>
<a name="gbab-242"></a>  <span class="cm">/*@}*/</span>
<a name="gbab-243"></a>  <span class="cm">/**\name Aspect ratio</span>
<a name="gbab-244"></a><span class="cm">   * The aspect ratio of the pixels.</span>
<a name="gbab-245"></a><span class="cm">   * If either value is zero, the aspect ratio is undefined.</span>
<a name="gbab-246"></a><span class="cm">   * If not specified by any external means, 1:1 should be assumed.</span>
<a name="gbab-247"></a><span class="cm">   * The aspect ratio of the full picture can be computed as</span>
<a name="gbab-248"></a><span class="cm">   * \code</span>
<a name="gbab-249"></a><span class="cm">   *  aspect_numerator*pic_width/(aspect_denominator*pic_height).</span>
<a name="gbab-250"></a><span class="cm">   * \endcode */</span>
<a name="gbab-251"></a>  <span class="cm">/*@{*/</span>
<a name="gbab-252"></a>  <span class="n">ogg_uint32_t</span>  <span class="n">aspect_numerator</span><span class="p">;</span>
<a name="gbab-253"></a>  <span class="n">ogg_uint32_t</span>  <span class="n">aspect_denominator</span><span class="p">;</span>
<a name="gbab-254"></a>  <span class="cm">/*@}*/</span>
<a name="gbab-255"></a>  <span class="cm">/**The color space.*/</span>
<a name="gbab-256"></a>  <span class="n">th_colorspace</span> <span class="n">colorspace</span><span class="p">;</span>
<a name="gbab-257"></a>  <span class="cm">/**The pixel format.*/</span>
<a name="gbab-258"></a>  <span class="n">th_pixel_fmt</span>  <span class="n">pixel_fmt</span><span class="p">;</span>
<a name="gbab-259"></a>  <span class="cm">/**The target bit-rate in bits per second.</span>
<a name="gbab-260"></a><span class="cm">     If initializing an encoder with this struct, set this field to a non-zero</span>
<a name="gbab-261"></a><span class="cm">      value to activate CBR encoding by default.*/</span>
<a name="gbab-262"></a>  <span class="kt">int</span>           <span class="n">target_bitrate</span><span class="p">;</span>
<a name="gbab-263"></a>  <span class="cm">/**The target quality level.</span>
<a name="gbab-264"></a><span class="cm">     Valid values range from 0 to 63, inclusive, with higher values giving</span>
<a name="gbab-265"></a><span class="cm">      higher quality.</span>
<a name="gbab-266"></a><span class="cm">     If initializing an encoder with this struct, and #target_bitrate is set</span>
<a name="gbab-267"></a><span class="cm">      to zero, VBR encoding at this quality will be activated by default.*/</span>
<a name="gbab-268"></a>  <span class="cm">/*Currently this is set so that a qi of 0 corresponds to distortions of 24</span>
<a name="gbab-269"></a><span class="cm">     times the JND, and each increase by 16 halves that value.</span>
<a name="gbab-270"></a><span class="cm">    This gives us fine discrimination at low qualities, yet effective rate</span>
<a name="gbab-271"></a><span class="cm">     control at high qualities.</span>
<a name="gbab-272"></a><span class="cm">    The qi value 63 is special, however.</span>
<a name="gbab-273"></a><span class="cm">    For this, the highest quality, we use one half of a JND for our threshold.</span>
<a name="gbab-274"></a><span class="cm">    Due to the lower bounds placed on allowable quantizers in Theora, we will</span>
<a name="gbab-275"></a><span class="cm">     not actually be able to achieve quality this good, but this should</span>
<a name="gbab-276"></a><span class="cm">     provide as close to visually lossless quality as Theora is capable of.</span>
<a name="gbab-277"></a><span class="cm">    We could lift the quantizer restrictions without breaking VP3.1</span>
<a name="gbab-278"></a><span class="cm">     compatibility, but this would result in quantized coefficients that are</span>
<a name="gbab-279"></a><span class="cm">     too large for the current bitstream to be able to store.</span>
<a name="gbab-280"></a><span class="cm">    We&#39;d have to redesign the token syntax to store these large coefficients,</span>
<a name="gbab-281"></a><span class="cm">     which would make transcoding complex.*/</span>
<a name="gbab-282"></a>  <span class="kt">int</span>           <span class="n">quality</span><span class="p">;</span>
<a name="gbab-283"></a>  <span class="cm">/**The amount to shift to extract the last keyframe number from the granule</span>
<a name="gbab-284"></a><span class="cm">   *  position.</span>
<a name="gbab-285"></a><span class="cm">   * This can be at most 31.</span>
<a name="gbab-286"></a><span class="cm">   * th_info_init() will set this to a default value (currently &lt;tt&gt;6&lt;/tt&gt;,</span>
<a name="gbab-287"></a><span class="cm">   *  which is good for streaming applications), but you can set it to 0 to</span>
<a name="gbab-288"></a><span class="cm">   *  make every frame a keyframe.</span>
<a name="gbab-289"></a><span class="cm">   * The maximum distance between key frames is</span>
<a name="gbab-290"></a><span class="cm">   *  &lt;tt&gt;1&lt;&lt;#keyframe_granule_shift&lt;/tt&gt;.</span>
<a name="gbab-291"></a><span class="cm">   * The keyframe frequency can be more finely controlled with</span>
<a name="gbab-292"></a><span class="cm">   *  #TH_ENCCTL_SET_KEYFRAME_FREQUENCY_FORCE, which can also be adjusted</span>
<a name="gbab-293"></a><span class="cm">   *  during encoding (for example, to force the next frame to be a keyframe),</span>
<a name="gbab-294"></a><span class="cm">   *  but it cannot be set larger than the amount permitted by this field after</span>
<a name="gbab-295"></a><span class="cm">   *  the headers have been output.*/</span>
<a name="gbab-296"></a>  <span class="kt">int</span>           <span class="n">keyframe_granule_shift</span><span class="p">;</span>
<a name="gbab-297"></a><span class="p">}</span><span class="n">th_info</span><span class="p">;</span>
<a name="gbab-298"></a>
<a name="gbab-299"></a><span class="cm">/**The comment information.</span>
<a name="gbab-300"></a><span class="cm"> *</span>
<a name="gbab-301"></a><span class="cm"> * This structure holds the in-stream metadata corresponding to</span>
<a name="gbab-302"></a><span class="cm"> *  the &#39;comment&#39; header packet.</span>
<a name="gbab-303"></a><span class="cm"> * The comment header is meant to be used much like someone jotting a quick</span>
<a name="gbab-304"></a><span class="cm"> *  note on the label of a video.</span>
<a name="gbab-305"></a><span class="cm"> * It should be a short, to the point text note that can be more than a couple</span>
<a name="gbab-306"></a><span class="cm"> *  words, but not more than a short paragraph.</span>
<a name="gbab-307"></a><span class="cm"> *</span>
<a name="gbab-308"></a><span class="cm"> * The metadata is stored as a series of (tag, value) pairs, in</span>
<a name="gbab-309"></a><span class="cm"> *  length-encoded string vectors.</span>
<a name="gbab-310"></a><span class="cm"> * The first occurrence of the &#39;=&#39; character delimits the tag and value.</span>
<a name="gbab-311"></a><span class="cm"> * A particular tag may occur more than once, and order is significant.</span>
<a name="gbab-312"></a><span class="cm"> * The character set encoding for the strings is always UTF-8, but the tag</span>
<a name="gbab-313"></a><span class="cm"> *  names are limited to ASCII, and treated as case-insensitive.</span>
<a name="gbab-314"></a><span class="cm"> * See &lt;a href=&quot;http://www.theora.org/doc/Theora.pdf&quot;&gt;the Theora</span>
<a name="gbab-315"></a><span class="cm"> *  specification&lt;/a&gt;, Section 6.3.3 for details.</span>
<a name="gbab-316"></a><span class="cm"> *</span>
<a name="gbab-317"></a><span class="cm"> * In filling in this structure, th_decode_headerin() will null-terminate</span>
<a name="gbab-318"></a><span class="cm"> *  the user_comment strings for safety.</span>
<a name="gbab-319"></a><span class="cm"> * However, the bitstream format itself treats them as 8-bit clean vectors,</span>
<a name="gbab-320"></a><span class="cm"> *  possibly containing null characters, and so the length array should be</span>
<a name="gbab-321"></a><span class="cm"> *  treated as their authoritative length.</span>
<a name="gbab-322"></a><span class="cm"> */</span>
<a name="gbab-323"></a><span class="k">typedef</span> <span class="k">struct</span> <span class="n">th_comment</span><span class="p">{</span>
<a name="gbab-324"></a>  <span class="cm">/**The array of comment string vectors.*/</span>
<a name="gbab-325"></a>  <span class="kt">char</span> <span class="o">**</span><span class="n">user_comments</span><span class="p">;</span>
<a name="gbab-326"></a>  <span class="cm">/**An array of the corresponding length of each vector, in bytes.*/</span>
<a name="gbab-327"></a>  <span class="kt">int</span>   <span class="o">*</span><span class="n">comment_lengths</span><span class="p">;</span>
<a name="gbab-328"></a>  <span class="cm">/**The total number of comment strings.*/</span>
<a name="gbab-329"></a>  <span class="kt">int</span>    <span class="n">comments</span><span class="p">;</span>
<a name="gbab-330"></a>  <span class="cm">/**The null-terminated vendor string.</span>
<a name="gbab-331"></a><span class="cm">     This identifies the software used to encode the stream.*/</span>
<a name="gbab-332"></a>  <span class="kt">char</span>  <span class="o">*</span><span class="n">vendor</span><span class="p">;</span>
<a name="gbab-333"></a><span class="p">}</span><span class="n">th_comment</span><span class="p">;</span>
<a name="gbab-334"></a>
<a name="gbab-335"></a>
<a name="gbab-336"></a>
<a name="gbab-337"></a><span class="cm">/**A single base matrix.*/</span>
<a name="gbab-338"></a><span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">th_quant_base</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
<a name="gbab-339"></a>
<a name="gbab-340"></a><span class="cm">/**A set of \a qi ranges.*/</span>
<a name="gbab-341"></a><span class="k">typedef</span> <span class="k">struct</span><span class="p">{</span>
<a name="gbab-342"></a>  <span class="cm">/**The number of ranges in the set.*/</span>
<a name="gbab-343"></a>  <span class="kt">int</span>                  <span class="n">nranges</span><span class="p">;</span>
<a name="gbab-344"></a>  <span class="cm">/**The size of each of the #nranges ranges.</span>
<a name="gbab-345"></a><span class="cm">     These must sum to 63.*/</span>
<a name="gbab-346"></a>  <span class="k">const</span> <span class="kt">int</span>           <span class="o">*</span><span class="n">sizes</span><span class="p">;</span>
<a name="gbab-347"></a>  <span class="cm">/**#nranges &lt;tt&gt;+1&lt;/tt&gt; base matrices.</span>
<a name="gbab-348"></a><span class="cm">     Matrices \a i and &lt;tt&gt;i+1&lt;/tt&gt; form the endpoints of range \a i.*/</span>
<a name="gbab-349"></a>  <span class="k">const</span> <span class="n">th_quant_base</span> <span class="o">*</span><span class="n">base_matrices</span><span class="p">;</span>
<a name="gbab-350"></a><span class="p">}</span><span class="n">th_quant_ranges</span><span class="p">;</span>
<a name="gbab-351"></a>
<a name="gbab-352"></a><span class="cm">/**A complete set of quantization parameters.</span>
<a name="gbab-353"></a><span class="cm">   The quantizer for each coefficient is calculated as:</span>
<a name="gbab-354"></a><span class="cm">   \code</span>
<a name="gbab-355"></a><span class="cm">    Q=MAX(MIN(qmin[qti][ci!=0],scale[ci!=0][qi]*base[qti][pli][qi][ci]/100),</span>
<a name="gbab-356"></a><span class="cm">     1024).</span>
<a name="gbab-357"></a><span class="cm">   \endcode</span>
<a name="gbab-358"></a>
<a name="gbab-359"></a><span class="cm">   \a qti is the quantization type index: 0 for intra, 1 for inter.</span>
<a name="gbab-360"></a><span class="cm">   &lt;tt&gt;ci!=0&lt;/tt&gt; is 0 for the DC coefficient and 1 for AC coefficients.</span>
<a name="gbab-361"></a><span class="cm">   \a qi is the quality index, ranging between 0 (low quality) and 63 (high</span>
<a name="gbab-362"></a><span class="cm">    quality).</span>
<a name="gbab-363"></a><span class="cm">   \a pli is the color plane index: 0 for Y&#39;, 1 for Cb, 2 for Cr.</span>
<a name="gbab-364"></a><span class="cm">   \a ci is the DCT coefficient index.</span>
<a name="gbab-365"></a><span class="cm">   Coefficient indices correspond to the normal 2D DCT block</span>
<a name="gbab-366"></a><span class="cm">    ordering--row-major with low frequencies first--\em not zig-zag order.</span>
<a name="gbab-367"></a>
<a name="gbab-368"></a><span class="cm">   Minimum quantizers are constant, and are given by:</span>
<a name="gbab-369"></a><span class="cm">   \code</span>
<a name="gbab-370"></a><span class="cm">   qmin[2][2]={{4,2},{8,4}}.</span>
<a name="gbab-371"></a><span class="cm">   \endcode</span>
<a name="gbab-372"></a>
<a name="gbab-373"></a><span class="cm">   Parameters that can be stored in the bitstream are as follows:</span>
<a name="gbab-374"></a><span class="cm">    - The two scale matrices ac_scale and dc_scale.</span>
<a name="gbab-375"></a><span class="cm">      \code</span>
<a name="gbab-376"></a><span class="cm">      scale[2][64]={dc_scale,ac_scale}.</span>
<a name="gbab-377"></a><span class="cm">      \endcode</span>
<a name="gbab-378"></a><span class="cm">    - The base matrices for each \a qi, \a qti and \a pli (up to 384 in all).</span>
<a name="gbab-379"></a><span class="cm">      In order to avoid storing a full 384 base matrices, only a sparse set of</span>
<a name="gbab-380"></a><span class="cm">       matrices are stored, and the rest are linearly interpolated.</span>
<a name="gbab-381"></a><span class="cm">      This is done as follows.</span>
<a name="gbab-382"></a><span class="cm">      For each \a qti and \a pli, a series of \a n \a qi ranges is defined.</span>
<a name="gbab-383"></a><span class="cm">      The size of each \a qi range can vary arbitrarily, but they must sum to</span>
<a name="gbab-384"></a><span class="cm">       63.</span>
<a name="gbab-385"></a><span class="cm">      Then, &lt;tt&gt;n+1&lt;/tt&gt; matrices are specified, one for each endpoint of the</span>
<a name="gbab-386"></a><span class="cm">       ranges.</span>
<a name="gbab-387"></a><span class="cm">      For interpolation purposes, each range&#39;s endpoints are the first \a qi</span>
<a name="gbab-388"></a><span class="cm">       value it contains and one past the last \a qi value it contains.</span>
<a name="gbab-389"></a><span class="cm">      Fractional values are rounded to the nearest integer, with ties rounded</span>
<a name="gbab-390"></a><span class="cm">       away from zero.</span>
<a name="gbab-391"></a>
<a name="gbab-392"></a><span class="cm">      Base matrices are stored by reference, so if the same matrices are used</span>
<a name="gbab-393"></a><span class="cm">       multiple times, they will only appear once in the bitstream.</span>
<a name="gbab-394"></a><span class="cm">      The bitstream is also capable of omitting an entire set of ranges and</span>
<a name="gbab-395"></a><span class="cm">       its associated matrices if they are the same as either the previous</span>
<a name="gbab-396"></a><span class="cm">       set (indexed in row-major order) or if the inter set is the same as the</span>
<a name="gbab-397"></a><span class="cm">       intra set.</span>
<a name="gbab-398"></a>
<a name="gbab-399"></a><span class="cm">    - Loop filter limit values.</span>
<a name="gbab-400"></a><span class="cm">      The same limits are used for the loop filter in all color planes, despite</span>
<a name="gbab-401"></a><span class="cm">       potentially differing levels of quantization in each.</span>
<a name="gbab-402"></a>
<a name="gbab-403"></a><span class="cm">   For the current encoder, &lt;tt&gt;scale[ci!=0][qi]&lt;/tt&gt; must be no greater</span>
<a name="gbab-404"></a><span class="cm">    than &lt;tt&gt;scale[ci!=0][qi-1]&lt;/tt&gt; and &lt;tt&gt;base[qti][pli][qi][ci]&lt;/tt&gt; must</span>
<a name="gbab-405"></a><span class="cm">    be no greater than &lt;tt&gt;base[qti][pli][qi-1][ci]&lt;/tt&gt;.</span>
<a name="gbab-406"></a><span class="cm">   These two conditions ensure that the actual quantizer for a given \a qti,</span>
<a name="gbab-407"></a><span class="cm">    \a pli, and \a ci does not increase as \a qi increases.</span>
<a name="gbab-408"></a><span class="cm">   This is not required by the decoder.*/</span>
<a name="gbab-409"></a><span class="k">typedef</span> <span class="k">struct</span><span class="p">{</span>
<a name="gbab-410"></a>  <span class="cm">/**The DC scaling factors.*/</span>
<a name="gbab-411"></a>  <span class="n">ogg_uint16_t</span>    <span class="n">dc_scale</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
<a name="gbab-412"></a>  <span class="cm">/**The AC scaling factors.*/</span>
<a name="gbab-413"></a>  <span class="n">ogg_uint16_t</span>    <span class="n">ac_scale</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
<a name="gbab-414"></a>  <span class="cm">/**The loop filter limit values.*/</span>
<a name="gbab-415"></a>  <span class="kt">unsigned</span> <span class="kt">char</span>   <span class="n">loop_filter_limits</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
<a name="gbab-416"></a>  <span class="cm">/**The \a qi ranges for each \a ci and \a pli.*/</span>
<a name="gbab-417"></a>  <span class="n">th_quant_ranges</span> <span class="n">qi_ranges</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">];</span>
<a name="gbab-418"></a><span class="p">}</span><span class="n">th_quant_info</span><span class="p">;</span>
<a name="gbab-419"></a>
<a name="gbab-420"></a>
<a name="gbab-421"></a>
<a name="gbab-422"></a><span class="cm">/**The number of Huffman tables used by Theora.*/</span>
<a name="gbab-423"></a><span class="cp">#define TH_NHUFFMAN_TABLES (80)</span>
<a name="gbab-424"></a><span class="cm">/**The number of DCT token values in each table.*/</span>
<a name="gbab-425"></a><span class="cp">#define TH_NDCT_TOKENS     (32)</span>
<a name="gbab-426"></a>
<a name="gbab-427"></a><span class="cm">/**A Huffman code for a Theora DCT token.</span>
<a name="gbab-428"></a><span class="cm"> * Each set of Huffman codes in a given table must form a complete, prefix-free</span>
<a name="gbab-429"></a><span class="cm"> *  code.</span>
<a name="gbab-430"></a><span class="cm"> * There is no requirement that all the tokens in a table have a valid code,</span>
<a name="gbab-431"></a><span class="cm"> *  but the current encoder is not optimized to take advantage of this.</span>
<a name="gbab-432"></a><span class="cm"> * If each of the five grouops of 16 tables does not contain at least one table</span>
<a name="gbab-433"></a><span class="cm"> *  with a code for every token, then the encoder may fail to encode certain</span>
<a name="gbab-434"></a><span class="cm"> *  frames.</span>
<a name="gbab-435"></a><span class="cm"> * The complete table in the first group of 16 does not have to be in the same</span>
<a name="gbab-436"></a><span class="cm"> *  place as the complete table in the other groups, but the complete tables in</span>
<a name="gbab-437"></a><span class="cm"> *  the remaining four groups must all be in the same place.*/</span>
<a name="gbab-438"></a><span class="k">typedef</span> <span class="k">struct</span><span class="p">{</span>
<a name="gbab-439"></a>  <span class="cm">/**The bit pattern for the code, with the LSbit of the pattern aligned in</span>
<a name="gbab-440"></a><span class="cm">   *   the LSbit of the word.*/</span>
<a name="gbab-441"></a>  <span class="n">ogg_uint32_t</span> <span class="n">pattern</span><span class="p">;</span>
<a name="gbab-442"></a>  <span class="cm">/**The number of bits in the code.</span>
<a name="gbab-443"></a><span class="cm">   * This must be between 0 and 32, inclusive.*/</span>
<a name="gbab-444"></a>  <span class="kt">int</span>          <span class="n">nbits</span><span class="p">;</span>
<a name="gbab-445"></a><span class="p">}</span><span class="n">th_huff_code</span><span class="p">;</span>
<a name="gbab-446"></a>
<a name="gbab-447"></a>
<a name="gbab-448"></a>
<a name="gbab-449"></a><span class="cm">/**\defgroup basefuncs Functions Shared by Encode and Decode*/</span>
<a name="gbab-450"></a><span class="cm">/*@{*/</span>
<a name="gbab-451"></a><span class="cm">/**\name Basic shared functions*/</span>
<a name="gbab-452"></a><span class="cm">/*@{*/</span>
<a name="gbab-453"></a><span class="cm">/**Retrieves a human-readable string to identify the library vendor and</span>
<a name="gbab-454"></a><span class="cm"> *  version.</span>
<a name="gbab-455"></a><span class="cm"> * \return the version string.*/</span>
<a name="gbab-456"></a><span class="k">extern</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="nf">th_version_string</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<a name="gbab-457"></a><span class="cm">/**Retrieves the library version number.</span>
<a name="gbab-458"></a><span class="cm"> * This is the highest bitstream version that the encoder library will produce,</span>
<a name="gbab-459"></a><span class="cm"> *  or that the decoder library can decode.</span>
<a name="gbab-460"></a><span class="cm"> * This number is composed of a 16-bit major version, 8-bit minor version</span>
<a name="gbab-461"></a><span class="cm"> * and 8 bit sub-version, composed as follows:</span>
<a name="gbab-462"></a><span class="cm"> * \code</span>
<a name="gbab-463"></a><span class="cm"> * (VERSION_MAJOR&lt;&lt;16)+(VERSION_MINOR&lt;&lt;8)+(VERSION_SUBMINOR)</span>
<a name="gbab-464"></a><span class="cm"> * \endcode</span>
<a name="gbab-465"></a><span class="cm"> * \return the version number.*/</span>
<a name="gbab-466"></a><span class="k">extern</span> <span class="n">ogg_uint32_t</span> <span class="nf">th_version_number</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<a name="gbab-467"></a><span class="cm">/**Converts a granule position to an absolute frame index, starting at</span>
<a name="gbab-468"></a><span class="cm"> *  &lt;tt&gt;0&lt;/tt&gt;.</span>
<a name="gbab-469"></a><span class="cm"> * The granule position is interpreted in the context of a given</span>
<a name="gbab-470"></a><span class="cm"> *  #th_enc_ctx or #th_dec_ctx handle (either will suffice).</span>
<a name="gbab-471"></a><span class="cm"> * \param _encdec  A previously allocated #th_enc_ctx or #th_dec_ctx</span>
<a name="gbab-472"></a><span class="cm"> *                  handle.</span>
<a name="gbab-473"></a><span class="cm"> * \param _granpos The granule position to convert.</span>
<a name="gbab-474"></a><span class="cm"> * \returns The absolute frame index corresponding to \a _granpos.</span>
<a name="gbab-475"></a><span class="cm"> * \retval -1 The given granule position was invalid (i.e. negative).*/</span>
<a name="gbab-476"></a><span class="k">extern</span> <span class="n">ogg_int64_t</span> <span class="nf">th_granule_frame</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">_encdec</span><span class="p">,</span><span class="n">ogg_int64_t</span> <span class="n">_granpos</span><span class="p">);</span>
<a name="gbab-477"></a><span class="cm">/**Converts a granule position to an absolute time in seconds.</span>
<a name="gbab-478"></a><span class="cm"> * The granule position is interpreted in the context of a given</span>
<a name="gbab-479"></a><span class="cm"> *  #th_enc_ctx or #th_dec_ctx handle (either will suffice).</span>
<a name="gbab-480"></a><span class="cm"> * \param _encdec  A previously allocated #th_enc_ctx or #th_dec_ctx</span>
<a name="gbab-481"></a><span class="cm"> *                  handle.</span>
<a name="gbab-482"></a><span class="cm"> * \param _granpos The granule position to convert.</span>
<a name="gbab-483"></a><span class="cm"> * \return The absolute time in seconds corresponding to \a _granpos.</span>
<a name="gbab-484"></a><span class="cm"> *         This is the &quot;end time&quot; for the frame, or the latest time it should</span>
<a name="gbab-485"></a><span class="cm"> *          be displayed.</span>
<a name="gbab-486"></a><span class="cm"> *         It is not the presentation time.</span>
<a name="gbab-487"></a><span class="cm"> * \retval -1 The given granule position was invalid (i.e. negative).*/</span>
<a name="gbab-488"></a><span class="k">extern</span> <span class="kt">double</span> <span class="nf">th_granule_time</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">_encdec</span><span class="p">,</span><span class="n">ogg_int64_t</span> <span class="n">_granpos</span><span class="p">);</span>
<a name="gbab-489"></a><span class="cm">/**Determines whether a Theora packet is a header or not.</span>
<a name="gbab-490"></a><span class="cm"> * This function does no verification beyond checking the packet type bit, so</span>
<a name="gbab-491"></a><span class="cm"> *  it should not be used for bitstream identification; use</span>
<a name="gbab-492"></a><span class="cm"> *  th_decode_headerin() for that.</span>
<a name="gbab-493"></a><span class="cm"> * As per the Theora specification, an empty (0-byte) packet is treated as a</span>
<a name="gbab-494"></a><span class="cm"> *  data packet (a delta frame with no coded blocks).</span>
<a name="gbab-495"></a><span class="cm"> * \param _op An &lt;tt&gt;ogg_packet&lt;/tt&gt; containing encoded Theora data.</span>
<a name="gbab-496"></a><span class="cm"> * \retval 1 The packet is a header packet</span>
<a name="gbab-497"></a><span class="cm"> * \retval 0 The packet is a video data packet.*/</span>
<a name="gbab-498"></a><span class="k">extern</span> <span class="kt">int</span> <span class="nf">th_packet_isheader</span><span class="p">(</span><span class="n">ogg_packet</span> <span class="o">*</span><span class="n">_op</span><span class="p">);</span>
<a name="gbab-499"></a><span class="cm">/**Determines whether a theora packet is a key frame or not.</span>
<a name="gbab-500"></a><span class="cm"> * This function does no verification beyond checking the packet type and</span>
<a name="gbab-501"></a><span class="cm"> *  key frame bits, so it should not be used for bitstream identification; use</span>
<a name="gbab-502"></a><span class="cm"> *  th_decode_headerin() for that.</span>
<a name="gbab-503"></a><span class="cm"> * As per the Theora specification, an empty (0-byte) packet is treated as a</span>
<a name="gbab-504"></a><span class="cm"> *  delta frame (with no coded blocks).</span>
<a name="gbab-505"></a><span class="cm"> * \param _op An &lt;tt&gt;ogg_packet&lt;/tt&gt; containing encoded Theora data.</span>
<a name="gbab-506"></a><span class="cm"> * \retval 1  The packet contains a key frame.</span>
<a name="gbab-507"></a><span class="cm"> * \retval 0  The packet contains a delta frame.</span>
<a name="gbab-508"></a><span class="cm"> * \retval -1 The packet is not a video data packet.*/</span>
<a name="gbab-509"></a><span class="k">extern</span> <span class="kt">int</span> <span class="nf">th_packet_iskeyframe</span><span class="p">(</span><span class="n">ogg_packet</span> <span class="o">*</span><span class="n">_op</span><span class="p">);</span>
<a name="gbab-510"></a><span class="cm">/*@}*/</span>
<a name="gbab-511"></a>
<a name="gbab-512"></a>
<a name="gbab-513"></a><span class="cm">/**\name Functions for manipulating header data*/</span>
<a name="gbab-514"></a><span class="cm">/*@{*/</span>
<a name="gbab-515"></a><span class="cm">/**Initializes a th_info structure.</span>
<a name="gbab-516"></a><span class="cm"> * This should be called on a freshly allocated #th_info structure before</span>
<a name="gbab-517"></a><span class="cm"> *  attempting to use it.</span>
<a name="gbab-518"></a><span class="cm"> * \param _info The #th_info struct to initialize.*/</span>
<a name="gbab-519"></a><span class="k">extern</span> <span class="kt">void</span> <span class="nf">th_info_init</span><span class="p">(</span><span class="n">th_info</span> <span class="o">*</span><span class="n">_info</span><span class="p">);</span>
<a name="gbab-520"></a><span class="cm">/**Clears a #th_info structure.</span>
<a name="gbab-521"></a><span class="cm"> * This should be called on a #th_info structure after it is no longer</span>
<a name="gbab-522"></a><span class="cm"> *  needed.</span>
<a name="gbab-523"></a><span class="cm"> * \param _info The #th_info struct to clear.*/</span>
<a name="gbab-524"></a><span class="k">extern</span> <span class="kt">void</span> <span class="nf">th_info_clear</span><span class="p">(</span><span class="n">th_info</span> <span class="o">*</span><span class="n">_info</span><span class="p">);</span>
<a name="gbab-525"></a>
<a name="gbab-526"></a><span class="cm">/**Initialize a #th_comment structure.</span>
<a name="gbab-527"></a><span class="cm"> * This should be called on a freshly allocated #th_comment structure</span>
<a name="gbab-528"></a><span class="cm"> *  before attempting to use it.</span>
<a name="gbab-529"></a><span class="cm"> * \param _tc The #th_comment struct to initialize.*/</span>
<a name="gbab-530"></a><span class="k">extern</span> <span class="kt">void</span> <span class="nf">th_comment_init</span><span class="p">(</span><span class="n">th_comment</span> <span class="o">*</span><span class="n">_tc</span><span class="p">);</span>
<a name="gbab-531"></a><span class="cm">/**Add a comment to an initialized #th_comment structure.</span>
<a name="gbab-532"></a><span class="cm"> * \note Neither th_comment_add() nor th_comment_add_tag() support</span>
<a name="gbab-533"></a><span class="cm"> *  comments containing null values, although the bitstream format does</span>
<a name="gbab-534"></a><span class="cm"> *  support them.</span>
<a name="gbab-535"></a><span class="cm"> * To add such comments you will need to manipulate the #th_comment</span>
<a name="gbab-536"></a><span class="cm"> *  structure directly.</span>
<a name="gbab-537"></a><span class="cm"> * \param _tc      The #th_comment struct to add the comment to.</span>
<a name="gbab-538"></a><span class="cm"> * \param _comment Must be a null-terminated UTF-8 string containing the</span>
<a name="gbab-539"></a><span class="cm"> *                  comment in &quot;TAG=the value&quot; form.*/</span>
<a name="gbab-540"></a><span class="k">extern</span> <span class="kt">void</span> <span class="nf">th_comment_add</span><span class="p">(</span><span class="n">th_comment</span> <span class="o">*</span><span class="n">_tc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_comment</span><span class="p">);</span>
<a name="gbab-541"></a><span class="cm">/**Add a comment to an initialized #th_comment structure.</span>
<a name="gbab-542"></a><span class="cm"> * \note Neither th_comment_add() nor th_comment_add_tag() support</span>
<a name="gbab-543"></a><span class="cm"> *  comments containing null values, although the bitstream format does</span>
<a name="gbab-544"></a><span class="cm"> *  support them.</span>
<a name="gbab-545"></a><span class="cm"> * To add such comments you will need to manipulate the #th_comment</span>
<a name="gbab-546"></a><span class="cm"> *  structure directly.</span>
<a name="gbab-547"></a><span class="cm"> * \param _tc  The #th_comment struct to add the comment to.</span>
<a name="gbab-548"></a><span class="cm"> * \param _tag A null-terminated string containing the tag  associated with</span>
<a name="gbab-549"></a><span class="cm"> *              the comment.</span>
<a name="gbab-550"></a><span class="cm"> * \param _val The corresponding value as a null-terminated string.*/</span>
<a name="gbab-551"></a><span class="k">extern</span> <span class="kt">void</span> <span class="nf">th_comment_add_tag</span><span class="p">(</span><span class="n">th_comment</span> <span class="o">*</span><span class="n">_tc</span><span class="p">,</span><span class="kt">char</span> <span class="o">*</span><span class="n">_tag</span><span class="p">,</span><span class="kt">char</span> <span class="o">*</span><span class="n">_val</span><span class="p">);</span>
<a name="gbab-552"></a><span class="cm">/**Look up a comment value by its tag.</span>
<a name="gbab-553"></a><span class="cm"> * \param _tc    An initialized #th_comment structure.</span>
<a name="gbab-554"></a><span class="cm"> * \param _tag   The tag to look up.</span>
<a name="gbab-555"></a><span class="cm"> * \param _count The instance of the tag.</span>
<a name="gbab-556"></a><span class="cm"> *               The same tag can appear multiple times, each with a distinct</span>
<a name="gbab-557"></a><span class="cm"> *                value, so an index is required to retrieve them all.</span>
<a name="gbab-558"></a><span class="cm"> *               The order in which these values appear is significant and</span>
<a name="gbab-559"></a><span class="cm"> *                should be preserved.</span>
<a name="gbab-560"></a><span class="cm"> *               Use th_comment_query_count() to get the legal range for</span>
<a name="gbab-561"></a><span class="cm"> *                the \a _count parameter.</span>
<a name="gbab-562"></a><span class="cm"> * \return A pointer to the queried tag&#39;s value.</span>
<a name="gbab-563"></a><span class="cm"> *         This points directly to data in the #th_comment structure.</span>
<a name="gbab-564"></a><span class="cm"> *         It should not be modified or freed by the application, and</span>
<a name="gbab-565"></a><span class="cm"> *          modifications to the structure may invalidate the pointer.</span>
<a name="gbab-566"></a><span class="cm"> * \retval NULL If no matching tag is found.*/</span>
<a name="gbab-567"></a><span class="k">extern</span> <span class="kt">char</span> <span class="o">*</span><span class="nf">th_comment_query</span><span class="p">(</span><span class="n">th_comment</span> <span class="o">*</span><span class="n">_tc</span><span class="p">,</span><span class="kt">char</span> <span class="o">*</span><span class="n">_tag</span><span class="p">,</span><span class="kt">int</span> <span class="n">_count</span><span class="p">);</span>
<a name="gbab-568"></a><span class="cm">/**Look up the number of instances of a tag.</span>
<a name="gbab-569"></a><span class="cm"> * Call this first when querying for a specific tag and then iterate over the</span>
<a name="gbab-570"></a><span class="cm"> *  number of instances with separate calls to th_comment_query() to</span>
<a name="gbab-571"></a><span class="cm"> *  retrieve all the values for that tag in order.</span>
<a name="gbab-572"></a><span class="cm"> * \param _tc    An initialized #th_comment structure.</span>
<a name="gbab-573"></a><span class="cm"> * \param _tag   The tag to look up.</span>
<a name="gbab-574"></a><span class="cm"> * \return The number on instances of this particular tag.*/</span>
<a name="gbab-575"></a><span class="k">extern</span> <span class="kt">int</span> <span class="nf">th_comment_query_count</span><span class="p">(</span><span class="n">th_comment</span> <span class="o">*</span><span class="n">_tc</span><span class="p">,</span><span class="kt">char</span> <span class="o">*</span><span class="n">_tag</span><span class="p">);</span>
<a name="gbab-576"></a><span class="cm">/**Clears a #th_comment structure.</span>
<a name="gbab-577"></a><span class="cm"> * This should be called on a #th_comment structure after it is no longer</span>
<a name="gbab-578"></a><span class="cm"> *  needed.</span>
<a name="gbab-579"></a><span class="cm"> * It will free all memory used by the structure members.</span>
<a name="gbab-580"></a><span class="cm"> * \param _tc The #th_comment struct to clear.*/</span>
<a name="gbab-581"></a><span class="k">extern</span> <span class="kt">void</span> <span class="nf">th_comment_clear</span><span class="p">(</span><span class="n">th_comment</span> <span class="o">*</span><span class="n">_tc</span><span class="p">);</span>
<a name="gbab-582"></a><span class="cm">/*@}*/</span>
<a name="gbab-583"></a><span class="cm">/*@}*/</span>
<a name="gbab-584"></a>
<a name="gbab-585"></a>
<a name="gbab-586"></a>
<a name="gbab-587"></a><span class="cp">#if defined(__cplusplus)</span>
<a name="gbab-588"></a><span class="p">}</span>
<a name="gbab-589"></a><span class="cp">#endif</span>
<a name="gbab-590"></a>
<a name="gbab-591"></a><span class="cp">#endif</span>
</pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486</pre></div></td><td class="code"><div class="highlight"><pre><span></span><a name="gbab-1"></a><span class="cm">/********************************************************************</span>
<a name="gbab-2"></a><span class="cm"> *                                                                  *</span>
<a name="gbab-3"></a><span class="cm"> * THIS FILE IS PART OF THE OggTheora SOFTWARE CODEC SOURCE CODE.   *</span>
<a name="gbab-4"></a><span class="cm"> * USE, DISTRIBUTION AND REPRODUCTION OF THIS LIBRARY SOURCE IS     *</span>
<a name="gbab-5"></a><span class="cm"> * GOVERNED BY A BSD-STYLE SOURCE LICENSE INCLUDED WITH THIS SOURCE *</span>
<a name="gbab-6"></a><span class="cm"> * IN &#39;COPYING&#39;. PLEASE READ THESE TERMS BEFORE DISTRIBUTING.       *</span>
<a name="gbab-7"></a><span class="cm"> *                                                                  *</span>
<a name="gbab-8"></a><span class="cm"> * THE Theora SOURCE CODE IS COPYRIGHT (C) 2002-2009                *</span>
<a name="gbab-9"></a><span class="cm"> * by the Xiph.Org Foundation http://www.xiph.org/                  *</span>
<a name="gbab-10"></a><span class="cm"> *                                                                  *</span>
<a name="gbab-11"></a><span class="cm"> ********************************************************************</span>
<a name="gbab-12"></a>
<a name="gbab-13"></a><span class="cm">  function:</span>
<a name="gbab-14"></a><span class="cm">  last mod: $Id: theora.h,v 1.8 2004/03/15 22:17:32 derf Exp $</span>
<a name="gbab-15"></a>
<a name="gbab-16"></a><span class="cm"> ********************************************************************/</span>
<a name="gbab-17"></a>
<a name="gbab-18"></a><span class="cm">/**\file</span>
<a name="gbab-19"></a><span class="cm"> * The &lt;tt&gt;libtheoraenc&lt;/tt&gt; C encoding API.*/</span>
<a name="gbab-20"></a>
<a name="gbab-21"></a><span class="cp">#if !defined(_O_THEORA_THEORAENC_H_)</span>
<a name="gbab-22"></a><span class="cp"># define _O_THEORA_THEORAENC_H_ (1)</span>
<a name="gbab-23"></a><span class="cp"># include &lt;stddef.h&gt;</span>
<a name="gbab-24"></a><span class="cp"># include &lt;ogg/ogg.h&gt;</span>
<a name="gbab-25"></a><span class="cp"># include &quot;codec.h&quot;</span>
<a name="gbab-26"></a>
<a name="gbab-27"></a><span class="cp">#if defined(__cplusplus)</span>
<a name="gbab-28"></a><span class="k">extern</span> <span class="s">&quot;C&quot;</span> <span class="p">{</span>
<a name="gbab-29"></a><span class="cp">#endif</span>
<a name="gbab-30"></a>
<a name="gbab-31"></a>
<a name="gbab-32"></a>
<a name="gbab-33"></a><span class="cm">/**\name th_encode_ctl() codes</span>
<a name="gbab-34"></a><span class="cm"> * \anchor encctlcodes</span>
<a name="gbab-35"></a><span class="cm"> * These are the available request codes for th_encode_ctl().</span>
<a name="gbab-36"></a><span class="cm"> * By convention, these are even, to distinguish them from the</span>
<a name="gbab-37"></a><span class="cm"> *  \ref decctlcodes &quot;decoder control codes&quot;.</span>
<a name="gbab-38"></a><span class="cm"> * Keep any experimental or vendor-specific values above \c 0x8000.*/</span>
<a name="gbab-39"></a><span class="cm">/*@{*/</span>
<a name="gbab-40"></a><span class="cm">/**Sets the Huffman tables to use.</span>
<a name="gbab-41"></a><span class="cm"> * The tables are copied, not stored by reference, so they can be freed after</span>
<a name="gbab-42"></a><span class="cm"> *  this call.</span>
<a name="gbab-43"></a><span class="cm"> * &lt;tt&gt;NULL&lt;/tt&gt; may be specified to revert to the default tables.</span>
<a name="gbab-44"></a><span class="cm"> *</span>
<a name="gbab-45"></a><span class="cm"> * \param[in] _buf &lt;tt&gt;#th_huff_code[#TH_NHUFFMAN_TABLES][#TH_NDCT_TOKENS]&lt;/tt&gt;</span>
<a name="gbab-46"></a><span class="cm"> * \retval TH_EFAULT \a _enc_ctx is &lt;tt&gt;NULL&lt;/tt&gt;.</span>
<a name="gbab-47"></a><span class="cm"> * \retval TH_EINVAL Encoding has already begun or one or more of the given</span>
<a name="gbab-48"></a><span class="cm"> *                     tables is not full or prefix-free, \a _buf is</span>
<a name="gbab-49"></a><span class="cm"> *                     &lt;tt&gt;NULL&lt;/tt&gt; and \a _buf_sz is not zero, or \a _buf is</span>
<a name="gbab-50"></a><span class="cm"> *                     non-&lt;tt&gt;NULL&lt;/tt&gt; and \a _buf_sz is not</span>
<a name="gbab-51"></a><span class="cm"> *                     &lt;tt&gt;sizeof(#th_huff_code)*#TH_NHUFFMAN_TABLES*#TH_NDCT_TOKENS&lt;/tt&gt;.</span>
<a name="gbab-52"></a><span class="cm"> * \retval TH_EIMPL   Not supported by this implementation.*/</span>
<a name="gbab-53"></a><span class="cp">#define TH_ENCCTL_SET_HUFFMAN_CODES (0)</span>
<a name="gbab-54"></a><span class="cm">/**Sets the quantization parameters to use.</span>
<a name="gbab-55"></a><span class="cm"> * The parameters are copied, not stored by reference, so they can be freed</span>
<a name="gbab-56"></a><span class="cm"> *  after this call.</span>
<a name="gbab-57"></a><span class="cm"> * &lt;tt&gt;NULL&lt;/tt&gt; may be specified to revert to the default parameters.</span>
<a name="gbab-58"></a><span class="cm"> *</span>
<a name="gbab-59"></a><span class="cm"> * \param[in] _buf #th_quant_info</span>
<a name="gbab-60"></a><span class="cm"> * \retval TH_EFAULT \a _enc_ctx is &lt;tt&gt;NULL&lt;/tt&gt;.</span>
<a name="gbab-61"></a><span class="cm"> * \retval TH_EINVAL Encoding has already begun, \a _buf is </span>
<a name="gbab-62"></a><span class="cm"> *                    &lt;tt&gt;NULL&lt;/tt&gt; and \a _buf_sz is not zero,</span>
<a name="gbab-63"></a><span class="cm"> *                    or \a _buf is non-&lt;tt&gt;NULL&lt;/tt&gt; and</span>
<a name="gbab-64"></a><span class="cm"> *                    \a _buf_sz is not &lt;tt&gt;sizeof(#th_quant_info)&lt;/tt&gt;.</span>
<a name="gbab-65"></a><span class="cm"> * \retval TH_EIMPL   Not supported by this implementation.*/</span>
<a name="gbab-66"></a><span class="cp">#define TH_ENCCTL_SET_QUANT_PARAMS (2)</span>
<a name="gbab-67"></a><span class="cm">/**Sets the maximum distance between key frames.</span>
<a name="gbab-68"></a><span class="cm"> * This can be changed during an encode, but will be bounded by</span>
<a name="gbab-69"></a><span class="cm"> *  &lt;tt&gt;1&lt;&lt;th_info#keyframe_granule_shift&lt;/tt&gt;.</span>
<a name="gbab-70"></a><span class="cm"> * If it is set before encoding begins, th_info#keyframe_granule_shift will</span>
<a name="gbab-71"></a><span class="cm"> *  be enlarged appropriately.</span>
<a name="gbab-72"></a><span class="cm"> *</span>
<a name="gbab-73"></a><span class="cm"> * \param[in]  _buf &lt;tt&gt;ogg_uint32_t&lt;/tt&gt;: The maximum distance between key</span>
<a name="gbab-74"></a><span class="cm"> *                   frames.</span>
<a name="gbab-75"></a><span class="cm"> * \param[out] _buf &lt;tt&gt;ogg_uint32_t&lt;/tt&gt;: The actual maximum distance set.</span>
<a name="gbab-76"></a><span class="cm"> * \retval TH_EFAULT \a _enc_ctx or \a _buf is &lt;tt&gt;NULL&lt;/tt&gt;.</span>
<a name="gbab-77"></a><span class="cm"> * \retval TH_EINVAL \a _buf_sz is not &lt;tt&gt;sizeof(ogg_uint32_t)&lt;/tt&gt;.</span>
<a name="gbab-78"></a><span class="cm"> * \retval TH_EIMPL   Not supported by this implementation.*/</span>
<a name="gbab-79"></a><span class="cp">#define TH_ENCCTL_SET_KEYFRAME_FREQUENCY_FORCE (4)</span>
<a name="gbab-80"></a><span class="cm">/**Disables any encoder features that would prevent lossless transcoding back</span>
<a name="gbab-81"></a><span class="cm"> *  to VP3.</span>
<a name="gbab-82"></a><span class="cm"> * This primarily means disabling block-adaptive quantization and always coding</span>
<a name="gbab-83"></a><span class="cm"> *  all four luma blocks in a macro block when 4MV is used.</span>
<a name="gbab-84"></a><span class="cm"> * It also includes using the VP3 quantization tables and Huffman codes; if you</span>
<a name="gbab-85"></a><span class="cm"> *  set them explicitly after calling this function, the resulting stream will</span>
<a name="gbab-86"></a><span class="cm"> *  not be VP3-compatible.</span>
<a name="gbab-87"></a><span class="cm"> * If you enable VP3-compatibility when encoding 4:2:2 or 4:4:4 source</span>
<a name="gbab-88"></a><span class="cm"> *  material, or when using a picture region smaller than the full frame (e.g.</span>
<a name="gbab-89"></a><span class="cm"> *  a non-multiple-of-16 width or height), then non-VP3 bitstream features will</span>
<a name="gbab-90"></a><span class="cm"> *  still be disabled, but the stream will still not be VP3-compatible, as VP3</span>
<a name="gbab-91"></a><span class="cm"> *  was not capable of encoding such formats.</span>
<a name="gbab-92"></a><span class="cm"> * If you call this after encoding has already begun, then the quantization</span>
<a name="gbab-93"></a><span class="cm"> *  tables and codebooks cannot be changed, but the frame-level features will</span>
<a name="gbab-94"></a><span class="cm"> *  be enabled or disabled as requested.</span>
<a name="gbab-95"></a><span class="cm"> *</span>
<a name="gbab-96"></a><span class="cm"> * \param[in]  _buf &lt;tt&gt;int&lt;/tt&gt;: a non-zero value to enable VP3 compatibility,</span>
<a name="gbab-97"></a><span class="cm"> *                   or 0 to disable it (the default).</span>
<a name="gbab-98"></a><span class="cm"> * \param[out] _buf &lt;tt&gt;int&lt;/tt&gt;: 1 if all bitstream features required for</span>
<a name="gbab-99"></a><span class="cm"> *                   VP3-compatibility could be set, and 0 otherwise.</span>
<a name="gbab-100"></a><span class="cm"> *                  The latter will be returned if the pixel format is not</span>
<a name="gbab-101"></a><span class="cm"> *                   4:2:0, the picture region is smaller than the full frame,</span>
<a name="gbab-102"></a><span class="cm"> *                   or if encoding has begun, preventing the quantization</span>
<a name="gbab-103"></a><span class="cm"> *                   tables and codebooks from being set.</span>
<a name="gbab-104"></a><span class="cm"> * \retval TH_EFAULT \a _enc_ctx or \a _buf is &lt;tt&gt;NULL&lt;/tt&gt;.</span>
<a name="gbab-105"></a><span class="cm"> * \retval TH_EINVAL \a _buf_sz is not &lt;tt&gt;sizeof(int)&lt;/tt&gt;.</span>
<a name="gbab-106"></a><span class="cm"> * \retval TH_EIMPL   Not supported by this implementation.*/</span>
<a name="gbab-107"></a><span class="cp">#define TH_ENCCTL_SET_VP3_COMPATIBLE (10)</span>
<a name="gbab-108"></a><span class="cm">/**Gets the maximum speed level.</span>
<a name="gbab-109"></a><span class="cm"> * Higher speed levels favor quicker encoding over better quality per bit.</span>
<a name="gbab-110"></a><span class="cm"> * Depending on the encoding mode, and the internal algorithms used, quality</span>
<a name="gbab-111"></a><span class="cm"> *  may actually improve, but in this case bitrate will also likely increase.</span>
<a name="gbab-112"></a><span class="cm"> * In any case, overall rate/distortion performance will probably decrease.</span>
<a name="gbab-113"></a><span class="cm"> * The maximum value, and the meaning of each value, may change depending on</span>
<a name="gbab-114"></a><span class="cm"> *  the current encoding mode (VBR vs. constant quality, etc.).</span>
<a name="gbab-115"></a><span class="cm"> *</span>
<a name="gbab-116"></a><span class="cm"> * \param[out] _buf &lt;tt&gt;int&lt;/tt&gt;: The maximum encoding speed level.</span>
<a name="gbab-117"></a><span class="cm"> * \retval TH_EFAULT \a _enc_ctx or \a _buf is &lt;tt&gt;NULL&lt;/tt&gt;.</span>
<a name="gbab-118"></a><span class="cm"> * \retval TH_EINVAL \a _buf_sz is not &lt;tt&gt;sizeof(int)&lt;/tt&gt;.</span>
<a name="gbab-119"></a><span class="cm"> * \retval TH_EIMPL   Not supported by this implementation in the current</span>
<a name="gbab-120"></a><span class="cm"> *                    encoding mode.*/</span>
<a name="gbab-121"></a><span class="cp">#define TH_ENCCTL_GET_SPLEVEL_MAX (12)</span>
<a name="gbab-122"></a><span class="cm">/**Sets the speed level.</span>
<a name="gbab-123"></a><span class="cm"> * The current speed level may be retrieved using #TH_ENCCTL_GET_SPLEVEL.</span>
<a name="gbab-124"></a><span class="cm"> *</span>
<a name="gbab-125"></a><span class="cm"> * \param[in] _buf &lt;tt&gt;int&lt;/tt&gt;: The new encoding speed level.</span>
<a name="gbab-126"></a><span class="cm"> *                 0 is slowest, larger values use less CPU.</span>
<a name="gbab-127"></a><span class="cm"> * \retval TH_EFAULT \a _enc_ctx or \a _buf is &lt;tt&gt;NULL&lt;/tt&gt;.</span>
<a name="gbab-128"></a><span class="cm"> * \retval TH_EINVAL \a _buf_sz is not &lt;tt&gt;sizeof(int)&lt;/tt&gt;, or the</span>
<a name="gbab-129"></a><span class="cm"> *                    encoding speed level is out of bounds.</span>
<a name="gbab-130"></a><span class="cm"> *                   The maximum encoding speed level may be</span>
<a name="gbab-131"></a><span class="cm"> *                    implementation- and encoding mode-specific, and can be</span>
<a name="gbab-132"></a><span class="cm"> *                    obtained via #TH_ENCCTL_GET_SPLEVEL_MAX.</span>
<a name="gbab-133"></a><span class="cm"> * \retval TH_EIMPL   Not supported by this implementation in the current</span>
<a name="gbab-134"></a><span class="cm"> *                    encoding mode.*/</span>
<a name="gbab-135"></a><span class="cp">#define TH_ENCCTL_SET_SPLEVEL (14)</span>
<a name="gbab-136"></a><span class="cm">/**Gets the current speed level.</span>
<a name="gbab-137"></a><span class="cm"> * The default speed level may vary according to encoder implementation, but if</span>
<a name="gbab-138"></a><span class="cm"> *  this control code is not supported (it returns #TH_EIMPL), the default may</span>
<a name="gbab-139"></a><span class="cm"> *  be assumed to be the slowest available speed (0).</span>
<a name="gbab-140"></a><span class="cm"> * The maximum encoding speed level may be implementation- and encoding</span>
<a name="gbab-141"></a><span class="cm"> *  mode-specific, and can be obtained via #TH_ENCCTL_GET_SPLEVEL_MAX.</span>
<a name="gbab-142"></a><span class="cm"> *</span>
<a name="gbab-143"></a><span class="cm"> * \param[out] _buf &lt;tt&gt;int&lt;/tt&gt;: The current encoding speed level.</span>
<a name="gbab-144"></a><span class="cm"> *                  0 is slowest, larger values use less CPU.</span>
<a name="gbab-145"></a><span class="cm"> * \retval TH_EFAULT \a _enc_ctx or \a _buf is &lt;tt&gt;NULL&lt;/tt&gt;.</span>
<a name="gbab-146"></a><span class="cm"> * \retval TH_EINVAL \a _buf_sz is not &lt;tt&gt;sizeof(int)&lt;/tt&gt;.</span>
<a name="gbab-147"></a><span class="cm"> * \retval TH_EIMPL   Not supported by this implementation in the current</span>
<a name="gbab-148"></a><span class="cm"> *                    encoding mode.*/</span>
<a name="gbab-149"></a><span class="cp">#define TH_ENCCTL_GET_SPLEVEL (16)</span>
<a name="gbab-150"></a><span class="cm">/**Sets the number of duplicates of the next frame to produce.</span>
<a name="gbab-151"></a><span class="cm"> * Although libtheora can encode duplicate frames very cheaply, it costs some</span>
<a name="gbab-152"></a><span class="cm"> *  amount of CPU to detect them, and a run of duplicates cannot span a</span>
<a name="gbab-153"></a><span class="cm"> *  keyframe boundary.</span>
<a name="gbab-154"></a><span class="cm"> * This control code tells the encoder to produce the specified number of extra</span>
<a name="gbab-155"></a><span class="cm"> *  duplicates of the next frame.</span>
<a name="gbab-156"></a><span class="cm"> * This allows the encoder to make smarter keyframe placement decisions and</span>
<a name="gbab-157"></a><span class="cm"> *  rate control decisions, and reduces CPU usage as well, when compared to</span>
<a name="gbab-158"></a><span class="cm"> *  just submitting the same frame for encoding multiple times.</span>
<a name="gbab-159"></a><span class="cm"> * This setting only applies to the next frame submitted for encoding.</span>
<a name="gbab-160"></a><span class="cm"> * You MUST call th_encode_packetout() repeatedly until it returns 0, or the</span>
<a name="gbab-161"></a><span class="cm"> *  extra duplicate frames will be lost.</span>
<a name="gbab-162"></a><span class="cm"> *</span>
<a name="gbab-163"></a><span class="cm"> * \param[in] _buf &lt;tt&gt;int&lt;/tt&gt;: The number of duplicates to produce.</span>
<a name="gbab-164"></a><span class="cm"> *                 If this is negative or zero, no duplicates will be produced.</span>
<a name="gbab-165"></a><span class="cm"> * \retval TH_EFAULT \a _enc_ctx or \a _buf is &lt;tt&gt;NULL&lt;/tt&gt;.</span>
<a name="gbab-166"></a><span class="cm"> * \retval TH_EINVAL \a _buf_sz is not &lt;tt&gt;sizeof(int)&lt;/tt&gt;, or the</span>
<a name="gbab-167"></a><span class="cm"> *                    number of duplicates is greater than or equal to the</span>
<a name="gbab-168"></a><span class="cm"> *                    maximum keyframe interval.</span>
<a name="gbab-169"></a><span class="cm"> *                   In the latter case, NO duplicate frames will be produced.</span>
<a name="gbab-170"></a><span class="cm"> *                   You must ensure that the maximum keyframe interval is set</span>
<a name="gbab-171"></a><span class="cm"> *                    larger than the maximum number of duplicates you will</span>
<a name="gbab-172"></a><span class="cm"> *                    ever wish to insert prior to encoding.</span>
<a name="gbab-173"></a><span class="cm"> * \retval TH_EIMPL   Not supported by this implementation in the current</span>
<a name="gbab-174"></a><span class="cm"> *                    encoding mode.*/</span>
<a name="gbab-175"></a><span class="cp">#define TH_ENCCTL_SET_DUP_COUNT (18)</span>
<a name="gbab-176"></a><span class="cm">/**Modifies the default bitrate management behavior.</span>
<a name="gbab-177"></a><span class="cm"> * Use to allow or disallow frame dropping, and to enable or disable capping</span>
<a name="gbab-178"></a><span class="cm"> *  bit reservoir overflows and underflows.</span>
<a name="gbab-179"></a><span class="cm"> * See \ref encctlcodes &quot;the list of available flags&quot;.</span>
<a name="gbab-180"></a><span class="cm"> * The flags are set by default to</span>
<a name="gbab-181"></a><span class="cm"> *  &lt;tt&gt;#TH_RATECTL_DROP_FRAMES|#TH_RATECTL_CAP_OVERFLOW&lt;/tt&gt;.</span>
<a name="gbab-182"></a><span class="cm"> *</span>
<a name="gbab-183"></a><span class="cm"> * \param[in] _buf &lt;tt&gt;int&lt;/tt&gt;: Any combination of</span>
<a name="gbab-184"></a><span class="cm"> *                  \ref ratectlflags &quot;the available flags&quot;:</span>
<a name="gbab-185"></a><span class="cm"> *                 - #TH_RATECTL_DROP_FRAMES: Enable frame dropping.</span>
<a name="gbab-186"></a><span class="cm"> *                 - #TH_RATECTL_CAP_OVERFLOW: Don&#39;t bank excess bits for later</span>
<a name="gbab-187"></a><span class="cm"> *                    use.</span>
<a name="gbab-188"></a><span class="cm"> *                 - #TH_RATECTL_CAP_UNDERFLOW: Don&#39;t try to make up shortfalls</span>
<a name="gbab-189"></a><span class="cm"> *                    later.</span>
<a name="gbab-190"></a><span class="cm"> * \retval TH_EFAULT \a _enc_ctx or \a _buf is &lt;tt&gt;NULL&lt;/tt&gt;.</span>
<a name="gbab-191"></a><span class="cm"> * \retval TH_EINVAL \a _buf_sz is not &lt;tt&gt;sizeof(int)&lt;/tt&gt; or rate control</span>
<a name="gbab-192"></a><span class="cm"> *                    is not enabled.</span>
<a name="gbab-193"></a><span class="cm"> * \retval TH_EIMPL   Not supported by this implementation in the current</span>
<a name="gbab-194"></a><span class="cm"> *                    encoding mode.*/</span>
<a name="gbab-195"></a><span class="cp">#define TH_ENCCTL_SET_RATE_FLAGS (20)</span>
<a name="gbab-196"></a><span class="cm">/**Sets the size of the bitrate management bit reservoir as a function</span>
<a name="gbab-197"></a><span class="cm"> *  of number of frames.</span>
<a name="gbab-198"></a><span class="cm"> * The reservoir size affects how quickly bitrate management reacts to</span>
<a name="gbab-199"></a><span class="cm"> *  instantaneous changes in the video complexity.</span>
<a name="gbab-200"></a><span class="cm"> * Larger reservoirs react more slowly, and provide better overall quality, but</span>
<a name="gbab-201"></a><span class="cm"> *  require more buffering by a client, adding more latency to live streams.</span>
<a name="gbab-202"></a><span class="cm"> * By default, libtheora sets the reservoir to the maximum distance between</span>
<a name="gbab-203"></a><span class="cm"> *  keyframes, subject to a minimum and maximum limit.</span>
<a name="gbab-204"></a><span class="cm"> * This call may be used to increase or decrease the reservoir, increasing or</span>
<a name="gbab-205"></a><span class="cm"> *  decreasing the allowed temporary variance in bitrate.</span>
<a name="gbab-206"></a><span class="cm"> * An implementation may impose some limits on the size of a reservoir it can</span>
<a name="gbab-207"></a><span class="cm"> *  handle, in which case the actual reservoir size may not be exactly what was</span>
<a name="gbab-208"></a><span class="cm"> *  requested.</span>
<a name="gbab-209"></a><span class="cm"> * The actual value set will be returned.</span>
<a name="gbab-210"></a><span class="cm"> *</span>
<a name="gbab-211"></a><span class="cm"> * \param[in]  _buf &lt;tt&gt;int&lt;/tt&gt;: Requested size of the reservoir measured in</span>
<a name="gbab-212"></a><span class="cm"> *                   frames.</span>
<a name="gbab-213"></a><span class="cm"> * \param[out] _buf &lt;tt&gt;int&lt;/tt&gt;: The actual size of the reservoir set.</span>
<a name="gbab-214"></a><span class="cm"> * \retval TH_EFAULT \a _enc_ctx or \a _buf is &lt;tt&gt;NULL&lt;/tt&gt;.</span>
<a name="gbab-215"></a><span class="cm"> * \retval TH_EINVAL \a _buf_sz is not &lt;tt&gt;sizeof(int)&lt;/tt&gt;, or rate control</span>
<a name="gbab-216"></a><span class="cm"> *                    is not enabled.  The buffer has an implementation</span>
<a name="gbab-217"></a><span class="cm"> *                    defined minimum and maximum size and the value in _buf</span>
<a name="gbab-218"></a><span class="cm"> *                    will be adjusted to match the actual value set.</span>
<a name="gbab-219"></a><span class="cm"> * \retval TH_EIMPL   Not supported by this implementation in the current</span>
<a name="gbab-220"></a><span class="cm"> *                    encoding mode.*/</span>
<a name="gbab-221"></a><span class="cp">#define TH_ENCCTL_SET_RATE_BUFFER (22)</span>
<a name="gbab-222"></a><span class="cm">/**Enable pass 1 of two-pass encoding mode and retrieve the first pass metrics.</span>
<a name="gbab-223"></a><span class="cm"> * Pass 1 mode must be enabled before the first frame is encoded, and a target</span>
<a name="gbab-224"></a><span class="cm"> *  bitrate must have already been specified to the encoder.</span>
<a name="gbab-225"></a><span class="cm"> * Although this does not have to be the exact rate that will be used in the</span>
<a name="gbab-226"></a><span class="cm"> *  second pass, closer values may produce better results.</span>
<a name="gbab-227"></a><span class="cm"> * The first call returns the size of the two-pass header data, along with some</span>
<a name="gbab-228"></a><span class="cm"> *  placeholder content, and sets the encoder into pass 1 mode implicitly.</span>
<a name="gbab-229"></a><span class="cm"> * This call sets the encoder to pass 1 mode implicitly.</span>
<a name="gbab-230"></a><span class="cm"> * Then, a subsequent call must be made after each call to</span>
<a name="gbab-231"></a><span class="cm"> *  th_encode_ycbcr_in() to retrieve the metrics for that frame.</span>
<a name="gbab-232"></a><span class="cm"> * An additional, final call must be made to retrieve the summary data,</span>
<a name="gbab-233"></a><span class="cm"> *  containing such information as the total number of frames, etc.</span>
<a name="gbab-234"></a><span class="cm"> * This must be stored in place of the placeholder data that was returned</span>
<a name="gbab-235"></a><span class="cm"> *  in the first call, before the frame metrics data.</span>
<a name="gbab-236"></a><span class="cm"> * All of this data must be presented back to the encoder during pass 2 using</span>
<a name="gbab-237"></a><span class="cm"> *  #TH_ENCCTL_2PASS_IN.</span>
<a name="gbab-238"></a><span class="cm"> *</span>
<a name="gbab-239"></a><span class="cm"> * \param[out] &lt;tt&gt;char *&lt;/tt&gt;_buf: Returns a pointer to internal storage</span>
<a name="gbab-240"></a><span class="cm"> *              containing the two pass metrics data.</span>
<a name="gbab-241"></a><span class="cm"> *             This storage is only valid until the next call, or until the</span>
<a name="gbab-242"></a><span class="cm"> *              encoder context is freed, and must be copied by the</span>
<a name="gbab-243"></a><span class="cm"> *              application.</span>
<a name="gbab-244"></a><span class="cm"> * \retval &gt;=0       The number of bytes of metric data available in the</span>
<a name="gbab-245"></a><span class="cm"> *                    returned buffer.</span>
<a name="gbab-246"></a><span class="cm"> * \retval TH_EFAULT \a _enc_ctx or \a _buf is &lt;tt&gt;NULL&lt;/tt&gt;.</span>
<a name="gbab-247"></a><span class="cm"> * \retval TH_EINVAL \a _buf_sz is not &lt;tt&gt;sizeof(char *)&lt;/tt&gt;, no target</span>
<a name="gbab-248"></a><span class="cm"> *                    bitrate has been set, or the first call was made after</span>
<a name="gbab-249"></a><span class="cm"> *                    the first frame was submitted for encoding.</span>
<a name="gbab-250"></a><span class="cm"> * \retval TH_EIMPL   Not supported by this implementation.*/</span>
<a name="gbab-251"></a><span class="cp">#define TH_ENCCTL_2PASS_OUT (24)</span>
<a name="gbab-252"></a><span class="cm">/**Submits two-pass encoding metric data collected the first encoding pass to</span>
<a name="gbab-253"></a><span class="cm"> *  the second pass.</span>
<a name="gbab-254"></a><span class="cm"> * The first call must be made before the first frame is encoded, and a target</span>
<a name="gbab-255"></a><span class="cm"> *  bitrate must have already been specified to the encoder.</span>
<a name="gbab-256"></a><span class="cm"> * It sets the encoder to pass 2 mode implicitly; this cannot be disabled.</span>
<a name="gbab-257"></a><span class="cm"> * The encoder may require reading data from some or all of the frames in</span>
<a name="gbab-258"></a><span class="cm"> *  advance, depending on, e.g., the reservoir size used in the second pass.</span>
<a name="gbab-259"></a><span class="cm"> * You must call this function repeatedly before each frame to provide data</span>
<a name="gbab-260"></a><span class="cm"> *  until either a) it fails to consume all of the data presented or b) all of</span>
<a name="gbab-261"></a><span class="cm"> *  the pass 1 data has been consumed.</span>
<a name="gbab-262"></a><span class="cm"> * In the first case, you must save the remaining data to be presented after</span>
<a name="gbab-263"></a><span class="cm"> *  the next frame.</span>
<a name="gbab-264"></a><span class="cm"> * You can call this function with a NULL argument to get an upper bound on</span>
<a name="gbab-265"></a><span class="cm"> *  the number of bytes that will be required before the next frame.</span>
<a name="gbab-266"></a><span class="cm"> *</span>
<a name="gbab-267"></a><span class="cm"> * When pass 2 is first enabled, the default bit reservoir is set to the entire</span>
<a name="gbab-268"></a><span class="cm"> *  file; this gives maximum flexibility but can lead to very high peak rates.</span>
<a name="gbab-269"></a><span class="cm"> * You can subsequently set it to another value with #TH_ENCCTL_SET_RATE_BUFFER</span>
<a name="gbab-270"></a><span class="cm"> *  (e.g., to set it to the keyframe interval for non-live streaming), however,</span>
<a name="gbab-271"></a><span class="cm"> *  you may then need to provide more data before the next frame.</span>
<a name="gbab-272"></a><span class="cm"> *</span>
<a name="gbab-273"></a><span class="cm"> * \param[in] _buf &lt;tt&gt;char[]&lt;/tt&gt;: A buffer containing the data returned by</span>
<a name="gbab-274"></a><span class="cm"> *                  #TH_ENCCTL_2PASS_OUT in pass 1.</span>
<a name="gbab-275"></a><span class="cm"> *                 You may pass &lt;tt&gt;NULL&lt;/tt&gt; for \a _buf to return an upper</span>
<a name="gbab-276"></a><span class="cm"> *                  bound on the number of additional bytes needed before the</span>
<a name="gbab-277"></a><span class="cm"> *                  next frame.</span>
<a name="gbab-278"></a><span class="cm"> *                 The summary data returned at the end of pass 1 must be at</span>
<a name="gbab-279"></a><span class="cm"> *                  the head of the buffer on the first call with a</span>
<a name="gbab-280"></a><span class="cm"> *                  non-&lt;tt&gt;NULL&lt;/tt&gt; \a _buf, and the placeholder data</span>
<a name="gbab-281"></a><span class="cm"> *                  returned at the start of pass 1 should be omitted.</span>
<a name="gbab-282"></a><span class="cm"> *                 After each call you should advance this buffer by the number</span>
<a name="gbab-283"></a><span class="cm"> *                  of bytes consumed.</span>
<a name="gbab-284"></a><span class="cm"> * \retval &gt;0            The number of bytes of metric data required/consumed.</span>
<a name="gbab-285"></a><span class="cm"> * \retval 0             No more data is required before the next frame.</span>
<a name="gbab-286"></a><span class="cm"> * \retval TH_EFAULT     \a _enc_ctx is &lt;tt&gt;NULL&lt;/tt&gt;.</span>
<a name="gbab-287"></a><span class="cm"> * \retval TH_EINVAL     No target bitrate has been set, or the first call was</span>
<a name="gbab-288"></a><span class="cm"> *                        made after the first frame was submitted for</span>
<a name="gbab-289"></a><span class="cm"> *                        encoding.</span>
<a name="gbab-290"></a><span class="cm"> * \retval TH_ENOTFORMAT The data did not appear to be pass 1 from a compatible</span>
<a name="gbab-291"></a><span class="cm"> *                        implementation of this library.</span>
<a name="gbab-292"></a><span class="cm"> * \retval TH_EBADHEADER The data was invalid; this may be returned when</span>
<a name="gbab-293"></a><span class="cm"> *                        attempting to read an aborted pass 1 file that still</span>
<a name="gbab-294"></a><span class="cm"> *                        has the placeholder data in place of the summary</span>
<a name="gbab-295"></a><span class="cm"> *                        data.</span>
<a name="gbab-296"></a><span class="cm"> * \retval TH_EIMPL       Not supported by this implementation.*/</span>
<a name="gbab-297"></a><span class="cp">#define TH_ENCCTL_2PASS_IN (26)</span>
<a name="gbab-298"></a><span class="cm">/**Sets the current encoding quality.</span>
<a name="gbab-299"></a><span class="cm"> * This is only valid so long as no bitrate has been specified, either through</span>
<a name="gbab-300"></a><span class="cm"> *  the #th_info struct used to initialize the encoder or through</span>
<a name="gbab-301"></a><span class="cm"> *  #TH_ENCCTL_SET_BITRATE (this restriction may be relaxed in a future</span>
<a name="gbab-302"></a><span class="cm"> *  version).</span>
<a name="gbab-303"></a><span class="cm"> * If it is set before the headers are emitted, the target quality encoded in</span>
<a name="gbab-304"></a><span class="cm"> *  them will be updated.</span>
<a name="gbab-305"></a><span class="cm"> *</span>
<a name="gbab-306"></a><span class="cm"> * \param[in] _buf &lt;tt&gt;int&lt;/tt&gt;: The new target quality, in the range 0...63,</span>
<a name="gbab-307"></a><span class="cm"> *                  inclusive.</span>
<a name="gbab-308"></a><span class="cm"> * \retval 0             Success.</span>
<a name="gbab-309"></a><span class="cm"> * \retval TH_EFAULT     \a _enc_ctx or \a _buf is &lt;tt&gt;NULL&lt;/tt&gt;.</span>
<a name="gbab-310"></a><span class="cm"> * \retval TH_EINVAL     A target bitrate has already been specified, or the</span>
<a name="gbab-311"></a><span class="cm"> *                        quality index was not in the range 0...63.</span>
<a name="gbab-312"></a><span class="cm"> * \retval TH_EIMPL       Not supported by this implementation.*/</span>
<a name="gbab-313"></a><span class="cp">#define TH_ENCCTL_SET_QUALITY (28)</span>
<a name="gbab-314"></a><span class="cm">/**Sets the current encoding bitrate.</span>
<a name="gbab-315"></a><span class="cm"> * Once a bitrate is set, the encoder must use a rate-controlled mode for all</span>
<a name="gbab-316"></a><span class="cm"> *  future frames (this restriction may be relaxed in a future version).</span>
<a name="gbab-317"></a><span class="cm"> * If it is set before the headers are emitted, the target bitrate encoded in</span>
<a name="gbab-318"></a><span class="cm"> *  them will be updated.</span>
<a name="gbab-319"></a><span class="cm"> * Due to the buffer delay, the exact bitrate of each section of the encode is</span>
<a name="gbab-320"></a><span class="cm"> *  not guaranteed.</span>
<a name="gbab-321"></a><span class="cm"> * The encoder may have already used more bits than allowed for the frames it</span>
<a name="gbab-322"></a><span class="cm"> *  has encoded, expecting to make them up in future frames, or it may have</span>
<a name="gbab-323"></a><span class="cm"> *  used fewer, holding the excess in reserve.</span>
<a name="gbab-324"></a><span class="cm"> * The exact transition between the two bitrates is not well-defined by this</span>
<a name="gbab-325"></a><span class="cm"> *  API, but may be affected by flags set with #TH_ENCCTL_SET_RATE_FLAGS.</span>
<a name="gbab-326"></a><span class="cm"> * After a number of frames equal to the buffer delay, one may expect further</span>
<a name="gbab-327"></a><span class="cm"> *  output to average at the target bitrate.</span>
<a name="gbab-328"></a><span class="cm"> *</span>
<a name="gbab-329"></a><span class="cm"> * \param[in] _buf &lt;tt&gt;long&lt;/tt&gt;: The new target bitrate, in bits per second.</span>
<a name="gbab-330"></a><span class="cm"> * \retval 0             Success.</span>
<a name="gbab-331"></a><span class="cm"> * \retval TH_EFAULT     \a _enc_ctx or \a _buf is &lt;tt&gt;NULL&lt;/tt&gt;.</span>
<a name="gbab-332"></a><span class="cm"> * \retval TH_EINVAL     The target bitrate was not positive.</span>
<a name="gbab-333"></a><span class="cm"> * \retval TH_EIMPL       Not supported by this implementation.*/</span>
<a name="gbab-334"></a><span class="cp">#define TH_ENCCTL_SET_BITRATE (30)</span>
<a name="gbab-335"></a>
<a name="gbab-336"></a><span class="cm">/*@}*/</span>
<a name="gbab-337"></a>
<a name="gbab-338"></a>
<a name="gbab-339"></a><span class="cm">/**\name TH_ENCCTL_SET_RATE_FLAGS flags</span>
<a name="gbab-340"></a><span class="cm"> * \anchor ratectlflags</span>
<a name="gbab-341"></a><span class="cm"> * These are the flags available for use with #TH_ENCCTL_SET_RATE_FLAGS.*/</span>
<a name="gbab-342"></a><span class="cm">/*@{*/</span>
<a name="gbab-343"></a><span class="cm">/**Drop frames to keep within bitrate buffer constraints.</span>
<a name="gbab-344"></a><span class="cm"> * This can have a severe impact on quality, but is the only way to ensure that</span>
<a name="gbab-345"></a><span class="cm"> *  bitrate targets are met at low rates during sudden bursts of activity.*/</span>
<a name="gbab-346"></a><span class="cp">#define TH_RATECTL_DROP_FRAMES   (0x1)</span>
<a name="gbab-347"></a><span class="cm">/**Ignore bitrate buffer overflows.</span>
<a name="gbab-348"></a><span class="cm"> * If the encoder uses so few bits that the reservoir of available bits</span>
<a name="gbab-349"></a><span class="cm"> *  overflows, ignore the excess.</span>
<a name="gbab-350"></a><span class="cm"> * The encoder will not try to use these extra bits in future frames.</span>
<a name="gbab-351"></a><span class="cm"> * At high rates this may cause the result to be undersized, but allows a</span>
<a name="gbab-352"></a><span class="cm"> *  client to play the stream using a finite buffer; it should normally be</span>
<a name="gbab-353"></a><span class="cm"> *  enabled.*/</span>
<a name="gbab-354"></a><span class="cp">#define TH_RATECTL_CAP_OVERFLOW  (0x2)</span>
<a name="gbab-355"></a><span class="cm">/**Ignore bitrate buffer underflows.</span>
<a name="gbab-356"></a><span class="cm"> * If the encoder uses so many bits that the reservoir of available bits</span>
<a name="gbab-357"></a><span class="cm"> *  underflows, ignore the deficit.</span>
<a name="gbab-358"></a><span class="cm"> * The encoder will not try to make up these extra bits in future frames.</span>
<a name="gbab-359"></a><span class="cm"> * At low rates this may cause the result to be oversized; it should normally</span>
<a name="gbab-360"></a><span class="cm"> *  be disabled.*/</span>
<a name="gbab-361"></a><span class="cp">#define TH_RATECTL_CAP_UNDERFLOW (0x4)</span>
<a name="gbab-362"></a><span class="cm">/*@}*/</span>
<a name="gbab-363"></a>
<a name="gbab-364"></a>
<a name="gbab-365"></a>
<a name="gbab-366"></a><span class="cm">/**The quantization parameters used by VP3.*/</span>
<a name="gbab-367"></a><span class="k">extern</span> <span class="k">const</span> <span class="n">th_quant_info</span> <span class="n">TH_VP31_QUANT_INFO</span><span class="p">;</span>
<a name="gbab-368"></a>
<a name="gbab-369"></a><span class="cm">/**The Huffman tables used by VP3.*/</span>
<a name="gbab-370"></a><span class="k">extern</span> <span class="k">const</span> <span class="n">th_huff_code</span>
<a name="gbab-371"></a> <span class="n">TH_VP31_HUFF_CODES</span><span class="p">[</span><span class="n">TH_NHUFFMAN_TABLES</span><span class="p">][</span><span class="n">TH_NDCT_TOKENS</span><span class="p">];</span>
<a name="gbab-372"></a>
<a name="gbab-373"></a>
<a name="gbab-374"></a>
<a name="gbab-375"></a><span class="cm">/**\name Encoder state</span>
<a name="gbab-376"></a><span class="cm">   The following data structure is opaque, and its contents are not publicly</span>
<a name="gbab-377"></a><span class="cm">    defined by this API.</span>
<a name="gbab-378"></a><span class="cm">   Referring to its internals directly is unsupported, and may break without</span>
<a name="gbab-379"></a><span class="cm">    warning.*/</span>
<a name="gbab-380"></a><span class="cm">/*@{*/</span>
<a name="gbab-381"></a><span class="cm">/**The encoder context.*/</span>
<a name="gbab-382"></a><span class="k">typedef</span> <span class="k">struct</span> <span class="n">th_enc_ctx</span>    <span class="n">th_enc_ctx</span><span class="p">;</span>
<a name="gbab-383"></a><span class="cm">/*@}*/</span>
<a name="gbab-384"></a>
<a name="gbab-385"></a>
<a name="gbab-386"></a>
<a name="gbab-387"></a><span class="cm">/**\defgroup encfuncs Functions for Encoding*/</span>
<a name="gbab-388"></a><span class="cm">/*@{*/</span>
<a name="gbab-389"></a><span class="cm">/**\name Functions for encoding</span>
<a name="gbab-390"></a><span class="cm"> * You must link to &lt;tt&gt;libtheoraenc&lt;/tt&gt; and &lt;tt&gt;libtheoradec&lt;/tt&gt;</span>
<a name="gbab-391"></a><span class="cm"> *  if you use any of the functions in this section.</span>
<a name="gbab-392"></a><span class="cm"> *</span>
<a name="gbab-393"></a><span class="cm"> * The functions are listed in the order they are used in a typical encode.</span>
<a name="gbab-394"></a><span class="cm"> * The basic steps are:</span>
<a name="gbab-395"></a><span class="cm"> * - Fill in a #th_info structure with details on the format of the video you</span>
<a name="gbab-396"></a><span class="cm"> *    wish to encode.</span>
<a name="gbab-397"></a><span class="cm"> * - Allocate a #th_enc_ctx handle with th_encode_alloc().</span>
<a name="gbab-398"></a><span class="cm"> * - Perform any additional encoder configuration required with</span>
<a name="gbab-399"></a><span class="cm"> *    th_encode_ctl().</span>
<a name="gbab-400"></a><span class="cm"> * - Repeatedly call th_encode_flushheader() to retrieve all the header</span>
<a name="gbab-401"></a><span class="cm"> *    packets.</span>
<a name="gbab-402"></a><span class="cm"> * - For each uncompressed frame:</span>
<a name="gbab-403"></a><span class="cm"> *   - Submit the uncompressed frame via th_encode_ycbcr_in()</span>
<a name="gbab-404"></a><span class="cm"> *   - Repeatedly call th_encode_packetout() to retrieve any video data packets</span>
<a name="gbab-405"></a><span class="cm"> *      that are ready.</span>
<a name="gbab-406"></a><span class="cm"> * - Call th_encode_free() to release all encoder memory.*/</span>
<a name="gbab-407"></a><span class="cm">/*@{*/</span>
<a name="gbab-408"></a><span class="cm">/**Allocates an encoder instance.</span>
<a name="gbab-409"></a><span class="cm"> * \param _info A #th_info struct filled with the desired encoding parameters.</span>
<a name="gbab-410"></a><span class="cm"> * \return The initialized #th_enc_ctx handle.</span>
<a name="gbab-411"></a><span class="cm"> * \retval NULL If the encoding parameters were invalid.*/</span>
<a name="gbab-412"></a><span class="k">extern</span> <span class="n">th_enc_ctx</span> <span class="o">*</span><span class="nf">th_encode_alloc</span><span class="p">(</span><span class="k">const</span> <span class="n">th_info</span> <span class="o">*</span><span class="n">_info</span><span class="p">);</span>
<a name="gbab-413"></a><span class="cm">/**Encoder control function.</span>
<a name="gbab-414"></a><span class="cm"> * This is used to provide advanced control the encoding process.</span>
<a name="gbab-415"></a><span class="cm"> * \param _enc    A #th_enc_ctx handle.</span>
<a name="gbab-416"></a><span class="cm"> * \param _req    The control code to process.</span>
<a name="gbab-417"></a><span class="cm"> *                See \ref encctlcodes &quot;the list of available control codes&quot;</span>
<a name="gbab-418"></a><span class="cm"> *                 for details.</span>
<a name="gbab-419"></a><span class="cm"> * \param _buf    The parameters for this control code.</span>
<a name="gbab-420"></a><span class="cm"> * \param _buf_sz The size of the parameter buffer.*/</span>
<a name="gbab-421"></a><span class="k">extern</span> <span class="kt">int</span> <span class="nf">th_encode_ctl</span><span class="p">(</span><span class="n">th_enc_ctx</span> <span class="o">*</span><span class="n">_enc</span><span class="p">,</span><span class="kt">int</span> <span class="n">_req</span><span class="p">,</span><span class="kt">void</span> <span class="o">*</span><span class="n">_buf</span><span class="p">,</span><span class="kt">size_t</span> <span class="n">_buf_sz</span><span class="p">);</span>
<a name="gbab-422"></a><span class="cm">/**Outputs the next header packet.</span>
<a name="gbab-423"></a><span class="cm"> * This should be called repeatedly after encoder initialization until it</span>
<a name="gbab-424"></a><span class="cm"> *  returns 0 in order to get all of the header packets, in order, before</span>
<a name="gbab-425"></a><span class="cm"> *  encoding actual video data.</span>
<a name="gbab-426"></a><span class="cm"> * \param _enc      A #th_enc_ctx handle.</span>
<a name="gbab-427"></a><span class="cm"> * \param _comments The metadata to place in the comment header, when it is</span>
<a name="gbab-428"></a><span class="cm"> *                   encoded.</span>
<a name="gbab-429"></a><span class="cm"> * \param _op       An &lt;tt&gt;ogg_packet&lt;/tt&gt; structure to fill.</span>
<a name="gbab-430"></a><span class="cm"> *                  All of the elements of this structure will be set,</span>
<a name="gbab-431"></a><span class="cm"> *                   including a pointer to the header data.</span>
<a name="gbab-432"></a><span class="cm"> *                  The memory for the header data is owned by</span>
<a name="gbab-433"></a><span class="cm"> *                   &lt;tt&gt;libtheoraenc&lt;/tt&gt;, and may be invalidated when the</span>
<a name="gbab-434"></a><span class="cm"> *                   next encoder function is called.</span>
<a name="gbab-435"></a><span class="cm"> * \return A positive value indicates that a header packet was successfully</span>
<a name="gbab-436"></a><span class="cm"> *          produced.</span>
<a name="gbab-437"></a><span class="cm"> * \retval 0         No packet was produced, and no more header packets remain.</span>
<a name="gbab-438"></a><span class="cm"> * \retval TH_EFAULT \a _enc, \a _comments, or \a _op was &lt;tt&gt;NULL&lt;/tt&gt;.*/</span>
<a name="gbab-439"></a><span class="k">extern</span> <span class="kt">int</span> <span class="nf">th_encode_flushheader</span><span class="p">(</span><span class="n">th_enc_ctx</span> <span class="o">*</span><span class="n">_enc</span><span class="p">,</span>
<a name="gbab-440"></a> <span class="n">th_comment</span> <span class="o">*</span><span class="n">_comments</span><span class="p">,</span><span class="n">ogg_packet</span> <span class="o">*</span><span class="n">_op</span><span class="p">);</span>
<a name="gbab-441"></a><span class="cm">/**Submits an uncompressed frame to the encoder.</span>
<a name="gbab-442"></a><span class="cm"> * \param _enc   A #th_enc_ctx handle.</span>
<a name="gbab-443"></a><span class="cm"> * \param _ycbcr A buffer of Y&#39;CbCr data to encode.</span>
<a name="gbab-444"></a><span class="cm"> * \retval 0         Success.</span>
<a name="gbab-445"></a><span class="cm"> * \retval TH_EFAULT \a _enc or \a _ycbcr is &lt;tt&gt;NULL&lt;/tt&gt;.</span>
<a name="gbab-446"></a><span class="cm"> * \retval TH_EINVAL The buffer size does not match the frame size the encoder</span>
<a name="gbab-447"></a><span class="cm"> *                    was initialized with, or encoding has already</span>
<a name="gbab-448"></a><span class="cm"> *                    completed.*/</span>
<a name="gbab-449"></a><span class="k">extern</span> <span class="kt">int</span> <span class="nf">th_encode_ycbcr_in</span><span class="p">(</span><span class="n">th_enc_ctx</span> <span class="o">*</span><span class="n">_enc</span><span class="p">,</span><span class="n">th_ycbcr_buffer</span> <span class="n">_ycbcr</span><span class="p">);</span>
<a name="gbab-450"></a><span class="cm">/**Retrieves encoded video data packets.</span>
<a name="gbab-451"></a><span class="cm"> * This should be called repeatedly after each frame is submitted to flush any</span>
<a name="gbab-452"></a><span class="cm"> *  encoded packets, until it returns 0.</span>
<a name="gbab-453"></a><span class="cm"> * The encoder will not buffer these packets as subsequent frames are</span>
<a name="gbab-454"></a><span class="cm"> *  compressed, so a failure to do so will result in lost video data.</span>
<a name="gbab-455"></a><span class="cm"> * \note Currently the encoder operates in a one-frame-in, one-packet-out</span>
<a name="gbab-456"></a><span class="cm"> *        manner.</span>
<a name="gbab-457"></a><span class="cm"> *       However, this may be changed in the future.</span>
<a name="gbab-458"></a><span class="cm"> * \param _enc  A #th_enc_ctx handle.</span>
<a name="gbab-459"></a><span class="cm"> * \param _last Set this flag to a non-zero value if no more uncompressed</span>
<a name="gbab-460"></a><span class="cm"> *               frames will be submitted.</span>
<a name="gbab-461"></a><span class="cm"> *              This ensures that a proper EOS flag is set on the last packet.</span>
<a name="gbab-462"></a><span class="cm"> * \param _op   An &lt;tt&gt;ogg_packet&lt;/tt&gt; structure to fill.</span>
<a name="gbab-463"></a><span class="cm"> *              All of the elements of this structure will be set, including a</span>
<a name="gbab-464"></a><span class="cm"> *               pointer to the video data.</span>
<a name="gbab-465"></a><span class="cm"> *              The memory for the video data is owned by</span>
<a name="gbab-466"></a><span class="cm"> *               &lt;tt&gt;libtheoraenc&lt;/tt&gt;, and may be invalidated when the next</span>
<a name="gbab-467"></a><span class="cm"> *               encoder function is called.</span>
<a name="gbab-468"></a><span class="cm"> * \return A positive value indicates that a video data packet was successfully</span>
<a name="gbab-469"></a><span class="cm"> *          produced.</span>
<a name="gbab-470"></a><span class="cm"> * \retval 0         No packet was produced, and no more encoded video data</span>
<a name="gbab-471"></a><span class="cm"> *                    remains.</span>
<a name="gbab-472"></a><span class="cm"> * \retval TH_EFAULT \a _enc or \a _op was &lt;tt&gt;NULL&lt;/tt&gt;.*/</span>
<a name="gbab-473"></a><span class="k">extern</span> <span class="kt">int</span> <span class="nf">th_encode_packetout</span><span class="p">(</span><span class="n">th_enc_ctx</span> <span class="o">*</span><span class="n">_enc</span><span class="p">,</span><span class="kt">int</span> <span class="n">_last</span><span class="p">,</span><span class="n">ogg_packet</span> <span class="o">*</span><span class="n">_op</span><span class="p">);</span>
<a name="gbab-474"></a><span class="cm">/**Frees an allocated encoder instance.</span>
<a name="gbab-475"></a><span class="cm"> * \param _enc A #th_enc_ctx handle.*/</span>
<a name="gbab-476"></a><span class="k">extern</span> <span class="kt">void</span> <span class="nf">th_encode_free</span><span class="p">(</span><span class="n">th_enc_ctx</span> <span class="o">*</span><span class="n">_enc</span><span class="p">);</span>
<a name="gbab-477"></a><span class="cm">/*@}*/</span>
<a name="gbab-478"></a><span class="cm">/*@}*/</span>
<a name="gbab-479"></a>
<a name="gbab-480"></a>
<a name="gbab-481"></a>
<a name="gbab-482"></a><span class="cp">#if defined(__cplusplus)</span>
<a name="gbab-483"></a><span class="p">}</span>
<a name="gbab-484"></a><span class="cp">#endif</span>
<a name="gbab-485"></a>
<a name="gbab-486"></a><span class="cp">#endif</span>
</pre></div>
</td></tr></table>
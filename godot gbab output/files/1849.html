<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>   1
   2
   3
   4
   5
   6
   7
   8
   9
  10
  11
  12
  13
  14
  15
  16
  17
  18
  19
  20
  21
  22
  23
  24
  25
  26
  27
  28
  29
  30
  31
  32
  33
  34
  35
  36
  37
  38
  39
  40
  41
  42
  43
  44
  45
  46
  47
  48
  49
  50
  51
  52
  53
  54
  55
  56
  57
  58
  59
  60
  61
  62
  63
  64
  65
  66
  67
  68
  69
  70
  71
  72
  73
  74
  75
  76
  77
  78
  79
  80
  81
  82
  83
  84
  85
  86
  87
  88
  89
  90
  91
  92
  93
  94
  95
  96
  97
  98
  99
 100
 101
 102
 103
 104
 105
 106
 107
 108
 109
 110
 111
 112
 113
 114
 115
 116
 117
 118
 119
 120
 121
 122
 123
 124
 125
 126
 127
 128
 129
 130
 131
 132
 133
 134
 135
 136
 137
 138
 139
 140
 141
 142
 143
 144
 145
 146
 147
 148
 149
 150
 151
 152
 153
 154
 155
 156
 157
 158
 159
 160
 161
 162
 163
 164
 165
 166
 167
 168
 169
 170
 171
 172
 173
 174
 175
 176
 177
 178
 179
 180
 181
 182
 183
 184
 185
 186
 187
 188
 189
 190
 191
 192
 193
 194
 195
 196
 197
 198
 199
 200
 201
 202
 203
 204
 205
 206
 207
 208
 209
 210
 211
 212
 213
 214
 215
 216
 217
 218
 219
 220
 221
 222
 223
 224
 225
 226
 227
 228
 229
 230
 231
 232
 233
 234
 235
 236
 237
 238
 239
 240
 241
 242
 243
 244
 245
 246
 247
 248
 249
 250
 251
 252
 253
 254
 255
 256
 257
 258
 259
 260
 261
 262
 263
 264
 265
 266
 267
 268
 269
 270
 271
 272
 273
 274
 275
 276
 277
 278
 279
 280
 281
 282
 283
 284
 285
 286
 287
 288
 289
 290
 291
 292
 293
 294
 295
 296
 297
 298
 299
 300
 301
 302
 303
 304
 305
 306
 307
 308
 309
 310
 311
 312
 313
 314
 315
 316
 317
 318
 319
 320
 321
 322
 323
 324
 325
 326
 327
 328
 329
 330
 331
 332
 333
 334
 335
 336
 337
 338
 339
 340
 341
 342
 343
 344
 345
 346
 347
 348
 349
 350
 351
 352
 353
 354
 355
 356
 357
 358
 359
 360
 361
 362
 363
 364
 365
 366
 367
 368
 369
 370
 371
 372
 373
 374
 375
 376
 377
 378
 379
 380
 381
 382
 383
 384
 385
 386
 387
 388
 389
 390
 391
 392
 393
 394
 395
 396
 397
 398
 399
 400
 401
 402
 403
 404
 405
 406
 407
 408
 409
 410
 411
 412
 413
 414
 415
 416
 417
 418
 419
 420
 421
 422
 423
 424
 425
 426
 427
 428
 429
 430
 431
 432
 433
 434
 435
 436
 437
 438
 439
 440
 441
 442
 443
 444
 445
 446
 447
 448
 449
 450
 451
 452
 453
 454
 455
 456
 457
 458
 459
 460
 461
 462
 463
 464
 465
 466
 467
 468
 469
 470
 471
 472
 473
 474
 475
 476
 477
 478
 479
 480
 481
 482
 483
 484
 485
 486
 487
 488
 489
 490
 491
 492
 493
 494
 495
 496
 497
 498
 499
 500
 501
 502
 503
 504
 505
 506
 507
 508
 509
 510
 511
 512
 513
 514
 515
 516
 517
 518
 519
 520
 521
 522
 523
 524
 525
 526
 527
 528
 529
 530
 531
 532
 533
 534
 535
 536
 537
 538
 539
 540
 541
 542
 543
 544
 545
 546
 547
 548
 549
 550
 551
 552
 553
 554
 555
 556
 557
 558
 559
 560
 561
 562
 563
 564
 565
 566
 567
 568
 569
 570
 571
 572
 573
 574
 575
 576
 577
 578
 579
 580
 581
 582
 583
 584
 585
 586
 587
 588
 589
 590
 591
 592
 593
 594
 595
 596
 597
 598
 599
 600
 601
 602
 603
 604
 605
 606
 607
 608
 609
 610
 611
 612
 613
 614
 615
 616
 617
 618
 619
 620
 621
 622
 623
 624
 625
 626
 627
 628
 629
 630
 631
 632
 633
 634
 635
 636
 637
 638
 639
 640
 641
 642
 643
 644
 645
 646
 647
 648
 649
 650
 651
 652
 653
 654
 655
 656
 657
 658
 659
 660
 661
 662
 663
 664
 665
 666
 667
 668
 669
 670
 671
 672
 673
 674
 675
 676
 677
 678
 679
 680
 681
 682
 683
 684
 685
 686
 687
 688
 689
 690
 691
 692
 693
 694
 695
 696
 697
 698
 699
 700
 701
 702
 703
 704
 705
 706
 707
 708
 709
 710
 711
 712
 713
 714
 715
 716
 717
 718
 719
 720
 721
 722
 723
 724
 725
 726
 727
 728
 729
 730
 731
 732
 733
 734
 735
 736
 737
 738
 739
 740
 741
 742
 743
 744
 745
 746
 747
 748
 749
 750
 751
 752
 753
 754
 755
 756
 757
 758
 759
 760
 761
 762
 763
 764
 765
 766
 767
 768
 769
 770
 771
 772
 773
 774
 775
 776
 777
 778
 779
 780
 781
 782
 783
 784
 785
 786
 787
 788
 789
 790
 791
 792
 793
 794
 795
 796
 797
 798
 799
 800
 801
 802
 803
 804
 805
 806
 807
 808
 809
 810
 811
 812
 813
 814
 815
 816
 817
 818
 819
 820
 821
 822
 823
 824
 825
 826
 827
 828
 829
 830
 831
 832
 833
 834
 835
 836
 837
 838
 839
 840
 841
 842
 843
 844
 845
 846
 847
 848
 849
 850
 851
 852
 853
 854
 855
 856
 857
 858
 859
 860
 861
 862
 863
 864
 865
 866
 867
 868
 869
 870
 871
 872
 873
 874
 875
 876
 877
 878
 879
 880
 881
 882
 883
 884
 885
 886
 887
 888
 889
 890
 891
 892
 893
 894
 895
 896
 897
 898
 899
 900
 901
 902
 903
 904
 905
 906
 907
 908
 909
 910
 911
 912
 913
 914
 915
 916
 917
 918
 919
 920
 921
 922
 923
 924
 925
 926
 927
 928
 929
 930
 931
 932
 933
 934
 935
 936
 937
 938
 939
 940
 941
 942
 943
 944
 945
 946
 947
 948
 949
 950
 951
 952
 953
 954
 955
 956
 957
 958
 959
 960
 961
 962
 963
 964
 965
 966
 967
 968
 969
 970
 971
 972
 973
 974
 975
 976
 977
 978
 979
 980
 981
 982
 983
 984
 985
 986
 987
 988
 989
 990
 991
 992
 993
 994
 995
 996
 997
 998
 999
1000
1001
1002
1003
1004
1005
1006
1007
1008
1009
1010
1011
1012
1013
1014
1015
1016
1017
1018
1019
1020
1021
1022
1023
1024
1025
1026
1027
1028
1029
1030
1031
1032
1033
1034
1035
1036
1037
1038
1039
1040
1041
1042
1043
1044
1045
1046
1047
1048
1049
1050
1051
1052
1053
1054
1055
1056
1057
1058
1059
1060
1061
1062
1063
1064
1065
1066
1067
1068
1069
1070
1071
1072
1073
1074
1075
1076
1077
1078
1079
1080
1081
1082
1083
1084
1085
1086
1087
1088
1089
1090
1091
1092
1093
1094
1095
1096
1097
1098
1099
1100
1101
1102
1103
1104
1105
1106
1107
1108
1109
1110
1111
1112
1113
1114
1115
1116
1117
1118
1119
1120
1121
1122
1123
1124
1125
1126
1127
1128
1129
1130
1131
1132
1133
1134
1135
1136
1137
1138
1139
1140
1141
1142
1143
1144
1145
1146
1147
1148
1149
1150
1151
1152
1153
1154
1155
1156
1157
1158
1159
1160
1161
1162
1163
1164
1165
1166
1167
1168
1169
1170
1171
1172
1173
1174
1175
1176
1177
1178
1179
1180
1181
1182
1183
1184
1185
1186
1187
1188
1189
1190
1191
1192
1193
1194
1195
1196
1197
1198
1199
1200
1201
1202
1203
1204
1205
1206
1207
1208
1209
1210
1211
1212
1213
1214
1215
1216
1217
1218
1219
1220
1221
1222
1223
1224
1225
1226
1227
1228
1229
1230
1231
1232
1233
1234
1235
1236
1237
1238
1239
1240
1241
1242
1243
1244
1245
1246
1247
1248
1249
1250
1251
1252
1253
1254
1255
1256
1257
1258
1259
1260
1261
1262
1263
1264
1265
1266
1267
1268
1269
1270
1271
1272
1273
1274
1275
1276
1277
1278
1279
1280
1281
1282
1283
1284
1285
1286
1287
1288
1289
1290
1291
1292
1293
1294
1295
1296
1297
1298
1299
1300
1301
1302
1303
1304
1305
1306
1307
1308
1309
1310
1311
1312
1313
1314
1315
1316
1317
1318
1319
1320
1321
1322
1323
1324
1325
1326
1327
1328
1329
1330
1331
1332
1333
1334
1335
1336
1337
1338
1339
1340
1341
1342
1343
1344
1345
1346
1347
1348
1349
1350
1351
1352
1353
1354
1355
1356
1357
1358
1359
1360
1361
1362
1363
1364
1365
1366
1367
1368
1369
1370
1371
1372
1373
1374
1375
1376
1377
1378
1379
1380
1381
1382
1383
1384
1385
1386
1387
1388
1389
1390
1391
1392
1393
1394
1395
1396
1397
1398
1399
1400
1401
1402
1403
1404
1405
1406
1407
1408
1409
1410
1411
1412
1413
1414
1415
1416
1417
1418
1419
1420
1421
1422
1423
1424
1425
1426
1427
1428
1429
1430
1431
1432
1433
1434
1435
1436
1437
1438
1439
1440
1441
1442
1443
1444
1445
1446
1447
1448
1449
1450
1451
1452
1453
1454
1455
1456
1457
1458
1459
1460
1461
1462
1463
1464
1465
1466
1467
1468
1469
1470
1471
1472
1473
1474
1475
1476
1477
1478
1479
1480
1481
1482
1483
1484
1485
1486
1487
1488
1489
1490
1491
1492
1493
1494
1495
1496
1497
1498
1499
1500
1501
1502
1503
1504
1505
1506
1507
1508
1509
1510
1511
1512
1513
1514
1515
1516
1517
1518
1519
1520
1521
1522
1523
1524
1525
1526
1527
1528
1529
1530
1531
1532
1533
1534
1535
1536
1537
1538
1539
1540
1541
1542
1543
1544
1545
1546
1547
1548
1549
1550
1551
1552
1553
1554
1555
1556
1557
1558
1559
1560
1561
1562
1563
1564
1565
1566
1567
1568
1569
1570
1571
1572
1573
1574
1575
1576
1577
1578
1579
1580
1581
1582
1583
1584
1585
1586
1587
1588
1589
1590
1591
1592
1593
1594
1595
1596
1597
1598
1599
1600
1601
1602
1603
1604
1605
1606
1607
1608
1609
1610
1611
1612
1613
1614
1615
1616
1617
1618
1619
1620
1621
1622
1623
1624
1625
1626
1627
1628
1629
1630
1631
1632
1633
1634
1635
1636
1637
1638
1639
1640
1641
1642
1643
1644
1645
1646
1647
1648
1649
1650
1651
1652
1653
1654
1655
1656
1657
1658
1659
1660
1661
1662
1663
1664
1665
1666
1667
1668
1669
1670
1671
1672
1673
1674
1675
1676
1677
1678
1679
1680
1681
1682
1683
1684
1685
1686
1687
1688
1689
1690
1691
1692
1693
1694
1695
1696
1697
1698
1699
1700
1701
1702
1703
1704
1705
1706
1707
1708
1709
1710
1711
1712
1713
1714
1715
1716
1717
1718
1719
1720
1721
1722
1723
1724
1725
1726
1727
1728
1729
1730
1731
1732
1733
1734
1735
1736
1737
1738
1739
1740
1741
1742
1743
1744
1745
1746
1747
1748
1749
1750
1751
1752
1753
1754
1755
1756
1757
1758
1759
1760
1761
1762
1763
1764
1765
1766
1767
1768
1769
1770
1771
1772
1773
1774
1775
1776
1777
1778
1779
1780
1781
1782
1783
1784
1785
1786
1787
1788
1789
1790
1791
1792
1793
1794
1795
1796
1797
1798
1799
1800
1801
1802
1803
1804
1805
1806
1807
1808
1809
1810
1811
1812
1813
1814
1815
1816
1817
1818
1819
1820
1821
1822
1823
1824
1825
1826
1827
1828
1829
1830
1831
1832
1833
1834
1835
1836
1837
1838
1839
1840
1841
1842
1843
1844
1845
1846
1847
1848
1849
1850
1851
1852
1853
1854
1855
1856
1857
1858
1859
1860
1861
1862
1863
1864
1865
1866
1867
1868
1869
1870
1871
1872
1873
1874
1875
1876
1877
1878
1879
1880
1881
1882
1883
1884
1885
1886
1887
1888
1889
1890
1891
1892
1893
1894
1895
1896
1897
1898
1899
1900
1901
1902
1903
1904
1905
1906
1907
1908
1909
1910
1911
1912
1913
1914
1915
1916
1917
1918
1919
1920
1921
1922
1923
1924
1925
1926
1927
1928
1929
1930
1931
1932
1933
1934
1935
1936
1937
1938
1939
1940
1941
1942
1943
1944
1945
1946
1947
1948
1949
1950
1951
1952
1953
1954
1955
1956
1957
1958
1959
1960
1961
1962
1963
1964
1965
1966
1967
1968
1969
1970
1971
1972
1973
1974
1975
1976
1977
1978
1979
1980
1981
1982
1983
1984
1985
1986
1987
1988
1989
1990
1991
1992
1993
1994
1995
1996
1997
1998
1999
2000
2001
2002
2003
2004
2005
2006
2007
2008
2009
2010
2011
2012
2013
2014
2015
2016
2017
2018
2019
2020
2021
2022
2023
2024
2025
2026
2027
2028
2029
2030
2031
2032
2033
2034
2035
2036
2037
2038
2039
2040
2041
2042
2043
2044
2045
2046
2047
2048
2049
2050
2051
2052
2053
2054
2055
2056
2057
2058
2059
2060
2061
2062
2063
2064
2065
2066
2067
2068
2069
2070
2071
2072
2073
2074
2075
2076
2077
2078
2079
2080
2081
2082
2083
2084
2085
2086
2087
2088
2089
2090
2091
2092
2093
2094
2095
2096
2097
2098
2099
2100
2101
2102
2103
2104
2105
2106
2107
2108
2109
2110
2111
2112
2113
2114
2115
2116
2117
2118
2119
2120
2121
2122
2123
2124
2125
2126
2127
2128
2129
2130
2131
2132
2133
2134
2135
2136
2137
2138
2139
2140
2141
2142
2143
2144
2145
2146
2147
2148</pre></div></td><td class="code"><div class="highlight"><pre><span></span><a name="gbab-1"></a><span class="cm">/********************************************************************</span>
<a name="gbab-2"></a><span class="cm"> *                                                                  *</span>
<a name="gbab-3"></a><span class="cm"> * THIS FILE IS PART OF THE libopusfile SOFTWARE CODEC SOURCE CODE. *</span>
<a name="gbab-4"></a><span class="cm"> * USE, DISTRIBUTION AND REPRODUCTION OF THIS LIBRARY SOURCE IS     *</span>
<a name="gbab-5"></a><span class="cm"> * GOVERNED BY A BSD-STYLE SOURCE LICENSE INCLUDED WITH THIS SOURCE *</span>
<a name="gbab-6"></a><span class="cm"> * IN &#39;COPYING&#39;. PLEASE READ THESE TERMS BEFORE DISTRIBUTING.       *</span>
<a name="gbab-7"></a><span class="cm"> *                                                                  *</span>
<a name="gbab-8"></a><span class="cm"> * THE libopusfile SOURCE CODE IS (C) COPYRIGHT 1994-2012           *</span>
<a name="gbab-9"></a><span class="cm"> * by the Xiph.Org Foundation and contributors http://www.xiph.org/ *</span>
<a name="gbab-10"></a><span class="cm"> *                                                                  *</span>
<a name="gbab-11"></a><span class="cm"> ********************************************************************</span>
<a name="gbab-12"></a>
<a name="gbab-13"></a><span class="cm"> function: stdio-based convenience library for opening/seeking/decoding</span>
<a name="gbab-14"></a><span class="cm"> last mod: $Id: vorbisfile.h 17182 2010-04-29 03:48:32Z xiphmont $</span>
<a name="gbab-15"></a>
<a name="gbab-16"></a><span class="cm"> ********************************************************************/</span>
<a name="gbab-17"></a><span class="cp">#if !defined(_opusfile_h)</span>
<a name="gbab-18"></a><span class="cp"># define _opusfile_h (1)</span>
<a name="gbab-19"></a>
<a name="gbab-20"></a><span class="cm">/**\mainpage</span>
<a name="gbab-21"></a><span class="cm">   \section Introduction</span>
<a name="gbab-22"></a>
<a name="gbab-23"></a><span class="cm">   This is the documentation for the &lt;tt&gt;libopusfile&lt;/tt&gt; C API.</span>
<a name="gbab-24"></a>
<a name="gbab-25"></a><span class="cm">   The &lt;tt&gt;libopusfile&lt;/tt&gt; package provides a convenient high-level API for</span>
<a name="gbab-26"></a><span class="cm">    decoding and basic manipulation of all Ogg Opus audio streams.</span>
<a name="gbab-27"></a><span class="cm">   &lt;tt&gt;libopusfile&lt;/tt&gt; is implemented as a layer on top of Xiph.Org&#39;s</span>
<a name="gbab-28"></a><span class="cm">    reference</span>
<a name="gbab-29"></a><span class="cm">    &lt;tt&gt;&lt;a href=&quot;https://www.xiph.org/ogg/doc/libogg/reference.html&quot;&gt;libogg&lt;/a&gt;&lt;/tt&gt;</span>
<a name="gbab-30"></a><span class="cm">    and</span>
<a name="gbab-31"></a><span class="cm">    &lt;tt&gt;&lt;a href=&quot;https://mf4.xiph.org/jenkins/view/opus/job/opus/ws/doc/html/index.html&quot;&gt;libopus&lt;/a&gt;&lt;/tt&gt;</span>
<a name="gbab-32"></a><span class="cm">    libraries.</span>
<a name="gbab-33"></a>
<a name="gbab-34"></a><span class="cm">   &lt;tt&gt;libopusfile&lt;/tt&gt; provides several sets of built-in routines for</span>
<a name="gbab-35"></a><span class="cm">    file/stream access, and may also use custom stream I/O routines provided by</span>
<a name="gbab-36"></a><span class="cm">    the embedded environment.</span>
<a name="gbab-37"></a><span class="cm">   There are built-in I/O routines provided for ANSI-compliant</span>
<a name="gbab-38"></a><span class="cm">    &lt;code&gt;stdio&lt;/code&gt; (&lt;code&gt;FILE *&lt;/code&gt;), memory buffers, and URLs</span>
<a name="gbab-39"></a><span class="cm">    (including &lt;file:&gt; URLs, plus optionally &lt;http:&gt; and &lt;https:&gt; URLs).</span>
<a name="gbab-40"></a>
<a name="gbab-41"></a><span class="cm">   \section Organization</span>
<a name="gbab-42"></a>
<a name="gbab-43"></a><span class="cm">   The main API is divided into several sections:</span>
<a name="gbab-44"></a><span class="cm">   - \ref stream_open_close</span>
<a name="gbab-45"></a><span class="cm">   - \ref stream_info</span>
<a name="gbab-46"></a><span class="cm">   - \ref stream_decoding</span>
<a name="gbab-47"></a><span class="cm">   - \ref stream_seeking</span>
<a name="gbab-48"></a>
<a name="gbab-49"></a><span class="cm">   Several additional sections are not tied to the main API.</span>
<a name="gbab-50"></a><span class="cm">   - \ref stream_callbacks</span>
<a name="gbab-51"></a><span class="cm">   - \ref header_info</span>
<a name="gbab-52"></a><span class="cm">   - \ref error_codes</span>
<a name="gbab-53"></a>
<a name="gbab-54"></a><span class="cm">   \section Overview</span>
<a name="gbab-55"></a>
<a name="gbab-56"></a><span class="cm">   The &lt;tt&gt;libopusfile&lt;/tt&gt; API always decodes files to 48&amp;nbsp;kHz.</span>
<a name="gbab-57"></a><span class="cm">   The original sample rate is not preserved by the lossy compression, though</span>
<a name="gbab-58"></a><span class="cm">    it is stored in the header to allow you to resample to it after decoding</span>
<a name="gbab-59"></a><span class="cm">    (the &lt;tt&gt;libopusfile&lt;/tt&gt; API does not currently provide a resampler,</span>
<a name="gbab-60"></a><span class="cm">    but the</span>
<a name="gbab-61"></a><span class="cm">    &lt;a href=&quot;http://www.speex.org/docs/manual/speex-manual/node7.html#SECTION00760000000000000000&quot;&gt;the</span>
<a name="gbab-62"></a><span class="cm">    Speex resampler&lt;/a&gt; is a good choice if you need one).</span>
<a name="gbab-63"></a><span class="cm">   In general, if you are playing back the audio, you should leave it at</span>
<a name="gbab-64"></a><span class="cm">    48&amp;nbsp;kHz, provided your audio hardware supports it.</span>
<a name="gbab-65"></a><span class="cm">   When decoding to a file, it may be worth resampling back to the original</span>
<a name="gbab-66"></a><span class="cm">    sample rate, so as not to surprise users who might not expect the sample</span>
<a name="gbab-67"></a><span class="cm">    rate to change after encoding to Opus and decoding.</span>
<a name="gbab-68"></a>
<a name="gbab-69"></a><span class="cm">   Opus files can contain anywhere from 1 to 255 channels of audio.</span>
<a name="gbab-70"></a><span class="cm">   The channel mappings for up to 8 channels are the same as the</span>
<a name="gbab-71"></a><span class="cm">    &lt;a href=&quot;http://www.xiph.org/vorbis/doc/Vorbis_I_spec.html#x1-800004.3.9&quot;&gt;Vorbis</span>
<a name="gbab-72"></a><span class="cm">    mappings&lt;/a&gt;.</span>
<a name="gbab-73"></a><span class="cm">   A special stereo API can convert everything to 2 channels, making it simple</span>
<a name="gbab-74"></a><span class="cm">    to support multichannel files in an application which only has stereo</span>
<a name="gbab-75"></a><span class="cm">    output.</span>
<a name="gbab-76"></a><span class="cm">   Although the &lt;tt&gt;libopusfile&lt;/tt&gt; ABI provides support for the theoretical</span>
<a name="gbab-77"></a><span class="cm">    maximum number of channels, the current implementation does not support</span>
<a name="gbab-78"></a><span class="cm">    files with more than 8 channels, as they do not have well-defined channel</span>
<a name="gbab-79"></a><span class="cm">    mappings.</span>
<a name="gbab-80"></a>
<a name="gbab-81"></a><span class="cm">   Like all Ogg files, Opus files may be &quot;chained&quot;.</span>
<a name="gbab-82"></a><span class="cm">   That is, multiple Opus files may be combined into a single, longer file just</span>
<a name="gbab-83"></a><span class="cm">    by concatenating the original files.</span>
<a name="gbab-84"></a><span class="cm">   This is commonly done in internet radio streaming, as it allows the title</span>
<a name="gbab-85"></a><span class="cm">    and artist to be updated each time the song changes, since each link in the</span>
<a name="gbab-86"></a><span class="cm">    chain includes its own set of metadata.</span>
<a name="gbab-87"></a>
<a name="gbab-88"></a><span class="cm">   &lt;tt&gt;libopusfile&lt;/tt&gt; fully supports chained files.</span>
<a name="gbab-89"></a><span class="cm">   It will decode the first Opus stream found in each link of a chained file</span>
<a name="gbab-90"></a><span class="cm">    (ignoring any other streams that might be concurrently multiplexed with it,</span>
<a name="gbab-91"></a><span class="cm">    such as a video stream).</span>
<a name="gbab-92"></a>
<a name="gbab-93"></a><span class="cm">   The channel count can also change between links.</span>
<a name="gbab-94"></a><span class="cm">   If your application is not prepared to deal with this, it can use the stereo</span>
<a name="gbab-95"></a><span class="cm">    API to ensure the audio from all links will always get decoded into a</span>
<a name="gbab-96"></a><span class="cm">    common format.</span>
<a name="gbab-97"></a><span class="cm">   Since &lt;tt&gt;libopusfile&lt;/tt&gt; always decodes to 48&amp;nbsp;kHz, you do not have to</span>
<a name="gbab-98"></a><span class="cm">    worry about the sample rate changing between links (as was possible with</span>
<a name="gbab-99"></a><span class="cm">    Vorbis).</span>
<a name="gbab-100"></a><span class="cm">   This makes application support for chained files with &lt;tt&gt;libopusfile&lt;/tt&gt;</span>
<a name="gbab-101"></a><span class="cm">    very easy.*/</span>
<a name="gbab-102"></a>
<a name="gbab-103"></a><span class="cp"># if defined(__cplusplus)</span>
<a name="gbab-104"></a><span class="k">extern</span> <span class="s">&quot;C&quot;</span> <span class="p">{</span>
<a name="gbab-105"></a><span class="cp"># endif</span>
<a name="gbab-106"></a>
<a name="gbab-107"></a><span class="cp"># include &lt;stdarg.h&gt;</span>
<a name="gbab-108"></a><span class="cp"># include &lt;stdio.h&gt;</span>
<a name="gbab-109"></a><span class="cp"># include &lt;ogg/ogg.h&gt;</span>
<a name="gbab-110"></a><span class="cp"># include &quot;opus/opus_multistream.h&quot;</span>
<a name="gbab-111"></a>
<a name="gbab-112"></a><span class="cm">/**@cond PRIVATE*/</span>
<a name="gbab-113"></a>
<a name="gbab-114"></a><span class="cm">/*Enable special features for gcc and gcc-compatible compilers.*/</span>
<a name="gbab-115"></a><span class="cp"># if !defined(OP_GNUC_PREREQ)</span>
<a name="gbab-116"></a><span class="cp">#  if defined(__GNUC__)&amp;&amp;defined(__GNUC_MINOR__)</span>
<a name="gbab-117"></a><span class="cp">#   define OP_GNUC_PREREQ(_maj,_min) \</span>
<a name="gbab-118"></a><span class="cp"> ((__GNUC__&lt;&lt;16)+__GNUC_MINOR__&gt;=((_maj)&lt;&lt;16)+(_min))</span>
<a name="gbab-119"></a><span class="cp">#  else</span>
<a name="gbab-120"></a><span class="cp">#   define OP_GNUC_PREREQ(_maj,_min) 0</span>
<a name="gbab-121"></a><span class="cp">#  endif</span>
<a name="gbab-122"></a><span class="cp"># endif</span>
<a name="gbab-123"></a>
<a name="gbab-124"></a><span class="cp"># if OP_GNUC_PREREQ(4,0)</span>
<a name="gbab-125"></a><span class="cp">#  pragma GCC visibility push(default)</span>
<a name="gbab-126"></a><span class="cp"># endif</span>
<a name="gbab-127"></a>
<a name="gbab-128"></a><span class="k">typedef</span> <span class="k">struct</span> <span class="n">OpusHead</span>          <span class="n">OpusHead</span><span class="p">;</span>
<a name="gbab-129"></a><span class="k">typedef</span> <span class="k">struct</span> <span class="n">OpusTags</span>          <span class="n">OpusTags</span><span class="p">;</span>
<a name="gbab-130"></a><span class="k">typedef</span> <span class="k">struct</span> <span class="n">OpusPictureTag</span>    <span class="n">OpusPictureTag</span><span class="p">;</span>
<a name="gbab-131"></a><span class="k">typedef</span> <span class="k">struct</span> <span class="n">OpusServerInfo</span>    <span class="n">OpusServerInfo</span><span class="p">;</span>
<a name="gbab-132"></a><span class="k">typedef</span> <span class="k">struct</span> <span class="n">OpusFileCallbacks</span> <span class="n">OpusFileCallbacks</span><span class="p">;</span>
<a name="gbab-133"></a><span class="k">typedef</span> <span class="k">struct</span> <span class="n">OggOpusFile</span>       <span class="n">OggOpusFile</span><span class="p">;</span>
<a name="gbab-134"></a>
<a name="gbab-135"></a><span class="cm">/*Warning attributes for libopusfile functions.*/</span>
<a name="gbab-136"></a><span class="cp"># if OP_GNUC_PREREQ(3,4)</span>
<a name="gbab-137"></a><span class="cp">#  define OP_WARN_UNUSED_RESULT __attribute__((__warn_unused_result__))</span>
<a name="gbab-138"></a><span class="cp"># else</span>
<a name="gbab-139"></a><span class="cp">#  define OP_WARN_UNUSED_RESULT</span>
<a name="gbab-140"></a><span class="cp"># endif</span>
<a name="gbab-141"></a><span class="cp"># if OP_GNUC_PREREQ(3,4)</span>
<a name="gbab-142"></a><span class="cp">#  define OP_ARG_NONNULL(_x) __attribute__((__nonnull__(_x)))</span>
<a name="gbab-143"></a><span class="cp"># else</span>
<a name="gbab-144"></a><span class="cp">#  define OP_ARG_NONNULL(_x)</span>
<a name="gbab-145"></a><span class="cp"># endif</span>
<a name="gbab-146"></a>
<a name="gbab-147"></a><span class="cm">/**@endcond*/</span>
<a name="gbab-148"></a>
<a name="gbab-149"></a><span class="cm">/**\defgroup error_codes Error Codes*/</span>
<a name="gbab-150"></a><span class="cm">/*@{*/</span>
<a name="gbab-151"></a><span class="cm">/**\name List of possible error codes</span>
<a name="gbab-152"></a><span class="cm">   Many of the functions in this library return a negative error code when a</span>
<a name="gbab-153"></a><span class="cm">    function fails.</span>
<a name="gbab-154"></a><span class="cm">   This list provides a brief explanation of the common errors.</span>
<a name="gbab-155"></a><span class="cm">   See each individual function for more details on what a specific error code</span>
<a name="gbab-156"></a><span class="cm">    means in that context.*/</span>
<a name="gbab-157"></a><span class="cm">/*@{*/</span>
<a name="gbab-158"></a>
<a name="gbab-159"></a><span class="cm">/**A request did not succeed.*/</span>
<a name="gbab-160"></a><span class="cp">#define OP_FALSE         (-1)</span>
<a name="gbab-161"></a><span class="cm">/*Currently not used externally.*/</span>
<a name="gbab-162"></a><span class="cp">#define OP_EOF           (-2)</span>
<a name="gbab-163"></a><span class="cm">/**There was a hole in the page sequence numbers (e.g., a page was corrupt or</span>
<a name="gbab-164"></a><span class="cm">    missing).*/</span>
<a name="gbab-165"></a><span class="cp">#define OP_HOLE          (-3)</span>
<a name="gbab-166"></a><span class="cm">/**An underlying read, seek, or tell operation failed when it should have</span>
<a name="gbab-167"></a><span class="cm">    succeeded.*/</span>
<a name="gbab-168"></a><span class="cp">#define OP_EREAD         (-128)</span>
<a name="gbab-169"></a><span class="cm">/**A &lt;code&gt;NULL&lt;/code&gt; pointer was passed where one was unexpected, or an</span>
<a name="gbab-170"></a><span class="cm">    internal memory allocation failed, or an internal library error was</span>
<a name="gbab-171"></a><span class="cm">    encountered.*/</span>
<a name="gbab-172"></a><span class="cp">#define OP_EFAULT        (-129)</span>
<a name="gbab-173"></a><span class="cm">/**The stream used a feature that is not implemented, such as an unsupported</span>
<a name="gbab-174"></a><span class="cm">    channel family.*/</span>
<a name="gbab-175"></a><span class="cp">#define OP_EIMPL         (-130)</span>
<a name="gbab-176"></a><span class="cm">/**One or more parameters to a function were invalid.*/</span>
<a name="gbab-177"></a><span class="cp">#define OP_EINVAL        (-131)</span>
<a name="gbab-178"></a><span class="cm">/**A purported Ogg Opus stream did not begin with an Ogg page, a purported</span>
<a name="gbab-179"></a><span class="cm">    header packet did not start with one of the required strings, &quot;OpusHead&quot; or</span>
<a name="gbab-180"></a><span class="cm">    &quot;OpusTags&quot;, or a link in a chained file was encountered that did not</span>
<a name="gbab-181"></a><span class="cm">    contain any logical Opus streams.*/</span>
<a name="gbab-182"></a><span class="cp">#define OP_ENOTFORMAT    (-132)</span>
<a name="gbab-183"></a><span class="cm">/**A required header packet was not properly formatted, contained illegal</span>
<a name="gbab-184"></a><span class="cm">    values, or was missing altogether.*/</span>
<a name="gbab-185"></a><span class="cp">#define OP_EBADHEADER    (-133)</span>
<a name="gbab-186"></a><span class="cm">/**The ID header contained an unrecognized version number.*/</span>
<a name="gbab-187"></a><span class="cp">#define OP_EVERSION      (-134)</span>
<a name="gbab-188"></a><span class="cm">/*Currently not used at all.*/</span>
<a name="gbab-189"></a><span class="cp">#define OP_ENOTAUDIO     (-135)</span>
<a name="gbab-190"></a><span class="cm">/**An audio packet failed to decode properly.</span>
<a name="gbab-191"></a><span class="cm">   This is usually caused by a multistream Ogg packet where the durations of</span>
<a name="gbab-192"></a><span class="cm">    the individual Opus packets contained in it are not all the same.*/</span>
<a name="gbab-193"></a><span class="cp">#define OP_EBADPACKET    (-136)</span>
<a name="gbab-194"></a><span class="cm">/**We failed to find data we had seen before, or the bitstream structure was</span>
<a name="gbab-195"></a><span class="cm">    sufficiently malformed that seeking to the target destination was</span>
<a name="gbab-196"></a><span class="cm">    impossible.*/</span>
<a name="gbab-197"></a><span class="cp">#define OP_EBADLINK      (-137)</span>
<a name="gbab-198"></a><span class="cm">/**An operation that requires seeking was requested on an unseekable stream.*/</span>
<a name="gbab-199"></a><span class="cp">#define OP_ENOSEEK       (-138)</span>
<a name="gbab-200"></a><span class="cm">/**The first or last granule position of a link failed basic validity checks.*/</span>
<a name="gbab-201"></a><span class="cp">#define OP_EBADTIMESTAMP (-139)</span>
<a name="gbab-202"></a>
<a name="gbab-203"></a><span class="cm">/*@}*/</span>
<a name="gbab-204"></a><span class="cm">/*@}*/</span>
<a name="gbab-205"></a>
<a name="gbab-206"></a><span class="cm">/**\defgroup header_info Header Information*/</span>
<a name="gbab-207"></a><span class="cm">/*@{*/</span>
<a name="gbab-208"></a>
<a name="gbab-209"></a><span class="cm">/**The maximum number of channels in an Ogg Opus stream.*/</span>
<a name="gbab-210"></a><span class="cp">#define OPUS_CHANNEL_COUNT_MAX (255)</span>
<a name="gbab-211"></a>
<a name="gbab-212"></a><span class="cm">/**Ogg Opus bitstream information.</span>
<a name="gbab-213"></a><span class="cm">   This contains the basic playback parameters for a stream, and corresponds to</span>
<a name="gbab-214"></a><span class="cm">    the initial ID header packet of an Ogg Opus stream.*/</span>
<a name="gbab-215"></a><span class="k">struct</span> <span class="n">OpusHead</span><span class="p">{</span>
<a name="gbab-216"></a>  <span class="cm">/**The Ogg Opus format version, in the range 0...255.</span>
<a name="gbab-217"></a><span class="cm">     The top 4 bits represent a &quot;major&quot; version, and the bottom four bits</span>
<a name="gbab-218"></a><span class="cm">      represent backwards-compatible &quot;minor&quot; revisions.</span>
<a name="gbab-219"></a><span class="cm">     The current specification describes version 1.</span>
<a name="gbab-220"></a><span class="cm">     This library will recognize versions up through 15 as backwards compatible</span>
<a name="gbab-221"></a><span class="cm">      with the current specification.</span>
<a name="gbab-222"></a><span class="cm">     An earlier draft of the specification described a version 0, but the only</span>
<a name="gbab-223"></a><span class="cm">      difference between version 1 and version 0 is that version 0 did</span>
<a name="gbab-224"></a><span class="cm">      not specify the semantics for handling the version field.*/</span>
<a name="gbab-225"></a>  <span class="kt">int</span>           <span class="n">version</span><span class="p">;</span>
<a name="gbab-226"></a>  <span class="cm">/**The number of channels, in the range 1...255.*/</span>
<a name="gbab-227"></a>  <span class="kt">int</span>           <span class="n">channel_count</span><span class="p">;</span>
<a name="gbab-228"></a>  <span class="cm">/**The number of samples that should be discarded from the beginning of the</span>
<a name="gbab-229"></a><span class="cm">      stream.*/</span>
<a name="gbab-230"></a>  <span class="kt">unsigned</span>      <span class="n">pre_skip</span><span class="p">;</span>
<a name="gbab-231"></a>  <span class="cm">/**The sampling rate of the original input.</span>
<a name="gbab-232"></a><span class="cm">     All Opus audio is coded at 48 kHz, and should also be decoded at 48 kHz</span>
<a name="gbab-233"></a><span class="cm">      for playback (unless the target hardware does not support this sampling</span>
<a name="gbab-234"></a><span class="cm">      rate).</span>
<a name="gbab-235"></a><span class="cm">     However, this field may be used to resample the audio back to the original</span>
<a name="gbab-236"></a><span class="cm">      sampling rate, for example, when saving the output to a file.*/</span>
<a name="gbab-237"></a>  <span class="n">opus_uint32</span>   <span class="n">input_sample_rate</span><span class="p">;</span>
<a name="gbab-238"></a>  <span class="cm">/**The gain to apply to the decoded output, in dB, as a Q8 value in the range</span>
<a name="gbab-239"></a><span class="cm">      -32768...32767.</span>
<a name="gbab-240"></a><span class="cm">     The &lt;tt&gt;libopusfile&lt;/tt&gt; API will automatically apply this gain to the</span>
<a name="gbab-241"></a><span class="cm">      decoded output before returning it, scaling it by</span>
<a name="gbab-242"></a><span class="cm">      &lt;code&gt;pow(10,output_gain/(20.0*256))&lt;/code&gt;.*/</span>
<a name="gbab-243"></a>  <span class="kt">int</span>           <span class="n">output_gain</span><span class="p">;</span>
<a name="gbab-244"></a>  <span class="cm">/**The channel mapping family, in the range 0...255.</span>
<a name="gbab-245"></a><span class="cm">     Channel mapping family 0 covers mono or stereo in a single stream.</span>
<a name="gbab-246"></a><span class="cm">     Channel mapping family 1 covers 1 to 8 channels in one or more streams,</span>
<a name="gbab-247"></a><span class="cm">      using the Vorbis speaker assignments.</span>
<a name="gbab-248"></a><span class="cm">     Channel mapping family 255 covers 1 to 255 channels in one or more</span>
<a name="gbab-249"></a><span class="cm">      streams, but without any defined speaker assignment.*/</span>
<a name="gbab-250"></a>  <span class="kt">int</span>           <span class="n">mapping_family</span><span class="p">;</span>
<a name="gbab-251"></a>  <span class="cm">/**The number of Opus streams in each Ogg packet, in the range 1...255.*/</span>
<a name="gbab-252"></a>  <span class="kt">int</span>           <span class="n">stream_count</span><span class="p">;</span>
<a name="gbab-253"></a>  <span class="cm">/**The number of coupled Opus streams in each Ogg packet, in the range</span>
<a name="gbab-254"></a><span class="cm">      0...127.</span>
<a name="gbab-255"></a><span class="cm">     This must satisfy &lt;code&gt;0 &lt;= coupled_count &lt;= stream_count&lt;/code&gt; and</span>
<a name="gbab-256"></a><span class="cm">      &lt;code&gt;coupled_count + stream_count &lt;= 255&lt;/code&gt;.</span>
<a name="gbab-257"></a><span class="cm">     The coupled streams appear first, before all uncoupled streams, in an Ogg</span>
<a name="gbab-258"></a><span class="cm">      Opus packet.*/</span>
<a name="gbab-259"></a>  <span class="kt">int</span>           <span class="n">coupled_count</span><span class="p">;</span>
<a name="gbab-260"></a>  <span class="cm">/**The mapping from coded stream channels to output channels.</span>
<a name="gbab-261"></a><span class="cm">     Let &lt;code&gt;index=mapping[k]&lt;/code&gt; be the value for channel &lt;code&gt;k&lt;/code&gt;.</span>
<a name="gbab-262"></a><span class="cm">     If &lt;code&gt;index&lt;2*coupled_count&lt;/code&gt;, then it refers to the left channel</span>
<a name="gbab-263"></a><span class="cm">      from stream &lt;code&gt;(index/2)&lt;/code&gt; if even, and the right channel from</span>
<a name="gbab-264"></a><span class="cm">      stream &lt;code&gt;(index/2)&lt;/code&gt; if odd.</span>
<a name="gbab-265"></a><span class="cm">     Otherwise, it refers to the output of the uncoupled stream</span>
<a name="gbab-266"></a><span class="cm">      &lt;code&gt;(index-coupled_count)&lt;/code&gt;.*/</span>
<a name="gbab-267"></a>  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">mapping</span><span class="p">[</span><span class="n">OPUS_CHANNEL_COUNT_MAX</span><span class="p">];</span>
<a name="gbab-268"></a><span class="p">};</span>
<a name="gbab-269"></a>
<a name="gbab-270"></a><span class="cm">/**The metadata from an Ogg Opus stream.</span>
<a name="gbab-271"></a>
<a name="gbab-272"></a><span class="cm">   This structure holds the in-stream metadata corresponding to the &#39;comment&#39;</span>
<a name="gbab-273"></a><span class="cm">    header packet of an Ogg Opus stream.</span>
<a name="gbab-274"></a><span class="cm">   The comment header is meant to be used much like someone jotting a quick</span>
<a name="gbab-275"></a><span class="cm">    note on the label of a CD.</span>
<a name="gbab-276"></a><span class="cm">   It should be a short, to the point text note that can be more than a couple</span>
<a name="gbab-277"></a><span class="cm">    words, but not more than a short paragraph.</span>
<a name="gbab-278"></a>
<a name="gbab-279"></a><span class="cm">   The metadata is stored as a series of (tag, value) pairs, in length-encoded</span>
<a name="gbab-280"></a><span class="cm">    string vectors, using the same format as Vorbis (without the final &quot;framing</span>
<a name="gbab-281"></a><span class="cm">    bit&quot;), Theora, and Speex, except for the packet header.</span>
<a name="gbab-282"></a><span class="cm">   The first occurrence of the &#39;=&#39; character delimits the tag and value.</span>
<a name="gbab-283"></a><span class="cm">   A particular tag may occur more than once, and order is significant.</span>
<a name="gbab-284"></a><span class="cm">   The character set encoding for the strings is always UTF-8, but the tag</span>
<a name="gbab-285"></a><span class="cm">    names are limited to ASCII, and treated as case-insensitive.</span>
<a name="gbab-286"></a><span class="cm">   See &lt;a href=&quot;http://www.xiph.org/vorbis/doc/v-comment.html&quot;&gt;the Vorbis</span>
<a name="gbab-287"></a><span class="cm">    comment header specification&lt;/a&gt; for details.</span>
<a name="gbab-288"></a>
<a name="gbab-289"></a><span class="cm">   In filling in this structure, &lt;tt&gt;libopusfile&lt;/tt&gt; will null-terminate the</span>
<a name="gbab-290"></a><span class="cm">    #user_comments strings for safety.</span>
<a name="gbab-291"></a><span class="cm">   However, the bitstream format itself treats them as 8-bit clean vectors,</span>
<a name="gbab-292"></a><span class="cm">    possibly containing NUL characters, so the #comment_lengths array should be</span>
<a name="gbab-293"></a><span class="cm">    treated as their authoritative length.</span>
<a name="gbab-294"></a>
<a name="gbab-295"></a><span class="cm">   This structure is binary and source-compatible with a</span>
<a name="gbab-296"></a><span class="cm">    &lt;code&gt;vorbis_comment&lt;/code&gt;, and pointers to it may be freely cast to</span>
<a name="gbab-297"></a><span class="cm">    &lt;code&gt;vorbis_comment&lt;/code&gt; pointers, and vice versa.</span>
<a name="gbab-298"></a><span class="cm">   It is provided as a separate type to avoid introducing a compile-time</span>
<a name="gbab-299"></a><span class="cm">    dependency on the libvorbis headers.*/</span>
<a name="gbab-300"></a><span class="k">struct</span> <span class="n">OpusTags</span><span class="p">{</span>
<a name="gbab-301"></a>  <span class="cm">/**The array of comment string vectors.*/</span>
<a name="gbab-302"></a>  <span class="kt">char</span> <span class="o">**</span><span class="n">user_comments</span><span class="p">;</span>
<a name="gbab-303"></a>  <span class="cm">/**An array of the corresponding length of each vector, in bytes.*/</span>
<a name="gbab-304"></a>  <span class="kt">int</span>   <span class="o">*</span><span class="n">comment_lengths</span><span class="p">;</span>
<a name="gbab-305"></a>  <span class="cm">/**The total number of comment streams.*/</span>
<a name="gbab-306"></a>  <span class="kt">int</span>    <span class="n">comments</span><span class="p">;</span>
<a name="gbab-307"></a>  <span class="cm">/**The null-terminated vendor string.</span>
<a name="gbab-308"></a><span class="cm">     This identifies the software used to encode the stream.*/</span>
<a name="gbab-309"></a>  <span class="kt">char</span>  <span class="o">*</span><span class="n">vendor</span><span class="p">;</span>
<a name="gbab-310"></a><span class="p">};</span>
<a name="gbab-311"></a>
<a name="gbab-312"></a><span class="cm">/**\name Picture tag image formats*/</span>
<a name="gbab-313"></a><span class="cm">/*@{*/</span>
<a name="gbab-314"></a>
<a name="gbab-315"></a><span class="cm">/**The MIME type was not recognized, or the image data did not match the</span>
<a name="gbab-316"></a><span class="cm">    declared MIME type.*/</span>
<a name="gbab-317"></a><span class="cp">#define OP_PIC_FORMAT_UNKNOWN (-1)</span>
<a name="gbab-318"></a><span class="cm">/**The MIME type indicates the image data is really a URL.*/</span>
<a name="gbab-319"></a><span class="cp">#define OP_PIC_FORMAT_URL     (0)</span>
<a name="gbab-320"></a><span class="cm">/**The image is a JPEG.*/</span>
<a name="gbab-321"></a><span class="cp">#define OP_PIC_FORMAT_JPEG    (1)</span>
<a name="gbab-322"></a><span class="cm">/**The image is a PNG.*/</span>
<a name="gbab-323"></a><span class="cp">#define OP_PIC_FORMAT_PNG     (2)</span>
<a name="gbab-324"></a><span class="cm">/**The image is a GIF.*/</span>
<a name="gbab-325"></a><span class="cp">#define OP_PIC_FORMAT_GIF     (3)</span>
<a name="gbab-326"></a>
<a name="gbab-327"></a><span class="cm">/*@}*/</span>
<a name="gbab-328"></a>
<a name="gbab-329"></a><span class="cm">/**The contents of a METADATA_BLOCK_PICTURE tag.*/</span>
<a name="gbab-330"></a><span class="k">struct</span> <span class="n">OpusPictureTag</span><span class="p">{</span>
<a name="gbab-331"></a>  <span class="cm">/**The picture type according to the ID3v2 APIC frame:</span>
<a name="gbab-332"></a><span class="cm">     &lt;ol start=&quot;0&quot;&gt;</span>
<a name="gbab-333"></a><span class="cm">     &lt;li&gt;Other&lt;/li&gt;</span>
<a name="gbab-334"></a><span class="cm">     &lt;li&gt;32x32 pixels &#39;file icon&#39; (PNG only)&lt;/li&gt;</span>
<a name="gbab-335"></a><span class="cm">     &lt;li&gt;Other file icon&lt;/li&gt;</span>
<a name="gbab-336"></a><span class="cm">     &lt;li&gt;Cover (front)&lt;/li&gt;</span>
<a name="gbab-337"></a><span class="cm">     &lt;li&gt;Cover (back)&lt;/li&gt;</span>
<a name="gbab-338"></a><span class="cm">     &lt;li&gt;Leaflet page&lt;/li&gt;</span>
<a name="gbab-339"></a><span class="cm">     &lt;li&gt;Media (e.g. label side of CD)&lt;/li&gt;</span>
<a name="gbab-340"></a><span class="cm">     &lt;li&gt;Lead artist/lead performer/soloist&lt;/li&gt;</span>
<a name="gbab-341"></a><span class="cm">     &lt;li&gt;Artist/performer&lt;/li&gt;</span>
<a name="gbab-342"></a><span class="cm">     &lt;li&gt;Conductor&lt;/li&gt;</span>
<a name="gbab-343"></a><span class="cm">     &lt;li&gt;Band/Orchestra&lt;/li&gt;</span>
<a name="gbab-344"></a><span class="cm">     &lt;li&gt;Composer&lt;/li&gt;</span>
<a name="gbab-345"></a><span class="cm">     &lt;li&gt;Lyricist/text writer&lt;/li&gt;</span>
<a name="gbab-346"></a><span class="cm">     &lt;li&gt;Recording Location&lt;/li&gt;</span>
<a name="gbab-347"></a><span class="cm">     &lt;li&gt;During recording&lt;/li&gt;</span>
<a name="gbab-348"></a><span class="cm">     &lt;li&gt;During performance&lt;/li&gt;</span>
<a name="gbab-349"></a><span class="cm">     &lt;li&gt;Movie/video screen capture&lt;/li&gt;</span>
<a name="gbab-350"></a><span class="cm">     &lt;li&gt;A bright colored fish&lt;/li&gt;</span>
<a name="gbab-351"></a><span class="cm">     &lt;li&gt;Illustration&lt;/li&gt;</span>
<a name="gbab-352"></a><span class="cm">     &lt;li&gt;Band/artist logotype&lt;/li&gt;</span>
<a name="gbab-353"></a><span class="cm">     &lt;li&gt;Publisher/Studio logotype&lt;/li&gt;</span>
<a name="gbab-354"></a><span class="cm">     &lt;/ol&gt;</span>
<a name="gbab-355"></a><span class="cm">     Others are reserved and should not be used.</span>
<a name="gbab-356"></a><span class="cm">     There may only be one each of picture type 1 and 2 in a file.*/</span>
<a name="gbab-357"></a>  <span class="n">opus_int32</span>     <span class="n">type</span><span class="p">;</span>
<a name="gbab-358"></a>  <span class="cm">/**The MIME type of the picture, in printable ASCII characters 0x20-0x7E.</span>
<a name="gbab-359"></a><span class="cm">     The MIME type may also be &lt;code&gt;&quot;--&gt;&quot;&lt;/code&gt; to signify that the data part</span>
<a name="gbab-360"></a><span class="cm">      is a URL pointing to the picture instead of the picture data itself.</span>
<a name="gbab-361"></a><span class="cm">     In this case, a terminating NUL is appended to the URL string in #data,</span>
<a name="gbab-362"></a><span class="cm">      but #data_length is set to the length of the string excluding that</span>
<a name="gbab-363"></a><span class="cm">      terminating NUL.*/</span>
<a name="gbab-364"></a>  <span class="kt">char</span>          <span class="o">*</span><span class="n">mime_type</span><span class="p">;</span>
<a name="gbab-365"></a>  <span class="cm">/**The description of the picture, in UTF-8.*/</span>
<a name="gbab-366"></a>  <span class="kt">char</span>          <span class="o">*</span><span class="n">description</span><span class="p">;</span>
<a name="gbab-367"></a>  <span class="cm">/**The width of the picture in pixels.*/</span>
<a name="gbab-368"></a>  <span class="n">opus_uint32</span>    <span class="n">width</span><span class="p">;</span>
<a name="gbab-369"></a>  <span class="cm">/**The height of the picture in pixels.*/</span>
<a name="gbab-370"></a>  <span class="n">opus_uint32</span>    <span class="n">height</span><span class="p">;</span>
<a name="gbab-371"></a>  <span class="cm">/**The color depth of the picture in bits-per-pixel (&lt;em&gt;not&lt;/em&gt;</span>
<a name="gbab-372"></a><span class="cm">      bits-per-channel).*/</span>
<a name="gbab-373"></a>  <span class="n">opus_uint32</span>    <span class="n">depth</span><span class="p">;</span>
<a name="gbab-374"></a>  <span class="cm">/**For indexed-color pictures (e.g., GIF), the number of colors used, or 0</span>
<a name="gbab-375"></a><span class="cm">      for non-indexed pictures.*/</span>
<a name="gbab-376"></a>  <span class="n">opus_uint32</span>    <span class="n">colors</span><span class="p">;</span>
<a name="gbab-377"></a>  <span class="cm">/**The length of the picture data in bytes.*/</span>
<a name="gbab-378"></a>  <span class="n">opus_uint32</span>    <span class="n">data_length</span><span class="p">;</span>
<a name="gbab-379"></a>  <span class="cm">/**The binary picture data.*/</span>
<a name="gbab-380"></a>  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">data</span><span class="p">;</span>
<a name="gbab-381"></a>  <span class="cm">/**The format of the picture data, if known.</span>
<a name="gbab-382"></a><span class="cm">     One of</span>
<a name="gbab-383"></a><span class="cm">     &lt;ul&gt;</span>
<a name="gbab-384"></a><span class="cm">     &lt;li&gt;#OP_PIC_FORMAT_UNKNOWN,&lt;/li&gt;</span>
<a name="gbab-385"></a><span class="cm">     &lt;li&gt;#OP_PIC_FORMAT_URL,&lt;/li&gt;</span>
<a name="gbab-386"></a><span class="cm">     &lt;li&gt;#OP_PIC_FORMAT_JPEG,&lt;/li&gt;</span>
<a name="gbab-387"></a><span class="cm">     &lt;li&gt;#OP_PIC_FORMAT_PNG, or&lt;/li&gt;</span>
<a name="gbab-388"></a><span class="cm">     &lt;li&gt;#OP_PIC_FORMAT_GIF.&lt;/li&gt;</span>
<a name="gbab-389"></a><span class="cm">     &lt;/ul&gt;*/</span>
<a name="gbab-390"></a>  <span class="kt">int</span>            <span class="n">format</span><span class="p">;</span>
<a name="gbab-391"></a><span class="p">};</span>
<a name="gbab-392"></a>
<a name="gbab-393"></a><span class="cm">/**\name Functions for manipulating header data</span>
<a name="gbab-394"></a>
<a name="gbab-395"></a><span class="cm">   These functions manipulate the #OpusHead and #OpusTags structures,</span>
<a name="gbab-396"></a><span class="cm">    which describe the audio parameters and tag-value metadata, respectively.</span>
<a name="gbab-397"></a><span class="cm">   These can be used to query the headers returned by &lt;tt&gt;libopusfile&lt;/tt&gt;, or</span>
<a name="gbab-398"></a><span class="cm">    to parse Opus headers from sources other than an Ogg Opus stream, provided</span>
<a name="gbab-399"></a><span class="cm">    they use the same format.*/</span>
<a name="gbab-400"></a><span class="cm">/*@{*/</span>
<a name="gbab-401"></a>
<a name="gbab-402"></a><span class="cm">/**Parses the contents of the ID header packet of an Ogg Opus stream.</span>
<a name="gbab-403"></a><span class="cm">   \param[out] _head Returns the contents of the parsed packet.</span>
<a name="gbab-404"></a><span class="cm">                     The contents of this structure are untouched on error.</span>
<a name="gbab-405"></a><span class="cm">                     This may be &lt;code&gt;NULL&lt;/code&gt; to merely test the header</span>
<a name="gbab-406"></a><span class="cm">                      for validity.</span>
<a name="gbab-407"></a><span class="cm">   \param[in]  _data The contents of the ID header packet.</span>
<a name="gbab-408"></a><span class="cm">   \param      _len  The number of bytes of data in the ID header packet.</span>
<a name="gbab-409"></a><span class="cm">   \return 0 on success or a negative value on error.</span>
<a name="gbab-410"></a><span class="cm">   \retval #OP_ENOTFORMAT If the data does not start with the &quot;OpusHead&quot;</span>
<a name="gbab-411"></a><span class="cm">                           string.</span>
<a name="gbab-412"></a><span class="cm">   \retval #OP_EVERSION   If the version field signaled a version this library</span>
<a name="gbab-413"></a><span class="cm">                           does not know how to parse.</span>
<a name="gbab-414"></a><span class="cm">   \retval #OP_EIMPL      If the channel mapping family was 255, which general</span>
<a name="gbab-415"></a><span class="cm">                           purpose players should not attempt to play.</span>
<a name="gbab-416"></a><span class="cm">   \retval #OP_EBADHEADER If the contents of the packet otherwise violate the</span>
<a name="gbab-417"></a><span class="cm">                           Ogg Opus specification:</span>
<a name="gbab-418"></a><span class="cm">                          &lt;ul&gt;</span>
<a name="gbab-419"></a><span class="cm">                           &lt;li&gt;Insufficient data,&lt;/li&gt;</span>
<a name="gbab-420"></a><span class="cm">                           &lt;li&gt;Too much data for the known minor versions,&lt;/li&gt;</span>
<a name="gbab-421"></a><span class="cm">                           &lt;li&gt;An unrecognized channel mapping family,&lt;/li&gt;</span>
<a name="gbab-422"></a><span class="cm">                           &lt;li&gt;Zero channels or too many channels,&lt;/li&gt;</span>
<a name="gbab-423"></a><span class="cm">                           &lt;li&gt;Zero coded streams,&lt;/li&gt;</span>
<a name="gbab-424"></a><span class="cm">                           &lt;li&gt;Too many coupled streams, or&lt;/li&gt;</span>
<a name="gbab-425"></a><span class="cm">                           &lt;li&gt;An invalid channel mapping index.&lt;/li&gt;</span>
<a name="gbab-426"></a><span class="cm">                          &lt;/ul&gt;*/</span>
<a name="gbab-427"></a><span class="n">OP_WARN_UNUSED_RESULT</span> <span class="kt">int</span> <span class="nf">opus_head_parse</span><span class="p">(</span><span class="n">OpusHead</span> <span class="o">*</span><span class="n">_head</span><span class="p">,</span>
<a name="gbab-428"></a> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_data</span><span class="p">,</span><span class="kt">size_t</span> <span class="n">_len</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<a name="gbab-429"></a>
<a name="gbab-430"></a><span class="cm">/**Converts a granule position to a sample offset for a given Ogg Opus stream.</span>
<a name="gbab-431"></a><span class="cm">   The sample offset is simply &lt;code&gt;_gp-_head-&gt;pre_skip&lt;/code&gt;.</span>
<a name="gbab-432"></a><span class="cm">   Granule position values smaller than OpusHead#pre_skip correspond to audio</span>
<a name="gbab-433"></a><span class="cm">    that should never be played, and thus have no associated sample offset.</span>
<a name="gbab-434"></a><span class="cm">   This function returns -1 for such values.</span>
<a name="gbab-435"></a><span class="cm">   This function also correctly handles extremely large granule positions,</span>
<a name="gbab-436"></a><span class="cm">    which may have wrapped around to a negative number when stored in a signed</span>
<a name="gbab-437"></a><span class="cm">    ogg_int64_t value.</span>
<a name="gbab-438"></a><span class="cm">   \param _head The #OpusHead information from the ID header of the stream.</span>
<a name="gbab-439"></a><span class="cm">   \param _gp   The granule position to convert.</span>
<a name="gbab-440"></a><span class="cm">   \return The sample offset associated with the given granule position</span>
<a name="gbab-441"></a><span class="cm">            (counting at a 48 kHz sampling rate), or the special value -1 on</span>
<a name="gbab-442"></a><span class="cm">            error (i.e., the granule position was smaller than the pre-skip</span>
<a name="gbab-443"></a><span class="cm">            amount).*/</span>
<a name="gbab-444"></a><span class="n">ogg_int64_t</span> <span class="nf">opus_granule_sample</span><span class="p">(</span><span class="k">const</span> <span class="n">OpusHead</span> <span class="o">*</span><span class="n">_head</span><span class="p">,</span><span class="n">ogg_int64_t</span> <span class="n">_gp</span><span class="p">)</span>
<a name="gbab-445"></a> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a name="gbab-446"></a>
<a name="gbab-447"></a><span class="cm">/**Parses the contents of the &#39;comment&#39; header packet of an Ogg Opus stream.</span>
<a name="gbab-448"></a><span class="cm">   \param[out] _tags An uninitialized #OpusTags structure.</span>
<a name="gbab-449"></a><span class="cm">                     This returns the contents of the parsed packet.</span>
<a name="gbab-450"></a><span class="cm">                     The contents of this structure are untouched on error.</span>
<a name="gbab-451"></a><span class="cm">                     This may be &lt;code&gt;NULL&lt;/code&gt; to merely test the header</span>
<a name="gbab-452"></a><span class="cm">                      for validity.</span>
<a name="gbab-453"></a><span class="cm">   \param[in]  _data The contents of the &#39;comment&#39; header packet.</span>
<a name="gbab-454"></a><span class="cm">   \param      _len  The number of bytes of data in the &#39;info&#39; header packet.</span>
<a name="gbab-455"></a><span class="cm">   \retval 0              Success.</span>
<a name="gbab-456"></a><span class="cm">   \retval #OP_ENOTFORMAT If the data does not start with the &quot;OpusTags&quot;</span>
<a name="gbab-457"></a><span class="cm">                           string.</span>
<a name="gbab-458"></a><span class="cm">   \retval #OP_EBADHEADER If the contents of the packet otherwise violate the</span>
<a name="gbab-459"></a><span class="cm">                           Ogg Opus specification.</span>
<a name="gbab-460"></a><span class="cm">   \retval #OP_EFAULT     If there wasn&#39;t enough memory to store the tags.*/</span>
<a name="gbab-461"></a><span class="n">OP_WARN_UNUSED_RESULT</span> <span class="kt">int</span> <span class="nf">opus_tags_parse</span><span class="p">(</span><span class="n">OpusTags</span> <span class="o">*</span><span class="n">_tags</span><span class="p">,</span>
<a name="gbab-462"></a> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_data</span><span class="p">,</span><span class="kt">size_t</span> <span class="n">_len</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<a name="gbab-463"></a>
<a name="gbab-464"></a><span class="cm">/**Performs a deep copy of an #OpusTags structure.</span>
<a name="gbab-465"></a><span class="cm">   \param _dst The #OpusTags structure to copy into.</span>
<a name="gbab-466"></a><span class="cm">               If this function fails, the contents of this structure remain</span>
<a name="gbab-467"></a><span class="cm">                untouched.</span>
<a name="gbab-468"></a><span class="cm">   \param _src The #OpusTags structure to copy from.</span>
<a name="gbab-469"></a><span class="cm">   \retval 0          Success.</span>
<a name="gbab-470"></a><span class="cm">   \retval #OP_EFAULT If there wasn&#39;t enough memory to copy the tags.*/</span>
<a name="gbab-471"></a><span class="kt">int</span> <span class="nf">opus_tags_copy</span><span class="p">(</span><span class="n">OpusTags</span> <span class="o">*</span><span class="n">_dst</span><span class="p">,</span><span class="k">const</span> <span class="n">OpusTags</span> <span class="o">*</span><span class="n">_src</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a name="gbab-472"></a>
<a name="gbab-473"></a><span class="cm">/**Initializes an #OpusTags structure.</span>
<a name="gbab-474"></a><span class="cm">   This should be called on a freshly allocated #OpusTags structure before</span>
<a name="gbab-475"></a><span class="cm">    attempting to use it.</span>
<a name="gbab-476"></a><span class="cm">   \param _tags The #OpusTags structure to initialize.*/</span>
<a name="gbab-477"></a><span class="kt">void</span> <span class="nf">opus_tags_init</span><span class="p">(</span><span class="n">OpusTags</span> <span class="o">*</span><span class="n">_tags</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a name="gbab-478"></a>
<a name="gbab-479"></a><span class="cm">/**Add a (tag, value) pair to an initialized #OpusTags structure.</span>
<a name="gbab-480"></a><span class="cm">   \note Neither opus_tags_add() nor opus_tags_add_comment() support values</span>
<a name="gbab-481"></a><span class="cm">    containing embedded NULs, although the bitstream format does support them.</span>
<a name="gbab-482"></a><span class="cm">   To add such tags, you will need to manipulate the #OpusTags structure</span>
<a name="gbab-483"></a><span class="cm">    directly.</span>
<a name="gbab-484"></a><span class="cm">   \param _tags  The #OpusTags structure to add the (tag, value) pair to.</span>
<a name="gbab-485"></a><span class="cm">   \param _tag   A NUL-terminated, case-insensitive, ASCII string containing</span>
<a name="gbab-486"></a><span class="cm">                  the tag to add (without an &#39;=&#39; character).</span>
<a name="gbab-487"></a><span class="cm">   \param _value A NUL-terminated UTF-8 containing the corresponding value.</span>
<a name="gbab-488"></a><span class="cm">   \return 0 on success, or a negative value on failure.</span>
<a name="gbab-489"></a><span class="cm">   \retval #OP_EFAULT An internal memory allocation failed.*/</span>
<a name="gbab-490"></a><span class="kt">int</span> <span class="nf">opus_tags_add</span><span class="p">(</span><span class="n">OpusTags</span> <span class="o">*</span><span class="n">_tags</span><span class="p">,</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_tag</span><span class="p">,</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_value</span><span class="p">)</span>
<a name="gbab-491"></a> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<a name="gbab-492"></a>
<a name="gbab-493"></a><span class="cm">/**Add a comment to an initialized #OpusTags structure.</span>
<a name="gbab-494"></a><span class="cm">   \note Neither opus_tags_add_comment() nor opus_tags_add() support comments</span>
<a name="gbab-495"></a><span class="cm">    containing embedded NULs, although the bitstream format does support them.</span>
<a name="gbab-496"></a><span class="cm">   To add such tags, you will need to manipulate the #OpusTags structure</span>
<a name="gbab-497"></a><span class="cm">    directly.</span>
<a name="gbab-498"></a><span class="cm">   \param _tags    The #OpusTags structure to add the comment to.</span>
<a name="gbab-499"></a><span class="cm">   \param _comment A NUL-terminated UTF-8 string containing the comment in</span>
<a name="gbab-500"></a><span class="cm">                    &quot;TAG=value&quot; form.</span>
<a name="gbab-501"></a><span class="cm">   \return 0 on success, or a negative value on failure.</span>
<a name="gbab-502"></a><span class="cm">   \retval #OP_EFAULT An internal memory allocation failed.*/</span>
<a name="gbab-503"></a><span class="kt">int</span> <span class="nf">opus_tags_add_comment</span><span class="p">(</span><span class="n">OpusTags</span> <span class="o">*</span><span class="n">_tags</span><span class="p">,</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_comment</span><span class="p">)</span>
<a name="gbab-504"></a> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<a name="gbab-505"></a>
<a name="gbab-506"></a><span class="cm">/**Replace the binary suffix data at the end of the packet (if any).</span>
<a name="gbab-507"></a><span class="cm">   \param _tags An initialized #OpusTags structure.</span>
<a name="gbab-508"></a><span class="cm">   \param _data A buffer of binary data to append after the encoded user</span>
<a name="gbab-509"></a><span class="cm">                 comments.</span>
<a name="gbab-510"></a><span class="cm">                The least significant bit of the first byte of this data must</span>
<a name="gbab-511"></a><span class="cm">                 be set (to ensure the data is preserved by other editors).</span>
<a name="gbab-512"></a><span class="cm">   \param _len  The number of bytes of binary data to append.</span>
<a name="gbab-513"></a><span class="cm">                This may be zero to remove any existing binary suffix data.</span>
<a name="gbab-514"></a><span class="cm">   \return 0 on success, or a negative value on error.</span>
<a name="gbab-515"></a><span class="cm">   \retval #OP_EINVAL \a _len was negative, or \a _len was positive but</span>
<a name="gbab-516"></a><span class="cm">                       \a _data was &lt;code&gt;NULL&lt;/code&gt; or the least significant</span>
<a name="gbab-517"></a><span class="cm">                       bit of the first byte was not set.</span>
<a name="gbab-518"></a><span class="cm">   \retval #OP_EFAULT An internal memory allocation failed.*/</span>
<a name="gbab-519"></a><span class="kt">int</span> <span class="nf">opus_tags_set_binary_suffix</span><span class="p">(</span><span class="n">OpusTags</span> <span class="o">*</span><span class="n">_tags</span><span class="p">,</span>
<a name="gbab-520"></a> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_data</span><span class="p">,</span><span class="kt">int</span> <span class="n">_len</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a name="gbab-521"></a>
<a name="gbab-522"></a><span class="cm">/**Look up a comment value by its tag.</span>
<a name="gbab-523"></a><span class="cm">   \param _tags  An initialized #OpusTags structure.</span>
<a name="gbab-524"></a><span class="cm">   \param _tag   The tag to look up.</span>
<a name="gbab-525"></a><span class="cm">   \param _count The instance of the tag.</span>
<a name="gbab-526"></a><span class="cm">                 The same tag can appear multiple times, each with a distinct</span>
<a name="gbab-527"></a><span class="cm">                  value, so an index is required to retrieve them all.</span>
<a name="gbab-528"></a><span class="cm">                 The order in which these values appear is significant and</span>
<a name="gbab-529"></a><span class="cm">                  should be preserved.</span>
<a name="gbab-530"></a><span class="cm">                 Use opus_tags_query_count() to get the legal range for the</span>
<a name="gbab-531"></a><span class="cm">                  \a _count parameter.</span>
<a name="gbab-532"></a><span class="cm">   \return A pointer to the queried tag&#39;s value.</span>
<a name="gbab-533"></a><span class="cm">           This points directly to data in the #OpusTags structure.</span>
<a name="gbab-534"></a><span class="cm">           It should not be modified or freed by the application, and</span>
<a name="gbab-535"></a><span class="cm">            modifications to the structure may invalidate the pointer.</span>
<a name="gbab-536"></a><span class="cm">   \retval NULL If no matching tag is found.*/</span>
<a name="gbab-537"></a><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="nf">opus_tags_query</span><span class="p">(</span><span class="k">const</span> <span class="n">OpusTags</span> <span class="o">*</span><span class="n">_tags</span><span class="p">,</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_tag</span><span class="p">,</span><span class="kt">int</span> <span class="n">_count</span><span class="p">)</span>
<a name="gbab-538"></a> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<a name="gbab-539"></a>
<a name="gbab-540"></a><span class="cm">/**Look up the number of instances of a tag.</span>
<a name="gbab-541"></a><span class="cm">   Call this first when querying for a specific tag and then iterate over the</span>
<a name="gbab-542"></a><span class="cm">    number of instances with separate calls to opus_tags_query() to retrieve</span>
<a name="gbab-543"></a><span class="cm">    all the values for that tag in order.</span>
<a name="gbab-544"></a><span class="cm">   \param _tags An initialized #OpusTags structure.</span>
<a name="gbab-545"></a><span class="cm">   \param _tag  The tag to look up.</span>
<a name="gbab-546"></a><span class="cm">   \return The number of instances of this particular tag.*/</span>
<a name="gbab-547"></a><span class="kt">int</span> <span class="nf">opus_tags_query_count</span><span class="p">(</span><span class="k">const</span> <span class="n">OpusTags</span> <span class="o">*</span><span class="n">_tags</span><span class="p">,</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_tag</span><span class="p">)</span>
<a name="gbab-548"></a> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<a name="gbab-549"></a>
<a name="gbab-550"></a><span class="cm">/**Retrieve the binary suffix data at the end of the packet (if any).</span>
<a name="gbab-551"></a><span class="cm">   \param      _tags An initialized #OpusTags structure.</span>
<a name="gbab-552"></a><span class="cm">   \param[out] _len  Returns the number of bytes of binary suffix data returned.</span>
<a name="gbab-553"></a><span class="cm">   \return A pointer to the binary suffix data, or &lt;code&gt;NULL&lt;/code&gt; if none</span>
<a name="gbab-554"></a><span class="cm">            was present.*/</span>
<a name="gbab-555"></a><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="nf">opus_tags_get_binary_suffix</span><span class="p">(</span><span class="k">const</span> <span class="n">OpusTags</span> <span class="o">*</span><span class="n">_tags</span><span class="p">,</span>
<a name="gbab-556"></a> <span class="kt">int</span> <span class="o">*</span><span class="n">_len</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<a name="gbab-557"></a>
<a name="gbab-558"></a><span class="cm">/**Get the album gain from an R128_ALBUM_GAIN tag, if one was specified.</span>
<a name="gbab-559"></a><span class="cm">   This searches for the first R128_ALBUM_GAIN tag with a valid signed,</span>
<a name="gbab-560"></a><span class="cm">    16-bit decimal integer value and returns the value.</span>
<a name="gbab-561"></a><span class="cm">   This routine is exposed merely for convenience for applications which wish</span>
<a name="gbab-562"></a><span class="cm">    to do something special with the album gain (i.e., display it).</span>
<a name="gbab-563"></a><span class="cm">   If you simply wish to apply the album gain instead of the header gain, you</span>
<a name="gbab-564"></a><span class="cm">    can use op_set_gain_offset() with an #OP_ALBUM_GAIN type and no offset.</span>
<a name="gbab-565"></a><span class="cm">   \param      _tags    An initialized #OpusTags structure.</span>
<a name="gbab-566"></a><span class="cm">   \param[out] _gain_q8 The album gain, in 1/256ths of a dB.</span>
<a name="gbab-567"></a><span class="cm">                        This will lie in the range [-32768,32767], and should</span>
<a name="gbab-568"></a><span class="cm">                         be applied in &lt;em&gt;addition&lt;/em&gt; to the header gain.</span>
<a name="gbab-569"></a><span class="cm">                        On error, no value is returned, and the previous</span>
<a name="gbab-570"></a><span class="cm">                         contents remain unchanged.</span>
<a name="gbab-571"></a><span class="cm">   \return 0 on success, or a negative value on error.</span>
<a name="gbab-572"></a><span class="cm">   \retval #OP_FALSE There was no album gain available in the given tags.*/</span>
<a name="gbab-573"></a><span class="kt">int</span> <span class="nf">opus_tags_get_album_gain</span><span class="p">(</span><span class="k">const</span> <span class="n">OpusTags</span> <span class="o">*</span><span class="n">_tags</span><span class="p">,</span><span class="kt">int</span> <span class="o">*</span><span class="n">_gain_q8</span><span class="p">)</span>
<a name="gbab-574"></a> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<a name="gbab-575"></a>
<a name="gbab-576"></a><span class="cm">/**Get the track gain from an R128_TRACK_GAIN tag, if one was specified.</span>
<a name="gbab-577"></a><span class="cm">   This searches for the first R128_TRACK_GAIN tag with a valid signed,</span>
<a name="gbab-578"></a><span class="cm">    16-bit decimal integer value and returns the value.</span>
<a name="gbab-579"></a><span class="cm">   This routine is exposed merely for convenience for applications which wish</span>
<a name="gbab-580"></a><span class="cm">    to do something special with the track gain (i.e., display it).</span>
<a name="gbab-581"></a><span class="cm">   If you simply wish to apply the track gain instead of the header gain, you</span>
<a name="gbab-582"></a><span class="cm">    can use op_set_gain_offset() with an #OP_TRACK_GAIN type and no offset.</span>
<a name="gbab-583"></a><span class="cm">   \param      _tags    An initialized #OpusTags structure.</span>
<a name="gbab-584"></a><span class="cm">   \param[out] _gain_q8 The track gain, in 1/256ths of a dB.</span>
<a name="gbab-585"></a><span class="cm">                        This will lie in the range [-32768,32767], and should</span>
<a name="gbab-586"></a><span class="cm">                         be applied in &lt;em&gt;addition&lt;/em&gt; to the header gain.</span>
<a name="gbab-587"></a><span class="cm">                        On error, no value is returned, and the previous</span>
<a name="gbab-588"></a><span class="cm">                         contents remain unchanged.</span>
<a name="gbab-589"></a><span class="cm">   \return 0 on success, or a negative value on error.</span>
<a name="gbab-590"></a><span class="cm">   \retval #OP_FALSE There was no track gain available in the given tags.*/</span>
<a name="gbab-591"></a><span class="kt">int</span> <span class="nf">opus_tags_get_track_gain</span><span class="p">(</span><span class="k">const</span> <span class="n">OpusTags</span> <span class="o">*</span><span class="n">_tags</span><span class="p">,</span><span class="kt">int</span> <span class="o">*</span><span class="n">_gain_q8</span><span class="p">)</span>
<a name="gbab-592"></a> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<a name="gbab-593"></a>
<a name="gbab-594"></a><span class="cm">/**Clears the #OpusTags structure.</span>
<a name="gbab-595"></a><span class="cm">   This should be called on an #OpusTags structure after it is no longer</span>
<a name="gbab-596"></a><span class="cm">    needed.</span>
<a name="gbab-597"></a><span class="cm">   It will free all memory used by the structure members.</span>
<a name="gbab-598"></a><span class="cm">   \param _tags The #OpusTags structure to clear.*/</span>
<a name="gbab-599"></a><span class="kt">void</span> <span class="nf">opus_tags_clear</span><span class="p">(</span><span class="n">OpusTags</span> <span class="o">*</span><span class="n">_tags</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a name="gbab-600"></a>
<a name="gbab-601"></a><span class="cm">/**Check if \a _comment is an instance of a \a _tag_name tag.</span>
<a name="gbab-602"></a><span class="cm">   \see opus_tagncompare</span>
<a name="gbab-603"></a><span class="cm">   \param _tag_name A NUL-terminated, case-insensitive, ASCII string containing</span>
<a name="gbab-604"></a><span class="cm">                     the name of the tag to check for (without the terminating</span>
<a name="gbab-605"></a><span class="cm">                     &#39;=&#39; character).</span>
<a name="gbab-606"></a><span class="cm">   \param _comment  The comment string to check.</span>
<a name="gbab-607"></a><span class="cm">   \return An integer less than, equal to, or greater than zero if \a _comment</span>
<a name="gbab-608"></a><span class="cm">            is found respectively, to be less than, to match, or be greater</span>
<a name="gbab-609"></a><span class="cm">            than a &quot;tag=value&quot; string whose tag matches \a _tag_name.*/</span>
<a name="gbab-610"></a><span class="kt">int</span> <span class="nf">opus_tagcompare</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_tag_name</span><span class="p">,</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_comment</span><span class="p">);</span>
<a name="gbab-611"></a>
<a name="gbab-612"></a><span class="cm">/**Check if \a _comment is an instance of a \a _tag_name tag.</span>
<a name="gbab-613"></a><span class="cm">   This version is slightly more efficient than opus_tagcompare() if the length</span>
<a name="gbab-614"></a><span class="cm">    of the tag name is already known (e.g., because it is a constant).</span>
<a name="gbab-615"></a><span class="cm">   \see opus_tagcompare</span>
<a name="gbab-616"></a><span class="cm">   \param _tag_name A case-insensitive ASCII string containing the name of the</span>
<a name="gbab-617"></a><span class="cm">                     tag to check for (without the terminating &#39;=&#39; character).</span>
<a name="gbab-618"></a><span class="cm">   \param _tag_len  The number of characters in the tag name.</span>
<a name="gbab-619"></a><span class="cm">                    This must be non-negative.</span>
<a name="gbab-620"></a><span class="cm">   \param _comment  The comment string to check.</span>
<a name="gbab-621"></a><span class="cm">   \return An integer less than, equal to, or greater than zero if \a _comment</span>
<a name="gbab-622"></a><span class="cm">            is found respectively, to be less than, to match, or be greater</span>
<a name="gbab-623"></a><span class="cm">            than a &quot;tag=value&quot; string whose tag matches the first \a _tag_len</span>
<a name="gbab-624"></a><span class="cm">            characters of \a _tag_name.*/</span>
<a name="gbab-625"></a><span class="kt">int</span> <span class="nf">opus_tagncompare</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_tag_name</span><span class="p">,</span><span class="kt">int</span> <span class="n">_tag_len</span><span class="p">,</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_comment</span><span class="p">);</span>
<a name="gbab-626"></a>
<a name="gbab-627"></a><span class="cm">/**Parse a single METADATA_BLOCK_PICTURE tag.</span>
<a name="gbab-628"></a><span class="cm">   This decodes the BASE64-encoded content of the tag and returns a structure</span>
<a name="gbab-629"></a><span class="cm">    with the MIME type, description, image parameters (if known), and the</span>
<a name="gbab-630"></a><span class="cm">    compressed image data.</span>
<a name="gbab-631"></a><span class="cm">   If the MIME type indicates the presence of an image format we recognize</span>
<a name="gbab-632"></a><span class="cm">    (JPEG, PNG, or GIF) and the actual image data contains the magic signature</span>
<a name="gbab-633"></a><span class="cm">    associated with that format, then the OpusPictureTag::format field will be</span>
<a name="gbab-634"></a><span class="cm">    set to the corresponding format.</span>
<a name="gbab-635"></a><span class="cm">   This is provided as a convenience to avoid requiring applications to parse</span>
<a name="gbab-636"></a><span class="cm">    the MIME type and/or do their own format detection for the commonly used</span>
<a name="gbab-637"></a><span class="cm">    formats.</span>
<a name="gbab-638"></a><span class="cm">   In this case, we also attempt to extract the image parameters directly from</span>
<a name="gbab-639"></a><span class="cm">    the image data (overriding any that were present in the tag, which the</span>
<a name="gbab-640"></a><span class="cm">    specification says applications are not meant to rely on).</span>
<a name="gbab-641"></a><span class="cm">   The application must still provide its own support for actually decoding the</span>
<a name="gbab-642"></a><span class="cm">    image data and, if applicable, retrieving that data from URLs.</span>
<a name="gbab-643"></a><span class="cm">   \param[out] _pic Returns the parsed picture data.</span>
<a name="gbab-644"></a><span class="cm">                    No sanitation is done on the type, MIME type, or</span>
<a name="gbab-645"></a><span class="cm">                     description fields, so these might return invalid values.</span>
<a name="gbab-646"></a><span class="cm">                    The contents of this structure are left unmodified on</span>
<a name="gbab-647"></a><span class="cm">                     failure.</span>
<a name="gbab-648"></a><span class="cm">   \param      _tag The METADATA_BLOCK_PICTURE tag contents.</span>
<a name="gbab-649"></a><span class="cm">                    The leading &quot;METADATA_BLOCK_PICTURE=&quot; portion is optional,</span>
<a name="gbab-650"></a><span class="cm">                     to allow the function to be used on either directly on the</span>
<a name="gbab-651"></a><span class="cm">                     values in OpusTags::user_comments or on the return value</span>
<a name="gbab-652"></a><span class="cm">                     of opus_tags_query().</span>
<a name="gbab-653"></a><span class="cm">   \return 0 on success or a negative value on error.</span>
<a name="gbab-654"></a><span class="cm">   \retval #OP_ENOTFORMAT The METADATA_BLOCK_PICTURE contents were not valid.</span>
<a name="gbab-655"></a><span class="cm">   \retval #OP_EFAULT     There was not enough memory to store the picture tag</span>
<a name="gbab-656"></a><span class="cm">                           contents.*/</span>
<a name="gbab-657"></a><span class="n">OP_WARN_UNUSED_RESULT</span> <span class="kt">int</span> <span class="nf">opus_picture_tag_parse</span><span class="p">(</span><span class="n">OpusPictureTag</span> <span class="o">*</span><span class="n">_pic</span><span class="p">,</span>
<a name="gbab-658"></a> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_tag</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<a name="gbab-659"></a>
<a name="gbab-660"></a><span class="cm">/**Initializes an #OpusPictureTag structure.</span>
<a name="gbab-661"></a><span class="cm">   This should be called on a freshly allocated #OpusPictureTag structure</span>
<a name="gbab-662"></a><span class="cm">    before attempting to use it.</span>
<a name="gbab-663"></a><span class="cm">   \param _pic The #OpusPictureTag structure to initialize.*/</span>
<a name="gbab-664"></a><span class="kt">void</span> <span class="nf">opus_picture_tag_init</span><span class="p">(</span><span class="n">OpusPictureTag</span> <span class="o">*</span><span class="n">_pic</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a name="gbab-665"></a>
<a name="gbab-666"></a><span class="cm">/**Clears the #OpusPictureTag structure.</span>
<a name="gbab-667"></a><span class="cm">   This should be called on an #OpusPictureTag structure after it is no longer</span>
<a name="gbab-668"></a><span class="cm">    needed.</span>
<a name="gbab-669"></a><span class="cm">   It will free all memory used by the structure members.</span>
<a name="gbab-670"></a><span class="cm">   \param _pic The #OpusPictureTag structure to clear.*/</span>
<a name="gbab-671"></a><span class="kt">void</span> <span class="nf">opus_picture_tag_clear</span><span class="p">(</span><span class="n">OpusPictureTag</span> <span class="o">*</span><span class="n">_pic</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a name="gbab-672"></a>
<a name="gbab-673"></a><span class="cm">/*@}*/</span>
<a name="gbab-674"></a>
<a name="gbab-675"></a><span class="cm">/*@}*/</span>
<a name="gbab-676"></a>
<a name="gbab-677"></a><span class="cm">/**\defgroup url_options URL Reading Options*/</span>
<a name="gbab-678"></a><span class="cm">/*@{*/</span>
<a name="gbab-679"></a><span class="cm">/**\name URL reading options</span>
<a name="gbab-680"></a><span class="cm">   Options for op_url_stream_create() and associated functions.</span>
<a name="gbab-681"></a><span class="cm">   These allow you to provide proxy configuration parameters, skip SSL</span>
<a name="gbab-682"></a><span class="cm">    certificate checks, etc.</span>
<a name="gbab-683"></a><span class="cm">   Options are processed in order, and if the same option is passed multiple</span>
<a name="gbab-684"></a><span class="cm">    times, only the value specified by the last occurrence has an effect</span>
<a name="gbab-685"></a><span class="cm">    (unless otherwise specified).</span>
<a name="gbab-686"></a><span class="cm">   They may be expanded in the future.*/</span>
<a name="gbab-687"></a><span class="cm">/*@{*/</span>
<a name="gbab-688"></a>
<a name="gbab-689"></a><span class="cm">/**@cond PRIVATE*/</span>
<a name="gbab-690"></a>
<a name="gbab-691"></a><span class="cm">/*These are the raw numbers used to define the request codes.</span>
<a name="gbab-692"></a><span class="cm">  They should not be used directly.*/</span>
<a name="gbab-693"></a><span class="cp">#define OP_SSL_SKIP_CERTIFICATE_CHECK_REQUEST (6464)</span>
<a name="gbab-694"></a><span class="cp">#define OP_HTTP_PROXY_HOST_REQUEST            (6528)</span>
<a name="gbab-695"></a><span class="cp">#define OP_HTTP_PROXY_PORT_REQUEST            (6592)</span>
<a name="gbab-696"></a><span class="cp">#define OP_HTTP_PROXY_USER_REQUEST            (6656)</span>
<a name="gbab-697"></a><span class="cp">#define OP_HTTP_PROXY_PASS_REQUEST            (6720)</span>
<a name="gbab-698"></a><span class="cp">#define OP_GET_SERVER_INFO_REQUEST            (6784)</span>
<a name="gbab-699"></a>
<a name="gbab-700"></a><span class="cp">#define OP_URL_OPT(_request) ((_request)+(char *)0)</span>
<a name="gbab-701"></a>
<a name="gbab-702"></a><span class="cm">/*These macros trigger compilation errors or warnings if the wrong types are</span>
<a name="gbab-703"></a><span class="cm">   provided to one of the URL options.*/</span>
<a name="gbab-704"></a><span class="cp">#define OP_CHECK_INT(_x) ((void)((_x)==(opus_int32)0),(opus_int32)(_x))</span>
<a name="gbab-705"></a><span class="cp">#define OP_CHECK_CONST_CHAR_PTR(_x) ((_x)+((_x)-(const char *)(_x)))</span>
<a name="gbab-706"></a><span class="cp">#define OP_CHECK_SERVER_INFO_PTR(_x) ((_x)+((_x)-(OpusServerInfo *)(_x)))</span>
<a name="gbab-707"></a>
<a name="gbab-708"></a><span class="cm">/**@endcond*/</span>
<a name="gbab-709"></a>
<a name="gbab-710"></a><span class="cm">/**HTTP/Shoutcast/Icecast server information associated with a URL.*/</span>
<a name="gbab-711"></a><span class="k">struct</span> <span class="n">OpusServerInfo</span><span class="p">{</span>
<a name="gbab-712"></a>  <span class="cm">/**The name of the server (icy-name/ice-name).</span>
<a name="gbab-713"></a><span class="cm">     This is &lt;code&gt;NULL&lt;/code&gt; if there was no &lt;code&gt;icy-name&lt;/code&gt; or</span>
<a name="gbab-714"></a><span class="cm">      &lt;code&gt;ice-name&lt;/code&gt; header.*/</span>
<a name="gbab-715"></a>  <span class="kt">char</span>        <span class="o">*</span><span class="n">name</span><span class="p">;</span>
<a name="gbab-716"></a>  <span class="cm">/**A short description of the server (icy-description/ice-description).</span>
<a name="gbab-717"></a><span class="cm">     This is &lt;code&gt;NULL&lt;/code&gt; if there was no &lt;code&gt;icy-description&lt;/code&gt; or</span>
<a name="gbab-718"></a><span class="cm">      &lt;code&gt;ice-description&lt;/code&gt; header.*/</span>
<a name="gbab-719"></a>  <span class="kt">char</span>        <span class="o">*</span><span class="n">description</span><span class="p">;</span>
<a name="gbab-720"></a>  <span class="cm">/**The genre the server falls under (icy-genre/ice-genre).</span>
<a name="gbab-721"></a><span class="cm">     This is &lt;code&gt;NULL&lt;/code&gt; if there was no &lt;code&gt;icy-genre&lt;/code&gt; or</span>
<a name="gbab-722"></a><span class="cm">      &lt;code&gt;ice-genre&lt;/code&gt; header.*/</span>
<a name="gbab-723"></a>  <span class="kt">char</span>        <span class="o">*</span><span class="n">genre</span><span class="p">;</span>
<a name="gbab-724"></a>  <span class="cm">/**The homepage for the server (icy-url/ice-url).</span>
<a name="gbab-725"></a><span class="cm">     This is &lt;code&gt;NULL&lt;/code&gt; if there was no &lt;code&gt;icy-url&lt;/code&gt; or</span>
<a name="gbab-726"></a><span class="cm">      &lt;code&gt;ice-url&lt;/code&gt; header.*/</span>
<a name="gbab-727"></a>  <span class="kt">char</span>        <span class="o">*</span><span class="n">url</span><span class="p">;</span>
<a name="gbab-728"></a>  <span class="cm">/**The software used by the origin server (Server).</span>
<a name="gbab-729"></a><span class="cm">     This is &lt;code&gt;NULL&lt;/code&gt; if there was no &lt;code&gt;Server&lt;/code&gt; header.*/</span>
<a name="gbab-730"></a>  <span class="kt">char</span>        <span class="o">*</span><span class="n">server</span><span class="p">;</span>
<a name="gbab-731"></a>  <span class="cm">/**The media type of the entity sent to the recepient (Content-Type).</span>
<a name="gbab-732"></a><span class="cm">     This is &lt;code&gt;NULL&lt;/code&gt; if there was no &lt;code&gt;Content-Type&lt;/code&gt;</span>
<a name="gbab-733"></a><span class="cm">      header.*/</span>
<a name="gbab-734"></a>  <span class="kt">char</span>        <span class="o">*</span><span class="n">content_type</span><span class="p">;</span>
<a name="gbab-735"></a>  <span class="cm">/**The nominal stream bitrate in kbps (icy-br/ice-bitrate).</span>
<a name="gbab-736"></a><span class="cm">     This is &lt;code&gt;-1&lt;/code&gt; if there was no &lt;code&gt;icy-br&lt;/code&gt; or</span>
<a name="gbab-737"></a><span class="cm">      &lt;code&gt;ice-bitrate&lt;/code&gt; header.*/</span>
<a name="gbab-738"></a>  <span class="n">opus_int32</span>   <span class="n">bitrate_kbps</span><span class="p">;</span>
<a name="gbab-739"></a>  <span class="cm">/**Flag indicating whether the server is public (&lt;code&gt;1&lt;/code&gt;) or not</span>
<a name="gbab-740"></a><span class="cm">      (&lt;code&gt;0&lt;/code&gt;) (icy-pub/ice-public).</span>
<a name="gbab-741"></a><span class="cm">     This is &lt;code&gt;-1&lt;/code&gt; if there was no &lt;code&gt;icy-pub&lt;/code&gt; or</span>
<a name="gbab-742"></a><span class="cm">      &lt;code&gt;ice-public&lt;/code&gt; header.*/</span>
<a name="gbab-743"></a>  <span class="kt">int</span>          <span class="n">is_public</span><span class="p">;</span>
<a name="gbab-744"></a>  <span class="cm">/**Flag indicating whether the server is using HTTPS instead of HTTP.</span>
<a name="gbab-745"></a><span class="cm">     This is &lt;code&gt;0&lt;/code&gt; unless HTTPS is being used.</span>
<a name="gbab-746"></a><span class="cm">     This may not match the protocol used in the original URL if there were</span>
<a name="gbab-747"></a><span class="cm">      redirections.*/</span>
<a name="gbab-748"></a>  <span class="kt">int</span>          <span class="n">is_ssl</span><span class="p">;</span>
<a name="gbab-749"></a><span class="p">};</span>
<a name="gbab-750"></a>
<a name="gbab-751"></a><span class="cm">/**Initializes an #OpusServerInfo structure.</span>
<a name="gbab-752"></a><span class="cm">   All fields are set as if the corresponding header was not available.</span>
<a name="gbab-753"></a><span class="cm">   \param _info The #OpusServerInfo structure to initialize.</span>
<a name="gbab-754"></a><span class="cm">   \note If you use this function, you must link against &lt;tt&gt;libopusurl&lt;/tt&gt;.*/</span>
<a name="gbab-755"></a><span class="kt">void</span> <span class="nf">opus_server_info_init</span><span class="p">(</span><span class="n">OpusServerInfo</span> <span class="o">*</span><span class="n">_info</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a name="gbab-756"></a>
<a name="gbab-757"></a><span class="cm">/**Clears the #OpusServerInfo structure.</span>
<a name="gbab-758"></a><span class="cm">   This should be called on an #OpusServerInfo structure after it is no longer</span>
<a name="gbab-759"></a><span class="cm">    needed.</span>
<a name="gbab-760"></a><span class="cm">   It will free all memory used by the structure members.</span>
<a name="gbab-761"></a><span class="cm">   \param _info The #OpusServerInfo structure to clear.</span>
<a name="gbab-762"></a><span class="cm">   \note If you use this function, you must link against &lt;tt&gt;libopusurl&lt;/tt&gt;.*/</span>
<a name="gbab-763"></a><span class="kt">void</span> <span class="nf">opus_server_info_clear</span><span class="p">(</span><span class="n">OpusServerInfo</span> <span class="o">*</span><span class="n">_info</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a name="gbab-764"></a>
<a name="gbab-765"></a><span class="cm">/**Skip the certificate check when connecting via TLS/SSL (https).</span>
<a name="gbab-766"></a><span class="cm">   \param _b &lt;code&gt;opus_int32&lt;/code&gt;: Whether or not to skip the certificate</span>
<a name="gbab-767"></a><span class="cm">              check.</span>
<a name="gbab-768"></a><span class="cm">             The check will be skipped if \a _b is non-zero, and will not be</span>
<a name="gbab-769"></a><span class="cm">              skipped if \a _b is zero.</span>
<a name="gbab-770"></a><span class="cm">   \hideinitializer*/</span>
<a name="gbab-771"></a><span class="cp">#define OP_SSL_SKIP_CERTIFICATE_CHECK(_b) \</span>
<a name="gbab-772"></a><span class="cp"> OP_URL_OPT(OP_SSL_SKIP_CERTIFICATE_CHECK_REQUEST),OP_CHECK_INT(_b)</span>
<a name="gbab-773"></a>
<a name="gbab-774"></a><span class="cm">/**Proxy connections through the given host.</span>
<a name="gbab-775"></a><span class="cm">   If no port is specified via #OP_HTTP_PROXY_PORT, the port number defaults</span>
<a name="gbab-776"></a><span class="cm">    to 8080 (http-alt).</span>
<a name="gbab-777"></a><span class="cm">   All proxy parameters are ignored for non-http and non-https URLs.</span>
<a name="gbab-778"></a><span class="cm">   \param _host &lt;code&gt;const char *&lt;/code&gt;: The proxy server hostname.</span>
<a name="gbab-779"></a><span class="cm">                This may be &lt;code&gt;NULL&lt;/code&gt; to disable the use of a proxy</span>
<a name="gbab-780"></a><span class="cm">                 server.</span>
<a name="gbab-781"></a><span class="cm">   \hideinitializer*/</span>
<a name="gbab-782"></a><span class="cp">#define OP_HTTP_PROXY_HOST(_host) \</span>
<a name="gbab-783"></a><span class="cp"> OP_URL_OPT(OP_HTTP_PROXY_HOST_REQUEST),OP_CHECK_CONST_CHAR_PTR(_host)</span>
<a name="gbab-784"></a>
<a name="gbab-785"></a><span class="cm">/**Use the given port when proxying connections.</span>
<a name="gbab-786"></a><span class="cm">   This option only has an effect if #OP_HTTP_PROXY_HOST is specified with a</span>
<a name="gbab-787"></a><span class="cm">    non-&lt;code&gt;NULL&lt;/code&gt; \a _host.</span>
<a name="gbab-788"></a><span class="cm">   If this option is not provided, the proxy port number defaults to 8080</span>
<a name="gbab-789"></a><span class="cm">    (http-alt).</span>
<a name="gbab-790"></a><span class="cm">   All proxy parameters are ignored for non-http and non-https URLs.</span>
<a name="gbab-791"></a><span class="cm">   \param _port &lt;code&gt;opus_int32&lt;/code&gt;: The proxy server port.</span>
<a name="gbab-792"></a><span class="cm">                This must be in the range 0...65535 (inclusive), or the</span>
<a name="gbab-793"></a><span class="cm">                 URL function this is passed to will fail.</span>
<a name="gbab-794"></a><span class="cm">   \hideinitializer*/</span>
<a name="gbab-795"></a><span class="cp">#define OP_HTTP_PROXY_PORT(_port) \</span>
<a name="gbab-796"></a><span class="cp"> OP_URL_OPT(OP_HTTP_PROXY_PORT_REQUEST),OP_CHECK_INT(_port)</span>
<a name="gbab-797"></a>
<a name="gbab-798"></a><span class="cm">/**Use the given user name for authentication when proxying connections.</span>
<a name="gbab-799"></a><span class="cm">   All proxy parameters are ignored for non-http and non-https URLs.</span>
<a name="gbab-800"></a><span class="cm">   \param _user const char *: The proxy server user name.</span>
<a name="gbab-801"></a><span class="cm">                              This may be &lt;code&gt;NULL&lt;/code&gt; to disable proxy</span>
<a name="gbab-802"></a><span class="cm">                               authentication.</span>
<a name="gbab-803"></a><span class="cm">                              A non-&lt;code&gt;NULL&lt;/code&gt; value only has an effect</span>
<a name="gbab-804"></a><span class="cm">                               if #OP_HTTP_PROXY_HOST and #OP_HTTP_PROXY_PASS</span>
<a name="gbab-805"></a><span class="cm">                               are also specified with non-&lt;code&gt;NULL&lt;/code&gt;</span>
<a name="gbab-806"></a><span class="cm">                               arguments.</span>
<a name="gbab-807"></a><span class="cm">   \hideinitializer*/</span>
<a name="gbab-808"></a><span class="cp">#define OP_HTTP_PROXY_USER(_user) \</span>
<a name="gbab-809"></a><span class="cp"> OP_URL_OPT(OP_HTTP_PROXY_USER_REQUEST),OP_CHECK_CONST_CHAR_PTR(_user)</span>
<a name="gbab-810"></a>
<a name="gbab-811"></a><span class="cm">/**Use the given password for authentication when proxying connections.</span>
<a name="gbab-812"></a><span class="cm">   All proxy parameters are ignored for non-http and non-https URLs.</span>
<a name="gbab-813"></a><span class="cm">   \param _pass const char *: The proxy server password.</span>
<a name="gbab-814"></a><span class="cm">                              This may be &lt;code&gt;NULL&lt;/code&gt; to disable proxy</span>
<a name="gbab-815"></a><span class="cm">                               authentication.</span>
<a name="gbab-816"></a><span class="cm">                              A non-&lt;code&gt;NULL&lt;/code&gt; value only has an effect</span>
<a name="gbab-817"></a><span class="cm">                               if #OP_HTTP_PROXY_HOST and #OP_HTTP_PROXY_USER</span>
<a name="gbab-818"></a><span class="cm">                               are also specified with non-&lt;code&gt;NULL&lt;/code&gt;</span>
<a name="gbab-819"></a><span class="cm">                               arguments.</span>
<a name="gbab-820"></a><span class="cm">   \hideinitializer*/</span>
<a name="gbab-821"></a><span class="cp">#define OP_HTTP_PROXY_PASS(_pass) \</span>
<a name="gbab-822"></a><span class="cp"> OP_URL_OPT(OP_HTTP_PROXY_PASS_REQUEST),OP_CHECK_CONST_CHAR_PTR(_pass)</span>
<a name="gbab-823"></a>
<a name="gbab-824"></a><span class="cm">/**Parse information about the streaming server (if any) and return it.</span>
<a name="gbab-825"></a><span class="cm">   Very little validation is done.</span>
<a name="gbab-826"></a><span class="cm">   In particular, OpusServerInfo::url may not be a valid URL,</span>
<a name="gbab-827"></a><span class="cm">    OpusServerInfo::bitrate_kbps may not really be in kbps, and</span>
<a name="gbab-828"></a><span class="cm">    OpusServerInfo::content_type may not be a valid MIME type.</span>
<a name="gbab-829"></a><span class="cm">   The character set of the string fields is not specified anywhere, and should</span>
<a name="gbab-830"></a><span class="cm">    not be assumed to be valid UTF-8.</span>
<a name="gbab-831"></a><span class="cm">   \param _info OpusServerInfo *: Returns information about the server.</span>
<a name="gbab-832"></a><span class="cm">                                  If there is any error opening the stream, the</span>
<a name="gbab-833"></a><span class="cm">                                   contents of this structure remain</span>
<a name="gbab-834"></a><span class="cm">                                   unmodified.</span>
<a name="gbab-835"></a><span class="cm">                                  On success, fills in the structure with the</span>
<a name="gbab-836"></a><span class="cm">                                   server information that was available, if</span>
<a name="gbab-837"></a><span class="cm">                                   any.</span>
<a name="gbab-838"></a><span class="cm">                                  After a successful return, the contents of</span>
<a name="gbab-839"></a><span class="cm">                                   this structure should be freed by calling</span>
<a name="gbab-840"></a><span class="cm">                                   opus_server_info_clear().</span>
<a name="gbab-841"></a><span class="cm">   \hideinitializer*/</span>
<a name="gbab-842"></a><span class="cp">#define OP_GET_SERVER_INFO(_info) \</span>
<a name="gbab-843"></a><span class="cp"> OP_URL_OPT(OP_GET_SERVER_INFO_REQUEST),OP_CHECK_SERVER_INFO_PTR(_info)</span>
<a name="gbab-844"></a>
<a name="gbab-845"></a><span class="cm">/*@}*/</span>
<a name="gbab-846"></a><span class="cm">/*@}*/</span>
<a name="gbab-847"></a>
<a name="gbab-848"></a><span class="cm">/**\defgroup stream_callbacks Abstract Stream Reading Interface*/</span>
<a name="gbab-849"></a><span class="cm">/*@{*/</span>
<a name="gbab-850"></a><span class="cm">/**\name Functions for reading from streams</span>
<a name="gbab-851"></a><span class="cm">   These functions define the interface used to read from and seek in a stream</span>
<a name="gbab-852"></a><span class="cm">    of data.</span>
<a name="gbab-853"></a><span class="cm">   A stream does not need to implement seeking, but the decoder will not be</span>
<a name="gbab-854"></a><span class="cm">    able to seek if it does not do so.</span>
<a name="gbab-855"></a><span class="cm">   These functions also include some convenience routines for working with</span>
<a name="gbab-856"></a><span class="cm">    standard &lt;code&gt;FILE&lt;/code&gt; pointers, complete streams stored in a single</span>
<a name="gbab-857"></a><span class="cm">    block of memory, or URLs.*/</span>
<a name="gbab-858"></a><span class="cm">/*@{*/</span>
<a name="gbab-859"></a>
<a name="gbab-860"></a><span class="cm">/**Reads up to \a _nbytes bytes of data from \a _stream.</span>
<a name="gbab-861"></a><span class="cm">   \param      _stream The stream to read from.</span>
<a name="gbab-862"></a><span class="cm">   \param[out] _ptr    The buffer to store the data in.</span>
<a name="gbab-863"></a><span class="cm">   \param      _nbytes The maximum number of bytes to read.</span>
<a name="gbab-864"></a><span class="cm">                       This function may return fewer, though it will not</span>
<a name="gbab-865"></a><span class="cm">                        return zero unless it reaches end-of-file.</span>
<a name="gbab-866"></a><span class="cm">   \return The number of bytes successfully read, or a negative value on</span>
<a name="gbab-867"></a><span class="cm">            error.*/</span>
<a name="gbab-868"></a><span class="k">typedef</span> <span class="nf">int</span> <span class="p">(</span><span class="o">*</span><span class="n">op_read_func</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="n">_stream</span><span class="p">,</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_ptr</span><span class="p">,</span><span class="kt">int</span> <span class="n">_nbytes</span><span class="p">);</span>
<a name="gbab-869"></a>
<a name="gbab-870"></a><span class="cm">/**Sets the position indicator for \a _stream.</span>
<a name="gbab-871"></a><span class="cm">   The new position, measured in bytes, is obtained by adding \a _offset</span>
<a name="gbab-872"></a><span class="cm">    bytes to the position specified by \a _whence.</span>
<a name="gbab-873"></a><span class="cm">   If \a _whence is set to &lt;code&gt;SEEK_SET&lt;/code&gt;, &lt;code&gt;SEEK_CUR&lt;/code&gt;, or</span>
<a name="gbab-874"></a><span class="cm">    &lt;code&gt;SEEK_END&lt;/code&gt;, the offset is relative to the start of the stream,</span>
<a name="gbab-875"></a><span class="cm">    the current position indicator, or end-of-file, respectively.</span>
<a name="gbab-876"></a><span class="cm">   \retval 0  Success.</span>
<a name="gbab-877"></a><span class="cm">   \retval -1 Seeking is not supported or an error occurred.</span>
<a name="gbab-878"></a><span class="cm">              &lt;code&gt;errno&lt;/code&gt; need not be set.*/</span>
<a name="gbab-879"></a><span class="k">typedef</span> <span class="nf">int</span> <span class="p">(</span><span class="o">*</span><span class="n">op_seek_func</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="n">_stream</span><span class="p">,</span><span class="n">opus_int64</span> <span class="n">_offset</span><span class="p">,</span><span class="kt">int</span> <span class="n">_whence</span><span class="p">);</span>
<a name="gbab-880"></a>
<a name="gbab-881"></a><span class="cm">/**Obtains the current value of the position indicator for \a _stream.</span>
<a name="gbab-882"></a><span class="cm">   \return The current position indicator.*/</span>
<a name="gbab-883"></a><span class="k">typedef</span> <span class="nf">opus_int64</span> <span class="p">(</span><span class="o">*</span><span class="n">op_tell_func</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="n">_stream</span><span class="p">);</span>
<a name="gbab-884"></a>
<a name="gbab-885"></a><span class="cm">/**Closes the underlying stream.</span>
<a name="gbab-886"></a><span class="cm">   \retval 0   Success.</span>
<a name="gbab-887"></a><span class="cm">   \retval EOF An error occurred.</span>
<a name="gbab-888"></a><span class="cm">               &lt;code&gt;errno&lt;/code&gt; need not be set.*/</span>
<a name="gbab-889"></a><span class="k">typedef</span> <span class="nf">int</span> <span class="p">(</span><span class="o">*</span><span class="n">op_close_func</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="n">_stream</span><span class="p">);</span>
<a name="gbab-890"></a>
<a name="gbab-891"></a><span class="cm">/**The callbacks used to access non-&lt;code&gt;FILE&lt;/code&gt; stream resources.</span>
<a name="gbab-892"></a><span class="cm">   The function prototypes are basically the same as for the stdio functions</span>
<a name="gbab-893"></a><span class="cm">    &lt;code&gt;fread()&lt;/code&gt;, &lt;code&gt;fseek()&lt;/code&gt;, &lt;code&gt;ftell()&lt;/code&gt;, and</span>
<a name="gbab-894"></a><span class="cm">    &lt;code&gt;fclose()&lt;/code&gt;.</span>
<a name="gbab-895"></a><span class="cm">   The differences are that the &lt;code&gt;FILE *&lt;/code&gt; arguments have been</span>
<a name="gbab-896"></a><span class="cm">    replaced with a &lt;code&gt;void *&lt;/code&gt;, which is to be used as a pointer to</span>
<a name="gbab-897"></a><span class="cm">    whatever internal data these functions might need, that #seek and #tell</span>
<a name="gbab-898"></a><span class="cm">    take and return 64-bit offsets, and that #seek &lt;em&gt;must&lt;/em&gt; return -1 if</span>
<a name="gbab-899"></a><span class="cm">    the stream is unseekable.*/</span>
<a name="gbab-900"></a><span class="k">struct</span> <span class="n">OpusFileCallbacks</span><span class="p">{</span>
<a name="gbab-901"></a>  <span class="cm">/**Used to read data from the stream.</span>
<a name="gbab-902"></a><span class="cm">     This must not be &lt;code&gt;NULL&lt;/code&gt;.*/</span>
<a name="gbab-903"></a>  <span class="n">op_read_func</span>  <span class="n">read</span><span class="p">;</span>
<a name="gbab-904"></a>  <span class="cm">/**Used to seek in the stream.</span>
<a name="gbab-905"></a><span class="cm">     This may be &lt;code&gt;NULL&lt;/code&gt; if seeking is not implemented.*/</span>
<a name="gbab-906"></a>  <span class="n">op_seek_func</span>  <span class="n">seek</span><span class="p">;</span>
<a name="gbab-907"></a>  <span class="cm">/**Used to return the current read position in the stream.</span>
<a name="gbab-908"></a><span class="cm">     This may be &lt;code&gt;NULL&lt;/code&gt; if seeking is not implemented.*/</span>
<a name="gbab-909"></a>  <span class="n">op_tell_func</span>  <span class="n">tell</span><span class="p">;</span>
<a name="gbab-910"></a>  <span class="cm">/**Used to close the stream when the decoder is freed.</span>
<a name="gbab-911"></a><span class="cm">     This may be &lt;code&gt;NULL&lt;/code&gt; to leave the stream open.*/</span>
<a name="gbab-912"></a>  <span class="n">op_close_func</span> <span class="n">close</span><span class="p">;</span>
<a name="gbab-913"></a><span class="p">};</span>
<a name="gbab-914"></a>
<a name="gbab-915"></a><span class="cm">/**Opens a stream with &lt;code&gt;fopen()&lt;/code&gt; and fills in a set of callbacks</span>
<a name="gbab-916"></a><span class="cm">    that can be used to access it.</span>
<a name="gbab-917"></a><span class="cm">   This is useful to avoid writing your own portable 64-bit seeking wrappers,</span>
<a name="gbab-918"></a><span class="cm">    and also avoids cross-module linking issues on Windows, where a</span>
<a name="gbab-919"></a><span class="cm">    &lt;code&gt;FILE *&lt;/code&gt; must be accessed by routines defined in the same module</span>
<a name="gbab-920"></a><span class="cm">    that opened it.</span>
<a name="gbab-921"></a><span class="cm">   \param[out] _cb   The callbacks to use for this file.</span>
<a name="gbab-922"></a><span class="cm">                     If there is an error opening the file, nothing will be</span>
<a name="gbab-923"></a><span class="cm">                      filled in here.</span>
<a name="gbab-924"></a><span class="cm">   \param      _path The path to the file to open.</span>
<a name="gbab-925"></a><span class="cm">                     On Windows, this string must be UTF-8 (to allow access to</span>
<a name="gbab-926"></a><span class="cm">                      files whose names cannot be represented in the current</span>
<a name="gbab-927"></a><span class="cm">                      MBCS code page).</span>
<a name="gbab-928"></a><span class="cm">                     All other systems use the native character encoding.</span>
<a name="gbab-929"></a><span class="cm">   \param      _mode The mode to open the file in.</span>
<a name="gbab-930"></a><span class="cm">   \return A stream handle to use with the callbacks, or &lt;code&gt;NULL&lt;/code&gt; on</span>
<a name="gbab-931"></a><span class="cm">            error.*/</span>
<a name="gbab-932"></a><span class="n">OP_WARN_UNUSED_RESULT</span> <span class="kt">void</span> <span class="o">*</span><span class="nf">op_fopen</span><span class="p">(</span><span class="n">OpusFileCallbacks</span> <span class="o">*</span><span class="n">_cb</span><span class="p">,</span>
<a name="gbab-933"></a> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_path</span><span class="p">,</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_mode</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="gbab-934"></a> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<a name="gbab-935"></a>
<a name="gbab-936"></a><span class="cm">/**Opens a stream with &lt;code&gt;fdopen()&lt;/code&gt; and fills in a set of callbacks</span>
<a name="gbab-937"></a><span class="cm">    that can be used to access it.</span>
<a name="gbab-938"></a><span class="cm">   This is useful to avoid writing your own portable 64-bit seeking wrappers,</span>
<a name="gbab-939"></a><span class="cm">    and also avoids cross-module linking issues on Windows, where a</span>
<a name="gbab-940"></a><span class="cm">    &lt;code&gt;FILE *&lt;/code&gt; must be accessed by routines defined in the same module</span>
<a name="gbab-941"></a><span class="cm">    that opened it.</span>
<a name="gbab-942"></a><span class="cm">   \param[out] _cb   The callbacks to use for this file.</span>
<a name="gbab-943"></a><span class="cm">                     If there is an error opening the file, nothing will be</span>
<a name="gbab-944"></a><span class="cm">                      filled in here.</span>
<a name="gbab-945"></a><span class="cm">   \param      _fd   The file descriptor to open.</span>
<a name="gbab-946"></a><span class="cm">   \param      _mode The mode to open the file in.</span>
<a name="gbab-947"></a><span class="cm">   \return A stream handle to use with the callbacks, or &lt;code&gt;NULL&lt;/code&gt; on</span>
<a name="gbab-948"></a><span class="cm">            error.*/</span>
<a name="gbab-949"></a><span class="n">OP_WARN_UNUSED_RESULT</span> <span class="kt">void</span> <span class="o">*</span><span class="nf">op_fdopen</span><span class="p">(</span><span class="n">OpusFileCallbacks</span> <span class="o">*</span><span class="n">_cb</span><span class="p">,</span>
<a name="gbab-950"></a> <span class="kt">int</span> <span class="n">_fd</span><span class="p">,</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_mode</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<a name="gbab-951"></a>
<a name="gbab-952"></a><span class="cm">/**Opens a stream with &lt;code&gt;freopen()&lt;/code&gt; and fills in a set of callbacks</span>
<a name="gbab-953"></a><span class="cm">    that can be used to access it.</span>
<a name="gbab-954"></a><span class="cm">   This is useful to avoid writing your own portable 64-bit seeking wrappers,</span>
<a name="gbab-955"></a><span class="cm">    and also avoids cross-module linking issues on Windows, where a</span>
<a name="gbab-956"></a><span class="cm">    &lt;code&gt;FILE *&lt;/code&gt; must be accessed by routines defined in the same module</span>
<a name="gbab-957"></a><span class="cm">    that opened it.</span>
<a name="gbab-958"></a><span class="cm">   \param[out] _cb     The callbacks to use for this file.</span>
<a name="gbab-959"></a><span class="cm">                       If there is an error opening the file, nothing will be</span>
<a name="gbab-960"></a><span class="cm">                        filled in here.</span>
<a name="gbab-961"></a><span class="cm">   \param      _path   The path to the file to open.</span>
<a name="gbab-962"></a><span class="cm">                       On Windows, this string must be UTF-8 (to allow access</span>
<a name="gbab-963"></a><span class="cm">                        to files whose names cannot be represented in the</span>
<a name="gbab-964"></a><span class="cm">                        current MBCS code page).</span>
<a name="gbab-965"></a><span class="cm">                       All other systems use the native character encoding.</span>
<a name="gbab-966"></a><span class="cm">   \param      _mode   The mode to open the file in.</span>
<a name="gbab-967"></a><span class="cm">   \param      _stream A stream previously returned by op_fopen(), op_fdopen(),</span>
<a name="gbab-968"></a><span class="cm">                        or op_freopen().</span>
<a name="gbab-969"></a><span class="cm">   \return A stream handle to use with the callbacks, or &lt;code&gt;NULL&lt;/code&gt; on</span>
<a name="gbab-970"></a><span class="cm">            error.*/</span>
<a name="gbab-971"></a><span class="n">OP_WARN_UNUSED_RESULT</span> <span class="kt">void</span> <span class="o">*</span><span class="nf">op_freopen</span><span class="p">(</span><span class="n">OpusFileCallbacks</span> <span class="o">*</span><span class="n">_cb</span><span class="p">,</span>
<a name="gbab-972"></a> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_path</span><span class="p">,</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_mode</span><span class="p">,</span><span class="kt">void</span> <span class="o">*</span><span class="n">_stream</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="gbab-973"></a> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
<a name="gbab-974"></a>
<a name="gbab-975"></a><span class="cm">/**Creates a stream that reads from the given block of memory.</span>
<a name="gbab-976"></a><span class="cm">   This block of memory must contain the complete stream to decode.</span>
<a name="gbab-977"></a><span class="cm">   This is useful for caching small streams (e.g., sound effects) in RAM.</span>
<a name="gbab-978"></a><span class="cm">   \param[out] _cb   The callbacks to use for this stream.</span>
<a name="gbab-979"></a><span class="cm">                     If there is an error creating the stream, nothing will be</span>
<a name="gbab-980"></a><span class="cm">                      filled in here.</span>
<a name="gbab-981"></a><span class="cm">   \param      _data The block of memory to read from.</span>
<a name="gbab-982"></a><span class="cm">   \param      _size The size of the block of memory.</span>
<a name="gbab-983"></a><span class="cm">   \return A stream handle to use with the callbacks, or &lt;code&gt;NULL&lt;/code&gt; on</span>
<a name="gbab-984"></a><span class="cm">            error.*/</span>
<a name="gbab-985"></a><span class="n">OP_WARN_UNUSED_RESULT</span> <span class="kt">void</span> <span class="o">*</span><span class="nf">op_mem_stream_create</span><span class="p">(</span><span class="n">OpusFileCallbacks</span> <span class="o">*</span><span class="n">_cb</span><span class="p">,</span>
<a name="gbab-986"></a> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_data</span><span class="p">,</span><span class="kt">size_t</span> <span class="n">_size</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a name="gbab-987"></a>
<a name="gbab-988"></a><span class="cm">/**Creates a stream that reads from the given URL.</span>
<a name="gbab-989"></a><span class="cm">   This function behaves identically to op_url_stream_create(), except that it</span>
<a name="gbab-990"></a><span class="cm">    takes a va_list instead of a variable number of arguments.</span>
<a name="gbab-991"></a><span class="cm">   It does not call the &lt;code&gt;va_end&lt;/code&gt; macro, and because it invokes the</span>
<a name="gbab-992"></a><span class="cm">    &lt;code&gt;va_arg&lt;/code&gt; macro, the value of \a _ap is undefined after the call.</span>
<a name="gbab-993"></a><span class="cm">   \note If you use this function, you must link against &lt;tt&gt;libopusurl&lt;/tt&gt;.</span>
<a name="gbab-994"></a><span class="cm">   \param[out]    _cb  The callbacks to use for this stream.</span>
<a name="gbab-995"></a><span class="cm">                       If there is an error creating the stream, nothing will</span>
<a name="gbab-996"></a><span class="cm">                        be filled in here.</span>
<a name="gbab-997"></a><span class="cm">   \param         _url The URL to read from.</span>
<a name="gbab-998"></a><span class="cm">                       Currently only the &lt;file:&gt;, &lt;http:&gt;, and &lt;https:&gt;</span>
<a name="gbab-999"></a><span class="cm">                        schemes are supported.</span>
<a name="gbab-1000"></a><span class="cm">                       Both &lt;http:&gt; and &lt;https:&gt; may be disabled at compile</span>
<a name="gbab-1001"></a><span class="cm">                        time, in which case opening such URLs will always fail.</span>
<a name="gbab-1002"></a><span class="cm">                       Currently this only supports URIs.</span>
<a name="gbab-1003"></a><span class="cm">                       IRIs should be converted to UTF-8 and URL-escaped, with</span>
<a name="gbab-1004"></a><span class="cm">                        internationalized domain names encoded in punycode,</span>
<a name="gbab-1005"></a><span class="cm">                        before passing them to this function.</span>
<a name="gbab-1006"></a><span class="cm">   \param[in,out] _ap  A list of the \ref url_options &quot;optional flags&quot; to use.</span>
<a name="gbab-1007"></a><span class="cm">                       This is a variable-length list of options terminated</span>
<a name="gbab-1008"></a><span class="cm">                        with &lt;code&gt;NULL&lt;/code&gt;.</span>
<a name="gbab-1009"></a><span class="cm">   \return A stream handle to use with the callbacks, or &lt;code&gt;NULL&lt;/code&gt; on</span>
<a name="gbab-1010"></a><span class="cm">            error.*/</span>
<a name="gbab-1011"></a><span class="n">OP_WARN_UNUSED_RESULT</span> <span class="kt">void</span> <span class="o">*</span><span class="nf">op_url_stream_vcreate</span><span class="p">(</span><span class="n">OpusFileCallbacks</span> <span class="o">*</span><span class="n">_cb</span><span class="p">,</span>
<a name="gbab-1012"></a> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_url</span><span class="p">,</span><span class="kt">va_list</span> <span class="n">_ap</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<a name="gbab-1013"></a>
<a name="gbab-1014"></a><span class="cm">/**Creates a stream that reads from the given URL.</span>
<a name="gbab-1015"></a><span class="cm">   \note If you use this function, you must link against &lt;tt&gt;libopusurl&lt;/tt&gt;.</span>
<a name="gbab-1016"></a><span class="cm">   \param[out] _cb  The callbacks to use for this stream.</span>
<a name="gbab-1017"></a><span class="cm">                    If there is an error creating the stream, nothing will be</span>
<a name="gbab-1018"></a><span class="cm">                     filled in here.</span>
<a name="gbab-1019"></a><span class="cm">   \param      _url The URL to read from.</span>
<a name="gbab-1020"></a><span class="cm">                    Currently only the &lt;file:&gt;, &lt;http:&gt;, and &lt;https:&gt; schemes</span>
<a name="gbab-1021"></a><span class="cm">                     are supported.</span>
<a name="gbab-1022"></a><span class="cm">                    Both &lt;http:&gt; and &lt;https:&gt; may be disabled at compile time,</span>
<a name="gbab-1023"></a><span class="cm">                     in which case opening such URLs will always fail.</span>
<a name="gbab-1024"></a><span class="cm">                    Currently this only supports URIs.</span>
<a name="gbab-1025"></a><span class="cm">                    IRIs should be converted to UTF-8 and URL-escaped, with</span>
<a name="gbab-1026"></a><span class="cm">                     internationalized domain names encoded in punycode, before</span>
<a name="gbab-1027"></a><span class="cm">                     passing them to this function.</span>
<a name="gbab-1028"></a><span class="cm">   \param      ...  The \ref url_options &quot;optional flags&quot; to use.</span>
<a name="gbab-1029"></a><span class="cm">                    This is a variable-length list of options terminated with</span>
<a name="gbab-1030"></a><span class="cm">                     &lt;code&gt;NULL&lt;/code&gt;.</span>
<a name="gbab-1031"></a><span class="cm">   \return A stream handle to use with the callbacks, or &lt;code&gt;NULL&lt;/code&gt; on</span>
<a name="gbab-1032"></a><span class="cm">            error.*/</span>
<a name="gbab-1033"></a><span class="n">OP_WARN_UNUSED_RESULT</span> <span class="kt">void</span> <span class="o">*</span><span class="nf">op_url_stream_create</span><span class="p">(</span><span class="n">OpusFileCallbacks</span> <span class="o">*</span><span class="n">_cb</span><span class="p">,</span>
<a name="gbab-1034"></a> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_url</span><span class="p">,...)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<a name="gbab-1035"></a>
<a name="gbab-1036"></a><span class="cm">/*@}*/</span>
<a name="gbab-1037"></a><span class="cm">/*@}*/</span>
<a name="gbab-1038"></a>
<a name="gbab-1039"></a><span class="cm">/**\defgroup stream_open_close Opening and Closing*/</span>
<a name="gbab-1040"></a><span class="cm">/*@{*/</span>
<a name="gbab-1041"></a><span class="cm">/**\name Functions for opening and closing streams</span>
<a name="gbab-1042"></a>
<a name="gbab-1043"></a><span class="cm">   These functions allow you to test a stream to see if it is Opus, open it,</span>
<a name="gbab-1044"></a><span class="cm">    and close it.</span>
<a name="gbab-1045"></a><span class="cm">   Several flavors are provided for each of the built-in stream types, plus a</span>
<a name="gbab-1046"></a><span class="cm">    more general version which takes a set of application-provided callbacks.*/</span>
<a name="gbab-1047"></a><span class="cm">/*@{*/</span>
<a name="gbab-1048"></a>
<a name="gbab-1049"></a><span class="cm">/**Test to see if this is an Opus stream.</span>
<a name="gbab-1050"></a><span class="cm">   For good results, you will need at least 57 bytes (for a pure Opus-only</span>
<a name="gbab-1051"></a><span class="cm">    stream).</span>
<a name="gbab-1052"></a><span class="cm">   Something like 512 bytes will give more reliable results for multiplexed</span>
<a name="gbab-1053"></a><span class="cm">    streams.</span>
<a name="gbab-1054"></a><span class="cm">   This function is meant to be a quick-rejection filter.</span>
<a name="gbab-1055"></a><span class="cm">   Its purpose is not to guarantee that a stream is a valid Opus stream, but to</span>
<a name="gbab-1056"></a><span class="cm">    ensure that it looks enough like Opus that it isn&#39;t going to be recognized</span>
<a name="gbab-1057"></a><span class="cm">    as some other format (except possibly an Opus stream that is also</span>
<a name="gbab-1058"></a><span class="cm">    multiplexed with other codecs, such as video).</span>
<a name="gbab-1059"></a><span class="cm">   \param[out] _head     The parsed ID header contents.</span>
<a name="gbab-1060"></a><span class="cm">                         You may pass &lt;code&gt;NULL&lt;/code&gt; if you do not need</span>
<a name="gbab-1061"></a><span class="cm">                          this information.</span>
<a name="gbab-1062"></a><span class="cm">                         If the function fails, the contents of this structure</span>
<a name="gbab-1063"></a><span class="cm">                          remain untouched.</span>
<a name="gbab-1064"></a><span class="cm">   \param _initial_data  An initial buffer of data from the start of the</span>
<a name="gbab-1065"></a><span class="cm">                          stream.</span>
<a name="gbab-1066"></a><span class="cm">   \param _initial_bytes The number of bytes in \a _initial_data.</span>
<a name="gbab-1067"></a><span class="cm">   \return 0 if the data appears to be Opus, or a negative value on error.</span>
<a name="gbab-1068"></a><span class="cm">   \retval #OP_FALSE      There was not enough data to tell if this was an Opus</span>
<a name="gbab-1069"></a><span class="cm">                           stream or not.</span>
<a name="gbab-1070"></a><span class="cm">   \retval #OP_EFAULT     An internal memory allocation failed.</span>
<a name="gbab-1071"></a><span class="cm">   \retval #OP_EIMPL      The stream used a feature that is not implemented,</span>
<a name="gbab-1072"></a><span class="cm">                           such as an unsupported channel family.</span>
<a name="gbab-1073"></a><span class="cm">   \retval #OP_ENOTFORMAT If the data did not contain a recognizable ID</span>
<a name="gbab-1074"></a><span class="cm">                           header for an Opus stream.</span>
<a name="gbab-1075"></a><span class="cm">   \retval #OP_EVERSION   If the version field signaled a version this library</span>
<a name="gbab-1076"></a><span class="cm">                           does not know how to parse.</span>
<a name="gbab-1077"></a><span class="cm">   \retval #OP_EBADHEADER The ID header was not properly formatted or contained</span>
<a name="gbab-1078"></a><span class="cm">                           illegal values.*/</span>
<a name="gbab-1079"></a><span class="kt">int</span> <span class="nf">op_test</span><span class="p">(</span><span class="n">OpusHead</span> <span class="o">*</span><span class="n">_head</span><span class="p">,</span>
<a name="gbab-1080"></a> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_initial_data</span><span class="p">,</span><span class="kt">size_t</span> <span class="n">_initial_bytes</span><span class="p">);</span>
<a name="gbab-1081"></a>
<a name="gbab-1082"></a><span class="cm">/**Open a stream from the given file path.</span>
<a name="gbab-1083"></a><span class="cm">   \param      _path  The path to the file to open.</span>
<a name="gbab-1084"></a><span class="cm">   \param[out] _error Returns 0 on success, or a failure code on error.</span>
<a name="gbab-1085"></a><span class="cm">                      You may pass in &lt;code&gt;NULL&lt;/code&gt; if you don&#39;t want the</span>
<a name="gbab-1086"></a><span class="cm">                       failure code.</span>
<a name="gbab-1087"></a><span class="cm">                      The failure code will be #OP_EFAULT if the file could not</span>
<a name="gbab-1088"></a><span class="cm">                       be opened, or one of the other failure codes from</span>
<a name="gbab-1089"></a><span class="cm">                       op_open_callbacks() otherwise.</span>
<a name="gbab-1090"></a><span class="cm">   \return A freshly opened \c OggOpusFile, or &lt;code&gt;NULL&lt;/code&gt; on error.*/</span>
<a name="gbab-1091"></a><span class="n">OP_WARN_UNUSED_RESULT</span> <span class="n">OggOpusFile</span> <span class="o">*</span><span class="nf">op_open_file</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_path</span><span class="p">,</span><span class="kt">int</span> <span class="o">*</span><span class="n">_error</span><span class="p">)</span>
<a name="gbab-1092"></a> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a name="gbab-1093"></a>
<a name="gbab-1094"></a><span class="cm">/**Open a stream from a memory buffer.</span>
<a name="gbab-1095"></a><span class="cm">   \param      _data  The memory buffer to open.</span>
<a name="gbab-1096"></a><span class="cm">   \param      _size  The number of bytes in the buffer.</span>
<a name="gbab-1097"></a><span class="cm">   \param[out] _error Returns 0 on success, or a failure code on error.</span>
<a name="gbab-1098"></a><span class="cm">                      You may pass in &lt;code&gt;NULL&lt;/code&gt; if you don&#39;t want the</span>
<a name="gbab-1099"></a><span class="cm">                       failure code.</span>
<a name="gbab-1100"></a><span class="cm">                      See op_open_callbacks() for a full list of failure codes.</span>
<a name="gbab-1101"></a><span class="cm">   \return A freshly opened \c OggOpusFile, or &lt;code&gt;NULL&lt;/code&gt; on error.*/</span>
<a name="gbab-1102"></a><span class="n">OP_WARN_UNUSED_RESULT</span> <span class="n">OggOpusFile</span> <span class="o">*</span><span class="nf">op_open_memory</span><span class="p">(</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_data</span><span class="p">,</span>
<a name="gbab-1103"></a> <span class="kt">size_t</span> <span class="n">_size</span><span class="p">,</span><span class="kt">int</span> <span class="o">*</span><span class="n">_error</span><span class="p">);</span>
<a name="gbab-1104"></a>
<a name="gbab-1105"></a><span class="cm">/**Open a stream from a URL.</span>
<a name="gbab-1106"></a><span class="cm">   This function behaves identically to op_open_url(), except that it</span>
<a name="gbab-1107"></a><span class="cm">    takes a va_list instead of a variable number of arguments.</span>
<a name="gbab-1108"></a><span class="cm">   It does not call the &lt;code&gt;va_end&lt;/code&gt; macro, and because it invokes the</span>
<a name="gbab-1109"></a><span class="cm">    &lt;code&gt;va_arg&lt;/code&gt; macro, the value of \a _ap is undefined after the call.</span>
<a name="gbab-1110"></a><span class="cm">   \note If you use this function, you must link against &lt;tt&gt;libopusurl&lt;/tt&gt;.</span>
<a name="gbab-1111"></a><span class="cm">   \param         _url   The URL to open.</span>
<a name="gbab-1112"></a><span class="cm">                         Currently only the &lt;file:&gt;, &lt;http:&gt;, and &lt;https:&gt;</span>
<a name="gbab-1113"></a><span class="cm">                          schemes are supported.</span>
<a name="gbab-1114"></a><span class="cm">                         Both &lt;http:&gt; and &lt;https:&gt; may be disabled at compile</span>
<a name="gbab-1115"></a><span class="cm">                          time, in which case opening such URLs will always</span>
<a name="gbab-1116"></a><span class="cm">                          fail.</span>
<a name="gbab-1117"></a><span class="cm">                         Currently this only supports URIs.</span>
<a name="gbab-1118"></a><span class="cm">                         IRIs should be converted to UTF-8 and URL-escaped,</span>
<a name="gbab-1119"></a><span class="cm">                          with internationalized domain names encoded in</span>
<a name="gbab-1120"></a><span class="cm">                          punycode, before passing them to this function.</span>
<a name="gbab-1121"></a><span class="cm">   \param[out]    _error Returns 0 on success, or a failure code on error.</span>
<a name="gbab-1122"></a><span class="cm">                         You may pass in &lt;code&gt;NULL&lt;/code&gt; if you don&#39;t want</span>
<a name="gbab-1123"></a><span class="cm">                          the failure code.</span>
<a name="gbab-1124"></a><span class="cm">                         See op_open_callbacks() for a full list of failure</span>
<a name="gbab-1125"></a><span class="cm">                          codes.</span>
<a name="gbab-1126"></a><span class="cm">   \param[in,out] _ap    A list of the \ref url_options &quot;optional flags&quot; to</span>
<a name="gbab-1127"></a><span class="cm">                          use.</span>
<a name="gbab-1128"></a><span class="cm">                         This is a variable-length list of options terminated</span>
<a name="gbab-1129"></a><span class="cm">                          with &lt;code&gt;NULL&lt;/code&gt;.</span>
<a name="gbab-1130"></a><span class="cm">   \return A freshly opened \c OggOpusFile, or &lt;code&gt;NULL&lt;/code&gt; on error.*/</span>
<a name="gbab-1131"></a><span class="n">OP_WARN_UNUSED_RESULT</span> <span class="n">OggOpusFile</span> <span class="o">*</span><span class="nf">op_vopen_url</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_url</span><span class="p">,</span>
<a name="gbab-1132"></a> <span class="kt">int</span> <span class="o">*</span><span class="n">_error</span><span class="p">,</span><span class="kt">va_list</span> <span class="n">_ap</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a name="gbab-1133"></a>
<a name="gbab-1134"></a><span class="cm">/**Open a stream from a URL.</span>
<a name="gbab-1135"></a><span class="cm">   \note If you use this function, you must link against &lt;tt&gt;libopusurl&lt;/tt&gt;.</span>
<a name="gbab-1136"></a><span class="cm">   \param      _url   The URL to open.</span>
<a name="gbab-1137"></a><span class="cm">                      Currently only the &lt;file:&gt;, &lt;http:&gt;, and &lt;https:&gt; schemes</span>
<a name="gbab-1138"></a><span class="cm">                       are supported.</span>
<a name="gbab-1139"></a><span class="cm">                      Both &lt;http:&gt; and &lt;https:&gt; may be disabled at compile</span>
<a name="gbab-1140"></a><span class="cm">                       time, in which case opening such URLs will always fail.</span>
<a name="gbab-1141"></a><span class="cm">                      Currently this only supports URIs.</span>
<a name="gbab-1142"></a><span class="cm">                      IRIs should be converted to UTF-8 and URL-escaped, with</span>
<a name="gbab-1143"></a><span class="cm">                       internationalized domain names encoded in punycode,</span>
<a name="gbab-1144"></a><span class="cm">                       before passing them to this function.</span>
<a name="gbab-1145"></a><span class="cm">   \param[out] _error Returns 0 on success, or a failure code on error.</span>
<a name="gbab-1146"></a><span class="cm">                      You may pass in &lt;code&gt;NULL&lt;/code&gt; if you don&#39;t want the</span>
<a name="gbab-1147"></a><span class="cm">                       failure code.</span>
<a name="gbab-1148"></a><span class="cm">                      See op_open_callbacks() for a full list of failure codes.</span>
<a name="gbab-1149"></a><span class="cm">   \param      ...    The \ref url_options &quot;optional flags&quot; to use.</span>
<a name="gbab-1150"></a><span class="cm">                      This is a variable-length list of options terminated with</span>
<a name="gbab-1151"></a><span class="cm">                       &lt;code&gt;NULL&lt;/code&gt;.</span>
<a name="gbab-1152"></a><span class="cm">   \return A freshly opened \c OggOpusFile, or &lt;code&gt;NULL&lt;/code&gt; on error.*/</span>
<a name="gbab-1153"></a><span class="n">OP_WARN_UNUSED_RESULT</span> <span class="n">OggOpusFile</span> <span class="o">*</span><span class="nf">op_open_url</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_url</span><span class="p">,</span>
<a name="gbab-1154"></a> <span class="kt">int</span> <span class="o">*</span><span class="n">_error</span><span class="p">,...)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a name="gbab-1155"></a>
<a name="gbab-1156"></a><span class="cm">/**Open a stream using the given set of callbacks to access it.</span>
<a name="gbab-1157"></a><span class="cm">   \param _source        The stream to read from (e.g., a &lt;code&gt;FILE *&lt;/code&gt;).</span>
<a name="gbab-1158"></a><span class="cm">   \param _cb            The callbacks with which to access the stream.</span>
<a name="gbab-1159"></a><span class="cm">                         &lt;code&gt;&lt;a href=&quot;#op_read_func&quot;&gt;read()&lt;/a&gt;&lt;/code&gt; must</span>
<a name="gbab-1160"></a><span class="cm">                          be implemented.</span>
<a name="gbab-1161"></a><span class="cm">                         &lt;code&gt;&lt;a href=&quot;#op_seek_func&quot;&gt;seek()&lt;/a&gt;&lt;/code&gt; and</span>
<a name="gbab-1162"></a><span class="cm">                          &lt;code&gt;&lt;a href=&quot;#op_tell_func&quot;&gt;tell()&lt;/a&gt;&lt;/code&gt; may</span>
<a name="gbab-1163"></a><span class="cm">                          be &lt;code&gt;NULL&lt;/code&gt;, or may always return -1 to</span>
<a name="gbab-1164"></a><span class="cm">                          indicate a source is unseekable, but if</span>
<a name="gbab-1165"></a><span class="cm">                          &lt;code&gt;&lt;a href=&quot;#op_seek_func&quot;&gt;seek()&lt;/a&gt;&lt;/code&gt; is</span>
<a name="gbab-1166"></a><span class="cm">                          implemented and succeeds on a particular source, then</span>
<a name="gbab-1167"></a><span class="cm">                          &lt;code&gt;&lt;a href=&quot;#op_tell_func&quot;&gt;tell()&lt;/a&gt;&lt;/code&gt; must</span>
<a name="gbab-1168"></a><span class="cm">                          also.</span>
<a name="gbab-1169"></a><span class="cm">                         &lt;code&gt;&lt;a href=&quot;#op_close_func&quot;&gt;close()&lt;/a&gt;&lt;/code&gt; may</span>
<a name="gbab-1170"></a><span class="cm">                          be &lt;code&gt;NULL&lt;/code&gt;, but if it is not, it will be</span>
<a name="gbab-1171"></a><span class="cm">                          called when the \c OggOpusFile is destroyed by</span>
<a name="gbab-1172"></a><span class="cm">                          op_free().</span>
<a name="gbab-1173"></a><span class="cm">                         It will not be called if op_open_callbacks() fails</span>
<a name="gbab-1174"></a><span class="cm">                          with an error.</span>
<a name="gbab-1175"></a><span class="cm">   \param _initial_data  An initial buffer of data from the start of the</span>
<a name="gbab-1176"></a><span class="cm">                          stream.</span>
<a name="gbab-1177"></a><span class="cm">                         Applications can read some number of bytes from the</span>
<a name="gbab-1178"></a><span class="cm">                          start of the stream to help identify this as an Opus</span>
<a name="gbab-1179"></a><span class="cm">                          stream, and then provide them here to allow the</span>
<a name="gbab-1180"></a><span class="cm">                          stream to be opened, even if it is unseekable.</span>
<a name="gbab-1181"></a><span class="cm">   \param _initial_bytes The number of bytes in \a _initial_data.</span>
<a name="gbab-1182"></a><span class="cm">                         If the stream is seekable, its current position (as</span>
<a name="gbab-1183"></a><span class="cm">                          reported by</span>
<a name="gbab-1184"></a><span class="cm">                          &lt;code&gt;&lt;a href=&quot;#opus_tell_func&quot;&gt;tell()&lt;/a&gt;&lt;/code&gt;</span>
<a name="gbab-1185"></a><span class="cm">                          at the start of this function) must be equal to</span>
<a name="gbab-1186"></a><span class="cm">                          \a _initial_bytes.</span>
<a name="gbab-1187"></a><span class="cm">                         Otherwise, seeking to absolute positions will</span>
<a name="gbab-1188"></a><span class="cm">                          generate inconsistent results.</span>
<a name="gbab-1189"></a><span class="cm">   \param[out] _error    Returns 0 on success, or a failure code on error.</span>
<a name="gbab-1190"></a><span class="cm">                         You may pass in &lt;code&gt;NULL&lt;/code&gt; if you don&#39;t want</span>
<a name="gbab-1191"></a><span class="cm">                          the failure code.</span>
<a name="gbab-1192"></a><span class="cm">                         The failure code will be one of</span>
<a name="gbab-1193"></a><span class="cm">                         &lt;dl&gt;</span>
<a name="gbab-1194"></a><span class="cm">                           &lt;dt&gt;#OP_EREAD&lt;/dt&gt;</span>
<a name="gbab-1195"></a><span class="cm">                           &lt;dd&gt;An underlying read, seek, or tell operation</span>
<a name="gbab-1196"></a><span class="cm">                            failed when it should have succeeded, or we failed</span>
<a name="gbab-1197"></a><span class="cm">                            to find data in the stream we had seen before.&lt;/dd&gt;</span>
<a name="gbab-1198"></a><span class="cm">                           &lt;dt&gt;#OP_EFAULT&lt;/dt&gt;</span>
<a name="gbab-1199"></a><span class="cm">                           &lt;dd&gt;There was a memory allocation failure, or an</span>
<a name="gbab-1200"></a><span class="cm">                            internal library error.&lt;/dd&gt;</span>
<a name="gbab-1201"></a><span class="cm">                           &lt;dt&gt;#OP_EIMPL&lt;/dt&gt;</span>
<a name="gbab-1202"></a><span class="cm">                           &lt;dd&gt;The stream used a feature that is not</span>
<a name="gbab-1203"></a><span class="cm">                            implemented, such as an unsupported channel</span>
<a name="gbab-1204"></a><span class="cm">                            family.&lt;/dd&gt;</span>
<a name="gbab-1205"></a><span class="cm">                           &lt;dt&gt;#OP_EINVAL&lt;/dt&gt;</span>
<a name="gbab-1206"></a><span class="cm">                           &lt;dd&gt;&lt;code&gt;&lt;a href=&quot;#op_seek_func&quot;&gt;seek()&lt;/a&gt;&lt;/code&gt;</span>
<a name="gbab-1207"></a><span class="cm">                            was implemented and succeeded on this source, but</span>
<a name="gbab-1208"></a><span class="cm">                            &lt;code&gt;&lt;a href=&quot;#op_tell_func&quot;&gt;tell()&lt;/a&gt;&lt;/code&gt;</span>
<a name="gbab-1209"></a><span class="cm">                            did not, or the starting position indicator was</span>
<a name="gbab-1210"></a><span class="cm">                            not equal to \a _initial_bytes.&lt;/dd&gt;</span>
<a name="gbab-1211"></a><span class="cm">                           &lt;dt&gt;#OP_ENOTFORMAT&lt;/dt&gt;</span>
<a name="gbab-1212"></a><span class="cm">                           &lt;dd&gt;The stream contained a link that did not have</span>
<a name="gbab-1213"></a><span class="cm">                            any logical Opus streams in it.&lt;/dd&gt;</span>
<a name="gbab-1214"></a><span class="cm">                           &lt;dt&gt;#OP_EBADHEADER&lt;/dt&gt;</span>
<a name="gbab-1215"></a><span class="cm">                           &lt;dd&gt;A required header packet was not properly</span>
<a name="gbab-1216"></a><span class="cm">                            formatted, contained illegal values, or was missing</span>
<a name="gbab-1217"></a><span class="cm">                            altogether.&lt;/dd&gt;</span>
<a name="gbab-1218"></a><span class="cm">                           &lt;dt&gt;#OP_EVERSION&lt;/dt&gt;</span>
<a name="gbab-1219"></a><span class="cm">                           &lt;dd&gt;An ID header contained an unrecognized version</span>
<a name="gbab-1220"></a><span class="cm">                            number.&lt;/dd&gt;</span>
<a name="gbab-1221"></a><span class="cm">                           &lt;dt&gt;#OP_EBADLINK&lt;/dt&gt;</span>
<a name="gbab-1222"></a><span class="cm">                           &lt;dd&gt;We failed to find data we had seen before after</span>
<a name="gbab-1223"></a><span class="cm">                            seeking.&lt;/dd&gt;</span>
<a name="gbab-1224"></a><span class="cm">                           &lt;dt&gt;#OP_EBADTIMESTAMP&lt;/dt&gt;</span>
<a name="gbab-1225"></a><span class="cm">                           &lt;dd&gt;The first or last timestamp in a link failed</span>
<a name="gbab-1226"></a><span class="cm">                            basic validity checks.&lt;/dd&gt;</span>
<a name="gbab-1227"></a><span class="cm">                         &lt;/dl&gt;</span>
<a name="gbab-1228"></a><span class="cm">   \return A freshly opened \c OggOpusFile, or &lt;code&gt;NULL&lt;/code&gt; on error.</span>
<a name="gbab-1229"></a><span class="cm">           &lt;tt&gt;libopusfile&lt;/tt&gt; does &lt;em&gt;not&lt;/em&gt; take ownership of the source</span>
<a name="gbab-1230"></a><span class="cm">            if the call fails.</span>
<a name="gbab-1231"></a><span class="cm">           The calling application is responsible for closing the source if</span>
<a name="gbab-1232"></a><span class="cm">            this call returns an error.*/</span>
<a name="gbab-1233"></a><span class="n">OP_WARN_UNUSED_RESULT</span> <span class="n">OggOpusFile</span> <span class="o">*</span><span class="nf">op_open_callbacks</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">_source</span><span class="p">,</span>
<a name="gbab-1234"></a> <span class="k">const</span> <span class="n">OpusFileCallbacks</span> <span class="o">*</span><span class="n">_cb</span><span class="p">,</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_initial_data</span><span class="p">,</span>
<a name="gbab-1235"></a> <span class="kt">size_t</span> <span class="n">_initial_bytes</span><span class="p">,</span><span class="kt">int</span> <span class="o">*</span><span class="n">_error</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<a name="gbab-1236"></a>
<a name="gbab-1237"></a><span class="cm">/**Partially open a stream from the given file path.</span>
<a name="gbab-1238"></a><span class="cm">   \see op_test_callbacks</span>
<a name="gbab-1239"></a><span class="cm">   \param      _path  The path to the file to open.</span>
<a name="gbab-1240"></a><span class="cm">   \param[out] _error Returns 0 on success, or a failure code on error.</span>
<a name="gbab-1241"></a><span class="cm">                      You may pass in &lt;code&gt;NULL&lt;/code&gt; if you don&#39;t want the</span>
<a name="gbab-1242"></a><span class="cm">                       failure code.</span>
<a name="gbab-1243"></a><span class="cm">                      The failure code will be #OP_EFAULT if the file could not</span>
<a name="gbab-1244"></a><span class="cm">                       be opened, or one of the other failure codes from</span>
<a name="gbab-1245"></a><span class="cm">                       op_open_callbacks() otherwise.</span>
<a name="gbab-1246"></a><span class="cm">   \return A partially opened \c OggOpusFile, or &lt;code&gt;NULL&lt;/code&gt; on error.*/</span>
<a name="gbab-1247"></a><span class="n">OP_WARN_UNUSED_RESULT</span> <span class="n">OggOpusFile</span> <span class="o">*</span><span class="nf">op_test_file</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_path</span><span class="p">,</span><span class="kt">int</span> <span class="o">*</span><span class="n">_error</span><span class="p">)</span>
<a name="gbab-1248"></a> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a name="gbab-1249"></a>
<a name="gbab-1250"></a><span class="cm">/**Partially open a stream from a memory buffer.</span>
<a name="gbab-1251"></a><span class="cm">   \see op_test_callbacks</span>
<a name="gbab-1252"></a><span class="cm">   \param      _data  The memory buffer to open.</span>
<a name="gbab-1253"></a><span class="cm">   \param      _size  The number of bytes in the buffer.</span>
<a name="gbab-1254"></a><span class="cm">   \param[out] _error Returns 0 on success, or a failure code on error.</span>
<a name="gbab-1255"></a><span class="cm">                      You may pass in &lt;code&gt;NULL&lt;/code&gt; if you don&#39;t want the</span>
<a name="gbab-1256"></a><span class="cm">                       failure code.</span>
<a name="gbab-1257"></a><span class="cm">                      See op_open_callbacks() for a full list of failure codes.</span>
<a name="gbab-1258"></a><span class="cm">   \return A partially opened \c OggOpusFile, or &lt;code&gt;NULL&lt;/code&gt; on error.*/</span>
<a name="gbab-1259"></a><span class="n">OP_WARN_UNUSED_RESULT</span> <span class="n">OggOpusFile</span> <span class="o">*</span><span class="nf">op_test_memory</span><span class="p">(</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_data</span><span class="p">,</span>
<a name="gbab-1260"></a> <span class="kt">size_t</span> <span class="n">_size</span><span class="p">,</span><span class="kt">int</span> <span class="o">*</span><span class="n">_error</span><span class="p">);</span>
<a name="gbab-1261"></a>
<a name="gbab-1262"></a><span class="cm">/**Partially open a stream from a URL.</span>
<a name="gbab-1263"></a><span class="cm">   This function behaves identically to op_test_url(), except that it</span>
<a name="gbab-1264"></a><span class="cm">    takes a va_list instead of a variable number of arguments.</span>
<a name="gbab-1265"></a><span class="cm">   It does not call the &lt;code&gt;va_end&lt;/code&gt; macro, and because it invokes the</span>
<a name="gbab-1266"></a><span class="cm">    &lt;code&gt;va_arg&lt;/code&gt; macro, the value of \a _ap is undefined after the call.</span>
<a name="gbab-1267"></a><span class="cm">   \note If you use this function, you must link against &lt;tt&gt;libopusurl&lt;/tt&gt;.</span>
<a name="gbab-1268"></a><span class="cm">   \see op_test_url</span>
<a name="gbab-1269"></a><span class="cm">   \see op_test_callbacks</span>
<a name="gbab-1270"></a><span class="cm">   \param         _url    The URL to open.</span>
<a name="gbab-1271"></a><span class="cm">                          Currently only the &lt;file:&gt;, &lt;http:&gt;, and &lt;https:&gt;</span>
<a name="gbab-1272"></a><span class="cm">                           schemes are supported.</span>
<a name="gbab-1273"></a><span class="cm">                          Both &lt;http:&gt; and &lt;https:&gt; may be disabled at compile</span>
<a name="gbab-1274"></a><span class="cm">                           time, in which case opening such URLs will always</span>
<a name="gbab-1275"></a><span class="cm">                           fail.</span>
<a name="gbab-1276"></a><span class="cm">                          Currently this only supports URIs.</span>
<a name="gbab-1277"></a><span class="cm">                          IRIs should be converted to UTF-8 and URL-escaped,</span>
<a name="gbab-1278"></a><span class="cm">                           with internationalized domain names encoded in</span>
<a name="gbab-1279"></a><span class="cm">                           punycode, before passing them to this function.</span>
<a name="gbab-1280"></a><span class="cm">   \param[out]    _error  Returns 0 on success, or a failure code on error.</span>
<a name="gbab-1281"></a><span class="cm">                          You may pass in &lt;code&gt;NULL&lt;/code&gt; if you don&#39;t want</span>
<a name="gbab-1282"></a><span class="cm">                           the failure code.</span>
<a name="gbab-1283"></a><span class="cm">                          See op_open_callbacks() for a full list of failure</span>
<a name="gbab-1284"></a><span class="cm">                           codes.</span>
<a name="gbab-1285"></a><span class="cm">   \param[in,out] _ap     A list of the \ref url_options &quot;optional flags&quot; to</span>
<a name="gbab-1286"></a><span class="cm">                           use.</span>
<a name="gbab-1287"></a><span class="cm">                          This is a variable-length list of options terminated</span>
<a name="gbab-1288"></a><span class="cm">                           with &lt;code&gt;NULL&lt;/code&gt;.</span>
<a name="gbab-1289"></a><span class="cm">   \return A partially opened \c OggOpusFile, or &lt;code&gt;NULL&lt;/code&gt; on error.*/</span>
<a name="gbab-1290"></a><span class="n">OP_WARN_UNUSED_RESULT</span> <span class="n">OggOpusFile</span> <span class="o">*</span><span class="nf">op_vtest_url</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_url</span><span class="p">,</span>
<a name="gbab-1291"></a> <span class="kt">int</span> <span class="o">*</span><span class="n">_error</span><span class="p">,</span><span class="kt">va_list</span> <span class="n">_ap</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a name="gbab-1292"></a>
<a name="gbab-1293"></a><span class="cm">/**Partially open a stream from a URL.</span>
<a name="gbab-1294"></a><span class="cm">   \note If you use this function, you must link against &lt;tt&gt;libopusurl&lt;/tt&gt;.</span>
<a name="gbab-1295"></a><span class="cm">   \see op_test_callbacks</span>
<a name="gbab-1296"></a><span class="cm">   \param      _url    The URL to open.</span>
<a name="gbab-1297"></a><span class="cm">                       Currently only the &lt;file:&gt;, &lt;http:&gt;, and &lt;https:&gt;</span>
<a name="gbab-1298"></a><span class="cm">                        schemes are supported.</span>
<a name="gbab-1299"></a><span class="cm">                       Both &lt;http:&gt; and &lt;https:&gt; may be disabled at compile</span>
<a name="gbab-1300"></a><span class="cm">                        time, in which case opening such URLs will always fail.</span>
<a name="gbab-1301"></a><span class="cm">                       Currently this only supports URIs.</span>
<a name="gbab-1302"></a><span class="cm">                       IRIs should be converted to UTF-8 and URL-escaped, with</span>
<a name="gbab-1303"></a><span class="cm">                        internationalized domain names encoded in punycode,</span>
<a name="gbab-1304"></a><span class="cm">                        before passing them to this function.</span>
<a name="gbab-1305"></a><span class="cm">   \param[out] _error  Returns 0 on success, or a failure code on error.</span>
<a name="gbab-1306"></a><span class="cm">                       You may pass in &lt;code&gt;NULL&lt;/code&gt; if you don&#39;t want the</span>
<a name="gbab-1307"></a><span class="cm">                        failure code.</span>
<a name="gbab-1308"></a><span class="cm">                       See op_open_callbacks() for a full list of failure</span>
<a name="gbab-1309"></a><span class="cm">                        codes.</span>
<a name="gbab-1310"></a><span class="cm">   \param      ...     The \ref url_options &quot;optional flags&quot; to use.</span>
<a name="gbab-1311"></a><span class="cm">                       This is a variable-length list of options terminated</span>
<a name="gbab-1312"></a><span class="cm">                        with &lt;code&gt;NULL&lt;/code&gt;.</span>
<a name="gbab-1313"></a><span class="cm">   \return A partially opened \c OggOpusFile, or &lt;code&gt;NULL&lt;/code&gt; on error.*/</span>
<a name="gbab-1314"></a><span class="n">OP_WARN_UNUSED_RESULT</span> <span class="n">OggOpusFile</span> <span class="o">*</span><span class="nf">op_test_url</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_url</span><span class="p">,</span>
<a name="gbab-1315"></a> <span class="kt">int</span> <span class="o">*</span><span class="n">_error</span><span class="p">,...)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a name="gbab-1316"></a>
<a name="gbab-1317"></a><span class="cm">/**Partially open a stream using the given set of callbacks to access it.</span>
<a name="gbab-1318"></a><span class="cm">   This tests for Opusness and loads the headers for the first link.</span>
<a name="gbab-1319"></a><span class="cm">   It does not seek (although it tests for seekability).</span>
<a name="gbab-1320"></a><span class="cm">   You can query a partially open stream for the few pieces of basic</span>
<a name="gbab-1321"></a><span class="cm">    information returned by op_serialno(), op_channel_count(), op_head(), and</span>
<a name="gbab-1322"></a><span class="cm">    op_tags() (but only for the first link).</span>
<a name="gbab-1323"></a><span class="cm">   You may also determine if it is seekable via a call to op_seekable().</span>
<a name="gbab-1324"></a><span class="cm">   You cannot read audio from the stream, seek, get the size or duration,</span>
<a name="gbab-1325"></a><span class="cm">    get information from links other than the first one, or even get the total</span>
<a name="gbab-1326"></a><span class="cm">    number of links until you finish opening the stream with op_test_open().</span>
<a name="gbab-1327"></a><span class="cm">   If you do not need to do any of these things, you can dispose of it with</span>
<a name="gbab-1328"></a><span class="cm">    op_free() instead.</span>
<a name="gbab-1329"></a>
<a name="gbab-1330"></a><span class="cm">   This function is provided mostly to simplify porting existing code that used</span>
<a name="gbab-1331"></a><span class="cm">    &lt;tt&gt;libvorbisfile&lt;/tt&gt;.</span>
<a name="gbab-1332"></a><span class="cm">   For new code, you are likely better off using op_test() instead, which</span>
<a name="gbab-1333"></a><span class="cm">    is less resource-intensive, requires less data to succeed, and imposes a</span>
<a name="gbab-1334"></a><span class="cm">    hard limit on the amount of data it examines (important for unseekable</span>
<a name="gbab-1335"></a><span class="cm">    sources, where all such data must be buffered until you are sure of the</span>
<a name="gbab-1336"></a><span class="cm">    stream type).</span>
<a name="gbab-1337"></a><span class="cm">   \param _source        The stream to read from (e.g., a &lt;code&gt;FILE *&lt;/code&gt;).</span>
<a name="gbab-1338"></a><span class="cm">   \param _cb            The callbacks with which to access the stream.</span>
<a name="gbab-1339"></a><span class="cm">                         &lt;code&gt;&lt;a href=&quot;#op_read_func&quot;&gt;read()&lt;/a&gt;&lt;/code&gt; must</span>
<a name="gbab-1340"></a><span class="cm">                          be implemented.</span>
<a name="gbab-1341"></a><span class="cm">                         &lt;code&gt;&lt;a href=&quot;#op_seek_func&quot;&gt;seek()&lt;/a&gt;&lt;/code&gt; and</span>
<a name="gbab-1342"></a><span class="cm">                          &lt;code&gt;&lt;a href=&quot;#op_tell_func&quot;&gt;tell()&lt;/a&gt;&lt;/code&gt; may</span>
<a name="gbab-1343"></a><span class="cm">                          be &lt;code&gt;NULL&lt;/code&gt;, or may always return -1 to</span>
<a name="gbab-1344"></a><span class="cm">                          indicate a source is unseekable, but if</span>
<a name="gbab-1345"></a><span class="cm">                          &lt;code&gt;&lt;a href=&quot;#op_seek_func&quot;&gt;seek()&lt;/a&gt;&lt;/code&gt; is</span>
<a name="gbab-1346"></a><span class="cm">                          implemented and succeeds on a particular source, then</span>
<a name="gbab-1347"></a><span class="cm">                          &lt;code&gt;&lt;a href=&quot;#op_tell_func&quot;&gt;tell()&lt;/a&gt;&lt;/code&gt; must</span>
<a name="gbab-1348"></a><span class="cm">                          also.</span>
<a name="gbab-1349"></a><span class="cm">                         &lt;code&gt;&lt;a href=&quot;#op_close_func&quot;&gt;close()&lt;/a&gt;&lt;/code&gt; may</span>
<a name="gbab-1350"></a><span class="cm">                          be &lt;code&gt;NULL&lt;/code&gt;, but if it is not, it will be</span>
<a name="gbab-1351"></a><span class="cm">                          called when the \c OggOpusFile is destroyed by</span>
<a name="gbab-1352"></a><span class="cm">                          op_free().</span>
<a name="gbab-1353"></a><span class="cm">                         It will not be called if op_open_callbacks() fails</span>
<a name="gbab-1354"></a><span class="cm">                          with an error.</span>
<a name="gbab-1355"></a><span class="cm">   \param _initial_data  An initial buffer of data from the start of the</span>
<a name="gbab-1356"></a><span class="cm">                          stream.</span>
<a name="gbab-1357"></a><span class="cm">                         Applications can read some number of bytes from the</span>
<a name="gbab-1358"></a><span class="cm">                          start of the stream to help identify this as an Opus</span>
<a name="gbab-1359"></a><span class="cm">                          stream, and then provide them here to allow the</span>
<a name="gbab-1360"></a><span class="cm">                          stream to be tested more thoroughly, even if it is</span>
<a name="gbab-1361"></a><span class="cm">                          unseekable.</span>
<a name="gbab-1362"></a><span class="cm">   \param _initial_bytes The number of bytes in \a _initial_data.</span>
<a name="gbab-1363"></a><span class="cm">                         If the stream is seekable, its current position (as</span>
<a name="gbab-1364"></a><span class="cm">                          reported by</span>
<a name="gbab-1365"></a><span class="cm">                          &lt;code&gt;&lt;a href=&quot;#opus_tell_func&quot;&gt;tell()&lt;/a&gt;&lt;/code&gt;</span>
<a name="gbab-1366"></a><span class="cm">                          at the start of this function) must be equal to</span>
<a name="gbab-1367"></a><span class="cm">                          \a _initial_bytes.</span>
<a name="gbab-1368"></a><span class="cm">                         Otherwise, seeking to absolute positions will</span>
<a name="gbab-1369"></a><span class="cm">                          generate inconsistent results.</span>
<a name="gbab-1370"></a><span class="cm">   \param[out] _error    Returns 0 on success, or a failure code on error.</span>
<a name="gbab-1371"></a><span class="cm">                         You may pass in &lt;code&gt;NULL&lt;/code&gt; if you don&#39;t want</span>
<a name="gbab-1372"></a><span class="cm">                          the failure code.</span>
<a name="gbab-1373"></a><span class="cm">                         See op_open_callbacks() for a full list of failure</span>
<a name="gbab-1374"></a><span class="cm">                          codes.</span>
<a name="gbab-1375"></a><span class="cm">   \return A partially opened \c OggOpusFile, or &lt;code&gt;NULL&lt;/code&gt; on error.</span>
<a name="gbab-1376"></a><span class="cm">           &lt;tt&gt;libopusfile&lt;/tt&gt; does &lt;em&gt;not&lt;/em&gt; take ownership of the source</span>
<a name="gbab-1377"></a><span class="cm">            if the call fails.</span>
<a name="gbab-1378"></a><span class="cm">           The calling application is responsible for closing the source if</span>
<a name="gbab-1379"></a><span class="cm">            this call returns an error.*/</span>
<a name="gbab-1380"></a><span class="n">OP_WARN_UNUSED_RESULT</span> <span class="n">OggOpusFile</span> <span class="o">*</span><span class="nf">op_test_callbacks</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">_source</span><span class="p">,</span>
<a name="gbab-1381"></a> <span class="k">const</span> <span class="n">OpusFileCallbacks</span> <span class="o">*</span><span class="n">_cb</span><span class="p">,</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_initial_data</span><span class="p">,</span>
<a name="gbab-1382"></a> <span class="kt">size_t</span> <span class="n">_initial_bytes</span><span class="p">,</span><span class="kt">int</span> <span class="o">*</span><span class="n">_error</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<a name="gbab-1383"></a>
<a name="gbab-1384"></a><span class="cm">/**Finish opening a stream partially opened with op_test_callbacks() or one of</span>
<a name="gbab-1385"></a><span class="cm">    the associated convenience functions.</span>
<a name="gbab-1386"></a><span class="cm">   If this function fails, you are still responsible for freeing the</span>
<a name="gbab-1387"></a><span class="cm">    \c OggOpusFile with op_free().</span>
<a name="gbab-1388"></a><span class="cm">   \param _of The \c OggOpusFile to finish opening.</span>
<a name="gbab-1389"></a><span class="cm">   \return 0 on success, or a negative value on error.</span>
<a name="gbab-1390"></a><span class="cm">   \retval #OP_EREAD         An underlying read, seek, or tell operation failed</span>
<a name="gbab-1391"></a><span class="cm">                              when it should have succeeded.</span>
<a name="gbab-1392"></a><span class="cm">   \retval #OP_EFAULT        There was a memory allocation failure, or an</span>
<a name="gbab-1393"></a><span class="cm">                              internal library error.</span>
<a name="gbab-1394"></a><span class="cm">   \retval #OP_EIMPL         The stream used a feature that is not implemented,</span>
<a name="gbab-1395"></a><span class="cm">                              such as an unsupported channel family.</span>
<a name="gbab-1396"></a><span class="cm">   \retval #OP_EINVAL        The stream was not partially opened with</span>
<a name="gbab-1397"></a><span class="cm">                              op_test_callbacks() or one of the associated</span>
<a name="gbab-1398"></a><span class="cm">                              convenience functions.</span>
<a name="gbab-1399"></a><span class="cm">   \retval #OP_ENOTFORMAT    The stream contained a link that did not have any</span>
<a name="gbab-1400"></a><span class="cm">                              logical Opus streams in it.</span>
<a name="gbab-1401"></a><span class="cm">   \retval #OP_EBADHEADER    A required header packet was not properly</span>
<a name="gbab-1402"></a><span class="cm">                              formatted, contained illegal values, or was</span>
<a name="gbab-1403"></a><span class="cm">                              missing altogether.</span>
<a name="gbab-1404"></a><span class="cm">   \retval #OP_EVERSION      An ID header contained an unrecognized version</span>
<a name="gbab-1405"></a><span class="cm">                              number.</span>
<a name="gbab-1406"></a><span class="cm">   \retval #OP_EBADLINK      We failed to find data we had seen before after</span>
<a name="gbab-1407"></a><span class="cm">                              seeking.</span>
<a name="gbab-1408"></a><span class="cm">   \retval #OP_EBADTIMESTAMP The first or last timestamp in a link failed basic</span>
<a name="gbab-1409"></a><span class="cm">                              validity checks.*/</span>
<a name="gbab-1410"></a><span class="kt">int</span> <span class="nf">op_test_open</span><span class="p">(</span><span class="n">OggOpusFile</span> <span class="o">*</span><span class="n">_of</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a name="gbab-1411"></a>
<a name="gbab-1412"></a><span class="cm">/**Release all memory used by an \c OggOpusFile.</span>
<a name="gbab-1413"></a><span class="cm">   \param _of The \c OggOpusFile to free.*/</span>
<a name="gbab-1414"></a><span class="kt">void</span> <span class="nf">op_free</span><span class="p">(</span><span class="n">OggOpusFile</span> <span class="o">*</span><span class="n">_of</span><span class="p">);</span>
<a name="gbab-1415"></a>
<a name="gbab-1416"></a><span class="cm">/*@}*/</span>
<a name="gbab-1417"></a><span class="cm">/*@}*/</span>
<a name="gbab-1418"></a>
<a name="gbab-1419"></a><span class="cm">/**\defgroup stream_info Stream Information*/</span>
<a name="gbab-1420"></a><span class="cm">/*@{*/</span>
<a name="gbab-1421"></a><span class="cm">/**\name Functions for obtaining information about streams</span>
<a name="gbab-1422"></a>
<a name="gbab-1423"></a><span class="cm">   These functions allow you to get basic information about a stream, including</span>
<a name="gbab-1424"></a><span class="cm">    seekability, the number of links (for chained streams), plus the size,</span>
<a name="gbab-1425"></a><span class="cm">    duration, bitrate, header parameters, and meta information for each link</span>
<a name="gbab-1426"></a><span class="cm">    (or, where available, the stream as a whole).</span>
<a name="gbab-1427"></a><span class="cm">   Some of these (size, duration) are only available for seekable streams.</span>
<a name="gbab-1428"></a><span class="cm">   You can also query the current stream position, link, and playback time,</span>
<a name="gbab-1429"></a><span class="cm">    and instantaneous bitrate during playback.</span>
<a name="gbab-1430"></a>
<a name="gbab-1431"></a><span class="cm">   Some of these functions may be used successfully on the partially open</span>
<a name="gbab-1432"></a><span class="cm">    streams returned by op_test_callbacks() or one of the associated</span>
<a name="gbab-1433"></a><span class="cm">    convenience functions.</span>
<a name="gbab-1434"></a><span class="cm">   Their documention will indicate so explicitly.*/</span>
<a name="gbab-1435"></a><span class="cm">/*@{*/</span>
<a name="gbab-1436"></a>
<a name="gbab-1437"></a><span class="cm">/**Returns whether or not the data source being read is seekable.</span>
<a name="gbab-1438"></a><span class="cm">   This is true if</span>
<a name="gbab-1439"></a><span class="cm">   &lt;ol&gt;</span>
<a name="gbab-1440"></a><span class="cm">   &lt;li&gt;The &lt;code&gt;&lt;a href=&quot;#op_seek_func&quot;&gt;seek()&lt;/a&gt;&lt;/code&gt; and</span>
<a name="gbab-1441"></a><span class="cm">    &lt;code&gt;&lt;a href=&quot;#op_tell_func&quot;&gt;tell()&lt;/a&gt;&lt;/code&gt; callbacks are both</span>
<a name="gbab-1442"></a><span class="cm">    non-&lt;code&gt;NULL&lt;/code&gt;,&lt;/li&gt;</span>
<a name="gbab-1443"></a><span class="cm">   &lt;li&gt;The &lt;code&gt;&lt;a href=&quot;#op_seek_func&quot;&gt;seek()&lt;/a&gt;&lt;/code&gt; callback was</span>
<a name="gbab-1444"></a><span class="cm">    successfully executed at least once, and&lt;/li&gt;</span>
<a name="gbab-1445"></a><span class="cm">   &lt;li&gt;The &lt;code&gt;&lt;a href=&quot;#op_tell_func&quot;&gt;tell()&lt;/a&gt;&lt;/code&gt; callback was</span>
<a name="gbab-1446"></a><span class="cm">    successfully able to report the position indicator afterwards.&lt;/li&gt;</span>
<a name="gbab-1447"></a><span class="cm">   &lt;/ol&gt;</span>
<a name="gbab-1448"></a><span class="cm">   This function may be called on partially-opened streams.</span>
<a name="gbab-1449"></a><span class="cm">   \param _of The \c OggOpusFile whose seekable status is to be returned.</span>
<a name="gbab-1450"></a><span class="cm">   \return A non-zero value if seekable, and 0 if unseekable.*/</span>
<a name="gbab-1451"></a><span class="kt">int</span> <span class="nf">op_seekable</span><span class="p">(</span><span class="k">const</span> <span class="n">OggOpusFile</span> <span class="o">*</span><span class="n">_of</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a name="gbab-1452"></a>
<a name="gbab-1453"></a><span class="cm">/**Returns the number of links in this chained stream.</span>
<a name="gbab-1454"></a><span class="cm">   This function may be called on partially-opened streams, but it will always</span>
<a name="gbab-1455"></a><span class="cm">    return 1.</span>
<a name="gbab-1456"></a><span class="cm">   The actual number of links is not known until the stream is fully opened.</span>
<a name="gbab-1457"></a><span class="cm">   \param _of The \c OggOpusFile from which to retrieve the link count.</span>
<a name="gbab-1458"></a><span class="cm">   \return For fully-open seekable sources, this returns the total number of</span>
<a name="gbab-1459"></a><span class="cm">            links in the whole stream, which will be at least 1.</span>
<a name="gbab-1460"></a><span class="cm">           For partially-open or unseekable sources, this always returns 1.*/</span>
<a name="gbab-1461"></a><span class="kt">int</span> <span class="nf">op_link_count</span><span class="p">(</span><span class="k">const</span> <span class="n">OggOpusFile</span> <span class="o">*</span><span class="n">_of</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a name="gbab-1462"></a>
<a name="gbab-1463"></a><span class="cm">/**Get the serial number of the given link in a (possibly-chained) Ogg Opus</span>
<a name="gbab-1464"></a><span class="cm">    stream.</span>
<a name="gbab-1465"></a><span class="cm">   This function may be called on partially-opened streams, but it will always</span>
<a name="gbab-1466"></a><span class="cm">    return the serial number of the Opus stream in the first link.</span>
<a name="gbab-1467"></a><span class="cm">   \param _of The \c OggOpusFile from which to retrieve the serial number.</span>
<a name="gbab-1468"></a><span class="cm">   \param _li The index of the link whose serial number should be retrieved.</span>
<a name="gbab-1469"></a><span class="cm">              Use a negative number to get the serial number of the current</span>
<a name="gbab-1470"></a><span class="cm">               link.</span>
<a name="gbab-1471"></a><span class="cm">   \return The serial number of the given link.</span>
<a name="gbab-1472"></a><span class="cm">           If \a _li is greater than the total number of links, this returns</span>
<a name="gbab-1473"></a><span class="cm">            the serial number of the last link.</span>
<a name="gbab-1474"></a><span class="cm">           If the source is not seekable, this always returns the serial number</span>
<a name="gbab-1475"></a><span class="cm">            of the current link.*/</span>
<a name="gbab-1476"></a><span class="n">opus_uint32</span> <span class="nf">op_serialno</span><span class="p">(</span><span class="k">const</span> <span class="n">OggOpusFile</span> <span class="o">*</span><span class="n">_of</span><span class="p">,</span><span class="kt">int</span> <span class="n">_li</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a name="gbab-1477"></a>
<a name="gbab-1478"></a><span class="cm">/**Get the channel count of the given link in a (possibly-chained) Ogg Opus</span>
<a name="gbab-1479"></a><span class="cm">    stream.</span>
<a name="gbab-1480"></a><span class="cm">   This is equivalent to &lt;code&gt;op_head(_of,_li)-&gt;channel_count&lt;/code&gt;, but</span>
<a name="gbab-1481"></a><span class="cm">    is provided for convenience.</span>
<a name="gbab-1482"></a><span class="cm">   This function may be called on partially-opened streams, but it will always</span>
<a name="gbab-1483"></a><span class="cm">    return the channel count of the Opus stream in the first link.</span>
<a name="gbab-1484"></a><span class="cm">   \param _of The \c OggOpusFile from which to retrieve the channel count.</span>
<a name="gbab-1485"></a><span class="cm">   \param _li The index of the link whose channel count should be retrieved.</span>
<a name="gbab-1486"></a><span class="cm">              Use a negative number to get the channel count of the current</span>
<a name="gbab-1487"></a><span class="cm">               link.</span>
<a name="gbab-1488"></a><span class="cm">   \return The channel count of the given link.</span>
<a name="gbab-1489"></a><span class="cm">           If \a _li is greater than the total number of links, this returns</span>
<a name="gbab-1490"></a><span class="cm">            the channel count of the last link.</span>
<a name="gbab-1491"></a><span class="cm">           If the source is not seekable, this always returns the channel count</span>
<a name="gbab-1492"></a><span class="cm">            of the current link.*/</span>
<a name="gbab-1493"></a><span class="kt">int</span> <span class="nf">op_channel_count</span><span class="p">(</span><span class="k">const</span> <span class="n">OggOpusFile</span> <span class="o">*</span><span class="n">_of</span><span class="p">,</span><span class="kt">int</span> <span class="n">_li</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a name="gbab-1494"></a>
<a name="gbab-1495"></a><span class="cm">/**Get the total (compressed) size of the stream, or of an individual link in</span>
<a name="gbab-1496"></a><span class="cm">    a (possibly-chained) Ogg Opus stream, including all headers and Ogg muxing</span>
<a name="gbab-1497"></a><span class="cm">    overhead.</span>
<a name="gbab-1498"></a><span class="cm">   \warning If the Opus stream (or link) is concurrently multiplexed with other</span>
<a name="gbab-1499"></a><span class="cm">    logical streams (e.g., video), this returns the size of the entire stream</span>
<a name="gbab-1500"></a><span class="cm">    (or link), not just the number of bytes in the first logical Opus stream.</span>
<a name="gbab-1501"></a><span class="cm">   Returning the latter would require scanning the entire file.</span>
<a name="gbab-1502"></a><span class="cm">   \param _of The \c OggOpusFile from which to retrieve the compressed size.</span>
<a name="gbab-1503"></a><span class="cm">   \param _li The index of the link whose compressed size should be computed.</span>
<a name="gbab-1504"></a><span class="cm">              Use a negative number to get the compressed size of the entire</span>
<a name="gbab-1505"></a><span class="cm">               stream.</span>
<a name="gbab-1506"></a><span class="cm">   \return The compressed size of the entire stream if \a _li is negative, the</span>
<a name="gbab-1507"></a><span class="cm">            compressed size of link \a _li if it is non-negative, or a negative</span>
<a name="gbab-1508"></a><span class="cm">            value on error.</span>
<a name="gbab-1509"></a><span class="cm">           The compressed size of the entire stream may be smaller than that</span>
<a name="gbab-1510"></a><span class="cm">            of the underlying source if trailing garbage was detected in the</span>
<a name="gbab-1511"></a><span class="cm">            file.</span>
<a name="gbab-1512"></a><span class="cm">   \retval #OP_EINVAL The source is not seekable (so we can&#39;t know the length),</span>
<a name="gbab-1513"></a><span class="cm">                       \a _li wasn&#39;t less than the total number of links in</span>
<a name="gbab-1514"></a><span class="cm">                       the stream, or the stream was only partially open.*/</span>
<a name="gbab-1515"></a><span class="n">opus_int64</span> <span class="nf">op_raw_total</span><span class="p">(</span><span class="k">const</span> <span class="n">OggOpusFile</span> <span class="o">*</span><span class="n">_of</span><span class="p">,</span><span class="kt">int</span> <span class="n">_li</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a name="gbab-1516"></a>
<a name="gbab-1517"></a><span class="cm">/**Get the total PCM length (number of samples at 48 kHz) of the stream, or of</span>
<a name="gbab-1518"></a><span class="cm">    an individual link in a (possibly-chained) Ogg Opus stream.</span>
<a name="gbab-1519"></a><span class="cm">   Users looking for &lt;code&gt;op_time_total()&lt;/code&gt; should use op_pcm_total()</span>
<a name="gbab-1520"></a><span class="cm">    instead.</span>
<a name="gbab-1521"></a><span class="cm">   Because timestamps in Opus are fixed at 48 kHz, there is no need for a</span>
<a name="gbab-1522"></a><span class="cm">    separate function to convert this to seconds (and leaving it out avoids</span>
<a name="gbab-1523"></a><span class="cm">    introducing floating point to the API, for those that wish to avoid it).</span>
<a name="gbab-1524"></a><span class="cm">   \param _of The \c OggOpusFile from which to retrieve the PCM offset.</span>
<a name="gbab-1525"></a><span class="cm">   \param _li The index of the link whose PCM length should be computed.</span>
<a name="gbab-1526"></a><span class="cm">              Use a negative number to get the PCM length of the entire stream.</span>
<a name="gbab-1527"></a><span class="cm">   \return The PCM length of the entire stream if \a _li is negative, the PCM</span>
<a name="gbab-1528"></a><span class="cm">            length of link \a _li if it is non-negative, or a negative value on</span>
<a name="gbab-1529"></a><span class="cm">            error.</span>
<a name="gbab-1530"></a><span class="cm">   \retval #OP_EINVAL The source is not seekable (so we can&#39;t know the length),</span>
<a name="gbab-1531"></a><span class="cm">                       \a _li wasn&#39;t less than the total number of links in</span>
<a name="gbab-1532"></a><span class="cm">                       the stream, or the stream was only partially open.*/</span>
<a name="gbab-1533"></a><span class="n">ogg_int64_t</span> <span class="nf">op_pcm_total</span><span class="p">(</span><span class="k">const</span> <span class="n">OggOpusFile</span> <span class="o">*</span><span class="n">_of</span><span class="p">,</span><span class="kt">int</span> <span class="n">_li</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a name="gbab-1534"></a>
<a name="gbab-1535"></a><span class="cm">/**Get the ID header information for the given link in a (possibly chained) Ogg</span>
<a name="gbab-1536"></a><span class="cm">    Opus stream.</span>
<a name="gbab-1537"></a><span class="cm">   This function may be called on partially-opened streams, but it will always</span>
<a name="gbab-1538"></a><span class="cm">    return the ID header information of the Opus stream in the first link.</span>
<a name="gbab-1539"></a><span class="cm">   \param _of The \c OggOpusFile from which to retrieve the ID header</span>
<a name="gbab-1540"></a><span class="cm">               information.</span>
<a name="gbab-1541"></a><span class="cm">   \param _li The index of the link whose ID header information should be</span>
<a name="gbab-1542"></a><span class="cm">               retrieved.</span>
<a name="gbab-1543"></a><span class="cm">              Use a negative number to get the ID header information of the</span>
<a name="gbab-1544"></a><span class="cm">               current link.</span>
<a name="gbab-1545"></a><span class="cm">              For an unseekable stream, \a _li is ignored, and the ID header</span>
<a name="gbab-1546"></a><span class="cm">               information for the current link is always returned, if</span>
<a name="gbab-1547"></a><span class="cm">               available.</span>
<a name="gbab-1548"></a><span class="cm">   \return The contents of the ID header for the given link.*/</span>
<a name="gbab-1549"></a><span class="k">const</span> <span class="n">OpusHead</span> <span class="o">*</span><span class="nf">op_head</span><span class="p">(</span><span class="k">const</span> <span class="n">OggOpusFile</span> <span class="o">*</span><span class="n">_of</span><span class="p">,</span><span class="kt">int</span> <span class="n">_li</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a name="gbab-1550"></a>
<a name="gbab-1551"></a><span class="cm">/**Get the comment header information for the given link in a (possibly</span>
<a name="gbab-1552"></a><span class="cm">    chained) Ogg Opus stream.</span>
<a name="gbab-1553"></a><span class="cm">   This function may be called on partially-opened streams, but it will always</span>
<a name="gbab-1554"></a><span class="cm">    return the tags from the Opus stream in the first link.</span>
<a name="gbab-1555"></a><span class="cm">   \param _of The \c OggOpusFile from which to retrieve the comment header</span>
<a name="gbab-1556"></a><span class="cm">               information.</span>
<a name="gbab-1557"></a><span class="cm">   \param _li The index of the link whose comment header information should be</span>
<a name="gbab-1558"></a><span class="cm">               retrieved.</span>
<a name="gbab-1559"></a><span class="cm">              Use a negative number to get the comment header information of</span>
<a name="gbab-1560"></a><span class="cm">               the current link.</span>
<a name="gbab-1561"></a><span class="cm">              For an unseekable stream, \a _li is ignored, and the comment</span>
<a name="gbab-1562"></a><span class="cm">               header information for the current link is always returned, if</span>
<a name="gbab-1563"></a><span class="cm">               available.</span>
<a name="gbab-1564"></a><span class="cm">   \return The contents of the comment header for the given link, or</span>
<a name="gbab-1565"></a><span class="cm">            &lt;code&gt;NULL&lt;/code&gt; if this is an unseekable stream that encountered</span>
<a name="gbab-1566"></a><span class="cm">            an invalid link.*/</span>
<a name="gbab-1567"></a><span class="k">const</span> <span class="n">OpusTags</span> <span class="o">*</span><span class="nf">op_tags</span><span class="p">(</span><span class="k">const</span> <span class="n">OggOpusFile</span> <span class="o">*</span><span class="n">_of</span><span class="p">,</span><span class="kt">int</span> <span class="n">_li</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a name="gbab-1568"></a>
<a name="gbab-1569"></a><span class="cm">/**Retrieve the index of the current link.</span>
<a name="gbab-1570"></a><span class="cm">   This is the link that produced the data most recently read by</span>
<a name="gbab-1571"></a><span class="cm">    op_read_float() or its associated functions, or, after a seek, the link</span>
<a name="gbab-1572"></a><span class="cm">    that the seek target landed in.</span>
<a name="gbab-1573"></a><span class="cm">   Reading more data may advance the link index (even on the first read after a</span>
<a name="gbab-1574"></a><span class="cm">    seek).</span>
<a name="gbab-1575"></a><span class="cm">   \param _of The \c OggOpusFile from which to retrieve the current link index.</span>
<a name="gbab-1576"></a><span class="cm">   \return The index of the current link on success, or a negative value on</span>
<a name="gbab-1577"></a><span class="cm">            failure.</span>
<a name="gbab-1578"></a><span class="cm">           For seekable streams, this is a number between 0 and the value</span>
<a name="gbab-1579"></a><span class="cm">            returned by op_link_count().</span>
<a name="gbab-1580"></a><span class="cm">           For unseekable streams, this value starts at 0 and increments by one</span>
<a name="gbab-1581"></a><span class="cm">            each time a new link is encountered (even though op_link_count()</span>
<a name="gbab-1582"></a><span class="cm">            always returns 1).</span>
<a name="gbab-1583"></a><span class="cm">   \retval #OP_EINVAL The stream was only partially open.*/</span>
<a name="gbab-1584"></a><span class="kt">int</span> <span class="nf">op_current_link</span><span class="p">(</span><span class="k">const</span> <span class="n">OggOpusFile</span> <span class="o">*</span><span class="n">_of</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a name="gbab-1585"></a>
<a name="gbab-1586"></a><span class="cm">/**Computes the bitrate of the stream, or of an individual link in a</span>
<a name="gbab-1587"></a><span class="cm">    (possibly-chained) Ogg Opus stream.</span>
<a name="gbab-1588"></a><span class="cm">   The stream must be seekable to compute the bitrate.</span>
<a name="gbab-1589"></a><span class="cm">   For unseekable streams, use op_bitrate_instant() to get periodic estimates.</span>
<a name="gbab-1590"></a><span class="cm">   \warning If the Opus stream (or link) is concurrently multiplexed with other</span>
<a name="gbab-1591"></a><span class="cm">    logical streams (e.g., video), this uses the size of the entire stream (or</span>
<a name="gbab-1592"></a><span class="cm">    link) to compute the bitrate, not just the number of bytes in the first</span>
<a name="gbab-1593"></a><span class="cm">    logical Opus stream.</span>
<a name="gbab-1594"></a><span class="cm">   Returning the latter requires scanning the entire file, but this may be done</span>
<a name="gbab-1595"></a><span class="cm">    by decoding the whole file and calling op_bitrate_instant() once at the</span>
<a name="gbab-1596"></a><span class="cm">    end.</span>
<a name="gbab-1597"></a><span class="cm">   Install a trivial decoding callback with op_set_decode_callback() if you</span>
<a name="gbab-1598"></a><span class="cm">    wish to skip actual decoding during this process.</span>
<a name="gbab-1599"></a><span class="cm">   \param _of The \c OggOpusFile from which to retrieve the bitrate.</span>
<a name="gbab-1600"></a><span class="cm">   \param _li The index of the link whose bitrate should be computed.</span>
<a name="gbab-1601"></a><span class="cm">              Use a negative number to get the bitrate of the whole stream.</span>
<a name="gbab-1602"></a><span class="cm">   \return The bitrate on success, or a negative value on error.</span>
<a name="gbab-1603"></a><span class="cm">   \retval #OP_EINVAL The stream was only partially open, the stream was not</span>
<a name="gbab-1604"></a><span class="cm">                       seekable, or \a _li was larger than the number of</span>
<a name="gbab-1605"></a><span class="cm">                       links.*/</span>
<a name="gbab-1606"></a><span class="n">opus_int32</span> <span class="nf">op_bitrate</span><span class="p">(</span><span class="k">const</span> <span class="n">OggOpusFile</span> <span class="o">*</span><span class="n">_of</span><span class="p">,</span><span class="kt">int</span> <span class="n">_li</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a name="gbab-1607"></a>
<a name="gbab-1608"></a><span class="cm">/**Compute the instantaneous bitrate, measured as the ratio of bits to playable</span>
<a name="gbab-1609"></a><span class="cm">    samples decoded since a) the last call to op_bitrate_instant(), b) the last</span>
<a name="gbab-1610"></a><span class="cm">    seek, or c) the start of playback, whichever was most recent.</span>
<a name="gbab-1611"></a><span class="cm">   This will spike somewhat after a seek or at the start/end of a chain</span>
<a name="gbab-1612"></a><span class="cm">    boundary, as pre-skip, pre-roll, and end-trimming causes samples to be</span>
<a name="gbab-1613"></a><span class="cm">    decoded but not played.</span>
<a name="gbab-1614"></a><span class="cm">   \param _of The \c OggOpusFile from which to retrieve the bitrate.</span>
<a name="gbab-1615"></a><span class="cm">   \return The bitrate, in bits per second, or a negative value on error.</span>
<a name="gbab-1616"></a><span class="cm">   \retval #OP_FALSE  No data has been decoded since any of the events</span>
<a name="gbab-1617"></a><span class="cm">                       described above.</span>
<a name="gbab-1618"></a><span class="cm">   \retval #OP_EINVAL The stream was only partially open.*/</span>
<a name="gbab-1619"></a><span class="n">opus_int32</span> <span class="nf">op_bitrate_instant</span><span class="p">(</span><span class="n">OggOpusFile</span> <span class="o">*</span><span class="n">_of</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a name="gbab-1620"></a>
<a name="gbab-1621"></a><span class="cm">/**Obtain the current value of the position indicator for \a _of.</span>
<a name="gbab-1622"></a><span class="cm">   \param _of The \c OggOpusFile from which to retrieve the position indicator.</span>
<a name="gbab-1623"></a><span class="cm">   \return The byte position that is currently being read from.</span>
<a name="gbab-1624"></a><span class="cm">   \retval #OP_EINVAL The stream was only partially open.*/</span>
<a name="gbab-1625"></a><span class="n">opus_int64</span> <span class="nf">op_raw_tell</span><span class="p">(</span><span class="k">const</span> <span class="n">OggOpusFile</span> <span class="o">*</span><span class="n">_of</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a name="gbab-1626"></a>
<a name="gbab-1627"></a><span class="cm">/**Obtain the PCM offset of the next sample to be read.</span>
<a name="gbab-1628"></a><span class="cm">   If the stream is not properly timestamped, this might not increment by the</span>
<a name="gbab-1629"></a><span class="cm">    proper amount between reads, or even return monotonically increasing</span>
<a name="gbab-1630"></a><span class="cm">    values.</span>
<a name="gbab-1631"></a><span class="cm">   \param _of The \c OggOpusFile from which to retrieve the PCM offset.</span>
<a name="gbab-1632"></a><span class="cm">   \return The PCM offset of the next sample to be read.</span>
<a name="gbab-1633"></a><span class="cm">   \retval #OP_EINVAL The stream was only partially open.*/</span>
<a name="gbab-1634"></a><span class="n">ogg_int64_t</span> <span class="nf">op_pcm_tell</span><span class="p">(</span><span class="k">const</span> <span class="n">OggOpusFile</span> <span class="o">*</span><span class="n">_of</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a name="gbab-1635"></a>
<a name="gbab-1636"></a><span class="cm">/*@}*/</span>
<a name="gbab-1637"></a><span class="cm">/*@}*/</span>
<a name="gbab-1638"></a>
<a name="gbab-1639"></a><span class="cm">/**\defgroup stream_seeking Seeking*/</span>
<a name="gbab-1640"></a><span class="cm">/*@{*/</span>
<a name="gbab-1641"></a><span class="cm">/**\name Functions for seeking in Opus streams</span>
<a name="gbab-1642"></a>
<a name="gbab-1643"></a><span class="cm">   These functions let you seek in Opus streams, if the underlying source</span>
<a name="gbab-1644"></a><span class="cm">    support it.</span>
<a name="gbab-1645"></a><span class="cm">   Seeking is implemented for all built-in stream I/O routines, though some</span>
<a name="gbab-1646"></a><span class="cm">    individual sources may not be seekable (pipes, live HTTP streams, or HTTP</span>
<a name="gbab-1647"></a><span class="cm">    streams from a server that does not support &lt;code&gt;Range&lt;/code&gt; requests).</span>
<a name="gbab-1648"></a>
<a name="gbab-1649"></a><span class="cm">   op_raw_seek() is the fastest: it is guaranteed to perform at most one</span>
<a name="gbab-1650"></a><span class="cm">    physical seek, but, since the target is a byte position, makes no guarantee</span>
<a name="gbab-1651"></a><span class="cm">    how close to a given time it will come.</span>
<a name="gbab-1652"></a><span class="cm">   op_pcm_seek() provides sample-accurate seeking.</span>
<a name="gbab-1653"></a><span class="cm">   The number of physical seeks it requires is still quite small (often 1 or</span>
<a name="gbab-1654"></a><span class="cm">    2, even in highly variable bitrate streams).</span>
<a name="gbab-1655"></a>
<a name="gbab-1656"></a><span class="cm">   Seeking in Opus requires decoding some pre-roll amount before playback to</span>
<a name="gbab-1657"></a><span class="cm">    allow the internal state to converge (as if recovering from packet loss).</span>
<a name="gbab-1658"></a><span class="cm">   This is handled internally by &lt;tt&gt;libopusfile&lt;/tt&gt;, but means there is</span>
<a name="gbab-1659"></a><span class="cm">    little extra overhead for decoding up to the exact position requested</span>
<a name="gbab-1660"></a><span class="cm">    (since it must decode some amount of audio anyway).</span>
<a name="gbab-1661"></a><span class="cm">   It also means that decoding after seeking may not return exactly the same</span>
<a name="gbab-1662"></a><span class="cm">    values as would be obtained by decoding the stream straight through.</span>
<a name="gbab-1663"></a><span class="cm">   However, such differences are expected to be smaller than the loss</span>
<a name="gbab-1664"></a><span class="cm">    introduced by Opus&#39;s lossy compression.*/</span>
<a name="gbab-1665"></a><span class="cm">/*@{*/</span>
<a name="gbab-1666"></a>
<a name="gbab-1667"></a><span class="cm">/**Seek to a byte offset relative to the &lt;b&gt;compressed&lt;/b&gt; data.</span>
<a name="gbab-1668"></a><span class="cm">   This also scans packets to update the PCM cursor.</span>
<a name="gbab-1669"></a><span class="cm">   It will cross a logical bitstream boundary, but only if it can&#39;t get any</span>
<a name="gbab-1670"></a><span class="cm">    packets out of the tail of the link to which it seeks.</span>
<a name="gbab-1671"></a><span class="cm">   \param _of          The \c OggOpusFile in which to seek.</span>
<a name="gbab-1672"></a><span class="cm">   \param _byte_offset The byte position to seek to.</span>
<a name="gbab-1673"></a><span class="cm">   \return 0 on success, or a negative error code on failure.</span>
<a name="gbab-1674"></a><span class="cm">   \retval #OP_EREAD    The underlying seek operation failed.</span>
<a name="gbab-1675"></a><span class="cm">   \retval #OP_EINVAL   The stream was only partially open, or the target was</span>
<a name="gbab-1676"></a><span class="cm">                         outside the valid range for the stream.</span>
<a name="gbab-1677"></a><span class="cm">   \retval #OP_ENOSEEK  This stream is not seekable.</span>
<a name="gbab-1678"></a><span class="cm">   \retval #OP_EBADLINK Failed to initialize a decoder for a stream for an</span>
<a name="gbab-1679"></a><span class="cm">                         unknown reason.*/</span>
<a name="gbab-1680"></a><span class="kt">int</span> <span class="nf">op_raw_seek</span><span class="p">(</span><span class="n">OggOpusFile</span> <span class="o">*</span><span class="n">_of</span><span class="p">,</span><span class="n">opus_int64</span> <span class="n">_byte_offset</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a name="gbab-1681"></a>
<a name="gbab-1682"></a><span class="cm">/**Seek to the specified PCM offset, such that decoding will begin at exactly</span>
<a name="gbab-1683"></a><span class="cm">    the requested position.</span>
<a name="gbab-1684"></a><span class="cm">   \param _of         The \c OggOpusFile in which to seek.</span>
<a name="gbab-1685"></a><span class="cm">   \param _pcm_offset The PCM offset to seek to.</span>
<a name="gbab-1686"></a><span class="cm">                      This is in samples at 48 kHz relative to the start of the</span>
<a name="gbab-1687"></a><span class="cm">                       stream.</span>
<a name="gbab-1688"></a><span class="cm">   \return 0 on success, or a negative value on error.</span>
<a name="gbab-1689"></a><span class="cm">   \retval #OP_EREAD    An underlying read or seek operation failed.</span>
<a name="gbab-1690"></a><span class="cm">   \retval #OP_EINVAL   The stream was only partially open, or the target was</span>
<a name="gbab-1691"></a><span class="cm">                         outside the valid range for the stream.</span>
<a name="gbab-1692"></a><span class="cm">   \retval #OP_ENOSEEK  This stream is not seekable.</span>
<a name="gbab-1693"></a><span class="cm">   \retval #OP_EBADLINK We failed to find data we had seen before, or the</span>
<a name="gbab-1694"></a><span class="cm">                         bitstream structure was sufficiently malformed that</span>
<a name="gbab-1695"></a><span class="cm">                         seeking to the target destination was impossible.*/</span>
<a name="gbab-1696"></a><span class="kt">int</span> <span class="nf">op_pcm_seek</span><span class="p">(</span><span class="n">OggOpusFile</span> <span class="o">*</span><span class="n">_of</span><span class="p">,</span><span class="n">ogg_int64_t</span> <span class="n">_pcm_offset</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a name="gbab-1697"></a>
<a name="gbab-1698"></a><span class="cm">/*@}*/</span>
<a name="gbab-1699"></a><span class="cm">/*@}*/</span>
<a name="gbab-1700"></a>
<a name="gbab-1701"></a><span class="cm">/**\defgroup stream_decoding Decoding*/</span>
<a name="gbab-1702"></a><span class="cm">/*@{*/</span>
<a name="gbab-1703"></a><span class="cm">/**\name Functions for decoding audio data</span>
<a name="gbab-1704"></a>
<a name="gbab-1705"></a><span class="cm">   These functions retrieve actual decoded audio data from the stream.</span>
<a name="gbab-1706"></a><span class="cm">   The general functions, op_read() and op_read_float() return 16-bit or</span>
<a name="gbab-1707"></a><span class="cm">    floating-point output, both using native endian ordering.</span>
<a name="gbab-1708"></a><span class="cm">   The number of channels returned can change from link to link in a chained</span>
<a name="gbab-1709"></a><span class="cm">    stream.</span>
<a name="gbab-1710"></a><span class="cm">   There are special functions, op_read_stereo() and op_read_float_stereo(),</span>
<a name="gbab-1711"></a><span class="cm">    which always output two channels, to simplify applications which do not</span>
<a name="gbab-1712"></a><span class="cm">    wish to handle multichannel audio.</span>
<a name="gbab-1713"></a><span class="cm">   These downmix multichannel files to two channels, so they can always return</span>
<a name="gbab-1714"></a><span class="cm">    samples in the same format for every link in a chained file.</span>
<a name="gbab-1715"></a>
<a name="gbab-1716"></a><span class="cm">   If the rest of your audio processing chain can handle floating point, those</span>
<a name="gbab-1717"></a><span class="cm">    routines should be preferred, as floating point output avoids introducing</span>
<a name="gbab-1718"></a><span class="cm">    clipping and other issues which might be avoided entirely if, e.g., you</span>
<a name="gbab-1719"></a><span class="cm">    scale down the volume at some other stage.</span>
<a name="gbab-1720"></a><span class="cm">   However, if you intend to direct consume 16-bit samples, the conversion in</span>
<a name="gbab-1721"></a><span class="cm">    &lt;tt&gt;libopusfile&lt;/tt&gt; provides noise-shaping dithering and, if compiled</span>
<a name="gbab-1722"></a><span class="cm">    against &lt;tt&gt;libopus&lt;/tt&gt;&amp;nbsp;1.1 or later, soft-clipping prevention.</span>
<a name="gbab-1723"></a>
<a name="gbab-1724"></a><span class="cm">   &lt;tt&gt;libopusfile&lt;/tt&gt; can also be configured at compile time to use the</span>
<a name="gbab-1725"></a><span class="cm">    fixed-point &lt;tt&gt;libopus&lt;/tt&gt; API.</span>
<a name="gbab-1726"></a><span class="cm">   If so, &lt;tt&gt;libopusfile&lt;/tt&gt;&#39;s floating-point API may also be disabled.</span>
<a name="gbab-1727"></a><span class="cm">   In that configuration, nothing in &lt;tt&gt;libopusfile&lt;/tt&gt; will use any</span>
<a name="gbab-1728"></a><span class="cm">    floating-point operations, to simplify support on devices without an</span>
<a name="gbab-1729"></a><span class="cm">    adequate FPU.</span>
<a name="gbab-1730"></a>
<a name="gbab-1731"></a><span class="cm">   \warning HTTPS streams may be be vulnerable to truncation attacks if you do</span>
<a name="gbab-1732"></a><span class="cm">    not check the error return code from op_read_float() or its associated</span>
<a name="gbab-1733"></a><span class="cm">    functions.</span>
<a name="gbab-1734"></a><span class="cm">   If the remote peer does not close the connection gracefully (with a TLS</span>
<a name="gbab-1735"></a><span class="cm">    &quot;close notify&quot; message), these functions will return #OP_EREAD instead of 0</span>
<a name="gbab-1736"></a><span class="cm">    when they reach the end of the file.</span>
<a name="gbab-1737"></a><span class="cm">   If you are reading from an &lt;https:&gt; URL (particularly if seeking is not</span>
<a name="gbab-1738"></a><span class="cm">    supported), you should make sure to check for this error and warn the user</span>
<a name="gbab-1739"></a><span class="cm">    appropriately.*/</span>
<a name="gbab-1740"></a><span class="cm">/*@{*/</span>
<a name="gbab-1741"></a>
<a name="gbab-1742"></a><span class="cm">/**Indicates that the decoding callback should produce signed 16-bit</span>
<a name="gbab-1743"></a><span class="cm">    native-endian output samples.*/</span>
<a name="gbab-1744"></a><span class="cp">#define OP_DEC_FORMAT_SHORT (7008)</span>
<a name="gbab-1745"></a><span class="cm">/**Indicates that the decoding callback should produce 32-bit native-endian</span>
<a name="gbab-1746"></a><span class="cm">    float samples.*/</span>
<a name="gbab-1747"></a><span class="cp">#define OP_DEC_FORMAT_FLOAT (7040)</span>
<a name="gbab-1748"></a>
<a name="gbab-1749"></a><span class="cm">/**Indicates that the decoding callback did not decode anything, and that</span>
<a name="gbab-1750"></a><span class="cm">    &lt;tt&gt;libopusfile&lt;/tt&gt; should decode normally instead.*/</span>
<a name="gbab-1751"></a><span class="cp">#define OP_DEC_USE_DEFAULT  (6720)</span>
<a name="gbab-1752"></a>
<a name="gbab-1753"></a><span class="cm">/**Called to decode an Opus packet.</span>
<a name="gbab-1754"></a><span class="cm">   This should invoke the functional equivalent of opus_multistream_decode() or</span>
<a name="gbab-1755"></a><span class="cm">    opus_multistream_decode_float(), except that it returns 0 on success</span>
<a name="gbab-1756"></a><span class="cm">    instead of the number of decoded samples (which is known a priori).</span>
<a name="gbab-1757"></a><span class="cm">   \param _ctx       The application-provided callback context.</span>
<a name="gbab-1758"></a><span class="cm">   \param _decoder   The decoder to use to decode the packet.</span>
<a name="gbab-1759"></a><span class="cm">   \param[out] _pcm  The buffer to decode into.</span>
<a name="gbab-1760"></a><span class="cm">                     This will always have enough room for \a _nchannels of</span>
<a name="gbab-1761"></a><span class="cm">                      \a _nsamples samples, which should be placed into this</span>
<a name="gbab-1762"></a><span class="cm">                      buffer interleaved.</span>
<a name="gbab-1763"></a><span class="cm">   \param _op        The packet to decode.</span>
<a name="gbab-1764"></a><span class="cm">                     This will always have its granule position set to a valid</span>
<a name="gbab-1765"></a><span class="cm">                      value.</span>
<a name="gbab-1766"></a><span class="cm">   \param _nsamples  The number of samples expected from the packet.</span>
<a name="gbab-1767"></a><span class="cm">   \param _nchannels The number of channels expected from the packet.</span>
<a name="gbab-1768"></a><span class="cm">   \param _format    The desired sample output format.</span>
<a name="gbab-1769"></a><span class="cm">                     This is either #OP_DEC_FORMAT_SHORT or</span>
<a name="gbab-1770"></a><span class="cm">                      #OP_DEC_FORMAT_FLOAT.</span>
<a name="gbab-1771"></a><span class="cm">   \param _li        The index of the link from which this packet was decoded.</span>
<a name="gbab-1772"></a><span class="cm">   \return A non-negative value on success, or a negative value on error.</span>
<a name="gbab-1773"></a><span class="cm">           The error codes should be the same as those returned by</span>
<a name="gbab-1774"></a><span class="cm">            opus_multistream_decode() or opus_multistream_decode_float().</span>
<a name="gbab-1775"></a><span class="cm">   \retval 0                   Decoding was successful.</span>
<a name="gbab-1776"></a><span class="cm">                               The application has filled the buffer with</span>
<a name="gbab-1777"></a><span class="cm">                                exactly &lt;code&gt;\a _nsamples*\a</span>
<a name="gbab-1778"></a><span class="cm">                                _nchannels&lt;/code&gt; samples in the requested</span>
<a name="gbab-1779"></a><span class="cm">                                format.</span>
<a name="gbab-1780"></a><span class="cm">   \retval #OP_DEC_USE_DEFAULT No decoding was done.</span>
<a name="gbab-1781"></a><span class="cm">                               &lt;tt&gt;libopusfile&lt;/tt&gt; should decode normally</span>
<a name="gbab-1782"></a><span class="cm">                                instead.*/</span>
<a name="gbab-1783"></a><span class="k">typedef</span> <span class="nf">int</span> <span class="p">(</span><span class="o">*</span><span class="n">op_decode_cb_func</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="n">_ctx</span><span class="p">,</span><span class="n">OpusMSDecoder</span> <span class="o">*</span><span class="n">_decoder</span><span class="p">,</span><span class="kt">void</span> <span class="o">*</span><span class="n">_pcm</span><span class="p">,</span>
<a name="gbab-1784"></a> <span class="k">const</span> <span class="n">ogg_packet</span> <span class="o">*</span><span class="n">_op</span><span class="p">,</span><span class="kt">int</span> <span class="n">_nsamples</span><span class="p">,</span><span class="kt">int</span> <span class="n">_nchannels</span><span class="p">,</span><span class="kt">int</span> <span class="n">_format</span><span class="p">,</span><span class="kt">int</span> <span class="n">_li</span><span class="p">);</span>
<a name="gbab-1785"></a>
<a name="gbab-1786"></a><span class="cm">/**Sets the packet decode callback function.</span>
<a name="gbab-1787"></a><span class="cm">   This is called once for each packet that needs to be decoded.</span>
<a name="gbab-1788"></a><span class="cm">   A call to this function is no guarantee that the audio will eventually be</span>
<a name="gbab-1789"></a><span class="cm">    delivered to the application.</span>
<a name="gbab-1790"></a><span class="cm">   Some or all of the data from the packet may be discarded (i.e., at the</span>
<a name="gbab-1791"></a><span class="cm">    beginning or end of a link, or after a seek), however the callback is</span>
<a name="gbab-1792"></a><span class="cm">    required to provide all of it.</span>
<a name="gbab-1793"></a><span class="cm">   \param _of        The \c OggOpusFile on which to set the decode callback.</span>
<a name="gbab-1794"></a><span class="cm">   \param _decode_cb The callback function to call.</span>
<a name="gbab-1795"></a><span class="cm">                     This may be &lt;code&gt;NULL&lt;/code&gt; to disable calling the</span>
<a name="gbab-1796"></a><span class="cm">                      callback.</span>
<a name="gbab-1797"></a><span class="cm">   \param _ctx       The application-provided context pointer to pass to the</span>
<a name="gbab-1798"></a><span class="cm">                      callback on each call.*/</span>
<a name="gbab-1799"></a><span class="kt">void</span> <span class="nf">op_set_decode_callback</span><span class="p">(</span><span class="n">OggOpusFile</span> <span class="o">*</span><span class="n">_of</span><span class="p">,</span>
<a name="gbab-1800"></a> <span class="n">op_decode_cb_func</span> <span class="n">_decode_cb</span><span class="p">,</span><span class="kt">void</span> <span class="o">*</span><span class="n">_ctx</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a name="gbab-1801"></a>
<a name="gbab-1802"></a><span class="cm">/**Gain offset type that indicates that the provided offset is relative to the</span>
<a name="gbab-1803"></a><span class="cm">    header gain.</span>
<a name="gbab-1804"></a><span class="cm">   This is the default.*/</span>
<a name="gbab-1805"></a><span class="cp">#define OP_HEADER_GAIN   (0)</span>
<a name="gbab-1806"></a>
<a name="gbab-1807"></a><span class="cm">/**Gain offset type that indicates that the provided offset is relative to the</span>
<a name="gbab-1808"></a><span class="cm">    R128_ALBUM_GAIN value (if any), in addition to the header gain.*/</span>
<a name="gbab-1809"></a><span class="cp">#define OP_ALBUM_GAIN    (3007)</span>
<a name="gbab-1810"></a>
<a name="gbab-1811"></a><span class="cm">/**Gain offset type that indicates that the provided offset is relative to the</span>
<a name="gbab-1812"></a><span class="cm">    R128_TRACK_GAIN value (if any), in addition to the header gain.*/</span>
<a name="gbab-1813"></a><span class="cp">#define OP_TRACK_GAIN    (3008)</span>
<a name="gbab-1814"></a>
<a name="gbab-1815"></a><span class="cm">/**Gain offset type that indicates that the provided offset should be used as</span>
<a name="gbab-1816"></a><span class="cm">    the gain directly, without applying any the header or track gains.*/</span>
<a name="gbab-1817"></a><span class="cp">#define OP_ABSOLUTE_GAIN (3009)</span>
<a name="gbab-1818"></a>
<a name="gbab-1819"></a><span class="cm">/**Sets the gain to be used for decoded output.</span>
<a name="gbab-1820"></a><span class="cm">   By default, the gain in the header is applied with no additional offset.</span>
<a name="gbab-1821"></a><span class="cm">   The total gain (including header gain and/or track gain, if applicable, and</span>
<a name="gbab-1822"></a><span class="cm">    this offset), will be clamped to [-32768,32767]/256 dB.</span>
<a name="gbab-1823"></a><span class="cm">   This is more than enough to saturate or underflow 16-bit PCM.</span>
<a name="gbab-1824"></a><span class="cm">   \note The new gain will not be applied to any already buffered, decoded</span>
<a name="gbab-1825"></a><span class="cm">    output.</span>
<a name="gbab-1826"></a><span class="cm">   This means you cannot change it sample-by-sample, as at best it will be</span>
<a name="gbab-1827"></a><span class="cm">    updated packet-by-packet.</span>
<a name="gbab-1828"></a><span class="cm">   It is meant for setting a target volume level, rather than applying smooth</span>
<a name="gbab-1829"></a><span class="cm">    fades, etc.</span>
<a name="gbab-1830"></a><span class="cm">   \param _of             The \c OggOpusFile on which to set the gain offset.</span>
<a name="gbab-1831"></a><span class="cm">   \param _gain_type      One of #OP_HEADER_GAIN, #OP_ALBUM_GAIN,</span>
<a name="gbab-1832"></a><span class="cm">                           #OP_TRACK_GAIN, or #OP_ABSOLUTE_GAIN.</span>
<a name="gbab-1833"></a><span class="cm">   \param _gain_offset_q8 The gain offset to apply, in 1/256ths of a dB.</span>
<a name="gbab-1834"></a><span class="cm">   \return 0 on success or a negative value on error.</span>
<a name="gbab-1835"></a><span class="cm">   \retval #OP_EINVAL The \a _gain_type was unrecognized.*/</span>
<a name="gbab-1836"></a><span class="kt">int</span> <span class="nf">op_set_gain_offset</span><span class="p">(</span><span class="n">OggOpusFile</span> <span class="o">*</span><span class="n">_of</span><span class="p">,</span>
<a name="gbab-1837"></a> <span class="kt">int</span> <span class="n">_gain_type</span><span class="p">,</span><span class="n">opus_int32</span> <span class="n">_gain_offset_q8</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a name="gbab-1838"></a>
<a name="gbab-1839"></a><span class="cm">/**Sets whether or not dithering is enabled for 16-bit decoding.</span>
<a name="gbab-1840"></a><span class="cm">   By default, when &lt;tt&gt;libopusfile&lt;/tt&gt; is compiled to use floating-point</span>
<a name="gbab-1841"></a><span class="cm">    internally, calling op_read() or op_read_stereo() will first decode to</span>
<a name="gbab-1842"></a><span class="cm">    float, and then convert to fixed-point using noise-shaping dithering.</span>
<a name="gbab-1843"></a><span class="cm">   This flag can be used to disable that dithering.</span>
<a name="gbab-1844"></a><span class="cm">   When the application uses op_read_float() or op_read_float_stereo(), or when</span>
<a name="gbab-1845"></a><span class="cm">    the library has been compiled to decode directly to fixed point, this flag</span>
<a name="gbab-1846"></a><span class="cm">    has no effect.</span>
<a name="gbab-1847"></a><span class="cm">   \param _of      The \c OggOpusFile on which to enable or disable dithering.</span>
<a name="gbab-1848"></a><span class="cm">   \param _enabled A non-zero value to enable dithering, or 0 to disable it.*/</span>
<a name="gbab-1849"></a><span class="kt">void</span> <span class="nf">op_set_dither_enabled</span><span class="p">(</span><span class="n">OggOpusFile</span> <span class="o">*</span><span class="n">_of</span><span class="p">,</span><span class="kt">int</span> <span class="n">_enabled</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a name="gbab-1850"></a>
<a name="gbab-1851"></a><span class="cm">/**Reads more samples from the stream.</span>
<a name="gbab-1852"></a><span class="cm">   \note Although \a _buf_size must indicate the total number of values that</span>
<a name="gbab-1853"></a><span class="cm">    can be stored in \a _pcm, the return value is the number of samples</span>
<a name="gbab-1854"></a><span class="cm">    &lt;em&gt;per channel&lt;/em&gt;.</span>
<a name="gbab-1855"></a><span class="cm">   This is done because</span>
<a name="gbab-1856"></a><span class="cm">   &lt;ol&gt;</span>
<a name="gbab-1857"></a><span class="cm">   &lt;li&gt;The channel count cannot be known a priori (reading more samples might</span>
<a name="gbab-1858"></a><span class="cm">        advance us into the next link, with a different channel count), so</span>
<a name="gbab-1859"></a><span class="cm">        \a _buf_size cannot also be in units of samples per channel,&lt;/li&gt;</span>
<a name="gbab-1860"></a><span class="cm">   &lt;li&gt;Returning the samples per channel matches the &lt;code&gt;libopus&lt;/code&gt; API</span>
<a name="gbab-1861"></a><span class="cm">        as closely as we&#39;re able,&lt;/li&gt;</span>
<a name="gbab-1862"></a><span class="cm">   &lt;li&gt;Returning the total number of values instead of samples per channel</span>
<a name="gbab-1863"></a><span class="cm">        would mean the caller would need a division to compute the samples per</span>
<a name="gbab-1864"></a><span class="cm">        channel, and might worry about the possibility of getting back samples</span>
<a name="gbab-1865"></a><span class="cm">        for some channels and not others, and&lt;/li&gt;</span>
<a name="gbab-1866"></a><span class="cm">   &lt;li&gt;This approach is relatively fool-proof: if an application passes too</span>
<a name="gbab-1867"></a><span class="cm">        small a value to \a _buf_size, they will simply get fewer samples back,</span>
<a name="gbab-1868"></a><span class="cm">        and if they assume the return value is the total number of values, then</span>
<a name="gbab-1869"></a><span class="cm">        they will simply read too few (rather than reading too many and going</span>
<a name="gbab-1870"></a><span class="cm">        off the end of the buffer).&lt;/li&gt;</span>
<a name="gbab-1871"></a><span class="cm">   &lt;/ol&gt;</span>
<a name="gbab-1872"></a><span class="cm">   \param      _of       The \c OggOpusFile from which to read.</span>
<a name="gbab-1873"></a><span class="cm">   \param[out] _pcm      A buffer in which to store the output PCM samples, as</span>
<a name="gbab-1874"></a><span class="cm">                          signed native-endian 16-bit values at 48&amp;nbsp;kHz</span>
<a name="gbab-1875"></a><span class="cm">                          with a nominal range of &lt;code&gt;[-32768,32767)&lt;/code&gt;.</span>
<a name="gbab-1876"></a><span class="cm">                         Multiple channels are interleaved using the</span>
<a name="gbab-1877"></a><span class="cm">                          &lt;a href=&quot;http://www.xiph.org/vorbis/doc/Vorbis_I_spec.html#x1-800004.3.9&quot;&gt;Vorbis</span>
<a name="gbab-1878"></a><span class="cm">                          channel ordering&lt;/a&gt;.</span>
<a name="gbab-1879"></a><span class="cm">                         This must have room for at least \a _buf_size values.</span>
<a name="gbab-1880"></a><span class="cm">   \param      _buf_size The number of values that can be stored in \a _pcm.</span>
<a name="gbab-1881"></a><span class="cm">                         It is recommended that this be large enough for at</span>
<a name="gbab-1882"></a><span class="cm">                          least 120 ms of data at 48 kHz per channel (5760</span>
<a name="gbab-1883"></a><span class="cm">                          values per channel).</span>
<a name="gbab-1884"></a><span class="cm">                         Smaller buffers will simply return less data, possibly</span>
<a name="gbab-1885"></a><span class="cm">                          consuming more memory to buffer the data internally.</span>
<a name="gbab-1886"></a><span class="cm">                         &lt;tt&gt;libopusfile&lt;/tt&gt; may return less data than</span>
<a name="gbab-1887"></a><span class="cm">                          requested.</span>
<a name="gbab-1888"></a><span class="cm">                         If so, there is no guarantee that the remaining data</span>
<a name="gbab-1889"></a><span class="cm">                          in \a _pcm will be unmodified.</span>
<a name="gbab-1890"></a><span class="cm">   \param[out] _li       The index of the link this data was decoded from.</span>
<a name="gbab-1891"></a><span class="cm">                         You may pass &lt;code&gt;NULL&lt;/code&gt; if you do not need this</span>
<a name="gbab-1892"></a><span class="cm">                          information.</span>
<a name="gbab-1893"></a><span class="cm">                         If this function fails (returning a negative value),</span>
<a name="gbab-1894"></a><span class="cm">                          this parameter is left unset.</span>
<a name="gbab-1895"></a><span class="cm">   \return The number of samples read per channel on success, or a negative</span>
<a name="gbab-1896"></a><span class="cm">            value on failure.</span>
<a name="gbab-1897"></a><span class="cm">           The channel count can be retrieved on success by calling</span>
<a name="gbab-1898"></a><span class="cm">            &lt;code&gt;op_head(_of,*_li)&lt;/code&gt;.</span>
<a name="gbab-1899"></a><span class="cm">           The number of samples returned may be 0 if the buffer was too small</span>
<a name="gbab-1900"></a><span class="cm">            to store even a single sample for all channels, or if end-of-file</span>
<a name="gbab-1901"></a><span class="cm">            was reached.</span>
<a name="gbab-1902"></a><span class="cm">           The list of possible failure codes follows.</span>
<a name="gbab-1903"></a><span class="cm">           Most of them can only be returned by unseekable, chained streams</span>
<a name="gbab-1904"></a><span class="cm">            that encounter a new link.</span>
<a name="gbab-1905"></a><span class="cm">   \retval #OP_HOLE          There was a hole in the data, and some samples</span>
<a name="gbab-1906"></a><span class="cm">                              may have been skipped.</span>
<a name="gbab-1907"></a><span class="cm">                             Call this function again to continue decoding</span>
<a name="gbab-1908"></a><span class="cm">                              past the hole.</span>
<a name="gbab-1909"></a><span class="cm">   \retval #OP_EREAD         An underlying read operation failed.</span>
<a name="gbab-1910"></a><span class="cm">                             This may signal a truncation attack from an</span>
<a name="gbab-1911"></a><span class="cm">                              &lt;https:&gt; source.</span>
<a name="gbab-1912"></a><span class="cm">   \retval #OP_EFAULT        An internal memory allocation failed.</span>
<a name="gbab-1913"></a><span class="cm">   \retval #OP_EIMPL         An unseekable stream encountered a new link that</span>
<a name="gbab-1914"></a><span class="cm">                              used a feature that is not implemented, such as</span>
<a name="gbab-1915"></a><span class="cm">                              an unsupported channel family.</span>
<a name="gbab-1916"></a><span class="cm">   \retval #OP_EINVAL        The stream was only partially open.</span>
<a name="gbab-1917"></a><span class="cm">   \retval #OP_ENOTFORMAT    An unseekable stream encountered a new link that</span>
<a name="gbab-1918"></a><span class="cm">                              did not have any logical Opus streams in it.</span>
<a name="gbab-1919"></a><span class="cm">   \retval #OP_EBADHEADER    An unseekable stream encountered a new link with a</span>
<a name="gbab-1920"></a><span class="cm">                              required header packet that was not properly</span>
<a name="gbab-1921"></a><span class="cm">                              formatted, contained illegal values, or was</span>
<a name="gbab-1922"></a><span class="cm">                              missing altogether.</span>
<a name="gbab-1923"></a><span class="cm">   \retval #OP_EVERSION      An unseekable stream encountered a new link with</span>
<a name="gbab-1924"></a><span class="cm">                              an ID header that contained an unrecognized</span>
<a name="gbab-1925"></a><span class="cm">                              version number.</span>
<a name="gbab-1926"></a><span class="cm">   \retval #OP_EBADPACKET    Failed to properly decode the next packet.</span>
<a name="gbab-1927"></a><span class="cm">   \retval #OP_EBADLINK      We failed to find data we had seen before.</span>
<a name="gbab-1928"></a><span class="cm">   \retval #OP_EBADTIMESTAMP An unseekable stream encountered a new link with</span>
<a name="gbab-1929"></a><span class="cm">                              a starting timestamp that failed basic validity</span>
<a name="gbab-1930"></a><span class="cm">                              checks.*/</span>
<a name="gbab-1931"></a><span class="n">OP_WARN_UNUSED_RESULT</span> <span class="kt">int</span> <span class="nf">op_read</span><span class="p">(</span><span class="n">OggOpusFile</span> <span class="o">*</span><span class="n">_of</span><span class="p">,</span>
<a name="gbab-1932"></a> <span class="n">opus_int16</span> <span class="o">*</span><span class="n">_pcm</span><span class="p">,</span><span class="kt">int</span> <span class="n">_buf_size</span><span class="p">,</span><span class="kt">int</span> <span class="o">*</span><span class="n">_li</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a name="gbab-1933"></a>
<a name="gbab-1934"></a><span class="cm">/**Reads more samples from the stream.</span>
<a name="gbab-1935"></a><span class="cm">   \note Although \a _buf_size must indicate the total number of values that</span>
<a name="gbab-1936"></a><span class="cm">    can be stored in \a _pcm, the return value is the number of samples</span>
<a name="gbab-1937"></a><span class="cm">    &lt;em&gt;per channel&lt;/em&gt;.</span>
<a name="gbab-1938"></a><span class="cm">   &lt;ol&gt;</span>
<a name="gbab-1939"></a><span class="cm">   &lt;li&gt;The channel count cannot be known a priori (reading more samples might</span>
<a name="gbab-1940"></a><span class="cm">        advance us into the next link, with a different channel count), so</span>
<a name="gbab-1941"></a><span class="cm">        \a _buf_size cannot also be in units of samples per channel,&lt;/li&gt;</span>
<a name="gbab-1942"></a><span class="cm">   &lt;li&gt;Returning the samples per channel matches the &lt;code&gt;libopus&lt;/code&gt; API</span>
<a name="gbab-1943"></a><span class="cm">        as closely as we&#39;re able,&lt;/li&gt;</span>
<a name="gbab-1944"></a><span class="cm">   &lt;li&gt;Returning the total number of values instead of samples per channel</span>
<a name="gbab-1945"></a><span class="cm">        would mean the caller would need a division to compute the samples per</span>
<a name="gbab-1946"></a><span class="cm">        channel, and might worry about the possibility of getting back samples</span>
<a name="gbab-1947"></a><span class="cm">        for some channels and not others, and&lt;/li&gt;</span>
<a name="gbab-1948"></a><span class="cm">   &lt;li&gt;This approach is relatively fool-proof: if an application passes too</span>
<a name="gbab-1949"></a><span class="cm">        small a value to \a _buf_size, they will simply get fewer samples back,</span>
<a name="gbab-1950"></a><span class="cm">        and if they assume the return value is the total number of values, then</span>
<a name="gbab-1951"></a><span class="cm">        they will simply read too few (rather than reading too many and going</span>
<a name="gbab-1952"></a><span class="cm">        off the end of the buffer).&lt;/li&gt;</span>
<a name="gbab-1953"></a><span class="cm">   &lt;/ol&gt;</span>
<a name="gbab-1954"></a><span class="cm">   \param      _of       The \c OggOpusFile from which to read.</span>
<a name="gbab-1955"></a><span class="cm">   \param[out] _pcm      A buffer in which to store the output PCM samples as</span>
<a name="gbab-1956"></a><span class="cm">                          signed floats at 48&amp;nbsp;kHz with a nominal range of</span>
<a name="gbab-1957"></a><span class="cm">                          &lt;code&gt;[-1.0,1.0]&lt;/code&gt;.</span>
<a name="gbab-1958"></a><span class="cm">                         Multiple channels are interleaved using the</span>
<a name="gbab-1959"></a><span class="cm">                          &lt;a href=&quot;http://www.xiph.org/vorbis/doc/Vorbis_I_spec.html#x1-800004.3.9&quot;&gt;Vorbis</span>
<a name="gbab-1960"></a><span class="cm">                          channel ordering&lt;/a&gt;.</span>
<a name="gbab-1961"></a><span class="cm">                         This must have room for at least \a _buf_size floats.</span>
<a name="gbab-1962"></a><span class="cm">   \param      _buf_size The number of floats that can be stored in \a _pcm.</span>
<a name="gbab-1963"></a><span class="cm">                         It is recommended that this be large enough for at</span>
<a name="gbab-1964"></a><span class="cm">                          least 120 ms of data at 48 kHz per channel (5760</span>
<a name="gbab-1965"></a><span class="cm">                          samples per channel).</span>
<a name="gbab-1966"></a><span class="cm">                         Smaller buffers will simply return less data, possibly</span>
<a name="gbab-1967"></a><span class="cm">                          consuming more memory to buffer the data internally.</span>
<a name="gbab-1968"></a><span class="cm">                         If less than \a _buf_size values are returned,</span>
<a name="gbab-1969"></a><span class="cm">                          &lt;tt&gt;libopusfile&lt;/tt&gt; makes no guarantee that the</span>
<a name="gbab-1970"></a><span class="cm">                          remaining data in \a _pcm will be unmodified.</span>
<a name="gbab-1971"></a><span class="cm">   \param[out] _li       The index of the link this data was decoded from.</span>
<a name="gbab-1972"></a><span class="cm">                         You may pass &lt;code&gt;NULL&lt;/code&gt; if you do not need this</span>
<a name="gbab-1973"></a><span class="cm">                          information.</span>
<a name="gbab-1974"></a><span class="cm">                         If this function fails (returning a negative value),</span>
<a name="gbab-1975"></a><span class="cm">                          this parameter is left unset.</span>
<a name="gbab-1976"></a><span class="cm">   \return The number of samples read per channel on success, or a negative</span>
<a name="gbab-1977"></a><span class="cm">            value on failure.</span>
<a name="gbab-1978"></a><span class="cm">           The channel count can be retrieved on success by calling</span>
<a name="gbab-1979"></a><span class="cm">            &lt;code&gt;op_head(_of,*_li)&lt;/code&gt;.</span>
<a name="gbab-1980"></a><span class="cm">           The number of samples returned may be 0 if the buffer was too small</span>
<a name="gbab-1981"></a><span class="cm">            to store even a single sample for all channels, or if end-of-file</span>
<a name="gbab-1982"></a><span class="cm">            was reached.</span>
<a name="gbab-1983"></a><span class="cm">           The list of possible failure codes follows.</span>
<a name="gbab-1984"></a><span class="cm">           Most of them can only be returned by unseekable, chained streams</span>
<a name="gbab-1985"></a><span class="cm">            that encounter a new link.</span>
<a name="gbab-1986"></a><span class="cm">   \retval #OP_HOLE          There was a hole in the data, and some samples</span>
<a name="gbab-1987"></a><span class="cm">                              may have been skipped.</span>
<a name="gbab-1988"></a><span class="cm">                             Call this function again to continue decoding</span>
<a name="gbab-1989"></a><span class="cm">                              past the hole.</span>
<a name="gbab-1990"></a><span class="cm">   \retval #OP_EREAD         An underlying read operation failed.</span>
<a name="gbab-1991"></a><span class="cm">                             This may signal a truncation attack from an</span>
<a name="gbab-1992"></a><span class="cm">                              &lt;https:&gt; source.</span>
<a name="gbab-1993"></a><span class="cm">   \retval #OP_EFAULT        An internal memory allocation failed.</span>
<a name="gbab-1994"></a><span class="cm">   \retval #OP_EIMPL         An unseekable stream encountered a new link that</span>
<a name="gbab-1995"></a><span class="cm">                              used a feature that is not implemented, such as</span>
<a name="gbab-1996"></a><span class="cm">                              an unsupported channel family.</span>
<a name="gbab-1997"></a><span class="cm">   \retval #OP_EINVAL        The stream was only partially open.</span>
<a name="gbab-1998"></a><span class="cm">   \retval #OP_ENOTFORMAT    An unseekable stream encountered a new link that</span>
<a name="gbab-1999"></a><span class="cm">                              did not have any logical Opus streams in it.</span>
<a name="gbab-2000"></a><span class="cm">   \retval #OP_EBADHEADER    An unseekable stream encountered a new link with a</span>
<a name="gbab-2001"></a><span class="cm">                              required header packet that was not properly</span>
<a name="gbab-2002"></a><span class="cm">                              formatted, contained illegal values, or was</span>
<a name="gbab-2003"></a><span class="cm">                              missing altogether.</span>
<a name="gbab-2004"></a><span class="cm">   \retval #OP_EVERSION      An unseekable stream encountered a new link with</span>
<a name="gbab-2005"></a><span class="cm">                              an ID header that contained an unrecognized</span>
<a name="gbab-2006"></a><span class="cm">                              version number.</span>
<a name="gbab-2007"></a><span class="cm">   \retval #OP_EBADPACKET    Failed to properly decode the next packet.</span>
<a name="gbab-2008"></a><span class="cm">   \retval #OP_EBADLINK      We failed to find data we had seen before.</span>
<a name="gbab-2009"></a><span class="cm">   \retval #OP_EBADTIMESTAMP An unseekable stream encountered a new link with</span>
<a name="gbab-2010"></a><span class="cm">                              a starting timestamp that failed basic validity</span>
<a name="gbab-2011"></a><span class="cm">                              checks.*/</span>
<a name="gbab-2012"></a><span class="n">OP_WARN_UNUSED_RESULT</span> <span class="kt">int</span> <span class="nf">op_read_float</span><span class="p">(</span><span class="n">OggOpusFile</span> <span class="o">*</span><span class="n">_of</span><span class="p">,</span>
<a name="gbab-2013"></a> <span class="kt">float</span> <span class="o">*</span><span class="n">_pcm</span><span class="p">,</span><span class="kt">int</span> <span class="n">_buf_size</span><span class="p">,</span><span class="kt">int</span> <span class="o">*</span><span class="n">_li</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a name="gbab-2014"></a>
<a name="gbab-2015"></a><span class="cm">/**Reads more samples from the stream and downmixes to stereo, if necessary.</span>
<a name="gbab-2016"></a><span class="cm">   This function is intended for simple players that want a uniform output</span>
<a name="gbab-2017"></a><span class="cm">    format, even if the channel count changes between links in a chained</span>
<a name="gbab-2018"></a><span class="cm">    stream.</span>
<a name="gbab-2019"></a><span class="cm">   \note \a _buf_size indicates the total number of values that can be stored</span>
<a name="gbab-2020"></a><span class="cm">    in \a _pcm, while the return value is the number of samples &lt;em&gt;per</span>
<a name="gbab-2021"></a><span class="cm">    channel&lt;/em&gt;, even though the channel count is known, for consistency with</span>
<a name="gbab-2022"></a><span class="cm">    op_read().</span>
<a name="gbab-2023"></a><span class="cm">   \param      _of       The \c OggOpusFile from which to read.</span>
<a name="gbab-2024"></a><span class="cm">   \param[out] _pcm      A buffer in which to store the output PCM samples, as</span>
<a name="gbab-2025"></a><span class="cm">                          signed native-endian 16-bit values at 48&amp;nbsp;kHz</span>
<a name="gbab-2026"></a><span class="cm">                          with a nominal range of &lt;code&gt;[-32768,32767)&lt;/code&gt;.</span>
<a name="gbab-2027"></a><span class="cm">                         The left and right channels are interleaved in the</span>
<a name="gbab-2028"></a><span class="cm">                          buffer.</span>
<a name="gbab-2029"></a><span class="cm">                         This must have room for at least \a _buf_size values.</span>
<a name="gbab-2030"></a><span class="cm">   \param      _buf_size The number of values that can be stored in \a _pcm.</span>
<a name="gbab-2031"></a><span class="cm">                         It is recommended that this be large enough for at</span>
<a name="gbab-2032"></a><span class="cm">                          least 120 ms of data at 48 kHz per channel (11520</span>
<a name="gbab-2033"></a><span class="cm">                          values total).</span>
<a name="gbab-2034"></a><span class="cm">                         Smaller buffers will simply return less data, possibly</span>
<a name="gbab-2035"></a><span class="cm">                          consuming more memory to buffer the data internally.</span>
<a name="gbab-2036"></a><span class="cm">                         If less than \a _buf_size values are returned,</span>
<a name="gbab-2037"></a><span class="cm">                          &lt;tt&gt;libopusfile&lt;/tt&gt; makes no guarantee that the</span>
<a name="gbab-2038"></a><span class="cm">                          remaining data in \a _pcm will be unmodified.</span>
<a name="gbab-2039"></a><span class="cm">   \return The number of samples read per channel on success, or a negative</span>
<a name="gbab-2040"></a><span class="cm">            value on failure.</span>
<a name="gbab-2041"></a><span class="cm">           The number of samples returned may be 0 if the buffer was too small</span>
<a name="gbab-2042"></a><span class="cm">            to store even a single sample for both channels, or if end-of-file</span>
<a name="gbab-2043"></a><span class="cm">            was reached.</span>
<a name="gbab-2044"></a><span class="cm">           The list of possible failure codes follows.</span>
<a name="gbab-2045"></a><span class="cm">           Most of them can only be returned by unseekable, chained streams</span>
<a name="gbab-2046"></a><span class="cm">            that encounter a new link.</span>
<a name="gbab-2047"></a><span class="cm">   \retval #OP_HOLE          There was a hole in the data, and some samples</span>
<a name="gbab-2048"></a><span class="cm">                              may have been skipped.</span>
<a name="gbab-2049"></a><span class="cm">                             Call this function again to continue decoding</span>
<a name="gbab-2050"></a><span class="cm">                              past the hole.</span>
<a name="gbab-2051"></a><span class="cm">   \retval #OP_EREAD         An underlying read operation failed.</span>
<a name="gbab-2052"></a><span class="cm">                             This may signal a truncation attack from an</span>
<a name="gbab-2053"></a><span class="cm">                              &lt;https:&gt; source.</span>
<a name="gbab-2054"></a><span class="cm">   \retval #OP_EFAULT        An internal memory allocation failed.</span>
<a name="gbab-2055"></a><span class="cm">   \retval #OP_EIMPL         An unseekable stream encountered a new link that</span>
<a name="gbab-2056"></a><span class="cm">                              used a feature that is not implemented, such as</span>
<a name="gbab-2057"></a><span class="cm">                              an unsupported channel family.</span>
<a name="gbab-2058"></a><span class="cm">   \retval #OP_EINVAL        The stream was only partially open.</span>
<a name="gbab-2059"></a><span class="cm">   \retval #OP_ENOTFORMAT    An unseekable stream encountered a new link that</span>
<a name="gbab-2060"></a><span class="cm">                              did not have any logical Opus streams in it.</span>
<a name="gbab-2061"></a><span class="cm">   \retval #OP_EBADHEADER    An unseekable stream encountered a new link with a</span>
<a name="gbab-2062"></a><span class="cm">                              required header packet that was not properly</span>
<a name="gbab-2063"></a><span class="cm">                              formatted, contained illegal values, or was</span>
<a name="gbab-2064"></a><span class="cm">                              missing altogether.</span>
<a name="gbab-2065"></a><span class="cm">   \retval #OP_EVERSION      An unseekable stream encountered a new link with</span>
<a name="gbab-2066"></a><span class="cm">                              an ID header that contained an unrecognized</span>
<a name="gbab-2067"></a><span class="cm">                              version number.</span>
<a name="gbab-2068"></a><span class="cm">   \retval #OP_EBADPACKET    Failed to properly decode the next packet.</span>
<a name="gbab-2069"></a><span class="cm">   \retval #OP_EBADLINK      We failed to find data we had seen before.</span>
<a name="gbab-2070"></a><span class="cm">   \retval #OP_EBADTIMESTAMP An unseekable stream encountered a new link with</span>
<a name="gbab-2071"></a><span class="cm">                              a starting timestamp that failed basic validity</span>
<a name="gbab-2072"></a><span class="cm">                              checks.*/</span>
<a name="gbab-2073"></a><span class="n">OP_WARN_UNUSED_RESULT</span> <span class="kt">int</span> <span class="nf">op_read_stereo</span><span class="p">(</span><span class="n">OggOpusFile</span> <span class="o">*</span><span class="n">_of</span><span class="p">,</span>
<a name="gbab-2074"></a> <span class="n">opus_int16</span> <span class="o">*</span><span class="n">_pcm</span><span class="p">,</span><span class="kt">int</span> <span class="n">_buf_size</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a name="gbab-2075"></a>
<a name="gbab-2076"></a><span class="cm">/**Reads more samples from the stream and downmixes to stereo, if necessary.</span>
<a name="gbab-2077"></a><span class="cm">   This function is intended for simple players that want a uniform output</span>
<a name="gbab-2078"></a><span class="cm">    format, even if the channel count changes between links in a chained</span>
<a name="gbab-2079"></a><span class="cm">    stream.</span>
<a name="gbab-2080"></a><span class="cm">   \note \a _buf_size indicates the total number of values that can be stored</span>
<a name="gbab-2081"></a><span class="cm">    in \a _pcm, while the return value is the number of samples &lt;em&gt;per</span>
<a name="gbab-2082"></a><span class="cm">    channel&lt;/em&gt;, even though the channel count is known, for consistency with</span>
<a name="gbab-2083"></a><span class="cm">    op_read_float().</span>
<a name="gbab-2084"></a><span class="cm">   \param      _of       The \c OggOpusFile from which to read.</span>
<a name="gbab-2085"></a><span class="cm">   \param[out] _pcm      A buffer in which to store the output PCM samples, as</span>
<a name="gbab-2086"></a><span class="cm">                          signed floats at 48&amp;nbsp;kHz with a nominal range of</span>
<a name="gbab-2087"></a><span class="cm">                          &lt;code&gt;[-1.0,1.0]&lt;/code&gt;.</span>
<a name="gbab-2088"></a><span class="cm">                         The left and right channels are interleaved in the</span>
<a name="gbab-2089"></a><span class="cm">                          buffer.</span>
<a name="gbab-2090"></a><span class="cm">                         This must have room for at least \a _buf_size values.</span>
<a name="gbab-2091"></a><span class="cm">   \param      _buf_size The number of values that can be stored in \a _pcm.</span>
<a name="gbab-2092"></a><span class="cm">                         It is recommended that this be large enough for at</span>
<a name="gbab-2093"></a><span class="cm">                          least 120 ms of data at 48 kHz per channel (11520</span>
<a name="gbab-2094"></a><span class="cm">                          values total).</span>
<a name="gbab-2095"></a><span class="cm">                         Smaller buffers will simply return less data, possibly</span>
<a name="gbab-2096"></a><span class="cm">                          consuming more memory to buffer the data internally.</span>
<a name="gbab-2097"></a><span class="cm">                         If less than \a _buf_size values are returned,</span>
<a name="gbab-2098"></a><span class="cm">                          &lt;tt&gt;libopusfile&lt;/tt&gt; makes no guarantee that the</span>
<a name="gbab-2099"></a><span class="cm">                          remaining data in \a _pcm will be unmodified.</span>
<a name="gbab-2100"></a><span class="cm">   \return The number of samples read per channel on success, or a negative</span>
<a name="gbab-2101"></a><span class="cm">            value on failure.</span>
<a name="gbab-2102"></a><span class="cm">           The number of samples returned may be 0 if the buffer was too small</span>
<a name="gbab-2103"></a><span class="cm">            to store even a single sample for both channels, or if end-of-file</span>
<a name="gbab-2104"></a><span class="cm">            was reached.</span>
<a name="gbab-2105"></a><span class="cm">           The list of possible failure codes follows.</span>
<a name="gbab-2106"></a><span class="cm">           Most of them can only be returned by unseekable, chained streams</span>
<a name="gbab-2107"></a><span class="cm">            that encounter a new link.</span>
<a name="gbab-2108"></a><span class="cm">   \retval #OP_HOLE          There was a hole in the data, and some samples</span>
<a name="gbab-2109"></a><span class="cm">                              may have been skipped.</span>
<a name="gbab-2110"></a><span class="cm">                             Call this function again to continue decoding</span>
<a name="gbab-2111"></a><span class="cm">                              past the hole.</span>
<a name="gbab-2112"></a><span class="cm">   \retval #OP_EREAD         An underlying read operation failed.</span>
<a name="gbab-2113"></a><span class="cm">                             This may signal a truncation attack from an</span>
<a name="gbab-2114"></a><span class="cm">                              &lt;https:&gt; source.</span>
<a name="gbab-2115"></a><span class="cm">   \retval #OP_EFAULT        An internal memory allocation failed.</span>
<a name="gbab-2116"></a><span class="cm">   \retval #OP_EIMPL         An unseekable stream encountered a new link that</span>
<a name="gbab-2117"></a><span class="cm">                              used a feature that is not implemented, such as</span>
<a name="gbab-2118"></a><span class="cm">                              an unsupported channel family.</span>
<a name="gbab-2119"></a><span class="cm">   \retval #OP_EINVAL        The stream was only partially open.</span>
<a name="gbab-2120"></a><span class="cm">   \retval #OP_ENOTFORMAT    An unseekable stream encountered a new link that</span>
<a name="gbab-2121"></a><span class="cm">                              that did not have any logical Opus streams in it.</span>
<a name="gbab-2122"></a><span class="cm">   \retval #OP_EBADHEADER    An unseekable stream encountered a new link with a</span>
<a name="gbab-2123"></a><span class="cm">                              required header packet that was not properly</span>
<a name="gbab-2124"></a><span class="cm">                              formatted, contained illegal values, or was</span>
<a name="gbab-2125"></a><span class="cm">                              missing altogether.</span>
<a name="gbab-2126"></a><span class="cm">   \retval #OP_EVERSION      An unseekable stream encountered a new link with</span>
<a name="gbab-2127"></a><span class="cm">                              an ID header that contained an unrecognized</span>
<a name="gbab-2128"></a><span class="cm">                              version number.</span>
<a name="gbab-2129"></a><span class="cm">   \retval #OP_EBADPACKET    Failed to properly decode the next packet.</span>
<a name="gbab-2130"></a><span class="cm">   \retval #OP_EBADLINK      We failed to find data we had seen before.</span>
<a name="gbab-2131"></a><span class="cm">   \retval #OP_EBADTIMESTAMP An unseekable stream encountered a new link with</span>
<a name="gbab-2132"></a><span class="cm">                              a starting timestamp that failed basic validity</span>
<a name="gbab-2133"></a><span class="cm">                              checks.*/</span>
<a name="gbab-2134"></a><span class="n">OP_WARN_UNUSED_RESULT</span> <span class="kt">int</span> <span class="nf">op_read_float_stereo</span><span class="p">(</span><span class="n">OggOpusFile</span> <span class="o">*</span><span class="n">_of</span><span class="p">,</span>
<a name="gbab-2135"></a> <span class="kt">float</span> <span class="o">*</span><span class="n">_pcm</span><span class="p">,</span><span class="kt">int</span> <span class="n">_buf_size</span><span class="p">)</span> <span class="n">OP_ARG_NONNULL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a name="gbab-2136"></a>
<a name="gbab-2137"></a><span class="cm">/*@}*/</span>
<a name="gbab-2138"></a><span class="cm">/*@}*/</span>
<a name="gbab-2139"></a>
<a name="gbab-2140"></a><span class="cp"># if OP_GNUC_PREREQ(4,0)</span>
<a name="gbab-2141"></a><span class="cp">#  pragma GCC visibility pop</span>
<a name="gbab-2142"></a><span class="cp"># endif</span>
<a name="gbab-2143"></a>
<a name="gbab-2144"></a><span class="cp"># if defined(__cplusplus)</span>
<a name="gbab-2145"></a><span class="p">}</span>
<a name="gbab-2146"></a><span class="cp"># endif</span>
<a name="gbab-2147"></a>
<a name="gbab-2148"></a><span class="cp">#endif</span>
</pre></div>
</td></tr></table>